{"nodes":[{"pos":[32,94],"content":"Create a new transportation management engine | Microsoft Docs","needQuote":true,"needEscape":true,"nodes":[{"content":"Create a new transportation management engine | Microsoft Docs","pos":[0,62]}]},{"pos":[108,225],"content":"This article describes how to create a new transportation management engine in Microsoft Dynamics 365 for Operations.","needQuote":true,"needEscape":true,"nodes":[{"content":"This article describes how to create a new transportation management engine in Microsoft Dynamics 365 for Operations.","pos":[0,117]}]},{"pos":[642,687],"content":"Create a new transportation management engine","linkify":"Create a new transportation management engine","nodes":[{"content":"Create a new transportation management engine","pos":[0,45]}]},{"content":"Transportation management (TMS) engines define the logic that is used to generate and process transportation rates in Transportation management.","pos":[689,833]},{"content":"Microsoft Dynamics 365 for Operations provides several different engine types that calculate different parameters, such as rates, transit times, and the number of zones that will be crossed during transit.","pos":[834,1039]},{"content":"This article explains how to use the Microsoft Visual Studio development environment together with Dynamics 365 for Operations development tools to create and deploy a new TMS engine, and then how to set up the engine in Operations.","pos":[1040,1272]},{"content":"For more information about the engines that Dynamics 365 for Operations provides, see <bpt id=\"p1\">[</bpt>Transportation management engines<ept id=\"p1\">](http://ax.help.dynamics.com/en/wiki/transportation-management-engines/)</ept>.","pos":[1273,1467],"source":" For more information about the engines that Dynamics 365 for Operations provides, see [Transportation management engines](http://ax.help.dynamics.com/en/wiki/transportation-management-engines/)."},{"pos":[1472,1495],"content":"Create a new TMS engine","linkify":"Create a new TMS engine","nodes":[{"content":"Create a new TMS engine","pos":[0,23]}]},{"content":"This section explains how to create a class library that has a TMS engine implementation, and how to reference it from a Dynamics 365 for Operations model.","pos":[1496,1651]},{"content":"To deploy your new engines, you must have a Dynamics 365 for Operations model that will contain the engines.","pos":[1657,1765]},{"content":"On the <bpt id=\"p1\">**</bpt>Dynamics 365<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Model Management<ept id=\"p2\">**</ept> menu, click <bpt id=\"p3\">**</bpt>Create model<ept id=\"p3\">**</ept> to create a new model.","pos":[1766,1867],"source":" On the **Dynamics 365** &gt; **Model Management** menu, click **Create model** to create a new model."},{"content":"On the first page of the <bpt id=\"p1\">**</bpt>Create model<ept id=\"p1\">**</ept> wizard, name the model <bpt id=\"p2\">**</bpt>TMSEngines<ept id=\"p2\">**</ept>.","pos":[1868,1948],"source":" On the first page of the **Create model** wizard, name the model **TMSEngines**."},{"content":"![Creating a model]","pos":[1949,1968]},{"content":"On the next page, select <bpt id=\"p1\">**</bpt>Create new package<ept id=\"p1\">**</ept>.","pos":[1973,2021],"source":"On the next page, select **Create new package**."},{"content":"![Creating a new package]","pos":[2022,2047]},{"content":"On the next page, select the <bpt id=\"p1\">**</bpt>ApplicationSuite<ept id=\"p1\">**</ept> model to reference.","pos":[2052,2121],"source":"On the next page, select the **ApplicationSuite** model to reference."},{"content":"(The <bpt id=\"p1\">**</bpt>ApplicationPlatform<ept id=\"p1\">**</ept> model is preselected.) ![Selecting the model to reference]","pos":[2122,2209],"source":" (The **ApplicationPlatform** model is preselected.) ![Selecting the model to reference]"},{"content":"On the next page, click <bpt id=\"p1\">**</bpt>Finish<ept id=\"p1\">**</ept> to confirm the creation of a new model.","pos":[2214,2288],"source":"On the next page, click **Finish** to confirm the creation of a new model."},{"content":"![Completing model creation]","pos":[2289,2317]},{"content":"In a new solution, create a new Dynamics 365 for Operations project, and name it <bpt id=\"p1\">**</bpt>TMSThirdParty<ept id=\"p1\">**</ept>.","pos":[2322,2421],"source":"In a new solution, create a new Dynamics 365 for Operations project, and name it **TMSThirdParty**."},{"content":"In the project properties, set the project's model to <bpt id=\"p1\">**</bpt>TMSEngines<ept id=\"p1\">**</ept>.","pos":[2422,2491],"source":" In the project properties, set the project's model to **TMSEngines**."},{"pos":[2496,2579],"content":"Add a new C<ph id=\"ph1\">\\#</ph> class library to your solution, and name it <bpt id=\"p1\">**</bpt>ThirdPartyTMSEngines<ept id=\"p1\">**</ept>.","source":"Add a new C\\# class library to your solution, and name it **ThirdPartyTMSEngines**."},{"content":"In the ThirdPartyTMSEngines project, add references to Dynamics 365 for Operations–specific assemblies:","pos":[2584,2687]},{"content":"Application assemblies that enable X++ types to be referenced.","pos":[2696,2758]},{"content":"These assemblies can be found in the following locations.","pos":[2759,2816]},{"content":"<ph id=\"ph1\">\\[</ph>Packages root<ph id=\"ph2\">\\]</ph> is the path of the location where all the deployed Dynamics 365 for Operations assemblies are placed, such as C:<ph id=\"ph3\">\\\\</ph>Packages.","pos":[2817,2958],"source":"\\[Packages root\\] is the path of the location where all the deployed Dynamics 365 for Operations assemblies are placed, such as C:\\\\Packages."},{"content":"Framework assemblies that enable access to data, LINQ, and auxiliary functions.","pos":[3231,3310]},{"content":"All these assembles can be found in <ph id=\"ph1\">\\[</ph>Packages root<ph id=\"ph2\">\\]</ph><ph id=\"ph3\">\\\\</ph>bin.","pos":[3311,3370],"source":" All these assembles can be found in \\[Packages root\\]\\\\bin."},{"content":"The core TMS assembly (which contains engines) and the TMS base assembly (which contains helpers, constants, data transfer class definitions, and so on).","pos":[3901,4054]},{"content":"These assemblies can be found in the following locations.","pos":[4055,4112]},{"pos":[4282,4397],"content":"Rename the C<ph id=\"ph1\">\\#</ph> class that is automatically generated in the ThirdPartyTMSEngines project to <bpt id=\"p1\">**</bpt>SampleRatingEngine<ept id=\"p1\">**</ept>.","source":"Rename the C\\# class that is automatically generated in the ThirdPartyTMSEngines project to **SampleRatingEngine**."},{"content":"Implement the engine.","pos":[4402,4423]},{"content":"Because we are creating a rate engine in this example, we inherit from the base class for rate engines.","pos":[4424,4527]},{"content":"The base class implements most of the rate engine interface (<bpt id=\"p1\">**</bpt>TMSFwkIRateEngine<ept id=\"p1\">**</ept>).","pos":[4528,4612],"source":" The base class implements most of the rate engine interface (**TMSFwkIRateEngine**)."},{"content":"We just have to implement the rate method.","pos":[4613,4655]},{"content":"To keep this example simple, we will make this method register a hard-coded rate of 100.","pos":[4656,4744]},{"content":"You can create engines that implement any of the engine interfaces, such as <bpt id=\"p1\">**</bpt>TMSFwkIAccessorialEngine<ept id=\"p1\">**</ept>.","pos":[4745,4850],"source":" You can create engines that implement any of the engine interfaces, such as **TMSFwkIAccessorialEngine**."},{"content":"All the engine interfaces are defined in X++.","pos":[4851,4896]},{"content":"Build the solution.","pos":[5654,5673]},{"content":"Add a new reference to the TMSThirdParty project.","pos":[5678,5727]},{"content":"The reference should point to the ThirdPartyTMSEngines project.","pos":[5728,5791]},{"content":"When you've finished, your solution should look like this.","pos":[5792,5850]},{"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>The solution, which includes a reference to the TMSThirdParty project<ept id=\"p1\">](media/052.png)](media/052.png)</ept>","pos":[5851,5955],"source":"[![The solution, which includes a reference to the TMSThirdParty project](media/052.png)](media/052.png)"},{"content":"Build the solution.","pos":[5960,5979]},{"content":"Verify that the new library appears in the <bpt id=\"p1\">**</bpt>References<ept id=\"p1\">**</ept> node in Application Explorer.","pos":[5980,6067],"source":" Verify that the new library appears in the **References** node in Application Explorer."},{"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>The new library in Application Explorer’s References node<ept id=\"p1\">](media/061.png)](media/061.png)</ept>","pos":[6068,6160],"source":"[![The new library in Application Explorer’s References node](media/061.png)](media/061.png)"},{"pos":[6165,6199],"content":"Deploy the TMS engine as a package","linkify":"Deploy the TMS engine as a package","nodes":[{"content":"Deploy the TMS engine as a package","pos":[0,34]}]},{"content":"One way to deploy third-party TMS engines is through a deployment package.","pos":[6200,6274]},{"content":"This approach is recommended in a production environment.","pos":[6275,6332]},{"content":"In a development environment, you can manually copy the assemblies, as described in the next section, \"Set up a TMS engine in Dynamics 365 for Operations.\"","pos":[6333,6488]},{"content":"To deploy the engine as a package, follow these steps.","pos":[6489,6543]},{"pos":[6549,6631],"content":"On the <bpt id=\"p1\">**</bpt>Dynamics 365 <ept id=\"p1\">**</ept><ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Deploy<ept id=\"p2\">**</ept> menu, click <bpt id=\"p3\">**</bpt>Create Deployment Package<ept id=\"p3\">**</ept>.","source":"On the **Dynamics 365 **&gt; **Deploy** menu, click **Create Deployment Package**."},{"content":"In the <bpt id=\"p1\">**</bpt>Create Deployment Package<ept id=\"p1\">**</ept> dialog box, select the TMSEngines model, and enter the path where you want to store your package files.","pos":[6636,6776],"source":"In the **Create Deployment Package** dialog box, select the TMSEngines model, and enter the path where you want to store your package files."},{"content":"![Selecting the TMSEngines model ]","pos":[6777,6811]},{"content":"You can now deploy the package to the target environment.","pos":[6816,6873]},{"content":"For a tutorial, see <bpt id=\"p1\">[</bpt>Install a deployable package<ept id=\"p1\">](http://ax.help.dynamics.com/en/wiki/installing-deployable-package-in-ax7/)</ept>.","pos":[6874,7000],"source":" For a tutorial, see [Install a deployable package](http://ax.help.dynamics.com/en/wiki/installing-deployable-package-in-ax7/)."},{"pos":[7005,7057],"content":"Set up the TMS engine in Dynamics 365 for Operations","linkify":"Set up the TMS engine in Dynamics 365 for Operations","nodes":[{"content":"Set up the TMS engine in Dynamics 365 for Operations","pos":[0,52]}]},{"content":"This section explains how to set up Dynamics 365 for Operations to use a TMS engine, and shows how the new engine that we have created is used in rate shopping.","pos":[7058,7218]},{"content":"The example in this section uses the USMF demo data company.","pos":[7219,7279]},{"content":"Create a new engine as described in the \"Create a new TMS engine\" section.","pos":[7285,7359]},{"content":"Build your solution.","pos":[7364,7384]},{"content":"Copy the resulting assembly into the binary location of the Dynamics 365 for Operations server, <ph id=\"ph1\">\\[</ph>AOSWebRoot<ph id=\"ph2\">\\]</ph>bin.","pos":[7389,7503],"source":"Copy the resulting assembly into the binary location of the Dynamics 365 for Operations server, \\[AOSWebRoot\\]bin."},{"content":"<bpt id=\"p1\">**</bpt>Note:<ept id=\"p1\">**</ept> This step is relevant only in a development environment.","pos":[7504,7570],"source":"**Note:** This step is relevant only in a development environment."},{"content":"In a production environment, you should deploy through a deployment package.","pos":[7571,7647]},{"content":"For instructions, see the previous section, \"Deploy the TMS engine as a package.\"","pos":[7648,7729]},{"content":"In Dynamics 365 for Operations, on the <bpt id=\"p1\">**</bpt>Rate engines<ept id=\"p1\">**</ept> page, create a new rating engine.","pos":[7734,7823],"source":"In Dynamics 365 for Operations, on the **Rate engines** page, create a new rating engine."},{"content":"The engine should point to the engine assembly that is produced by building the engine class library and the engine class that you implemented.","pos":[7824,7967]},{"content":"![Creating a new rating engine on the Rate engines page]","pos":[7968,8024]},{"content":"Create a shipping carrier that uses the Sample rate engine.","pos":[8029,8088]},{"content":"Because our engine doesn't use any data in Dynamics 365 for Operations, you don’t have to assign a rate master.","pos":[8089,8200]},{"content":"![Creating a new shipping carrier ]","pos":[8201,8236]},{"content":"On the <bpt id=\"p1\">**</bpt>Rate route workbench<ept id=\"p1\">**</ept> page, click <bpt id=\"p2\">**</bpt>Rate shop<ept id=\"p2\">**</ept>.","pos":[8241,8299],"source":"On the **Rate route workbench** page, click **Rate shop**."},{"content":"You should see a rate of 100.00 from SampleCarrier, as shown in the following screen shot.","pos":[8300,8390]},{"content":"In this example, we are rate shopping for a route from warehouse 24 to customer US-004.","pos":[8391,8478]},{"content":"However, but because the rate is hard-coded, you will always see a rate of 100.00.","pos":[8479,8561]},{"content":"![Rate route workbench]","pos":[8562,8585]},{"pos":[8590,8605],"content":"Tips and tricks","linkify":"Tips and tricks","nodes":[{"content":"Tips and tricks","pos":[0,15]}]},{"content":"If you’re using development tools for Dynamics 365 for Operations, it's useful to add a new Dynamics 365 for Operations project to your solution.","pos":[8610,8755]},{"content":"If you set this project as your startup project and start a debugging session, you can debug both X++ and C<ph id=\"ph1\">\\#</ph> code in the same debugging session.","pos":[8756,8901],"source":" If you set this project as your startup project and start a debugging session, you can debug both X++ and C\\# code in the same debugging session."},{"content":"Every time that you change and recompile your ThirdPartyTMSEngines project, you must manually copy the resulting assembly to the Dynamics 365 for Operations binary location or deploy through a deployment package.","pos":[8906,9118]},{"content":"Otherwise, you might run by using a stale assembly.","pos":[9119,9170]},{"content":"After you execute TMS-specific operations in Dynamics 365 for Operations, the Internet Information Services (IIS) worker process might lock the ThirdPartyTMSEngines assembly so that the assembly can’t be updated.","pos":[9175,9387]},{"content":"In this case, restart the w3svc process.","pos":[9388,9428]}],"content":"---\n# required metadata\n\ntitle: Create a new transportation management engine | Microsoft Docs\ndescription: This article describes how to create a new transportation management engine in Microsoft Dynamics 365 for Operations. \nauthor: annbe\nmanager: AnnBe\nms.date: 2016-02-23 23:18:05\nms.topic: article\nms.prod: \nms.service: Dynamics365Operations\nms.technology: \n\n# optional metadata\n\n# keywords: \n# ROBOTS: \naudience: Developer\n# ms.devlang: \nms.reviewer: 2084\nms.suite: Released- Dynamics AX 7.0.0\n# ms.tgt_pltfrm: \nms.custom: 51661\nms.assetid: ede56f8f-2c52-483f-a028-4d9b10610a70\n# ms.region: \n# ms.industry: \nms.author: twheeloc\n\n---\n\n# Create a new transportation management engine\n\nTransportation management (TMS) engines define the logic that is used to generate and process transportation rates in Transportation management. Microsoft Dynamics 365 for Operations provides several different engine types that calculate different parameters, such as rates, transit times, and the number of zones that will be crossed during transit. This article explains how to use the Microsoft Visual Studio development environment together with Dynamics 365 for Operations development tools to create and deploy a new TMS engine, and then how to set up the engine in Operations. For more information about the engines that Dynamics 365 for Operations provides, see [Transportation management engines](http://ax.help.dynamics.com/en/wiki/transportation-management-engines/).\n\n## Create a new TMS engine\nThis section explains how to create a class library that has a TMS engine implementation, and how to reference it from a Dynamics 365 for Operations model.\n\n1.  To deploy your new engines, you must have a Dynamics 365 for Operations model that will contain the engines. On the **Dynamics 365** &gt; **Model Management** menu, click **Create model** to create a new model. On the first page of the **Create model** wizard, name the model **TMSEngines**. ![Creating a model]\n2.  On the next page, select **Create new package**. ![Creating a new package]\n3.  On the next page, select the **ApplicationSuite** model to reference. (The **ApplicationPlatform** model is preselected.) ![Selecting the model to reference]\n4.  On the next page, click **Finish** to confirm the creation of a new model. ![Completing model creation]\n5.  In a new solution, create a new Dynamics 365 for Operations project, and name it **TMSThirdParty**. In the project properties, set the project's model to **TMSEngines**.\n6.  Add a new C\\# class library to your solution, and name it **ThirdPartyTMSEngines**.\n7.  In the ThirdPartyTMSEngines project, add references to Dynamics 365 for Operations–specific assemblies:\n    -   Application assemblies that enable X++ types to be referenced. These assemblies can be found in the following locations. \\[Packages root\\] is the path of the location where all the deployed Dynamics 365 for Operations assemblies are placed, such as C:\\\\Packages.\n\n            [Packages root]\\ApplicationPlatform\\bin\\Dynamics.AX.ApplicationPlatform.dll\n            [Packages root]\\ApplicationFoundation\\bin\\Dynamics.AX.ApplicationFoundation.dll\n            [Packages root]\\ApplicationSuite\\bin\\Dynamics.AX.ApplicationSuite.dll\n\n    -   Framework assemblies that enable access to data, LINQ, and auxiliary functions. All these assembles can be found in \\[Packages root\\]\\\\bin.\n\n            Microsoft.Dynamics.ApplicationPlatform.Environment.dll\n            Microsoft.Dynamics.AX.Data.Core.dll\n            Microsoft.Dynamics.AX.Framework.Linq.Data.AdoNet.dll\n            Microsoft.Dynamics.AX.Framework.Linq.Data.dll\n            Microsoft.Dynamics.AX.Framework.Linq.Data.Interface.dll\n            Microsoft.Dynamics.AX.Framework.Linq.Data.Msil.dll\n            Microsoft.Dynamics.AX.Server.Core.dll\n            Microsoft.Dynamics.AX.Xpp.AxShared.dll\n            Microsoft.Dynamics.AX.Xpp.Support.dll\n\n    -   The core TMS assembly (which contains engines) and the TMS base assembly (which contains helpers, constants, data transfer class definitions, and so on). These assemblies can be found in the following locations.\n\n            [Packages root]\\ApplicationSuite\\bin\\Microsoft.Dynamics.AX.Tms.dll\n            [Packages root]\\ApplicationSuite\\bin\\Microsoft.Dynamics.AX.Tms.Base.dll\n\n8.  Rename the C\\# class that is automatically generated in the ThirdPartyTMSEngines project to **SampleRatingEngine**.\n9.  Implement the engine. Because we are creating a rate engine in this example, we inherit from the base class for rate engines. The base class implements most of the rate engine interface (**TMSFwkIRateEngine**). We just have to implement the rate method. To keep this example simple, we will make this method register a hard-coded rate of 100. You can create engines that implement any of the engine interfaces, such as **TMSFwkIAccessorialEngine**. All the engine interfaces are defined in X++.\n\n        namespace ThirdPartyTMSEngines\n        {\n            using Dynamics.AX.Application;\n            using Microsoft.Dynamics.Ax.Tms.Base.Data;\n            using Microsoft.Dynamics.Ax.Tms.Base.Utility;\n            using Microsoft.Dynamics.Ax.Tms.Bll;\n            using System.Xml.Linq;\n            public class SampleRatingEngine : BaseRateEngine\n            {\n                public override RatingDto rate(TmsTransactionFacade transactionFacade, XElement shipment, TMSRateMasterCode rateMasterCode)\n                {\n                    XElement re = shipment.RetrieveOrCreateRatingEntity(this.RatingDto);\n                    re.AddRate(TmsRateType.Rate, 100);\n                    return this.RatingDto;\n                }\n            }\n        }\n\n10. Build the solution.\n11. Add a new reference to the TMSThirdParty project. The reference should point to the ThirdPartyTMSEngines project. When you've finished, your solution should look like this. [![The solution, which includes a reference to the TMSThirdParty project](media/052.png)](media/052.png)\n12. Build the solution. Verify that the new library appears in the **References** node in Application Explorer. [![The new library in Application Explorer’s References node](media/061.png)](media/061.png)\n\n## Deploy the TMS engine as a package\nOne way to deploy third-party TMS engines is through a deployment package. This approach is recommended in a production environment. In a development environment, you can manually copy the assemblies, as described in the next section, \"Set up a TMS engine in Dynamics 365 for Operations.\" To deploy the engine as a package, follow these steps.\n\n1.  On the **Dynamics 365 **&gt; **Deploy** menu, click **Create Deployment Package**.\n2.  In the **Create Deployment Package** dialog box, select the TMSEngines model, and enter the path where you want to store your package files. ![Selecting the TMSEngines model ]\n3.  You can now deploy the package to the target environment. For a tutorial, see [Install a deployable package](http://ax.help.dynamics.com/en/wiki/installing-deployable-package-in-ax7/).\n\n## Set up the TMS engine in Dynamics 365 for Operations\nThis section explains how to set up Dynamics 365 for Operations to use a TMS engine, and shows how the new engine that we have created is used in rate shopping. The example in this section uses the USMF demo data company.\n\n1.  Create a new engine as described in the \"Create a new TMS engine\" section.\n2.  Build your solution.\n3.  Copy the resulting assembly into the binary location of the Dynamics 365 for Operations server, \\[AOSWebRoot\\]bin. **Note:** This step is relevant only in a development environment. In a production environment, you should deploy through a deployment package. For instructions, see the previous section, \"Deploy the TMS engine as a package.\"\n4.  In Dynamics 365 for Operations, on the **Rate engines** page, create a new rating engine. The engine should point to the engine assembly that is produced by building the engine class library and the engine class that you implemented. ![Creating a new rating engine on the Rate engines page]\n5.  Create a shipping carrier that uses the Sample rate engine. Because our engine doesn't use any data in Dynamics 365 for Operations, you don’t have to assign a rate master. ![Creating a new shipping carrier ]\n6.  On the **Rate route workbench** page, click **Rate shop**. You should see a rate of 100.00 from SampleCarrier, as shown in the following screen shot. In this example, we are rate shopping for a route from warehouse 24 to customer US-004. However, but because the rate is hard-coded, you will always see a rate of 100.00. ![Rate route workbench]\n\n## Tips and tricks\n-   If you’re using development tools for Dynamics 365 for Operations, it's useful to add a new Dynamics 365 for Operations project to your solution. If you set this project as your startup project and start a debugging session, you can debug both X++ and C\\# code in the same debugging session.\n-   Every time that you change and recompile your ThirdPartyTMSEngines project, you must manually copy the resulting assembly to the Dynamics 365 for Operations binary location or deploy through a deployment package. Otherwise, you might run by using a stale assembly.\n-   After you execute TMS-specific operations in Dynamics 365 for Operations, the Internet Information Services (IIS) worker process might lock the ThirdPartyTMSEngines assembly so that the assembly can’t be updated. In this case, restart the w3svc process.\n\n\n"}