{"content":"---\n# required metadata\n\ntitle: Prepare to migrate to Dynamics 365 for Operations\ndescription: In this topic, we will describe the LCS code upgrade service and Visual Studio tools that help you migrate your code and metadata from Dynamics AX 2012 R3 to Microsoft Dynamics 365 for Operations. Most of these steps also apply to code migration between two major versions of Dynamics 365 for Operations. \nauthor: RobinARH\nmanager: AnnBe\nms.date: 04/04/2017\nms.topic: article\nms.prod: \nms.service: dynamics-ax-platform\nms.technology: \n\n# optional metadata\n\n# ms.search.form: \n# ROBOTS: \naudience: Developer\n# ms.devlang: \n# ms.reviewer: 61\nms.search.scope: AX 7.0.0, Operations\n# ms.tgt_pltfrm: \nms.custom: 25971\nms.assetid: a911b0f2-a7b0-4643-bf5b-16e55c9397be\nms.search.region: Global\n# ms.search.industry: \nms.author: robadawy\nms.search.validFrom: 2016-02-28\nms.dyn365.ops.version: AX 7.0.0\n\n---\n\n# Prepare to migrate to Dynamics 365 for Operations\n\n[!include[banner](../includes/banner.md)]\n\n\nIn this topic, we will describe the LCS code upgrade service and Visual Studio tools that help you migrate your code and metadata from Dynamics AX 2012 R3 to Microsoft Dynamics 365 for Operations. Most of these steps also apply to code migration between two major versions of Dynamics 365 for Operations. \n\nPrerequisites\n-------------\n\nYou will need access to a Dynamics 365 for Operations development environment using Remote Desktop, and be provisioned as an administrator on the instance. We recommend you become familiar with some of the Dynamics 365 for Operation development, customization and user interface concepts before you upgrade your code. Here are some references.\n\n-   [Development tools](..\\dev-tools\\developer-home-page.md)\n-   [Models and packages](..\\dev-tools\\models.md)\n-   [X++ programming language](..\\dev-ref\\xpp-language-reference.md)\n-   [Extensions and Overlayering](..\\extensibility\\extensibility-home-page.md)\n-   [User interface development](..\\user-interface\\user-interface-development-home-page.md)\n\n## Overview of the code migration process\n### Model split\n\nThe Dynamics 365 for Operations application is split into several packages, or assemblies: Platform Packages\n\n-   Application Platform\n-   Application Foundation\n-   Test Essentials\n\nApplication Packages\n\n-   Application Suite\n-   Other application packages.\n\nISV and customer code that is migrated from Dynamics AX 2012 R3 will be re-baselined into the correct package.\n\n### Auto-migration using the LCS Code Upgrade service\n\nThe LCS code upgrade service takes a Dynamics AX 2012 R3 model store as input and completes the following tasks:\n\n-   Converts metadata into the latest format.\n-   Re-baselines metadata, by moving and merging, into the right model.\n-   Provides an estimation to understand the effort required to upgrade the solution.\n-   Runs migration rules that auto-migrate parts of a solution.\n-   Runs migration rules that inform developers what to manually fix by using TODOs.\n-   Automatically checks-in the upgraded solution into your Visual Studio Team Services (VSTS) project.\n\nTo configure and run the code upgrade service, see [Configure and execute the code upgrade service in Lifecycle Services](..\\lifecycle-services\\configure-execute-code-upgrade.md).\n\n### Manual migration steps\n\nAfter you upgrade your code using the LCS code upgrade service configure your developer VM and VSTS to connect to the upgraded code branch.\n\n-   [Configure your developer VM](..\\dev-tools\\configure-developer-vm.md)\n-   [Configure VSTS](configure-vso-solution.md)\n\nThe code upgrade service will provide with Visual Studio solutions that you can open to compile your code. A **code merge** solution for all elements that contain conflicts and an **upgraded** solutions for all your upgraded elements. Typically, you can compile the application by fixing compilation errors in the order shown below. The order is determined based on the package dependencies graph, start with the lowest package in the graph. To determine package dependencies, see [Models](..\\dev-tools\\models.md). A typical order is Application Platform, Application Foundation, Directory, ...etc., Application Suite. For each of your upgraded models:\n\n-   Fix merge conflicts.\n-   Fix compilation errors related to a model split (references across packages).\n    -   Typical error messages are:\n        -   &lt;Element Type&gt; X refers to &lt;Element Type&gt; Y which does not exist.\n        -   The name &lt;Name&gt; does not denote a class, a table or an extended data type.\n    -   For example, your overlayering customizations may be referencing elements or code that are higher in the package dependency graph:\n        -   A method in the Directory model is referencing a table in the Application Suite package.\n        -   A form in the Directory package is referencing a data source in the Application Suite package.\n    -   You will have to refactor your code to address these dependencies by moving model elements or business logic to higher level packages.\n    -   [Delegates for Migration](delegates-migration.md) describes how to use delegates to solve some of these issues.\n-   Fix compilation errors.\n\nAfter you have resolved all of the compilation errors, all packages will compile. Next, you must complete the following tasks:\n\n1.  Address guided code upgrade TODOs and code upgrade-specific best practice warnings. Some examples and details are in the sections below.\n2.  Replace deprecated controls, for example, ActiveX or find an alternative.\n3.  Apply form patterns and sub patterns to all forms.\n4.  Validate that all scenarios work in multiple browsers with different sizes for custom patterns.\n5.  Write and run tests.\n\nFor more information, see [Resolve Conflicts Using Visual Studio Tools (Office Mix)](https://mix.office.com/watch/1rl75ei2cs6d7).\n\n## Best practice setup\nIn the Best Practice framework, there is a subset of Best Practice warnings that need to be resolved to complete migration. This applies if you are migrating from Dynamics AX 2012 R3 or earlier.\n\n1.  In Visual Studio, click **Dynamics 365 &gt; Options &gt; Best Practices**.\n2.  In the **Model** drop-down menu, select **Application Suite** (Repeat with all models you are working on)\n\nThese rules should be set to “ON” while migrating your solution. The setting is driven by an XML file in the AxRuleSet folder. For example, see the Application Suite xml file, BPRules.xml, located under C:\\\\Packages\\\\ApplicationSuite\\\\Foundation\\\\AxRuleSet. [![bpupgraderules](./media/bpupgraderules.png)](./media/bpupgraderules.png) To complete the migration, you need to fix all migration-specific Best Practice rules. The errors will show up in the error list as warnings. In the error list, you will see compiler warnings and best practice errors. Best Practice errors are prefixed with the text **BP**. For example, **BPErrorFormControlPatternUnspecified**.\n\n## Debugging\nBy default, Dynamics 365 for Operations optimizes the debugging experience for the files that you are working on. As a result, when you step into a file (F11) that is not in your project, the PDBs are not loaded and you can’t debug the code. To work around this, change the project debugging setting by clicking **Dynamics 365 **&gt; **Options** &gt; **Debugging**. Verify that the **Load symbols only for items in the solution** check box is not selected. This option is selected by default because it improves the debugger speed significantly. Another debugging setting that you may want to turn off is Intellitrace. Intellitrace collects the complete execution history of an application. It creates a lot of noise in the IDE when debugging. To turn off Intellitrace, click **Options** &gt; **IntelliTrace** &gt; **Enable IntelliTrace**, clear the check box, and then click **OK**. Note that Intellitrace is only available in the Enterprise version of Visual Studio.  \n\n## Address code migration tasks\nWhen metadata is migrated to Dynamics 365 for Operations, multiple auto-upgrade scripts are run. In the case where developers need to complete manual migration tasks, TO DOs and Best Practices (BP) have been added.\n\n-   TO DOs are prefixed with */\\* TODO: (Code Upgrade)*, and need to be fixed as a part of code migration.\n-   BP migration specific rules also need to be fixed as part of code migration.\n\nThis example below uses the **PurchCommitment\\_PSN** form to walk you through the migration task of fixing navigation. Specifically, you will see examples of duplicate buttons and Action Pane TODOs.\n\n### Setup\n\n1.  In Visual Studio, open **Application Explorer**, and search for the form, PurchCommitment\\_PSN.\n2.  Click **OK**.\n3.  Right-click the project and select **Properties**.\n4.  In the Model property, select **Application Suite**.\n5.  In the Company property, select FRSI.\n6.  Note: The form is located in the French demo data company FRSI.\n7.  Press **Ctrl+F5 to** see the form.\n\nWhile the form looks complete, there are still code migration tasks necessary to be migration-complete. [![i](./media/i1.png)](./media/i1.png)\n\n### Navigation migration tasks\n\n1.  In Visual Studio, build the project, and then on the toolbar, click **View** &gt; **Task List**.\n2.  Click the **Comments** drop-down list to view the TO DO: (Code Upgrade) tasks.\n3.  In the list, find the ActionPane TODOs.\n\n[![j](./media/j1.png)](./media/j1.png)\n\n### Code upgrade rule - Action Pane\n\nIn Dynamics 365 for Operations, the following core actions are provided as system-defined buttons:\n\n-   New\n-   Delete\n-   Edit\n-   Export\n\nAs part of the auto-migration, the Action Pane rule is run to identify redundant buttons. To complete this part of migration, you need to manually:\n\n-   Remove or move the code.\n-   Delete redundant controls in the application code.\n\n**Note**: In the section below, we will provide examples of how to migrate and modify the code on modeled buttons that replicate system-defined buttons. However, in practice, before making changes similar to those made in this article, the code must first be evaluated with respect to the scenario to determine if it is still needed. First, fix the TODO for the DeleteCmdButton, which duplicates the system-defined Delete button.\n\n1.  In Visual Studio, find the TODO shown below, and then double-click the TODO.[![k](./media/k1.png)](./media/k1.png)\n2.  Replace the TODO and the line of code as shown below.\n    -   The state of the system-defined **Delete** button is controlled by the AllowDelete property on the firstmaster datasource. By setting AllowDelete to false, the delete task is kept from executing when the keyboard shortcut is used.\n\n            // Delete button\n            /* TODO: (Code Upgrade) [Action Pane Rule] Please consider moving all references to the form task override method and remove the control: DeleteCmdButton */\n            deleteCmdButton.enabled(purchCommitmentHeader && purchCommitmentHeader.canDelete());\n            PurchCommitmentHeader_DS.allowDelete(purchCommitmentHeader && purchCommitmentHeader.canDelete());\n\n3.  In the editor, find and remove DeleteCmdButton from the form design. [![l](./media/l1.png)](./media/l1.png)\n4.  Press **Ctrl+S to** save the form.\n    -   Next, we will focus on the EditCmdButton that duplicates the system Edit button, handing the two TODOs associated with this button as well as removing this button.\n\n5.  In Visual Studio, find the TODO shown below, and then double-clickthe TODO.[![m](./media/m1.png)](./media/m1.png)\n6.  Because the visibility of the **Edit** button is controlled by the View/Edit mode of the form, you will need to modify this code so it sets that property. Replace the TODO and the line of code as shown in the following graphic.\n\n        /* TODO: (Code Upgrade) [Action Pane Rule] Please consider moving all references to the form task override method and remove the control: EditCmdButton */\n        editCmdButton.enabled(purchCommitmentHeader && isInDraftOrUnderRevisionStatus && !isInWorkFlowReviewState && !isLineReferenced);\n\n        if(purchCommitmentHeader && isInDraftOrUnderRevisionStatus && !isInWorkFlowReviewState && !isLineReferenced)\n        {\n            element.design().ViewEditMode(ViewEditMode::Auto);\n        }\n        else\n        {\n            element.design().ViewEditMode(ViewEditMode::View);\n\n        }\n\n7.   Double-click the other TODO for this button.[![n](./media/n1.png)](./media/n1.png)\n8.  Inspect the code on the modeled **Edit** button. This logic will need to be moved to the form’s task() method.\n\n        [Control(\"CommandButton\")]\n        class EditCmdButton\n        {\n            /* TODO: (Code Upgrade) [Action Pane Rule] Please consider moving this button code to the task override method and remove the control EditCmdButton. */\n            void clicked()\n            {\n                if (purchCommitmentHeader.WorkflowApprovalState ==     \n                    PurchCommitmentWorkflowApprovalState_PSN::Approved)\n                {\n                    if (Box::yesNo(strFmt(\"@SPS2140\", purchCommitmentHeader.CommitmentNumber), \n                        DialogButton::No) == DialogButton::Yes)\n                    {\n                        super();\n\n                        PurchCommitmentHeader_PSN::setWorkflowState(purchCommitmentHeader.RecId, \n                          PurchCommitmentWorkflowApprovalState_PSN::NotSubmitted);\n                    }\n                }\n                else\n                {\n                    super();\n                }\n            }\n        }\n\n9.  On the left side of the Visual Studio designer, right-click **Methods** &gt; **Override**, and select **Task**, to add an override for the form’s Task method.\n10. Update the task method as shown below so that the code from above is triggered when the system-defined **Edit** button is clicked.\n\n        /// \n            ///\n            /// \n            /// \n            /// \n            public int task(int _taskId)\n            {\n                #Task\n                int ret;\n\n                switch (_taskId)\n                {\n                    case #taskEditRecord:\n\n                        if (purchCommitmentHeader.WorkflowApprovalState == PurchCommitmentWorkflowApprovalState_PSN::Approved)\n                        {\n                            if (Box::yesNo(strFmt(\"@SPS2140\", purchCommitmentHeader.CommitmentNumber), DialogButton::No) == DialogButton::Yes)\n                            {\n                                ret = super(_taskId);\n\n                                PurchCommitmentHeader_PSN::setWorkflowState(purchCommitmentHeader.RecId, PurchCommitmentWorkflowApprovalState_PSN::NotSubmitted);\n                            }\n                        }\n                        else\n                        {\n                            ret = super(_taskId);\n                        }\n\n                        break;\n                    \n                    default:\n                        ret = super(_taskId);\n                        break;\n                }\n            \n                return ret;\n            }\n\n11. In the Editor, find and remove the **EditCmdButton** from the form design. [![o](./media/o1.png)](./media/o1.png)\n12. Press **Ctrl+S** to save the form.\n13. Press **Ctrl+F5** to view the form. Notice the **Delete** and **Edit** buttons in the **Commitment** tab have been removed.\n\n## Resolve casting exceptions\nIn Dynamics 365 for Operations, X++ is completely intermediate-language (IL) based and therefore has a stricter runtime type behavior than the interpreted Dynamics AX2 012. This stricter runtime type behavior can generate exceptions in migrated Dynamics AX 2012 R3 metadata. It is likely you will encounter these exceptions during your migration. The casting exceptions can be raised in different runtime scenarios, such as down-casting, casting runtime to design time objects, and side-casting. In the section below, we will walk through an example where a form, CosJournalName, is generating controls at runtime, and has a type mismatch which causes a .NET exception because it is strongly typed.\n\n### Example: Side-casting exception\n\n1.  In Visual Studio, select and right-click **Project Properties**, and verify that USMF is the default company.\n2.  Add the display menu item CosJournalName to your project, and set the menu item as your Startup object.\n3.  Add the CosJournalName form to your project.\n4.  Add the cosDimCheckBoxController class to your project.\n5.  Rebuild your project.\n6.  Press **Ctrl+F5** to run the form.\n7.  Note that you will get an exception, similar to the following, when running the form.[![u](./media/u1.png)](./media/u1.png)\n8.  Right-click the class, cosDimCheckBoxController, and then select **View Code**.\n9.  Set a breakpoint on the cosDimCheckBoxController::getBuildControl().\n10. Press **F5**.\n    -   The breakpoint will be hit. This is where the casting error occurs. The reason for the casting error is because we are trying to return a control of type: FormBuildCheckboxControl and the object is expecting FormBuildStringControl.\n\n11. Hover over the buildcontrol to see the type and notice the differences.[![v](./media/v1.png)](./media/v1.png)\n12. Press **F10** to hit the exception.[![w](./media/w2.png)](./media/w2.png)\n13. Stop debugging.\n14. To fix the exception, change the method declaration from FormBuildStringControl to FormBuildCheckBoxControl.\n\n        protected FormBuildStringControl getBuildControl()\n        protected FormBuildCheckBoxControl getBuildControl()\n\n15. Rebuild the project, and press **Ctrl+F5**. The form should open successfully because the casting error is resolved.\n\n[![a](./media/a-1024x576.png)](./media/a.png)\n\n## Migrating context menus and mouse doubleclick code\nRefer to these topics to migrate code Dynamics AX 2012 that deals with context menus and mouse double-click actions.\n\n-   [Context menus](code-migration-context-menus.md)\n-   [Mouse double-click](code-migration-double-click.md)\n\n\n\n\n","nodes":[{"pos":[32,81],"content":"Prepare to migrate to Dynamics 365 for Operations","needQuote":true,"needEscape":true,"nodes":[{"content":"Prepare to migrate to Dynamics 365 for Operations","pos":[0,49]}]},{"pos":[95,399],"content":"In this topic, we will describe the LCS code upgrade service and Visual Studio tools that help you migrate your code and metadata from Dynamics AX 2012 R3 to Microsoft Dynamics 365 for Operations. Most of these steps also apply to code migration between two major versions of Dynamics 365 for Operations.","needQuote":true,"needEscape":true,"nodes":[{"content":"In this topic, we will describe the LCS code upgrade service and Visual Studio tools that help you migrate your code and metadata from Dynamics AX 2012 R3 to Microsoft Dynamics 365 for Operations. Most of these steps also apply to code migration between two major versions of Dynamics 365 for Operations.","pos":[0,304],"nodes":[{"content":"In this topic, we will describe the LCS code upgrade service and Visual Studio tools that help you migrate your code and metadata from Dynamics AX 2012 R3 to Microsoft Dynamics 365 for Operations.","pos":[0,196]},{"content":"Most of these steps also apply to code migration between two major versions of Dynamics 365 for Operations.","pos":[197,304]}]}]},{"pos":[897,946],"content":"Prepare to migrate to Dynamics 365 for Operations","linkify":"Prepare to migrate to Dynamics 365 for Operations","nodes":[{"content":"Prepare to migrate to Dynamics 365 for Operations","pos":[0,49]}]},{"content":"In this topic, we will describe the LCS code upgrade service and Visual Studio tools that help you migrate your code and metadata from Dynamics AX 2012 R3 to Microsoft Dynamics 365 for Operations.","pos":[992,1188]},{"content":"Most of these steps also apply to code migration between two major versions of Dynamics 365 for Operations.","pos":[1189,1296]},{"pos":[1299,1312],"content":"Prerequisites","linkify":"Prerequisites","nodes":[{"content":"Prerequisites","pos":[0,13]}]},{"content":"You will need access to a Dynamics 365 for Operations development environment using Remote Desktop, and be provisioned as an administrator on the instance.","pos":[1328,1483]},{"content":"We recommend you become familiar with some of the Dynamics 365 for Operation development, customization and user interface concepts before you upgrade your code.","pos":[1484,1645]},{"content":"Here are some references.","pos":[1646,1671]},{"pos":[1677,1733],"content":"<bpt id=\"p1\">[</bpt>Development tools<ept id=\"p1\">](..\\dev-tools\\developer-home-page.md)</ept>","source":"[Development tools](..\\dev-tools\\developer-home-page.md)"},{"pos":[1738,1783],"content":"<bpt id=\"p1\">[</bpt>Models and packages<ept id=\"p1\">](..\\dev-tools\\models.md)</ept>","source":"[Models and packages](..\\dev-tools\\models.md)"},{"pos":[1788,1852],"content":"<bpt id=\"p1\">[</bpt>X++ programming language<ept id=\"p1\">](..\\dev-ref\\xpp-language-reference.md)</ept>","source":"[X++ programming language](..\\dev-ref\\xpp-language-reference.md)"},{"pos":[1857,1931],"content":"<bpt id=\"p1\">[</bpt>Extensions and Overlayering<ept id=\"p1\">](..\\extensibility\\extensibility-home-page.md)</ept>","source":"[Extensions and Overlayering](..\\extensibility\\extensibility-home-page.md)"},{"pos":[1936,2023],"content":"<bpt id=\"p1\">[</bpt>User interface development<ept id=\"p1\">](..\\user-interface\\user-interface-development-home-page.md)</ept>","source":"[User interface development](..\\user-interface\\user-interface-development-home-page.md)"},{"pos":[2028,2066],"content":"Overview of the code migration process","linkify":"Overview of the code migration process","nodes":[{"content":"Overview of the code migration process","pos":[0,38]}]},{"pos":[2071,2082],"content":"Model split","linkify":"Model split","nodes":[{"content":"Model split","pos":[0,11]}]},{"content":"The Dynamics 365 for Operations application is split into several packages, or assemblies: Platform Packages","pos":[2084,2192]},{"content":"Application Platform","pos":[2198,2218]},{"content":"Application Foundation","pos":[2223,2245]},{"content":"Test Essentials","pos":[2250,2265]},{"content":"Application Packages","pos":[2267,2287]},{"content":"Application Suite","pos":[2293,2310]},{"content":"Other application packages.","pos":[2315,2342]},{"content":"ISV and customer code that is migrated from Dynamics AX 2012 R3 will be re-baselined into the correct package.","pos":[2344,2454]},{"pos":[2460,2509],"content":"Auto-migration using the LCS Code Upgrade service","linkify":"Auto-migration using the LCS Code Upgrade service","nodes":[{"content":"Auto-migration using the LCS Code Upgrade service","pos":[0,49]}]},{"content":"The LCS code upgrade service takes a Dynamics AX 2012 R3 model store as input and completes the following tasks:","pos":[2511,2623]},{"content":"Converts metadata into the latest format.","pos":[2629,2670]},{"content":"Re-baselines metadata, by moving and merging, into the right model.","pos":[2675,2742]},{"content":"Provides an estimation to understand the effort required to upgrade the solution.","pos":[2747,2828]},{"content":"Runs migration rules that auto-migrate parts of a solution.","pos":[2833,2892]},{"content":"Runs migration rules that inform developers what to manually fix by using TODOs.","pos":[2897,2977]},{"content":"Automatically checks-in the upgraded solution into your Visual Studio Team Services (VSTS) project.","pos":[2982,3081]},{"pos":[3083,3262],"content":"To configure and run the code upgrade service, see <bpt id=\"p1\">[</bpt>Configure and execute the code upgrade service in Lifecycle Services<ept id=\"p1\">](..\\lifecycle-services\\configure-execute-code-upgrade.md)</ept>.","source":"To configure and run the code upgrade service, see [Configure and execute the code upgrade service in Lifecycle Services](..\\lifecycle-services\\configure-execute-code-upgrade.md)."},{"pos":[3268,3290],"content":"Manual migration steps","linkify":"Manual migration steps","nodes":[{"content":"Manual migration steps","pos":[0,22]}]},{"content":"After you upgrade your code using the LCS code upgrade service configure your developer VM and VSTS to connect to the upgraded code branch.","pos":[3292,3431]},{"pos":[3437,3506],"content":"<bpt id=\"p1\">[</bpt>Configure your developer VM<ept id=\"p1\">](..\\dev-tools\\configure-developer-vm.md)</ept>","source":"[Configure your developer VM](..\\dev-tools\\configure-developer-vm.md)"},{"pos":[3511,3554],"content":"<bpt id=\"p1\">[</bpt>Configure VSTS<ept id=\"p1\">](configure-vso-solution.md)</ept>","source":"[Configure VSTS](configure-vso-solution.md)"},{"content":"The code upgrade service will provide with Visual Studio solutions that you can open to compile your code.","pos":[3556,3662]},{"content":"A <bpt id=\"p1\">**</bpt>code merge<ept id=\"p1\">**</ept> solution for all elements that contain conflicts and an <bpt id=\"p2\">**</bpt>upgraded<ept id=\"p2\">**</ept> solutions for all your upgraded elements.","pos":[3663,3790],"source":" A **code merge** solution for all elements that contain conflicts and an **upgraded** solutions for all your upgraded elements."},{"content":"Typically, you can compile the application by fixing compilation errors in the order shown below.","pos":[3791,3888]},{"content":"The order is determined based on the package dependencies graph, start with the lowest package in the graph.","pos":[3889,3997]},{"content":"To determine package dependencies, see <bpt id=\"p1\">[</bpt>Models<ept id=\"p1\">](..\\dev-tools\\models.md)</ept>.","pos":[3998,4070],"source":" To determine package dependencies, see [Models](..\\dev-tools\\models.md)."},{"content":"A typical order is Application Platform, Application Foundation, Directory, ...etc., Application Suite.","pos":[4071,4174]},{"content":"For each of your upgraded models:","pos":[4175,4208]},{"content":"Fix merge conflicts.","pos":[4214,4234]},{"content":"Fix compilation errors related to a model split (references across packages).","pos":[4239,4316]},{"content":"Typical error messages are:","pos":[4325,4352]},{"content":"<ph id=\"ph1\">&amp;lt;</ph>Element Type<ph id=\"ph2\">&amp;gt;</ph> X refers to <ph id=\"ph3\">&amp;lt;</ph>Element Type<ph id=\"ph4\">&amp;gt;</ph> Y which does not exist.","pos":[4365,4442],"source":"&lt;Element Type&gt; X refers to &lt;Element Type&gt; Y which does not exist."},{"content":"The name <ph id=\"ph1\">&amp;lt;</ph>Name<ph id=\"ph2\">&amp;gt;</ph> does not denote a class, a table or an extended data type.","pos":[4455,4535],"source":"The name &lt;Name&gt; does not denote a class, a table or an extended data type."},{"content":"For example, your overlayering customizations may be referencing elements or code that are higher in the package dependency graph:","pos":[4544,4674]},{"content":"A method in the Directory model is referencing a table in the Application Suite package.","pos":[4687,4775]},{"content":"A form in the Directory package is referencing a data source in the Application Suite package.","pos":[4788,4882]},{"content":"You will have to refactor your code to address these dependencies by moving model elements or business logic to higher level packages.","pos":[4891,5025]},{"pos":[5034,5145],"content":"<bpt id=\"p1\">[</bpt>Delegates for Migration<ept id=\"p1\">](delegates-migration.md)</ept> describes how to use delegates to solve some of these issues.","source":"[Delegates for Migration](delegates-migration.md) describes how to use delegates to solve some of these issues."},{"content":"Fix compilation errors.","pos":[5150,5173]},{"content":"After you have resolved all of the compilation errors, all packages will compile.","pos":[5175,5256]},{"content":"Next, you must complete the following tasks:","pos":[5257,5301]},{"content":"Address guided code upgrade TODOs and code upgrade-specific best practice warnings.","pos":[5307,5390]},{"content":"Some examples and details are in the sections below.","pos":[5391,5443]},{"content":"Replace deprecated controls, for example, ActiveX or find an alternative.","pos":[5448,5521]},{"content":"Apply form patterns and sub patterns to all forms.","pos":[5526,5576]},{"content":"Validate that all scenarios work in multiple browsers with different sizes for custom patterns.","pos":[5581,5676]},{"content":"Write and run tests.","pos":[5681,5701]},{"pos":[5703,5832],"content":"For more information, see <bpt id=\"p1\">[</bpt>Resolve Conflicts Using Visual Studio Tools (Office Mix)<ept id=\"p1\">](https://mix.office.com/watch/1rl75ei2cs6d7)</ept>.","source":"For more information, see [Resolve Conflicts Using Visual Studio Tools (Office Mix)](https://mix.office.com/watch/1rl75ei2cs6d7)."},{"pos":[5837,5856],"content":"Best practice setup","linkify":"Best practice setup","nodes":[{"content":"Best practice setup","pos":[0,19]}]},{"content":"In the Best Practice framework, there is a subset of Best Practice warnings that need to be resolved to complete migration.","pos":[5857,5980]},{"content":"This applies if you are migrating from Dynamics AX 2012 R3 or earlier.","pos":[5981,6051]},{"pos":[6057,6131],"content":"In Visual Studio, click <bpt id=\"p1\">**</bpt>Dynamics 365 <ph id=\"ph1\">&amp;gt;</ph> Options <ph id=\"ph2\">&amp;gt;</ph> Best Practices<ept id=\"p1\">**</ept>.","source":"In Visual Studio, click **Dynamics 365 &gt; Options &gt; Best Practices**."},{"pos":[6136,6241],"content":"In the <bpt id=\"p1\">**</bpt>Model<ept id=\"p1\">**</ept> drop-down menu, select <bpt id=\"p2\">**</bpt>Application Suite<ept id=\"p2\">**</ept> (Repeat with all models you are working on)","source":"In the **Model** drop-down menu, select **Application Suite** (Repeat with all models you are working on)"},{"content":"These rules should be set to “ON” while migrating your solution.","pos":[6243,6307]},{"content":"The setting is driven by an XML file in the AxRuleSet folder.","pos":[6308,6369]},{"content":"For example, see the Application Suite xml file, BPRules.xml, located under C:<ph id=\"ph1\">\\\\</ph>Packages<ph id=\"ph2\">\\\\</ph>ApplicationSuite<ph id=\"ph3\">\\\\</ph>Foundation<ph id=\"ph4\">\\\\</ph>AxRuleSet.","pos":[6370,6500],"source":" For example, see the Application Suite xml file, BPRules.xml, located under C:\\\\Packages\\\\ApplicationSuite\\\\Foundation\\\\AxRuleSet."},{"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>bpupgraderules<ept id=\"p1\">](./media/bpupgraderules.png)](./media/bpupgraderules.png)</ept> To complete the migration, you need to fix all migration-specific Best Practice rules.","pos":[6501,6663],"source":"[![bpupgraderules](./media/bpupgraderules.png)](./media/bpupgraderules.png) To complete the migration, you need to fix all migration-specific Best Practice rules."},{"content":"The errors will show up in the error list as warnings.","pos":[6664,6718]},{"content":"In the error list, you will see compiler warnings and best practice errors.","pos":[6719,6794]},{"content":"Best Practice errors are prefixed with the text <bpt id=\"p1\">**</bpt>BP<ept id=\"p1\">**</ept>.","pos":[6795,6850],"source":" Best Practice errors are prefixed with the text **BP**."},{"content":"For example, <bpt id=\"p1\">**</bpt>BPErrorFormControlPatternUnspecified<ept id=\"p1\">**</ept>.","pos":[6851,6905],"source":" For example, **BPErrorFormControlPatternUnspecified**."},{"pos":[6910,6919],"content":"Debugging","linkify":"Debugging","nodes":[{"content":"Debugging","pos":[0,9]}]},{"content":"By default, Dynamics 365 for Operations optimizes the debugging experience for the files that you are working on.","pos":[6920,7033]},{"content":"As a result, when you step into a file (F11) that is not in your project, the PDBs are not loaded and you can’t debug the code.","pos":[7034,7161]},{"content":"To work around this, change the project debugging setting by clicking **Dynamics 365 **<ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p1\">**</bpt>Options<ept id=\"p1\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Debugging<ept id=\"p2\">**</ept>.","pos":[7162,7285],"source":" To work around this, change the project debugging setting by clicking **Dynamics 365 **&gt; **Options** &gt; **Debugging**."},{"content":"Verify that the <bpt id=\"p1\">**</bpt>Load symbols only for items in the solution<ept id=\"p1\">**</ept> check box is not selected.","pos":[7286,7376],"source":" Verify that the **Load symbols only for items in the solution** check box is not selected."},{"content":"This option is selected by default because it improves the debugger speed significantly.","pos":[7377,7465]},{"content":"Another debugging setting that you may want to turn off is Intellitrace.","pos":[7466,7538]},{"content":"Intellitrace collects the complete execution history of an application.","pos":[7539,7610]},{"content":"It creates a lot of noise in the IDE when debugging.","pos":[7611,7663]},{"content":"To turn off Intellitrace, click <bpt id=\"p1\">**</bpt>Options<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>IntelliTrace<ept id=\"p2\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>Enable IntelliTrace<ept id=\"p3\">**</ept>, clear the check box, and then click <bpt id=\"p4\">**</bpt>OK<ept id=\"p4\">**</ept>.","pos":[7664,7803],"source":" To turn off Intellitrace, click **Options** &gt; **IntelliTrace** &gt; **Enable IntelliTrace**, clear the check box, and then click **OK**."},{"content":"Note that Intellitrace is only available in the Enterprise version of Visual Studio.","pos":[7804,7888]},{"pos":[7895,7923],"content":"Address code migration tasks","linkify":"Address code migration tasks","nodes":[{"content":"Address code migration tasks","pos":[0,28]}]},{"content":"When metadata is migrated to Dynamics 365 for Operations, multiple auto-upgrade scripts are run.","pos":[7924,8020]},{"content":"In the case where developers need to complete manual migration tasks, TO DOs and Best Practices (BP) have been added.","pos":[8021,8138]},{"pos":[8144,8246],"content":"TO DOs are prefixed with <bpt id=\"p1\">*</bpt><ph id=\"ph1\">/</ph><ph id=\"ph2\">\\*</ph> TODO: (Code Upgrade)<ept id=\"p1\">*</ept>, and need to be fixed as a part of code migration.","source":"TO DOs are prefixed with */\\* TODO: (Code Upgrade)*, and need to be fixed as a part of code migration."},{"content":"BP migration specific rules also need to be fixed as part of code migration.","pos":[8251,8327]},{"content":"This example below uses the <bpt id=\"p1\">**</bpt>PurchCommitment<ph id=\"ph1\">\\_</ph>PSN<ept id=\"p1\">**</ept> form to walk you through the migration task of fixing navigation.","pos":[8329,8447],"source":"This example below uses the **PurchCommitment\\_PSN** form to walk you through the migration task of fixing navigation."},{"content":"Specifically, you will see examples of duplicate buttons and Action Pane TODOs.","pos":[8448,8527]},{"pos":[8533,8538],"content":"Setup","linkify":"Setup","nodes":[{"content":"Setup","pos":[0,5]}]},{"pos":[8544,8639],"content":"In Visual Studio, open <bpt id=\"p1\">**</bpt>Application Explorer<ept id=\"p1\">**</ept>, and search for the form, PurchCommitment<ph id=\"ph1\">\\_</ph>PSN.","source":"In Visual Studio, open **Application Explorer**, and search for the form, PurchCommitment\\_PSN."},{"pos":[8644,8657],"content":"Click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept>.","source":"Click **OK**."},{"pos":[8662,8712],"content":"Right-click the project and select <bpt id=\"p1\">**</bpt>Properties<ept id=\"p1\">**</ept>.","source":"Right-click the project and select **Properties**."},{"pos":[8717,8769],"content":"In the Model property, select <bpt id=\"p1\">**</bpt>Application Suite<ept id=\"p1\">**</ept>.","source":"In the Model property, select **Application Suite**."},{"content":"In the Company property, select FRSI.","pos":[8774,8811]},{"content":"Note: The form is located in the French demo data company FRSI.","pos":[8816,8879]},{"pos":[8884,8918],"content":"Press <bpt id=\"p1\">**</bpt>Ctrl+F5 to<ept id=\"p1\">**</ept> see the form.","source":"Press **Ctrl+F5 to** see the form."},{"content":"While the form looks complete, there are still code migration tasks necessary to be migration-complete.","pos":[8920,9023]},{"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>i<ept id=\"p1\">](./media/i1.png)](./media/i1.png)</ept>","pos":[9024,9062],"source":"[![i](./media/i1.png)](./media/i1.png)"},{"pos":[9068,9094],"content":"Navigation migration tasks","linkify":"Navigation migration tasks","nodes":[{"content":"Navigation migration tasks","pos":[0,26]}]},{"pos":[9100,9196],"content":"In Visual Studio, build the project, and then on the toolbar, click <bpt id=\"p1\">**</bpt>View<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Task List<ept id=\"p2\">**</ept>.","source":"In Visual Studio, build the project, and then on the toolbar, click **View** &gt; **Task List**."},{"pos":[9201,9279],"content":"Click the <bpt id=\"p1\">**</bpt>Comments<ept id=\"p1\">**</ept> drop-down list to view the TO DO: (Code Upgrade) tasks.","source":"Click the **Comments** drop-down list to view the TO DO: (Code Upgrade) tasks."},{"content":"In the list, find the ActionPane TODOs.","pos":[9284,9323]},{"pos":[9325,9363],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>j<ept id=\"p1\">](./media/j1.png)](./media/j1.png)</ept>","source":"[![j](./media/j1.png)](./media/j1.png)"},{"pos":[9369,9400],"content":"Code upgrade rule - Action Pane","linkify":"Code upgrade rule - Action Pane","nodes":[{"content":"Code upgrade rule - Action Pane","pos":[0,31]}]},{"content":"In Dynamics 365 for Operations, the following core actions are provided as system-defined buttons:","pos":[9402,9500]},{"content":"New","pos":[9506,9509]},{"content":"Delete","pos":[9514,9520]},{"content":"Edit","pos":[9525,9529]},{"content":"Export","pos":[9534,9540]},{"content":"As part of the auto-migration, the Action Pane rule is run to identify redundant buttons.","pos":[9542,9631]},{"content":"To complete this part of migration, you need to manually:","pos":[9632,9689]},{"content":"Remove or move the code.","pos":[9695,9719]},{"content":"Delete redundant controls in the application code.","pos":[9724,9774]},{"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>: In the section below, we will provide examples of how to migrate and modify the code on modeled buttons that replicate system-defined buttons.","pos":[9776,9928],"source":"**Note**: In the section below, we will provide examples of how to migrate and modify the code on modeled buttons that replicate system-defined buttons."},{"content":"However, in practice, before making changes similar to those made in this article, the code must first be evaluated with respect to the scenario to determine if it is still needed.","pos":[9929,10109]},{"content":"First, fix the TODO for the DeleteCmdButton, which duplicates the system-defined Delete button.","pos":[10110,10205]},{"pos":[10211,10325],"content":"In Visual Studio, find the TODO shown below, and then double-click the TODO.<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>k<ept id=\"p1\">](./media/k1.png)](./media/k1.png)</ept>","source":"In Visual Studio, find the TODO shown below, and then double-click the TODO.[![k](./media/k1.png)](./media/k1.png)"},{"content":"Replace the TODO and the line of code as shown below.","pos":[10330,10383]},{"content":"The state of the system-defined <bpt id=\"p1\">**</bpt>Delete<ept id=\"p1\">**</ept> button is controlled by the AllowDelete property on the firstmaster datasource.","pos":[10392,10514],"source":"The state of the system-defined **Delete** button is controlled by the AllowDelete property on the firstmaster datasource."},{"content":"By setting AllowDelete to false, the delete task is kept from executing when the keyboard shortcut is used.","pos":[10515,10622]},{"content":"In the editor, find and remove DeleteCmdButton from the form design.","pos":[11034,11102]},{"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>l<ept id=\"p1\">](./media/l1.png)](./media/l1.png)</ept>","pos":[11103,11141],"source":"[![l](./media/l1.png)](./media/l1.png)"},{"pos":[11146,11180],"content":"Press <bpt id=\"p1\">**</bpt>Ctrl+S to<ept id=\"p1\">**</ept> save the form.","source":"Press **Ctrl+S to** save the form."},{"content":"Next, we will focus on the EditCmdButton that duplicates the system Edit button, handing the two TODOs associated with this button as well as removing this button.","pos":[11189,11352]},{"pos":[11358,11471],"content":"In Visual Studio, find the TODO shown below, and then double-clickthe TODO.<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>m<ept id=\"p1\">](./media/m1.png)](./media/m1.png)</ept>","source":"In Visual Studio, find the TODO shown below, and then double-clickthe TODO.[![m](./media/m1.png)](./media/m1.png)"},{"content":"Because the visibility of the <bpt id=\"p1\">**</bpt>Edit<ept id=\"p1\">**</ept> button is controlled by the View/Edit mode of the form, you will need to modify this code so it sets that property.","pos":[11476,11630],"source":"Because the visibility of the **Edit** button is controlled by the View/Edit mode of the form, you will need to modify this code so it sets that property."},{"content":"Replace the TODO and the line of code as shown in the following graphic.","pos":[11631,11703]},{"pos":[12309,12391],"content":"Double-click the other TODO for this button.<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph><ph id=\"ph2\">n</ph><ept id=\"p1\">](./media/n1.png)](./media/n1.png)</ept>","source":"Double-click the other TODO for this button.[![n](./media/n1.png)](./media/n1.png)"},{"content":"Inspect the code on the modeled <bpt id=\"p1\">**</bpt>Edit<ept id=\"p1\">**</ept> button.","pos":[12396,12444],"source":"Inspect the code on the modeled **Edit** button."},{"content":"This logic will need to be moved to the form’s task() method.","pos":[12445,12506]},{"pos":[13500,13658],"content":"On the left side of the Visual Studio designer, right-click <bpt id=\"p1\">**</bpt>Methods<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Override<ept id=\"p2\">**</ept>, and select <bpt id=\"p3\">**</bpt>Task<ept id=\"p3\">**</ept>, to add an override for the form’s Task method.","source":"On the left side of the Visual Studio designer, right-click **Methods** &gt; **Override**, and select **Task**, to add an override for the form’s Task method."},{"pos":[13663,13793],"content":"Update the task method as shown below so that the code from above is triggered when the system-defined <bpt id=\"p1\">**</bpt>Edit<ept id=\"p1\">**</ept> button is clicked.","source":"Update the task method as shown below so that the code from above is triggered when the system-defined **Edit** button is clicked."},{"content":"In the Editor, find and remove the <bpt id=\"p1\">**</bpt>EditCmdButton<ept id=\"p1\">**</ept> from the form design.","pos":[15039,15113],"source":"In the Editor, find and remove the **EditCmdButton** from the form design."},{"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>o<ept id=\"p1\">](./media/o1.png)](./media/o1.png)</ept>","pos":[15114,15152],"source":"[![o](./media/o1.png)](./media/o1.png)"},{"pos":[15157,15191],"content":"Press <bpt id=\"p1\">**</bpt>Ctrl+S<ept id=\"p1\">**</ept> to save the form.","source":"Press **Ctrl+S** to save the form."},{"content":"Press <bpt id=\"p1\">**</bpt>Ctrl+F5<ept id=\"p1\">**</ept> to view the form.","pos":[15196,15231],"source":"Press **Ctrl+F5** to view the form."},{"content":"Notice the <bpt id=\"p1\">**</bpt>Delete<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>Edit<ept id=\"p2\">**</ept> buttons in the <bpt id=\"p3\">**</bpt>Commitment<ept id=\"p3\">**</ept> tab have been removed.","pos":[15232,15319],"source":" Notice the **Delete** and **Edit** buttons in the **Commitment** tab have been removed."},{"pos":[15324,15350],"content":"Resolve casting exceptions","linkify":"Resolve casting exceptions","nodes":[{"content":"Resolve casting exceptions","pos":[0,26]}]},{"content":"In Dynamics 365 for Operations, X++ is completely intermediate-language (IL) based and therefore has a stricter runtime type behavior than the interpreted Dynamics AX2 012.","pos":[15351,15523]},{"content":"This stricter runtime type behavior can generate exceptions in migrated Dynamics AX 2012 R3 metadata.","pos":[15524,15625]},{"content":"It is likely you will encounter these exceptions during your migration.","pos":[15626,15697]},{"content":"The casting exceptions can be raised in different runtime scenarios, such as down-casting, casting runtime to design time objects, and side-casting.","pos":[15698,15846]},{"content":"In the section below, we will walk through an example where a form, CosJournalName, is generating controls at runtime, and has a type mismatch which causes a .NET exception because it is strongly typed.","pos":[15847,16049]},{"pos":[16055,16086],"content":"Example: Side-casting exception","linkify":"Example: Side-casting exception","nodes":[{"content":"Example: Side-casting exception","pos":[0,31]}]},{"pos":[16092,16201],"content":"In Visual Studio, select and right-click <bpt id=\"p1\">**</bpt>Project Properties<ept id=\"p1\">**</ept>, and verify that USMF is the default company.","source":"In Visual Studio, select and right-click **Project Properties**, and verify that USMF is the default company."},{"content":"Add the display menu item CosJournalName to your project, and set the menu item as your Startup object.","pos":[16206,16309]},{"content":"Add the CosJournalName form to your project.","pos":[16314,16358]},{"content":"Add the cosDimCheckBoxController class to your project.","pos":[16363,16418]},{"content":"Rebuild your project.","pos":[16423,16444]},{"pos":[16449,16483],"content":"Press <bpt id=\"p1\">**</bpt>Ctrl+F5<ept id=\"p1\">**</ept> to run the form.","source":"Press **Ctrl+F5** to run the form."},{"pos":[16488,16611],"content":"Note that you will get an exception, similar to the following, when running the form.<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>u<ept id=\"p1\">](./media/u1.png)](./media/u1.png)</ept>","source":"Note that you will get an exception, similar to the following, when running the form.[![u](./media/u1.png)](./media/u1.png)"},{"pos":[16616,16695],"content":"Right-click the class, cosDimCheckBoxController, and then select <bpt id=\"p1\">**</bpt>View Code<ept id=\"p1\">**</ept>.","source":"Right-click the class, cosDimCheckBoxController, and then select **View Code**."},{"content":"Set a breakpoint on the cosDimCheckBoxController::getBuildControl().","pos":[16700,16768]},{"pos":[16773,16786],"content":"Press <bpt id=\"p1\">**</bpt>F5<ept id=\"p1\">**</ept>.","source":"Press **F5**."},{"content":"The breakpoint will be hit.","pos":[16795,16822]},{"content":"This is where the casting error occurs.","pos":[16823,16862]},{"content":"The reason for the casting error is because we are trying to return a control of type: FormBuildCheckboxControl and the object is expecting FormBuildStringControl.","pos":[16863,17026]},{"pos":[17032,17141],"content":"Hover over the buildcontrol to see the type and notice the differences.<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>v<ept id=\"p1\">](./media/v1.png)](./media/v1.png)</ept>","source":"Hover over the buildcontrol to see the type and notice the differences.[![v](./media/v1.png)](./media/v1.png)"},{"pos":[17146,17219],"content":"Press <bpt id=\"p1\">**</bpt>F10<ept id=\"p1\">**</ept> to hit the exception.<bpt id=\"p2\">[</bpt><ph id=\"ph1\">![</ph>w<ept id=\"p2\">](./media/w2.png)](./media/w2.png)</ept>","source":"Press **F10** to hit the exception.[![w](./media/w2.png)](./media/w2.png)"},{"content":"Stop debugging.","pos":[17224,17239]},{"content":"To fix the exception, change the method declaration from FormBuildStringControl to FormBuildCheckBoxControl.","pos":[17244,17352]},{"content":"Rebuild the project, and press <bpt id=\"p1\">**</bpt>Ctrl+F5<ept id=\"p1\">**</ept>.","pos":[17479,17522],"source":"Rebuild the project, and press **Ctrl+F5**."},{"content":"The form should open successfully because the casting error is resolved.","pos":[17523,17595]},{"pos":[17597,17642],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>a<ept id=\"p1\">](./media/a-1024x576.png)](./media/a.png)</ept>","source":"[![a](./media/a-1024x576.png)](./media/a.png)"},{"pos":[17647,17697],"content":"Migrating context menus and mouse doubleclick code","linkify":"Migrating context menus and mouse doubleclick code","nodes":[{"content":"Migrating context menus and mouse doubleclick code","pos":[0,50]}]},{"content":"Refer to these topics to migrate code Dynamics AX 2012 that deals with context menus and mouse double-click actions.","pos":[17698,17814]},{"pos":[17820,17868],"content":"<bpt id=\"p1\">[</bpt>Context menus<ept id=\"p1\">](code-migration-context-menus.md)</ept>","source":"[Context menus](code-migration-context-menus.md)"},{"pos":[17873,17925],"content":"<bpt id=\"p1\">[</bpt>Mouse double-click<ept id=\"p1\">](code-migration-double-click.md)</ept>","source":"[Mouse double-click](code-migration-double-click.md)"}]}