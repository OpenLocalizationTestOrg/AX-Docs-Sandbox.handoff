{"nodes":[{"pos":[32,108],"content":"Prepare to migrate to Microsoft Dynamics 365 for Operations | Microsoft Docs","needQuote":true,"needEscape":true,"nodes":[{"content":"Prepare to migrate to Microsoft Dynamics 365 for Operations | Microsoft Docs","pos":[0,76]}]},{"pos":[122,295],"content":"In this tutorial, we will use the LCS migration service and Visual Studio to migrate you code and metadata from Dynamics AX 2012 R3 to Microsoft Dynamics 365 for Operations.","needQuote":true,"needEscape":true,"nodes":[{"content":"In this tutorial, we will use the LCS migration service and Visual Studio to migrate you code and metadata from Dynamics AX 2012 R3 to Microsoft Dynamics 365 for Operations.","pos":[0,173]}]},{"pos":[710,769],"content":"Prepare to migrate to Microsoft Dynamics 365 for Operations","linkify":"Prepare to migrate to Microsoft Dynamics 365 for Operations","nodes":[{"content":"Prepare to migrate to Microsoft Dynamics 365 for Operations","pos":[0,59]}]},{"pos":[771,784],"content":"Prerequisites","linkify":"Prerequisites","nodes":[{"content":"Prerequisites","pos":[0,13]}]},{"content":"You will need access to the environment using Remote Desktop, and be provisioned as an administrator on the instance.","pos":[800,917]},{"pos":[922,936],"content":"Tutorial goals","linkify":"Tutorial goals","nodes":[{"content":"Tutorial goals","pos":[0,14]}]},{"content":"Describe the steps needed to move a Dynamics AX 2012 R3 solution to Dynamics 365 for Operations.","pos":[941,1037]},{"content":"Migrate Microsoft Application Suite examples manually.","pos":[1042,1096]},{"content":"Define the requirements to complete migration.","pos":[1101,1147]},{"pos":[1152,1160],"content":"Overview","linkify":"Overview","nodes":[{"content":"Overview","pos":[0,8]}]},{"pos":[1165,1176],"content":"Model split","linkify":"Model split","nodes":[{"content":"Model split","pos":[0,11]}]},{"content":"The application is split into three packages, or assemblies:","pos":[1178,1238]},{"content":"Application Platform","pos":[1244,1264]},{"content":"Application Foundation","pos":[1280,1302]},{"content":"Application Suite","pos":[1318,1335]},{"content":"ISV AX 2012 R3 solutions will be re-baselined into the correct model.","pos":[1337,1406]},{"pos":[1412,1452],"content":"Auto-migration using LCS Upgrade Service","linkify":"Auto-migration using LCS Upgrade Service","nodes":[{"content":"Auto-migration using LCS Upgrade Service","pos":[0,40]}]},{"content":"A migration service that takes a model store as input, can complete the following tasks:","pos":[1454,1542]},{"content":"Convert metadata into the format.","pos":[1548,1581]},{"content":"Re-baselines metadata, by moving and merging, into the right model.","pos":[1597,1664]},{"content":"Provides an estimation to understand the effort required to upgrade the solution.","pos":[1680,1761]},{"content":"Runs migration rules that auto-migrate parts of a solution.","pos":[1777,1836]},{"content":"Runs migration rules that inform developers what to manually fix by using TODOs.","pos":[1852,1932]},{"content":"Provides a one-box migration-ready VHD with your solution that is deployed into the Microsoft Dynamics 365 for Operations format.","pos":[1948,2077]},{"content":"Optional: Automatically checks-in the upgraded solution into TFS online.","pos":[2093,2165]},{"content":"Optional: Automatically sets up nightly builds for the TFS online solution.","pos":[2181,2256]},{"pos":[2262,2278],"content":"Manual migration","linkify":"Manual migration","nodes":[{"content":"Manual migration","pos":[0,16]}]},{"content":"After developers have a one-box migration deployment ready, the application can be compiled by fixing the compilation errors in this order:","pos":[2280,2419]},{"content":"Application platform","pos":[2425,2445]},{"content":"Manually fix merge conflicts.","pos":[2454,2483]},{"content":"Manually fix model split conflicts.","pos":[2492,2527]},{"content":"Manually fix compilation errors.","pos":[2536,2568]},{"content":"Application foundation","pos":[2574,2596]},{"content":"Manually fix merge conflicts.","pos":[2605,2634]},{"content":"Manually fix model split conflicts.","pos":[2643,2678]},{"content":"Manually fix compilation errors.","pos":[2687,2719]},{"content":"Application suite","pos":[2725,2742]},{"content":"Manually fix merge conflicts.","pos":[2751,2780]},{"content":"Manually fix model split conflicts.","pos":[2789,2824]},{"content":"Manually fix compilation errors.","pos":[2833,2865]},{"content":"ISV model","pos":[2871,2880]},{"content":"Manually fix merge conflicts.","pos":[2889,2918]},{"content":"Manually fix model split conflicts.","pos":[2927,2962]},{"content":"Manually fix compilation errors.","pos":[2971,3003]},{"content":"After you have resolved all of the compilation errors, all assemblies will compile.","pos":[3005,3088]},{"content":"Next, ISVs must complete the following tasks:","pos":[3089,3134]},{"content":"Address guided code upgrade TODOs and code upgrade-specific best practice warnings.","pos":[3140,3223]},{"content":"Replace deprecated controls, for example, ActiveX or find an alternative.","pos":[3228,3301]},{"content":"Apply form patterns and sub patterns to all forms.","pos":[3306,3356]},{"content":"Create data entities.","pos":[3361,3382]},{"content":"Validate that all scenarios work in multiple browsers with different sizes for custom patterns.","pos":[3387,3482]},{"content":"Write/run migration tests.","pos":[3487,3513]},{"content":"Upload the solution to LCS for certification.","pos":[3518,3563]},{"content":"Deploy to customers.","pos":[3568,3588]},{"pos":[3593,3605],"content":"Key concepts","linkify":"Key concepts","nodes":[{"content":"Key concepts","pos":[0,12]}]},{"pos":[3610,3645],"content":"Lifecycle Service Migration Service","linkify":"Lifecycle Service Migration Service","nodes":[{"content":"Lifecycle Service Migration Service","pos":[0,35]}]},{"content":"Lifecycle Services (LCS) is the application lifecycle service to manage deployments.","pos":[3647,3731]},{"content":"For more info about Lifecycle Services, see <bpt id=\"p1\">[</bpt>http://lcs.dynamics.com<ept id=\"p1\">](http://lcs.dynamics.com/en/)</ept>.","pos":[3732,3831],"source":" For more info about Lifecycle Services, see [http://lcs.dynamics.com](http://lcs.dynamics.com/en/)."},{"pos":[3837,3904],"content":"Application Platform, Application Foundation, and Application Suite","linkify":"Application Platform, Application Foundation, and Application Suite","nodes":[{"content":"Application Platform, Application Foundation, and Application Suite","pos":[0,67]}]},{"content":"Microsoft Dynamics 365 for Operations is split into 3 main models: the Application Platform, the Application Foundation, and the Application Suite.","pos":[3906,4053]},{"content":"Each of these models compile into its own assembly.","pos":[4054,4105]},{"content":"This graphic shows a visual breakdown of the application.","pos":[4106,4163]},{"content":"ll","pos":[4166,4168]},{"content":"The models concepts are as follows.","pos":[4193,4228]},{"content":"Property","pos":[4230,4238]},{"content":"Value","pos":[4240,4245]},{"content":"Field","pos":[4247,4252]},{"content":"CustomerDriverLicense This is the foreign key field on the FMRentalEntity.","pos":[4254,4328]},{"content":"Related Field","pos":[4330,4343]},{"content":"DriverLicense This is the unique key on the FMCustomerEntity.","pos":[4345,4406]},{"pos":[4412,4493],"content":"Package, models, namespaces, overlayering, referencing, extensions, and workloads","linkify":"Package, models, namespaces, overlayering, referencing, extensions, and workloads","nodes":[{"content":"Package, models, namespaces, overlayering, referencing, extensions, and workloads","pos":[0,81]}]},{"content":"A model can contain the following:","pos":[4495,4529]},{"content":"New elements and extensions from an underlying model.","pos":[4535,4588]},{"content":"Overlayered elements from an underlying model.","pos":[4593,4639]},{"content":"One or more models are compiled into an assembly.","pos":[4641,4690]},{"content":"An assembly, its non-code metadata, and its compiled artifacts form a package.","pos":[4691,4769]},{"content":"A package is an independent deployable unit.","pos":[4770,4814]},{"content":"For example, the Application suite module and the Application foundation module are separate assemblies.","pos":[4815,4919]},{"content":"A model that contains only new elements, or extensions, or both, should be compiled into its own package.","pos":[4920,5025]},{"content":"For example, the ISV.dll contains new tables, forms, and classes that the ISV added.","pos":[5026,5110]},{"content":"A model that contains overlayered elements must be compiled into the same package as the base model.","pos":[5111,5211]},{"content":"A model can’t contain overlayered elements from 2 different packages, meaning a model can be compiled into one and only one package <bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>: If you are not overlayering, you are developing in your own module.","pos":[5212,5421],"source":" A model can’t contain overlayered elements from 2 different packages, meaning a model can be compiled into one and only one package **Note**: If you are not overlayering, you are developing in your own module."},{"content":"For example, GLS layer overlaying sys must be compiled every time the sys layer or the code is changed.","pos":[5422,5525]},{"content":"Models have implicit layering.","pos":[5526,5556]},{"content":"Overlayered artifacts are stored as diffs with individual field level granularity, except for code, at higher layers.","pos":[5557,5674]},{"content":"For code, string diffs are stored at higher layers.","pos":[5675,5726]},{"content":"Code within a module can “reference” only “publicized” contracts in other modules.","pos":[5727,5809]},{"content":"Publicized contracts should be kept backward compatible.","pos":[5810,5866]},{"content":"Example:","pos":[5867,5875]},{"content":"JJISV code in a separate module can refer to only publicized contracts in Microsoft namespaces.","pos":[5881,5976]},{"content":"Microsoft patches don’t break publicized contracts.","pos":[5981,6032]},{"content":"JJISV does need not to be compiled when Microsoft module is patched.","pos":[6033,6101]},{"pos":[6107,6148],"content":"A collection of packages forms a workload","linkify":"A collection of packages forms a workload","nodes":[{"content":"A collection of packages forms a workload","pos":[0,41]}]},{"content":"Diagram","pos":[6150,6157]},{"content":"mm","pos":[6160,6162]},{"pos":[6191,6204],"content":"Machine setup","linkify":"Machine setup","nodes":[{"content":"Machine setup","pos":[0,13]}]},{"content":"This tutorial will walk you through configuring your one-box developer deployment and provide information about important migration settings.","pos":[6205,6346]},{"content":"In the Best Practice framework, there is a subset of Best Practice warnings that need to be resolved to complete migration.","pos":[6347,6470]},{"pos":[6476,6550],"content":"In Visual Studio, click <bpt id=\"p1\">**</bpt>Dynamics 365 <ph id=\"ph1\">&amp;gt;</ph> Options <ph id=\"ph2\">&amp;gt;</ph> Best Practices<ept id=\"p1\">**</ept>.","source":"In Visual Studio, click **Dynamics 365 &gt; Options &gt; Best Practices**."},{"pos":[6555,6617],"content":"In the <bpt id=\"p1\">**</bpt>Model<ept id=\"p1\">**</ept> drop-down menu, select <bpt id=\"p2\">**</bpt>Application Suite<ept id=\"p2\">**</ept>.","source":"In the **Model** drop-down menu, select **Application Suite**."},{"content":"During the migration phase, these rules should be set to “ON” when migrating your ISV solution.","pos":[6619,6714]},{"content":"The setting is driven by an XML file in the AxRuleSet folder.","pos":[6715,6776]},{"content":"For example, see the Application Suite xml file, BPRules.xml, located under C:<ph id=\"ph1\">\\\\</ph>Packages<ph id=\"ph2\">\\\\</ph>ApplicationSuite<ph id=\"ph3\">\\\\</ph>Foundation<ph id=\"ph4\">\\\\</ph>AxRuleSet.","pos":[6777,6907],"source":" For example, see the Application Suite xml file, BPRules.xml, located under C:\\\\Packages\\\\ApplicationSuite\\\\Foundation\\\\AxRuleSet."},{"content":"![oo] The LCS upgrade service will automatically add this XML file to your model.","pos":[6908,6989]},{"content":"To complete the migration, you need to fix all migration-specific Best Practice rules.","pos":[6990,7076]},{"content":"The errors will show up in the error list as warnings.","pos":[7077,7131]},{"content":"In the error list, you will see compiler warnings and best practice errors.","pos":[7132,7207]},{"content":"Best Practice errors are prefixed with the text <bpt id=\"p1\">**</bpt>BP<ept id=\"p1\">**</ept>.","pos":[7208,7263],"source":" Best Practice errors are prefixed with the text **BP**."},{"content":"For example, <bpt id=\"p1\">**</bpt>BPErrorFormControlPatternUnspecified<ept id=\"p1\">**</ept>.","pos":[7264,7318],"source":" For example, **BPErrorFormControlPatternUnspecified**."},{"content":"<bpt id=\"p1\">**</bpt>Important:<ept id=\"p1\">**</ept> After migration, remove this file as all Best Practice rules should be run during regular development.","pos":[7319,7436],"source":"**Important:** After migration, remove this file as all Best Practice rules should be run during regular development."},{"content":"<bpt id=\"p1\">**</bpt>Running BP rules per model<ept id=\"p1\">**</ept> Running BP rules per model is an important migration scenario, which means you should understand all required migration BPs for your model.","pos":[7437,7607],"source":"**Running BP rules per model** Running BP rules per model is an important migration scenario, which means you should understand all required migration BPs for your model."},{"content":"To only run the Best Practice tool, run it from the command line.","pos":[7608,7673]},{"content":"Both xppc.exe and xppbp.exe are in the C:<ph id=\"ph1\">\\\\</ph>Packages<ph id=\"ph2\">\\\\</ph>bin directory.","pos":[7674,7741],"source":" Both xppc.exe and xppbp.exe are in the C:\\\\Packages\\\\bin directory."},{"content":"The command to run BP rules on a model, for example the Application Suite, is: C:<ph id=\"ph1\">\\\\</ph>Packages<ph id=\"ph2\">\\\\</ph>bin<ph id=\"ph3\">\\\\</ph>xppbp.exe –m=C:<ph id=\"ph4\">\\\\</ph>Packages –me=Foundation –mu=ApplicationSuite -all.","pos":[7742,7907],"source":" The command to run BP rules on a model, for example the Application Suite, is: C:\\\\Packages\\\\bin\\\\xppbp.exe –m=C:\\\\Packages –me=Foundation –mu=ApplicationSuite -all."},{"pos":[7912,7925],"content":"Project setup","linkify":"Project setup","nodes":[{"content":"Project setup","pos":[0,13]}]},{"pos":[7930,8017],"content":"Start Visual Studio, and on the toolbar, click <bpt id=\"p1\">**</bpt>Microsoft Dynamics<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Options<ept id=\"p2\">**</ept>.","source":"Start Visual Studio, and on the toolbar, click **Microsoft Dynamics** &gt; **Options**."},{"pos":[8022,8090],"content":"Expand the <bpt id=\"p1\">**</bpt>Microsoft Dynamics<ept id=\"p1\">**</ept> node, and then click <bpt id=\"p2\">**</bpt>Projects<ept id=\"p2\">**</ept>.","source":"Expand the **Microsoft Dynamics** node, and then click **Projects**."},{"pos":[8095,8189],"content":"Verify that the <bpt id=\"p1\">**</bpt>Organize projects by element type<ept id=\"p1\">**</ept> check box is selected, and click <bpt id=\"p2\">**</bpt>OK<ept id=\"p2\">**</ept>.","source":"Verify that the **Organize projects by element type** check box is selected, and click **OK**."},{"pos":[8194,8322],"content":"To view the line numbers in your code editor, select <bpt id=\"p1\">**</bpt>Tools<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Options<ept id=\"p2\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>Text<ept id=\"p3\">**</ept> <bpt id=\"p4\">**</bpt>Editor<ept id=\"p4\">**</ept> <ph id=\"ph3\">&amp;gt;</ph> <bpt id=\"p5\">**</bpt>All Languages<ept id=\"p5\">**</ept>.","source":"To view the line numbers in your code editor, select **Tools** &gt; **Options** &gt; **Text** **Editor** &gt; **All Languages**."},{"pos":[8327,8370],"content":"Select the <bpt id=\"p1\">**</bpt>Line numbers<ept id=\"p1\">**</ept> check box.![qq]","source":"Select the **Line numbers** check box.![qq]"},{"pos":[8375,8459],"content":"Create a <bpt id=\"p1\">**</bpt>Microsoft Dynamics Project<ept id=\"p1\">**</ept> template project, and name it <bpt id=\"p2\">**</bpt>Migration<ept id=\"p2\">**</ept>.","source":"Create a **Microsoft Dynamics Project** template project, and name it **Migration**."},{"pos":[8464,8477],"content":"Click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept>.","source":"Click **OK**."},{"pos":[8482,8538],"content":"Verify that the project is in the <bpt id=\"p1\">**</bpt>Application Suite<ept id=\"p1\">**</ept>.","source":"Verify that the project is in the **Application Suite**."},{"pos":[8543,8594],"content":"Right-click the project, and select <bpt id=\"p1\">**</bpt>Properties<ept id=\"p1\">**</ept>.","source":"Right-click the project, and select **Properties**."},{"pos":[8599,8655],"content":"In the <bpt id=\"p1\">**</bpt>Model<ept id=\"p1\">**</ept> property, select <bpt id=\"p2\">**</bpt>Application Suite<ept id=\"p2\">**</ept>.","source":"In the **Model** property, select **Application Suite**."},{"content":"Set the <bpt id=\"p1\">**</bpt>Company<ept id=\"p1\">**</ept> property to <bpt id=\"p2\">**</bpt>USMF<ept id=\"p2\">**</ept>.","pos":[8660,8701],"source":"Set the **Company** property to **USMF**."},{"content":"Your settings should resemble the following screenshot.![rr]","pos":[8702,8762]},{"pos":[8767,8780],"content":"Click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept>.","source":"Click **OK**."},{"pos":[8785,8794],"content":"Debugging","linkify":"Debugging","nodes":[{"content":"Debugging","pos":[0,9]}]},{"content":"By default, Dynamics 365 for Operations optimizes the debugging experience for the files that you are working on.","pos":[8795,8908]},{"content":"As a result, when you step into a file (F11) that is not in your project, the PDBs are not loaded and you can’t debug the code.","pos":[8909,9036]},{"content":"To work around this, change the project debugging setting by clicking <bpt id=\"p1\">**</bpt>Dynamics 365 <ept id=\"p1\">**</ept><ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Options<ept id=\"p2\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>Debugging<ept id=\"p3\">**</ept>.","pos":[9037,9160],"source":" To work around this, change the project debugging setting by clicking **Dynamics 365 **&gt; **Options** &gt; **Debugging**."},{"content":"Verify that the <bpt id=\"p1\">**</bpt>Load symbols only for items in the solution<ept id=\"p1\">**</ept> check box is not selected.","pos":[9161,9251],"source":" Verify that the **Load symbols only for items in the solution** check box is not selected."},{"content":"Another debugging setting that you may want to turn off is Intellitrace.","pos":[9252,9324]},{"content":"Intellitrace collects the complete execution history of an application.","pos":[9325,9396]},{"content":"It creates a lot of noise in the IDE when debugging.","pos":[9397,9449]},{"content":"To turn off Intellitrace, click <bpt id=\"p1\">**</bpt>Options<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>IntelliTrace<ept id=\"p2\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>Enable IntelliTrace<ept id=\"p3\">**</ept>, clear the check box, and then click <bpt id=\"p4\">**</bpt>OK<ept id=\"p4\">**</ept>.","pos":[9450,9589],"source":" To turn off Intellitrace, click **Options** &gt; **IntelliTrace** &gt; **Enable IntelliTrace**, clear the check box, and then click **OK**."},{"content":"Note that Intellitrace is only available in the Ultimate version of Visual Studio.","pos":[9590,9672]},{"content":"![tt]","pos":[9673,9678]},{"pos":[9683,9711],"content":"Address code migration tasks","linkify":"Address code migration tasks","nodes":[{"content":"Address code migration tasks","pos":[0,28]}]},{"content":"When metadata is migrated to Dynamics 365 for Operations, multiple auto-upgrade scripts are run.","pos":[9712,9808]},{"content":"In the case where developers need to complete manual migration tasks, TO DOs and Best Practices (BP) have been added.","pos":[9809,9926]},{"pos":[9932,10037],"content":"TO DOs are prefixed with <bpt id=\"p1\">*</bpt><ph id=\"ph1\">/</ph><ph id=\"ph2\">\\*</ph> TODO: (Code Upgrade)<ept id=\"p1\">*</ept>, and need to be be fixed as a part of code migration.","source":"TO DOs are prefixed with */\\* TODO: (Code Upgrade)*, and need to be be fixed as a part of code migration."},{"content":"BP migration specific rules also need to be fixed as part of code migration.","pos":[10042,10118]},{"content":"This tutorial uses the <bpt id=\"p1\">**</bpt>PurchCommitment<ph id=\"ph1\">\\_</ph>PSN<ept id=\"p1\">**</ept> form to walk you through the migration task of fixing navigation.","pos":[10120,10233],"source":"This tutorial uses the **PurchCommitment\\_PSN** form to walk you through the migration task of fixing navigation."},{"content":"Specifically, you will see examples of duplicate buttons and Action Pane TODOs.","pos":[10234,10313]},{"pos":[10319,10324],"content":"Setup","linkify":"Setup","nodes":[{"content":"Setup","pos":[0,5]}]},{"pos":[10330,10425],"content":"In Visual Studio, open <bpt id=\"p1\">**</bpt>Application Explorer<ept id=\"p1\">**</ept>, and search for the form, PurchCommitment<ph id=\"ph1\">\\_</ph>PSN.","source":"In Visual Studio, open **Application Explorer**, and search for the form, PurchCommitment\\_PSN."},{"pos":[10430,10443],"content":"Click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept>.","source":"Click **OK**."},{"pos":[10448,10498],"content":"Right-click the project and select <bpt id=\"p1\">**</bpt>Properties<ept id=\"p1\">**</ept>.","source":"Right-click the project and select **Properties**."},{"pos":[10503,10555],"content":"In the Model property, select <bpt id=\"p1\">**</bpt>Application Suite<ept id=\"p1\">**</ept>.","source":"In the Model property, select **Application Suite**."},{"content":"In the Company property, select FRSI.","pos":[10560,10597]},{"content":"Note: The form is located in the French demo data company FRSI.","pos":[10602,10665]},{"pos":[10670,10704],"content":"Press <bpt id=\"p1\">**</bpt>Ctrl+F5 to<ept id=\"p1\">**</ept> see the form.","source":"Press **Ctrl+F5 to** see the form."},{"content":"While the form looks complete, there are still code migration tasks necessary to be migration-complete.","pos":[10706,10809]},{"content":"![i]","pos":[10810,10814]},{"pos":[10820,10846],"content":"Navigation migration tasks","linkify":"Navigation migration tasks","nodes":[{"content":"Navigation migration tasks","pos":[0,26]}]},{"pos":[10852,10948],"content":"In Visual Studio, build the project, and then on the toolbar, click <bpt id=\"p1\">**</bpt>View<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Task List<ept id=\"p2\">**</ept>.","source":"In Visual Studio, build the project, and then on the toolbar, click **View** &gt; **Task List**."},{"pos":[10953,11031],"content":"Click the <bpt id=\"p1\">**</bpt>Comments<ept id=\"p1\">**</ept> drop-down list to view the TO DO: (Code Upgrade) tasks.","source":"Click the **Comments** drop-down list to view the TO DO: (Code Upgrade) tasks."},{"content":"In the list, find the ActionPane TODOs.","pos":[11036,11075]},{"content":"![j]","pos":[11077,11081]},{"pos":[11087,11118],"content":"Code upgrade rule - Action Pane","linkify":"Code upgrade rule - Action Pane","nodes":[{"content":"Code upgrade rule - Action Pane","pos":[0,31]}]},{"content":"In Dynamics 365 for Operations, the following core actions are provided as system-defined buttons:","pos":[11120,11218]},{"content":"New","pos":[11224,11227]},{"content":"Delete","pos":[11232,11238]},{"content":"Edit","pos":[11243,11247]},{"content":"Export","pos":[11252,11258]},{"content":"As part of the auto-migration, the Action Pane rule is run to identify redundant buttons.","pos":[11260,11349]},{"content":"To complete this part of migration, you need to manually:","pos":[11350,11407]},{"content":"Remove or move the code.","pos":[11413,11437]},{"content":"Delete redundant controls in the application code.","pos":[11442,11492]},{"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>: In this tutorial, we will provide examples of how to migrate and modify the code on modeled buttons that replicate system-defined buttons.","pos":[11494,11642],"source":"**Note**: In this tutorial, we will provide examples of how to migrate and modify the code on modeled buttons that replicate system-defined buttons."},{"content":"However, in practice, before making changes similar to those made in this tutorial, the code must first be evaluated with respect to the scenario to determine if it is still needed.","pos":[11643,11824]},{"content":"First, fix the TODO for the DeleteCmdButton, which duplicates the system-defined Delete button.","pos":[11825,11920]},{"content":"In Visual Studio, find the TODO shown below, and then double-click the TODO.![k]","pos":[11926,12006]},{"content":"Replace the TODO and the line of code as shown below.","pos":[12011,12064]},{"content":"The state of the system-defined <bpt id=\"p1\">**</bpt>Delete<ept id=\"p1\">**</ept> button is controlled by the AllowDelete property on the firstmaster datasource.","pos":[12073,12195],"source":"The state of the system-defined **Delete** button is controlled by the AllowDelete property on the firstmaster datasource."},{"content":"By setting AllowDelete to false, the delete task is kept from executing when the keyboard shortcut is used.","pos":[12196,12303]},{"content":"In the editor, find and remove DeleteCmdButton from the form design.","pos":[12715,12783]},{"content":"![l]","pos":[12784,12788]},{"pos":[12793,12827],"content":"Press <bpt id=\"p1\">**</bpt>Ctrl+S to<ept id=\"p1\">**</ept> save the form.","source":"Press **Ctrl+S to** save the form."},{"content":"Next, we will focus on the EditCmdButton that duplicates the system Edit button, handing the two TODOs associated with this button as well as removing this button.","pos":[12836,12999]},{"content":"In Visual Studio, find the TODO shown below, and then double-clickthe TODO.![m]","pos":[13005,13084]},{"content":"Because the visibility of the <bpt id=\"p1\">**</bpt>Edit<ept id=\"p1\">**</ept> button is controlled by the View/Edit mode of the form, you will need to modify this code so it sets that property.","pos":[13089,13243],"source":"Because the visibility of the **Edit** button is controlled by the View/Edit mode of the form, you will need to modify this code so it sets that property."},{"content":"Replace the TODO and the line of code as shown in the following graphic.","pos":[13244,13316]},{"content":"Double-click the other TODO for this button.![n]","pos":[13922,13970]},{"content":"Inspect the code on the modeled <bpt id=\"p1\">**</bpt>Edit<ept id=\"p1\">**</ept> button.","pos":[13975,14023],"source":"Inspect the code on the modeled **Edit** button."},{"content":"This logic will need to be moved to the form’s task() method.","pos":[14024,14085]},{"pos":[15079,15237],"content":"On the left side of the Visual Studio designer, right-click <bpt id=\"p1\">**</bpt>Methods<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Override<ept id=\"p2\">**</ept>, and select <bpt id=\"p3\">**</bpt>Task<ept id=\"p3\">**</ept>, to add an override for the form’s Task method.","source":"On the left side of the Visual Studio designer, right-click **Methods** &gt; **Override**, and select **Task**, to add an override for the form’s Task method."},{"pos":[15242,15372],"content":"Update the task method as shown below so that the code from above is triggered when the system-defined <bpt id=\"p1\">**</bpt>Edit<ept id=\"p1\">**</ept> button is clicked.","source":"Update the task method as shown below so that the code from above is triggered when the system-defined **Edit** button is clicked."},{"content":"In the Editor, find and remove the <bpt id=\"p1\">**</bpt>EditCmdButton<ept id=\"p1\">**</ept> from the form design.","pos":[16618,16692],"source":"In the Editor, find and remove the **EditCmdButton** from the form design."},{"content":"![o]","pos":[16693,16697]},{"pos":[16702,16736],"content":"Press <bpt id=\"p1\">**</bpt>Ctrl+S<ept id=\"p1\">**</ept> to save the form.","source":"Press **Ctrl+S** to save the form."},{"content":"Press <bpt id=\"p1\">**</bpt>Ctrl+F5<ept id=\"p1\">**</ept> to view the form.","pos":[16741,16776],"source":"Press **Ctrl+F5** to view the form."},{"content":"Notice the <bpt id=\"p1\">**</bpt>Delete<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>Edit<ept id=\"p2\">**</ept> buttons in the <bpt id=\"p3\">**</bpt>Commitment<ept id=\"p3\">**</ept> tab have been removed.","pos":[16777,16864],"source":" Notice the **Delete** and **Edit** buttons in the **Commitment** tab have been removed."},{"pos":[16870,16902],"content":"Best Practice migration warnings","linkify":"Best Practice migration warnings","nodes":[{"content":"Best Practice migration warnings","pos":[0,32]}]},{"pos":[16908,16964],"content":"In <bpt id=\"p1\">**</bpt>Application Explorer<ept id=\"p1\">**</ept>, search for <bpt id=\"p2\">**</bpt>CosLineTree<ept id=\"p2\">**</ept>.","source":"In **Application Explorer**, search for **CosLineTree**."},{"pos":[16969,17051],"content":"Add the <bpt id=\"p1\">**</bpt>CosLineTree<ept id=\"p1\">**</ept> form and <bpt id=\"p2\">**</bpt>CosLineTree<ept id=\"p2\">**</ept> display menu item to the project.","source":"Add the **CosLineTree** form and **CosLineTree** display menu item to the project."},{"pos":[17056,17128],"content":"Right-click the display menu item, and select <bpt id=\"p1\">**</bpt>Set as Startup Object<ept id=\"p1\">**</ept>.","source":"Right-click the display menu item, and select **Set as Startup Object**."},{"content":"Rebuild the project.","pos":[17133,17153]},{"content":"Go to the Error List to view the warnings.","pos":[17158,17200]},{"pos":[17205,17290],"content":"In the BP filter, enter the word, <bpt id=\"p1\">*</bpt>mouse<ept id=\"p1\">*</ept>, to view the mouse related BP warnings.![p]","source":"In the BP filter, enter the word, *mouse*, to view the mouse related BP warnings.![p]"},{"content":"Double-click the warning to open the code editor.","pos":[17295,17344]},{"pos":[17349,17385],"content":"Press <bpt id=\"p1\">**</bpt>Ctrl+F5<ept id=\"p1\">**</ept> to start the form.","source":"Press **Ctrl+F5** to start the form."},{"pos":[17390,17447],"content":"Set a <bpt id=\"p1\">**</bpt>breakpoint<ept id=\"p1\">**</ept> on the <bpt id=\"p2\">**</bpt>mouseDblClick<ept id=\"p2\">**</ept> method.![q]","source":"Set a **breakpoint** on the **mouseDblClick** method.![q]"},{"content":"In Visual Studio, attach to the client process by clicking <bpt id=\"p1\">**</bpt>Debug<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Attach to Process<ept id=\"p2\">**</ept>.","pos":[17452,17548],"source":"In Visual Studio, attach to the client process by clicking **Debug** &gt; **Attach to Process**."},{"content":"Locate <bpt id=\"p1\">**</bpt>w3wp.exe<ept id=\"p1\">**</ept>.","pos":[17549,17569],"source":" Locate **w3wp.exe**."},{"pos":[17578,17697],"content":"Verify that you have selected the <bpt id=\"p1\">**</bpt>Show process from all users<ept id=\"p1\">**</ept> check box, or you might not see the w3wp.exe process.","source":"Verify that you have selected the **Show process from all users** check box, or you might not see the w3wp.exe process."},{"pos":[17706,17793],"content":"Verify that you only have <bpt id=\"p1\">**</bpt>Managed (v4.5, v4.0)<ept id=\"p1\">**</ept> selected in the <bpt id=\"p2\">**</bpt>Attach to<ept id=\"p2\">**</ept> field.","source":"Verify that you only have **Managed (v4.5, v4.0)** selected in the **Attach to** field."},{"pos":[17799,17857],"content":"Click <bpt id=\"p1\">**</bpt>Attach<ept id=\"p1\">**</ept>, and then double-click the form grid.![s]","source":"Click **Attach**, and then double-click the form grid.![s]"},{"pos":[17866,17945],"content":"Notice the breakpoint is <bpt id=\"p1\">**</bpt>not<ept id=\"p1\">**</ept> hit (as mouseDblClick is no longer supported).","source":"Notice the breakpoint is **not** hit (as mouseDblClick is no longer supported)."},{"content":"Close the client.","pos":[17951,17968]},{"content":"In this case, we need to add a button to the form and add the code to the click() method on the button.","pos":[17977,18080]},{"pos":[18086,18153],"content":"Go to the form designer and find the tab page, <bpt id=\"p1\">**</bpt>TabPage<ph id=\"ph1\">\\_</ph>Ledger.<ept id=\"p1\">**</ept>","source":"Go to the form designer and find the tab page, **TabPage\\_Ledger.**"},{"content":"Right-click the <bpt id=\"p1\">**</bpt>Tabpage<ept id=\"p1\">**</ept> to add a new Action Pane.","pos":[18162,18215],"source":"Right-click the **Tabpage** to add a new Action Pane."},{"content":"Verify that this is above the grid.","pos":[18216,18251]},{"content":"Right-click the Action Pane to add a new ButtonGroup.","pos":[18260,18313]},{"content":"Right-click othe <bpt id=\"p1\">**</bpt>ButtonGroup<ept id=\"p1\">**</ept> and add a new button.","pos":[18322,18376],"source":"Right-click othe **ButtonGroup** and add a new button."},{"content":"The metadata should look like the following example.","pos":[18377,18429]},{"content":"![t]","pos":[18430,18434]},{"content":"Select <bpt id=\"p1\">**</bpt>FormButtonControl1 (Button)<ept id=\"p1\">**</ept>, and then press <bpt id=\"p2\">**</bpt>F4<ept id=\"p2\">**</ept> to open the button properties.","pos":[18440,18532],"source":"Select **FormButtonControl1 (Button)**, and then press **F4** to open the button properties."},{"content":"Change the property text to <bpt id=\"p1\">**</bpt>Ledger Move<ept id=\"p1\">**</ept>.","pos":[18533,18577],"source":" Change the property text to **Ledger Move**."},{"pos":[18582,18683],"content":"Select <bpt id=\"p1\">**</bpt>FormButtonControl1 (Button)<ept id=\"p1\">**</ept>, right-click the <bpt id=\"p2\">**</bpt>Methods<ept id=\"p2\">**</ept> node, and add a Clicked() method.","source":"Select **FormButtonControl1 (Button)**, right-click the **Methods** node, and add a Clicked() method."},{"pos":[18688,18787],"content":"Select <bpt id=\"p1\">**</bpt>FormButtonControl1 (Button)<ept id=\"p1\">**</ept>, right-click the <bpt id=\"p2\">**</bpt>Methods<ept id=\"p2\">**</ept> node, and select <bpt id=\"p3\">**</bpt>View Code<ept id=\"p3\">**</ept>.","source":"Select **FormButtonControl1 (Button)**, right-click the **Methods** node, and select **View Code**."},{"content":"Verify that the double-click code is migrated to the method.","pos":[18792,18852]},{"content":"When you run the form, the code is now migrated.","pos":[19164,19212]},{"content":"<bpt id=\"p1\">**</bpt>Note:<ept id=\"p1\">**</ept> As part of migration, you should delete the mouseDblClick code because it has been migrated.","pos":[19214,19316],"source":"**Note:** As part of migration, you should delete the mouseDblClick code because it has been migrated."},{"content":"In this example the form is not migrated, so there are still runtime issues.","pos":[19317,19393]},{"pos":[19398,19424],"content":"Resolve casting exceptions","linkify":"Resolve casting exceptions","nodes":[{"content":"Resolve casting exceptions","pos":[0,26]}]},{"content":"In Dynamics 365 for Operations, X++ is completely IL based and therefore has a stricter runtime type behavior than the interpreted Dynamics AX2 012.","pos":[19425,19573]},{"content":"This stricter runtime type behavior can generate exceptions in migrated Dynamics AX 2012 R3 metadata.","pos":[19574,19675]},{"content":"It is likely you will encounter these exceptions during your migration.","pos":[19676,19747]},{"content":"The casting exceptions can be raised in different runtime scenarios, such as down-casting, casting runtime to design time objects, and side-casting.","pos":[19748,19896]},{"content":"In this tutorial, we will walk through an example where a form, CosJournalName, is generating controls at runtime, and has a type mismatch which causes a .NET exception because it is strongly typed.","pos":[19897,20095]},{"pos":[20101,20132],"content":"Example: Side-casting exception","linkify":"Example: Side-casting exception","nodes":[{"content":"Example: Side-casting exception","pos":[0,31]}]},{"pos":[20138,20247],"content":"In Visual Studio, select and right-click <bpt id=\"p1\">**</bpt>Project Properties<ept id=\"p1\">**</ept>, and verify that USMF is the default company.","source":"In Visual Studio, select and right-click **Project Properties**, and verify that USMF is the default company."},{"content":"Add the display menu item CosJournalName to your project, and set the menu item as your StartUp object.","pos":[20252,20355]},{"content":"Add the CosJournalName form to your project.","pos":[20360,20404]},{"content":"Add the cosDimCheckBoxController class to your project.","pos":[20409,20464]},{"content":"Rebuild your project.","pos":[20469,20490]},{"pos":[20495,20529],"content":"Press <bpt id=\"p1\">**</bpt>Ctrl+F5<ept id=\"p1\">**</ept> to run the form.","source":"Press **Ctrl+F5** to run the form."},{"content":"Note that you will get an exception, similar to the following, when running the form.![u]","pos":[20534,20623]},{"pos":[20628,20707],"content":"Right-click the class, cosDimCheckBoxController, and then select <bpt id=\"p1\">**</bpt>View Code<ept id=\"p1\">**</ept>.","source":"Right-click the class, cosDimCheckBoxController, and then select **View Code**."},{"content":"Set a breakpoint on the cosDimCheckBoxController::getBuildControl().","pos":[20712,20780]},{"pos":[20785,20798],"content":"Press <bpt id=\"p1\">**</bpt>F5<ept id=\"p1\">**</ept>.","source":"Press **F5**."},{"content":"The breakpoint will be hit.","pos":[20807,20834]},{"content":"This is where the casting error occurs.","pos":[20835,20874]},{"content":"The reason for the casting error is because we are trying to return a control of type: FormBuildCheckboxControl and the object is expecting FormBuildStringControl.","pos":[20875,21038]},{"content":"Hover over the buildcontrol to see the type and notice the differences.![v]","pos":[21044,21119]},{"pos":[21124,21163],"content":"Press <bpt id=\"p1\">**</bpt>F10<ept id=\"p1\">**</ept> to hit the exception.![w]","source":"Press **F10** to hit the exception.![w]"},{"content":"Stop debugging.","pos":[21168,21183]},{"content":"To fix the exception, change the method declaration from FormBuildStringControl to FormBuildCheckBoxControl.","pos":[21188,21296]},{"content":"Rebuild the project, and press <bpt id=\"p1\">**</bpt>Ctrl+F5<ept id=\"p1\">**</ept>.","pos":[21423,21466],"source":"Rebuild the project, and press **Ctrl+F5**."},{"content":"The form should open successfully because the casting error is resolved.","pos":[21467,21539]},{"content":"a","pos":[21543,21544]},{"pos":[21574,21606],"content":"Context menu (advanced tutorial)","linkify":"Context menu (advanced tutorial)","nodes":[{"content":"Context menu (advanced tutorial)","pos":[0,32]}]},{"content":"In Dynamics AX 2012, right-click context menus were modified by using the PopupMenu class.","pos":[21607,21697]},{"content":"This class relied on Windows APIs that were not available on the web.","pos":[21698,21767]},{"content":"In Dynamics 365 for Operations, the ContextMenu APIs have been created as replacements to provide similar functionality.","pos":[21768,21888]},{"content":"The context() and showContextMenu() method overrides were the previous entry points to modifying context menus for specific controls, and these overrides traditionally contained code for adding options to a context menu as well as processing the user’s selection using a wait model.","pos":[21889,22171]},{"content":"In Dynamics 365 for Operations, these overrides are being removed and the wait model eliminated.","pos":[22172,22268]},{"content":"The result is that your will need to create two overrides: getContextMenuOptions() to add options to the context menu, and selectedMenuOption() to process the user’s selection.","pos":[22269,22445]},{"content":"Migrating context menus in Dynamics 365 for Operations is a manual effort.","pos":[22446,22520]},{"content":"Steps for context menu migration:","pos":[22521,22554]},{"content":"Add macros for each menu option added to the context menu.","pos":[22560,22618]},{"pos":[22623,22724],"content":"Build the new context menu using the new <bpt id=\"p1\">*</bpt>getContextMenuOptions()<ept id=\"p1\">*</ept> override and the ContextMenu APIs.","source":"Build the new context menu using the new *getContextMenuOptions()* override and the ContextMenu APIs."},{"pos":[22729,22804],"content":"Process the user’s selection using the new <bpt id=\"p1\">*</bpt>selectedMenuOption()<ept id=\"p1\">*</ept> override.","source":"Process the user’s selection using the new *selectedMenuOption()* override."},{"pos":[22810,22829],"content":"Form: SysDateLookup","linkify":"Form: SysDateLookup","nodes":[{"content":"Form: SysDateLookup","pos":[0,19]}]},{"content":"In this example we will walk through the steps to migrate the context menu on a date control in the SysDateLookup form.","pos":[22831,22950]},{"content":"The old context menu code currently has no effect in Dynamics 365 for Operations.","pos":[22951,23032]},{"content":"To see the current context menu:","pos":[23033,23065]},{"content":"Add the SysDateLookup form to a project and set it as the startup object.","pos":[23071,23144]},{"pos":[23149,23187],"content":"Start without debugging (<bpt id=\"p1\">**</bpt>Ctrl+F5<ept id=\"p1\">**</ept>).","source":"Start without debugging (**Ctrl+F5**)."},{"content":"Right-click the date field.","pos":[23192,23219]},{"content":"b","pos":[23223,23224]},{"content":"This context menu is meant to contain options for switching to the previous month and the next month.","pos":[23249,23350]},{"content":"To start the migration process, first inspect the existing code for adding options to the context menu and for processing the user’s selection.","pos":[23351,23494]},{"pos":[23500,23532],"content":"Open the <bpt id=\"p1\">**</bpt>SysDateLookup<ept id=\"p1\">**</ept> form.","source":"Open the **SysDateLookup** form."},{"pos":[23537,23630],"content":"Search for the <bpt id=\"p1\">**</bpt>MontViewer<ept id=\"p1\">**</ept> control on the design node and expand the <bpt id=\"p2\">**</bpt>Methods<ept id=\"p2\">**</ept> node.![c]","source":"Search for the **MontViewer** control on the design node and expand the **Methods** node.![c]"},{"content":"Right-click the context override and click <bpt id=\"p1\">**</bpt>View code<ept id=\"p1\">**</ept>.","pos":[23635,23692],"source":"Right-click the context override and click **View code**."},{"content":"We will be migrating this code as well as the code in <bpt id=\"p1\">**</bpt>monthViewerContextCommon<ept id=\"p1\">**</ept> (which you can view by right-clicking the method name and clicking <bpt id=\"p2\">**</bpt>Go To Definition<ept id=\"p2\">**</ept>).","pos":[23693,23865],"source":" We will be migrating this code as well as the code in **monthViewerContextCommon** (which you can view by right-clicking the method name and clicking **Go To Definition**)."},{"content":"Go back to the designer for <bpt id=\"p1\">**</bpt>SysDateLookup<ept id=\"p1\">**</ept>.","pos":[24027,24073],"source":"Go back to the designer for **SysDateLookup**."},{"content":"Right-click <bpt id=\"p1\">**</bpt>Methods<ept id=\"p1\">**</ept> under the <bpt id=\"p2\">**</bpt>MontViewer<ept id=\"p2\">**</ept> control and add an override for <bpt id=\"p3\">*</bpt>getContextMenuOptions()<ept id=\"p3\">*</ept>.","pos":[24074,24181],"source":" Right-click **Methods** under the **MontViewer** control and add an override for *getContextMenuOptions()*."},{"content":"This is where the context menu will be constructed.","pos":[24182,24233]},{"content":"We will modify the code in this override later.","pos":[24234,24281]},{"content":"Move to the <bpt id=\"p1\">*</bpt>monthViewerContextCommon()<ept id=\"p1\">*</ept> method.","pos":[24286,24334],"source":"Move to the *monthViewerContextCommon()* method."},{"content":"This function adds two options to the context menu and then processes the user’s selection.","pos":[24335,24426]},{"content":"Find the menu options that are added to the context menu (choicePrev and choiceNext in this case), and add macros for each of these options at the top of the form.","pos":[24431,24594]},{"content":"Add a method just under <bpt id=\"p1\">*</bpt>monthViewerContextCommon()<ept id=\"p1\">*</ept> called <bpt id=\"p2\">*</bpt>monthViewerGetContextMenuOptions().<ept id=\"p2\">*</ept>","pos":[24599,24696],"source":"Add a method just under *monthViewerContextCommon()* called *monthViewerGetContextMenuOptions().*"},{"content":"This will contain the migrated code from <bpt id=\"p1\">*</bpt>monthViewerContextCommon()<ept id=\"p1\">*</ept> for adding the two context menu options.","pos":[24697,24807],"source":" This will contain the migrated code from *monthViewerContextCommon()* for adding the two context menu options."},{"pos":[24812,24924],"content":"Add these two options to the context menu using the new APIs in the <bpt id=\"p1\">*</bpt>monthViewerGetContextMenuOptions()<ept id=\"p1\">*</ept> method.","source":"Add these two options to the context menu using the new APIs in the *monthViewerGetContextMenuOptions()* method."},{"pos":[24929,25056],"content":"The portion of <bpt id=\"p1\">*</bpt>monthViewerContextCommon()<ept id=\"p1\">*</ept> that needs to be migrated into <bpt id=\"p2\">*</bpt>monthViewerGetContextMenuOptions()<ept id=\"p2\">*</ept> is shown below.","source":"The portion of *monthViewerContextCommon()* that needs to be migrated into *monthViewerGetContextMenuOptions()* is shown below."},{"content":"The migration of adding these two context menu options is shown below.","pos":[25327,25397]},{"content":"Modify <bpt id=\"p1\">*</bpt>getContextMenuOptions()<ept id=\"p1\">*</ept> as shown.","pos":[25402,25444],"source":"Modify *getContextMenuOptions()* as shown."},{"content":"Because system context menus in Dynamics 365 for Operationsonly include commands specific to a control, there is no need (or ability) to suppress the system context menu.","pos":[25445,25615]},{"content":"Go back to the designer for <bpt id=\"p1\">**</bpt>SysDateLookup<ept id=\"p1\">**</ept>.","pos":[26374,26420],"source":"Go back to the designer for **SysDateLookup**."},{"content":"Right-click <bpt id=\"p1\">**</bpt>Methods<ept id=\"p1\">**</ept> under the <bpt id=\"p2\">**</bpt>MontViewer<ept id=\"p2\">**</ept> control and add an override for <bpt id=\"p3\">*</bpt>selectedMenuOption()<ept id=\"p3\">*</ept>.","pos":[26421,26525],"source":" Right-click **Methods** under the **MontViewer** control and add an override for *selectedMenuOption()*."},{"content":"This is where the user’s selection will be processed.","pos":[26526,26579]},{"content":"We will add code to this override later in the tutorial.","pos":[26580,26636]},{"content":"Add a method just under <bpt id=\"p1\">*</bpt>monthViewerGetContextMenuOptions()<ept id=\"p1\">*</ept> called <bpt id=\"p2\">*</bpt>monthViewerSelectedOption().<ept id=\"p2\">*</ept>","pos":[26641,26739],"source":"Add a method just under *monthViewerGetContextMenuOptions()* called *monthViewerSelectedOption().*"},{"content":"This will contain the migrated code from <bpt id=\"p1\">*</bpt>monthViewerContextCommon()<ept id=\"p1\">*</ept> for processing the user’s selection.","pos":[26740,26846],"source":" This will contain the migrated code from *monthViewerContextCommon()* for processing the user’s selection."},{"content":"Move code to the <bpt id=\"p1\">*</bpt>monthViewerSelectedOption()<ept id=\"p1\">*</ept> override (generally the switch statement after the old call to draw()).","pos":[26851,26969],"source":"Move code to the *monthViewerSelectedOption()* override (generally the switch statement after the old call to draw())."},{"content":"Be sure to modify the variables to match your macro definitions.","pos":[26970,27034]},{"pos":[27919,27964],"content":"Modify <bpt id=\"p1\">*</bpt>selectedMenuOption()<ept id=\"p1\">*</ept> as shown below.","source":"Modify *selectedMenuOption()* as shown below."},{"content":"Delete the context() override from the MontViewer control.","pos":[28142,28200]},{"content":"Typically you would be able to delete the <bpt id=\"p1\">*</bpt>monthViewerContextCommon()<ept id=\"p1\">*</ept> method.","pos":[28205,28283],"source":"Typically you would be able to delete the *monthViewerContextCommon()* method."},{"content":"However, on this form there is another control <bpt id=\"p1\">**</bpt>arabicMontViewer<ept id=\"p1\">**</ept> with a context menu override (that we did not migrate in this tutorial) that calls this method.","pos":[28284,28447],"source":" However, on this form there is another control **arabicMontViewer** with a context menu override (that we did not migrate in this tutorial) that calls this method."},{"content":"You can either leave the method, or migrate the context menu code on that button and then delete the method.","pos":[28448,28556]},{"content":"Click <bpt id=\"p1\">**</bpt>Ctrl+F5<ept id=\"p1\">**</ept> to start the form without debugging.","pos":[28561,28615],"source":"Click **Ctrl+F5** to start the form without debugging."},{"content":"Notice the new options added to the bottom of the context menu.","pos":[28616,28679]},{"content":"<ph id=\"ph1\">![</ph>d<ph id=\"ph2\">](media/d2-1024x417.png)</ph>","pos":[28680,28707],"source":"![d](media/d2-1024x417.png)"}],"content":"---\n# required metadata\n\ntitle: Prepare to migrate to Microsoft Dynamics 365 for Operations | Microsoft Docs\ndescription: In this tutorial, we will use the LCS migration service and Visual Studio to migrate you code and metadata from Dynamics AX 2012 R3 to Microsoft Dynamics 365 for Operations.\n\nauthor: annbe\nmanager: AnnBe\nms.date: 2015-12-12 23:29:02\nms.topic: article\nms.prod: \nms.service: Dynamics365Operations\nms.technology: \n\n# optional metadata\n\n# keywords: \n# ROBOTS: \naudience: Developer\n# ms.devlang: \nms.reviewer: 61\nms.suite: Released- Dynamics AX 7.0.0\n# ms.tgt_pltfrm: \nms.custom: 25971\nms.assetid: 47a93e66-bd88-48c5-8771-0fe20164758d\n# ms.region: \n# ms.industry: \nms.author: RobinARH\n\n---\n\n# Prepare to migrate to Microsoft Dynamics 365 for Operations\n\nPrerequisites\n-------------\n\nYou will need access to the environment using Remote Desktop, and be provisioned as an administrator on the instance.\n\n## Tutorial goals\n-   Describe the steps needed to move a Dynamics AX 2012 R3 solution to Dynamics 365 for Operations.\n-   Migrate Microsoft Application Suite examples manually.\n-   Define the requirements to complete migration.\n\n## Overview\n### Model split\n\nThe application is split into three packages, or assemblies:\n\n-   Application Platform\n\n<!-- -->\n\n-   Application Foundation\n\n<!-- -->\n\n-   Application Suite\n\nISV AX 2012 R3 solutions will be re-baselined into the correct model.\n\n### Auto-migration using LCS Upgrade Service\n\nA migration service that takes a model store as input, can complete the following tasks:\n\n-   Convert metadata into the format.\n\n<!-- -->\n\n-   Re-baselines metadata, by moving and merging, into the right model.\n\n<!-- -->\n\n-   Provides an estimation to understand the effort required to upgrade the solution.\n\n<!-- -->\n\n-   Runs migration rules that auto-migrate parts of a solution.\n\n<!-- -->\n\n-   Runs migration rules that inform developers what to manually fix by using TODOs.\n\n<!-- -->\n\n-   Provides a one-box migration-ready VHD with your solution that is deployed into the Microsoft Dynamics 365 for Operations format.\n\n<!-- -->\n\n-   Optional: Automatically checks-in the upgraded solution into TFS online.\n\n<!-- -->\n\n-   Optional: Automatically sets up nightly builds for the TFS online solution.\n\n### Manual migration\n\nAfter developers have a one-box migration deployment ready, the application can be compiled by fixing the compilation errors in this order:\n\n1.  Application platform\n    -   Manually fix merge conflicts.\n    -   Manually fix model split conflicts.\n    -   Manually fix compilation errors.\n\n2.  Application foundation\n    -   Manually fix merge conflicts.\n    -   Manually fix model split conflicts.\n    -   Manually fix compilation errors.\n\n3.  Application suite\n    -   Manually fix merge conflicts.\n    -   Manually fix model split conflicts.\n    -   Manually fix compilation errors.\n\n4.  ISV model\n    -   Manually fix merge conflicts.\n    -   Manually fix model split conflicts.\n    -   Manually fix compilation errors.\n\nAfter you have resolved all of the compilation errors, all assemblies will compile. Next, ISVs must complete the following tasks:\n\n1.  Address guided code upgrade TODOs and code upgrade-specific best practice warnings.\n2.  Replace deprecated controls, for example, ActiveX or find an alternative.\n3.  Apply form patterns and sub patterns to all forms.\n4.  Create data entities.\n5.  Validate that all scenarios work in multiple browsers with different sizes for custom patterns.\n6.  Write/run migration tests.\n7.  Upload the solution to LCS for certification.\n8.  Deploy to customers.\n\n## Key concepts\n### Lifecycle Service Migration Service\n\nLifecycle Services (LCS) is the application lifecycle service to manage deployments. For more info about Lifecycle Services, see [http://lcs.dynamics.com](http://lcs.dynamics.com/en/).\n\n### Application Platform, Application Foundation, and Application Suite\n\nMicrosoft Dynamics 365 for Operations is split into 3 main models: the Application Platform, the Application Foundation, and the Application Suite. Each of these models compile into its own assembly. This graphic shows a visual breakdown of the application. ![ll](media/ll-1024x526.png) The models concepts are as follows.\n\nProperty\n\nValue\n\nField\n\nCustomerDriverLicense This is the foreign key field on the FMRentalEntity.\n\nRelated Field\n\nDriverLicense This is the unique key on the FMCustomerEntity.\n\n### Package, models, namespaces, overlayering, referencing, extensions, and workloads\n\nA model can contain the following:\n\n-   New elements and extensions from an underlying model.\n-   Overlayered elements from an underlying model.\n\nOne or more models are compiled into an assembly. An assembly, its non-code metadata, and its compiled artifacts form a package. A package is an independent deployable unit. For example, the Application suite module and the Application foundation module are separate assemblies. A model that contains only new elements, or extensions, or both, should be compiled into its own package. For example, the ISV.dll contains new tables, forms, and classes that the ISV added. A model that contains overlayered elements must be compiled into the same package as the base model. A model can’t contain overlayered elements from 2 different packages, meaning a model can be compiled into one and only one package **Note**: If you are not overlayering, you are developing in your own module. For example, GLS layer overlaying sys must be compiled every time the sys layer or the code is changed. Models have implicit layering. Overlayered artifacts are stored as diffs with individual field level granularity, except for code, at higher layers. For code, string diffs are stored at higher layers. Code within a module can “reference” only “publicized” contracts in other modules. Publicized contracts should be kept backward compatible. Example:\n\n-   JJISV code in a separate module can refer to only publicized contracts in Microsoft namespaces.\n-   Microsoft patches don’t break publicized contracts. JJISV does need not to be compiled when Microsoft module is patched.\n\n### A collection of packages forms a workload\n\nDiagram ![mm](media/mm-1024x573.png)\n\n## Machine setup\nThis tutorial will walk you through configuring your one-box developer deployment and provide information about important migration settings. In the Best Practice framework, there is a subset of Best Practice warnings that need to be resolved to complete migration.\n\n1.  In Visual Studio, click **Dynamics 365 &gt; Options &gt; Best Practices**.\n2.  In the **Model** drop-down menu, select **Application Suite**.\n\nDuring the migration phase, these rules should be set to “ON” when migrating your ISV solution. The setting is driven by an XML file in the AxRuleSet folder. For example, see the Application Suite xml file, BPRules.xml, located under C:\\\\Packages\\\\ApplicationSuite\\\\Foundation\\\\AxRuleSet. ![oo] The LCS upgrade service will automatically add this XML file to your model. To complete the migration, you need to fix all migration-specific Best Practice rules. The errors will show up in the error list as warnings. In the error list, you will see compiler warnings and best practice errors. Best Practice errors are prefixed with the text **BP**. For example, **BPErrorFormControlPatternUnspecified**. **Important:** After migration, remove this file as all Best Practice rules should be run during regular development. **Running BP rules per model** Running BP rules per model is an important migration scenario, which means you should understand all required migration BPs for your model. To only run the Best Practice tool, run it from the command line. Both xppc.exe and xppbp.exe are in the C:\\\\Packages\\\\bin directory. The command to run BP rules on a model, for example the Application Suite, is: C:\\\\Packages\\\\bin\\\\xppbp.exe –m=C:\\\\Packages –me=Foundation –mu=ApplicationSuite -all.\n\n## Project setup\n1.  Start Visual Studio, and on the toolbar, click **Microsoft Dynamics** &gt; **Options**.\n2.  Expand the **Microsoft Dynamics** node, and then click **Projects**.\n3.  Verify that the **Organize projects by element type** check box is selected, and click **OK**.\n4.  To view the line numbers in your code editor, select **Tools** &gt; **Options** &gt; **Text** **Editor** &gt; **All Languages**.\n5.  Select the **Line numbers** check box.![qq]\n6.  Create a **Microsoft Dynamics Project** template project, and name it **Migration**.\n7.  Click **OK**.\n8.  Verify that the project is in the **Application Suite**.\n9.  Right-click the project, and select **Properties**.\n10. In the **Model** property, select **Application Suite**.\n11. Set the **Company** property to **USMF**. Your settings should resemble the following screenshot.![rr]\n12. Click **OK**.\n\n## Debugging\nBy default, Dynamics 365 for Operations optimizes the debugging experience for the files that you are working on. As a result, when you step into a file (F11) that is not in your project, the PDBs are not loaded and you can’t debug the code. To work around this, change the project debugging setting by clicking **Dynamics 365 **&gt; **Options** &gt; **Debugging**. Verify that the **Load symbols only for items in the solution** check box is not selected. Another debugging setting that you may want to turn off is Intellitrace. Intellitrace collects the complete execution history of an application. It creates a lot of noise in the IDE when debugging. To turn off Intellitrace, click **Options** &gt; **IntelliTrace** &gt; **Enable IntelliTrace**, clear the check box, and then click **OK**. Note that Intellitrace is only available in the Ultimate version of Visual Studio. ![tt]\n\n## Address code migration tasks\nWhen metadata is migrated to Dynamics 365 for Operations, multiple auto-upgrade scripts are run. In the case where developers need to complete manual migration tasks, TO DOs and Best Practices (BP) have been added.\n\n-   TO DOs are prefixed with */\\* TODO: (Code Upgrade)*, and need to be be fixed as a part of code migration.\n-   BP migration specific rules also need to be fixed as part of code migration.\n\nThis tutorial uses the **PurchCommitment\\_PSN** form to walk you through the migration task of fixing navigation. Specifically, you will see examples of duplicate buttons and Action Pane TODOs.\n\n### Setup\n\n1.  In Visual Studio, open **Application Explorer**, and search for the form, PurchCommitment\\_PSN.\n2.  Click **OK**.\n3.  Right-click the project and select **Properties**.\n4.  In the Model property, select **Application Suite**.\n5.  In the Company property, select FRSI.\n6.  Note: The form is located in the French demo data company FRSI.\n7.  Press **Ctrl+F5 to** see the form.\n\nWhile the form looks complete, there are still code migration tasks necessary to be migration-complete. ![i]\n\n### Navigation migration tasks\n\n1.  In Visual Studio, build the project, and then on the toolbar, click **View** &gt; **Task List**.\n2.  Click the **Comments** drop-down list to view the TO DO: (Code Upgrade) tasks.\n3.  In the list, find the ActionPane TODOs.\n\n![j]\n\n### Code upgrade rule - Action Pane\n\nIn Dynamics 365 for Operations, the following core actions are provided as system-defined buttons:\n\n-   New\n-   Delete\n-   Edit\n-   Export\n\nAs part of the auto-migration, the Action Pane rule is run to identify redundant buttons. To complete this part of migration, you need to manually:\n\n-   Remove or move the code.\n-   Delete redundant controls in the application code.\n\n**Note**: In this tutorial, we will provide examples of how to migrate and modify the code on modeled buttons that replicate system-defined buttons. However, in practice, before making changes similar to those made in this tutorial, the code must first be evaluated with respect to the scenario to determine if it is still needed. First, fix the TODO for the DeleteCmdButton, which duplicates the system-defined Delete button.\n\n1.  In Visual Studio, find the TODO shown below, and then double-click the TODO.![k]\n2.  Replace the TODO and the line of code as shown below.\n    -   The state of the system-defined **Delete** button is controlled by the AllowDelete property on the firstmaster datasource. By setting AllowDelete to false, the delete task is kept from executing when the keyboard shortcut is used.\n\n            // Delete button\n            /* TODO: (Code Upgrade) [Action Pane Rule] Please consider moving all references to the form task override method and remove the control: DeleteCmdButton */\n            deleteCmdButton.enabled(purchCommitmentHeader && purchCommitmentHeader.canDelete());\n            PurchCommitmentHeader_DS.allowDelete(purchCommitmentHeader && purchCommitmentHeader.canDelete());\n\n3.  In the editor, find and remove DeleteCmdButton from the form design. ![l]\n4.  Press **Ctrl+S to** save the form.\n    -   Next, we will focus on the EditCmdButton that duplicates the system Edit button, handing the two TODOs associated with this button as well as removing this button.\n\n5.  In Visual Studio, find the TODO shown below, and then double-clickthe TODO.![m]\n6.  Because the visibility of the **Edit** button is controlled by the View/Edit mode of the form, you will need to modify this code so it sets that property. Replace the TODO and the line of code as shown in the following graphic.\n\n        /* TODO: (Code Upgrade) [Action Pane Rule] Please consider moving all references to the form task override method and remove the control: EditCmdButton */\n        editCmdButton.enabled(purchCommitmentHeader && isInDraftOrUnderRevisionStatus && !isInWorkFlowReviewState && !isLineReferenced);\n\n        if(purchCommitmentHeader && isInDraftOrUnderRevisionStatus && !isInWorkFlowReviewState && !isLineReferenced)\n        {\n            element.design().ViewEditMode(ViewEditMode::Auto);\n        }\n        else\n        {\n            element.design().ViewEditMode(ViewEditMode::View);\n\n        }\n\n7.   Double-click the other TODO for this button.![n]\n8.  Inspect the code on the modeled **Edit** button. This logic will need to be moved to the form’s task() method.\n\n        [Control(\"CommandButton\")]\n        class EditCmdButton\n        {\n            /* TODO: (Code Upgrade) [Action Pane Rule] Please consider moving this button code to the task override method and remove the control EditCmdButton. */\n            void clicked()\n            {\n                if (purchCommitmentHeader.WorkflowApprovalState ==     \n                    PurchCommitmentWorkflowApprovalState_PSN::Approved)\n                {\n                    if (Box::yesNo(strFmt(\"@SPS2140\", purchCommitmentHeader.CommitmentNumber), \n                        DialogButton::No) == DialogButton::Yes)\n                    {\n                        super();\n\n                        PurchCommitmentHeader_PSN::setWorkflowState(purchCommitmentHeader.RecId, \n                          PurchCommitmentWorkflowApprovalState_PSN::NotSubmitted);\n                    }\n                }\n                else\n                {\n                    super();\n                }\n            }\n        }\n\n9.  On the left side of the Visual Studio designer, right-click **Methods** &gt; **Override**, and select **Task**, to add an override for the form’s Task method.\n10. Update the task method as shown below so that the code from above is triggered when the system-defined **Edit** button is clicked.\n\n        /// \n            ///\n            /// \n            /// \n            /// \n            public int task(int _taskId)\n            {\n                #Task\n                int ret;\n\n                switch (_taskId)\n                {\n                    case #taskEditRecord:\n\n                        if (purchCommitmentHeader.WorkflowApprovalState == PurchCommitmentWorkflowApprovalState_PSN::Approved)\n                        {\n                            if (Box::yesNo(strFmt(\"@SPS2140\", purchCommitmentHeader.CommitmentNumber), DialogButton::No) == DialogButton::Yes)\n                            {\n                                ret = super(_taskId);\n\n                                PurchCommitmentHeader_PSN::setWorkflowState(purchCommitmentHeader.RecId, PurchCommitmentWorkflowApprovalState_PSN::NotSubmitted);\n                            }\n                        }\n                        else\n                        {\n                            ret = super(_taskId);\n                        }\n\n                        break;\n                    \n                    default:\n                        ret = super(_taskId);\n                        break;\n                }\n            \n                return ret;\n            }\n\n11. In the Editor, find and remove the **EditCmdButton** from the form design. ![o]\n12. Press **Ctrl+S** to save the form.\n13. Press **Ctrl+F5** to view the form. Notice the **Delete** and **Edit** buttons in the **Commitment** tab have been removed.\n\n### Best Practice migration warnings\n\n1.  In **Application Explorer**, search for **CosLineTree**.\n2.  Add the **CosLineTree** form and **CosLineTree** display menu item to the project.\n3.  Right-click the display menu item, and select **Set as Startup Object**.\n4.  Rebuild the project.\n5.  Go to the Error List to view the warnings.\n6.  In the BP filter, enter the word, *mouse*, to view the mouse related BP warnings.![p]\n7.  Double-click the warning to open the code editor.\n8.  Press **Ctrl+F5** to start the form.\n9.  Set a **breakpoint** on the **mouseDblClick** method.![q]\n10. In Visual Studio, attach to the client process by clicking **Debug** &gt; **Attach to Process**. Locate **w3wp.exe**.\n    -   Verify that you have selected the **Show process from all users** check box, or you might not see the w3wp.exe process.\n    -   Verify that you only have **Managed (v4.5, v4.0)** selected in the **Attach to** field.\n\n11. Click **Attach**, and then double-click the form grid.![s]\n    -   Notice the breakpoint is **not** hit (as mouseDblClick is no longer supported).\n\n12. Close the client.\n    -   In this case, we need to add a button to the form and add the code to the click() method on the button.\n\n13. Go to the form designer and find the tab page, **TabPage\\_Ledger.**\n    1.  Right-click the **Tabpage** to add a new Action Pane. Verify that this is above the grid.\n    2.  Right-click the Action Pane to add a new ButtonGroup.\n    3.  Right-click othe **ButtonGroup** and add a new button. The metadata should look like the following example. ![t]\n\n14. Select **FormButtonControl1 (Button)**, and then press **F4** to open the button properties. Change the property text to **Ledger Move**.\n15. Select **FormButtonControl1 (Button)**, right-click the **Methods** node, and add a Clicked() method.\n16. Select **FormButtonControl1 (Button)**, right-click the **Methods** node, and select **View Code**.\n17. Verify that the double-click code is migrated to the method.\n\n            [Control(\"Button\")]\n            class FormButtonControl1\n            {\n                /// \n                ///\n                /// \n                public void clicked()\n                {\n                    element.ledgerMove();\n                    super();\n                }\n\n            }\n\n18. When you run the form, the code is now migrated.\n\n**Note:** As part of migration, you should delete the mouseDblClick code because it has been migrated. In this example the form is not migrated, so there are still runtime issues.\n\n## Resolve casting exceptions\nIn Dynamics 365 for Operations, X++ is completely IL based and therefore has a stricter runtime type behavior than the interpreted Dynamics AX2 012. This stricter runtime type behavior can generate exceptions in migrated Dynamics AX 2012 R3 metadata. It is likely you will encounter these exceptions during your migration. The casting exceptions can be raised in different runtime scenarios, such as down-casting, casting runtime to design time objects, and side-casting. In this tutorial, we will walk through an example where a form, CosJournalName, is generating controls at runtime, and has a type mismatch which causes a .NET exception because it is strongly typed.\n\n### Example: Side-casting exception\n\n1.  In Visual Studio, select and right-click **Project Properties**, and verify that USMF is the default company.\n2.  Add the display menu item CosJournalName to your project, and set the menu item as your StartUp object.\n3.  Add the CosJournalName form to your project.\n4.  Add the cosDimCheckBoxController class to your project.\n5.  Rebuild your project.\n6.  Press **Ctrl+F5** to run the form.\n7.  Note that you will get an exception, similar to the following, when running the form.![u]\n8.  Right-click the class, cosDimCheckBoxController, and then select **View Code**.\n9.  Set a breakpoint on the cosDimCheckBoxController::getBuildControl().\n10. Press **F5**.\n    -   The breakpoint will be hit. This is where the casting error occurs. The reason for the casting error is because we are trying to return a control of type: FormBuildCheckboxControl and the object is expecting FormBuildStringControl.\n\n11. Hover over the buildcontrol to see the type and notice the differences.![v]\n12. Press **F10** to hit the exception.![w]\n13. Stop debugging.\n14. To fix the exception, change the method declaration from FormBuildStringControl to FormBuildCheckBoxControl.\n\n        protected FormBuildStringControl getBuildControl()\n        protected FormBuildCheckBoxControl getBuildControl()\n\n15. Rebuild the project, and press **Ctrl+F5**. The form should open successfully because the casting error is resolved.\n\n![a](media/a-1024x576.png)  \n\n## Context menu (advanced tutorial)\nIn Dynamics AX 2012, right-click context menus were modified by using the PopupMenu class. This class relied on Windows APIs that were not available on the web. In Dynamics 365 for Operations, the ContextMenu APIs have been created as replacements to provide similar functionality. The context() and showContextMenu() method overrides were the previous entry points to modifying context menus for specific controls, and these overrides traditionally contained code for adding options to a context menu as well as processing the user’s selection using a wait model. In Dynamics 365 for Operations, these overrides are being removed and the wait model eliminated. The result is that your will need to create two overrides: getContextMenuOptions() to add options to the context menu, and selectedMenuOption() to process the user’s selection. Migrating context menus in Dynamics 365 for Operations is a manual effort. Steps for context menu migration:\n\n1.  Add macros for each menu option added to the context menu.\n2.  Build the new context menu using the new *getContextMenuOptions()* override and the ContextMenu APIs.\n3.  Process the user’s selection using the new *selectedMenuOption()* override.\n\n### Form: SysDateLookup\n\nIn this example we will walk through the steps to migrate the context menu on a date control in the SysDateLookup form. The old context menu code currently has no effect in Dynamics 365 for Operations. To see the current context menu:\n\n1.  Add the SysDateLookup form to a project and set it as the startup object.\n2.  Start without debugging (**Ctrl+F5**).\n3.  Right-click the date field.\n\n![b](media/b1-1024x440.png) This context menu is meant to contain options for switching to the previous month and the next month. To start the migration process, first inspect the existing code for adding options to the context menu and for processing the user’s selection.\n\n-   Open the **SysDateLookup** form.\n-   Search for the **MontViewer** control on the design node and expand the **Methods** node.![c]\n-   Right-click the context override and click **View code**. We will be migrating this code as well as the code in **monthViewerContextCommon** (which you can view by right-clicking the method name and clicking **Go To Definition**).\n\n        void context()\n        {\n        PopupMenu popupMenu = new PopupMenu(this.hWnd());\n\n        element.monthViewerContextCommon(popupMenu);\n        }\n\n-   Go back to the designer for **SysDateLookup**. Right-click **Methods** under the **MontViewer** control and add an override for *getContextMenuOptions()*. This is where the context menu will be constructed. We will modify the code in this override later.\n-   Move to the *monthViewerContextCommon()* method. This function adds two options to the context menu and then processes the user’s selection.\n-   Find the menu options that are added to the context menu (choicePrev and choiceNext in this case), and add macros for each of these options at the top of the form.\n-   Add a method just under *monthViewerContextCommon()* called *monthViewerGetContextMenuOptions().* This will contain the migrated code from *monthViewerContextCommon()* for adding the two context menu options.\n-   Add these two options to the context menu using the new APIs in the *monthViewerGetContextMenuOptions()* method.\n-   The portion of *monthViewerContextCommon()* that needs to be migrated into *monthViewerGetContextMenuOptions()* is shown below.\n\n        void monthViewerContextCommon(PopupMenu popupMenu)\n        {\n        int    choicePrev,choiceNext,\n        choice;\n\n                choicePrev = popupMenu.insertItem(\"@SYS16527\");\n                choiceNext = popupMenu.insertItem(\"@SYS10078\");\n        ...\n\n-   The migration of adding these two context menu options is shown below.\n-   Modify *getContextMenuOptions()* as shown. Because system context menus in Dynamics 365 for Operationsonly include commands specific to a control, there is no need (or ability) to suppress the system context menu.\n\n        str monthViewerGetContextMenuOptions()\n        {\n        ContextMenu menu = new ContextMenu(); \n        List options = new List(types::Class);\n\n        ContextMenuOption choicePrev = ContextMenuOption::Create(\"@SYS16527\", #choicePrev); \n        options.addEnd(choicePrev);\n                \n        ContextMenuOption choiceNext = ContextMenuOption::Create(\"@SYS10078\", #choiceNext);         \n        options.addEnd(choiceNext); \n\n        menu.ContextMenuOptions(options); \n\n        return menu.Serialize(); \n        }\n\n        public str getContextMenuOptions()\n        {\n        str ret;\n                \n               ret = super();\n\n            ret = element.monthViewerGetContextMenuOptions();        \n\n               return ret;\n        }\n\n-   Go back to the designer for **SysDateLookup**. Right-click **Methods** under the **MontViewer** control and add an override for *selectedMenuOption()*. This is where the user’s selection will be processed. We will add code to this override later in the tutorial.\n-   Add a method just under *monthViewerGetContextMenuOptions()* called *monthViewerSelectedOption().* This will contain the migrated code from *monthViewerContextCommon()* for processing the user’s selection.\n-   Move code to the *monthViewerSelectedOption()* override (generally the switch statement after the old call to draw()). Be sure to modify the variables to match your macro definitions.\n\n           void monthViewerSelectedOption(int selectedOption)\n            {\n                switch (selectedOption)\n                {\n                    case #choicePrev:\n                        monthShown = calendarConverter.prevmth(monthShown);\n                        element.drawMonth();\n                        element.updateTable(daysTable);\n                        if (arabicCalendar)\n                            element.updateTable(hiddenDaysTable);\n                        break;\n                    case #choiceNext:\n                        monthShown = calendarConverter.nextmth(monthShown);\n                        element.drawMonth();\n                        element.updateTable(daysTable);\n                        if (arabicCalendar)\n                            element.updateTable(hiddenDaysTable);\n                        break;\n                }\n            }\n\n-   Modify *selectedMenuOption()* as shown below.\n\n        public void selectedMenuOption(int selectedOption)\n        {\n        super(selectedOption);\n\n        element.monthViewerSelectedOption(selectedOption); \n        }\n\n-   Delete the context() override from the MontViewer control.\n-   Typically you would be able to delete the *monthViewerContextCommon()* method. However, on this form there is another control **arabicMontViewer** with a context menu override (that we did not migrate in this tutorial) that calls this method. You can either leave the method, or migrate the context menu code on that button and then delete the method.\n-   Click **Ctrl+F5** to start the form without debugging. Notice the new options added to the bottom of the context menu. ![d](media/d2-1024x417.png)\n\n \n\n"}