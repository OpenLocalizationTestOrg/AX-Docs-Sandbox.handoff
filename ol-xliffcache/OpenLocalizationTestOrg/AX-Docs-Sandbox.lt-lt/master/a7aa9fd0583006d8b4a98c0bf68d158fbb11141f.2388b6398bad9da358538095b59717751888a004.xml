{"content":"---\n# required metadata\n\ntitle: Batch server overview\ndescription: This article describes batch processing and batch servers, and how to plan for their use.\nauthor: maertenm\nmanager: AnnBe\nms.date: 04/04/2017\nms.topic: article\nms.prod: \nms.service: dynamics-ax-platform\nms.technology: \n\n# optional metadata\n\n# ms.search.form: \n# ROBOTS: \naudience: IT Pro\n# ms.devlang: \nms.reviewer: annbe\nms.search.scope: AX 7.0.0, Operations, Core\n# ms.tgt_pltfrm: \nms.custom: 57201\nms.assetid: 22a56b7d-4e07-4161-8416-0cac4a0b65a2\nms.search.region: Global\n# ms.search.industry: \nms.author: maertenm\nms.search.validFrom: 2016-02-28\nms.dyn365.ops.version: AX 7.0.0\n\n---\n\n# Batch server overview\n\n[!include[banner](../includes/banner.md)]\n\n\nThis article describes batch processing and batch servers, and how to plan for their use.\n\nThe batch framework provides an asynchronous, server-based batch processing environment that can process tasks across multiple instances of Application Object Server (AOS). \n\nYou should become familiar with the following aspects of the batch framework:\n\n-   A **batch job** is a process that is used to achieve a specific goal. A batch job consists of one or more batch tasks.\n-   A **batch task** is an activity that is run by a batch job. You can add batch tasks that have multiple types of dependencies to a batch job. You can also configure AOS instances to run multiple threads, each of which runs a task. All batch tasks that are waiting to be run can be run by any available AOS instance that is configured as a batch server. To improve throughput and reduce overall execution time, you can define a batch job as many tasks and then use a batch server to run the tasks against all available AOS instances.\n-   A **batch group** is an attribute of a batch task. A batch group lets the administrator determine or specify which AOS instance runs the task. When you create a new task, it's put in the default batch group. All batch servers are configured to process the default batch group and the waiting tasks from any job. Additionally, you can create a named batch group, and then set an affinity between that batch group and specific AOS instances. After you create this affinity, only the specified AOS instances will process tasks from the named batch group, and those AOS instances will process tasks from the named batch group only. You can also add the default batch group to the configured servers, if that batch group is required.\n\n## Batch server topology planning\nThe capacity of a batch server is based on the maximum number of threads that can run concurrently on the AOS instance. Each thread runs one batch task. You can add complex dependencies between or among tasks. You can run these tasks in serial steps or parallel steps, depending on the business logic and requirements. All tasks that don't have any dependencies are considered parallel tasks. AOS instances that are configured as batch servers periodically check for tasks that are waiting to be processed. The batch server assigns each parallel task to a thread and starts to process the thread. \n\nYou can run multiple threads across multiple AOS instances. Each AOS instance automatically runs multiple threads, depending on that capacity that is defined in the configuration settings. Therefore, parallel tasks from a job can be run on multiple threads across multiple AOS instances.\n\nA batch server checks for available threads one time per minute. Therefore, you might have to wait for a minute before you see that a waiting task is picked up for processing by an available thread.\n\n## Batch server management planning\nAll batch servers can be managed from a single location. \n\nOne typical use of batch servers is to load balance jobs across multiple time zones and servers. You can define the period when an AOS instance acts as a batch server. You can also set the number of threads that the batch server will process during that period. The applicable times for the period are based on the user's time zone, not the time zone of the location of the AOS instance. The period is based on a scheduled start time and a scheduled end time. \n\nBecause batch servers are also active AOS instances that service requests from Microsoft Dynamics 365 for Finance and Operations clients and other associated components, you must carefully determine when an AOS instance should be available to process batches. \n\nFor example, a batch server is set to process only two batch threads from 8:00 AM to 6:00 PM in the time zone where it's located. However, from 6:00 PM to 7:30 AM, the server can be set to process 20 threads.\n\n## Walkthroughs\nThe following walkthroughs describe how tasks are processed, and how batch groups can be used to associate batch jobs with batch servers.\n\n### Batch processing of dependent tasks\n\nFor this example, you've created a job that is called JOB 1. As the following diagram shows, the job has seven tasks: TASK 1, TASK 2, TASK 3, TASK 4, TASK 5, TASK 6, and TASK 7. \n\n![A job that has dependent tasks](./media/batch_framework_programmability.gif) \n\nThe tasks have the following dependencies:\n\n-   TASK 1 is the first task.\n-   TASK 2 runs when TASK 1 is completed (regardless of the success or failure of TASK 1).\n-   TASK 3 runs when TASK 2 is successful.\n-   TASK 4 runs when TASK 2 is successful.\n-   TASK 5 runs when TASK 2 fails.\n-   TASK 6 runs when TASK 3 fails.\n-   TASK 7 runs when both TASK 3 and TASK 4 are successful.\n\nTwo batch servers, Batch1 and Batch2, are configured. Each server has a capacity of one thread. \n\nImagine that Batch1 checks for waiting tasks, assigns TASK 1 to its thread, and starts to run TASK 1. Although Batch2 and its single thread are also available, TASK 2 continues to wait until TASK 1 is completed. \n\nAs soon as TASK 1 is completed, TASK 2 is ready to be run. This time, imagine that Batch2 checks for waiting tasks, assigns TASK 2 to its thread, and starts to run TASK 2. \n\nIf TASK 2 is successful, TASK 3 and TASK 4 are ready to be run. This time, imagine that Batch2 checks for waiting tasks, assigns TASK 3 to its thread, and starts to run TASK 3. Batch1 also checks for waiting tasks, assigns TASK 4 to its thread, and starts to run TASK 4. \n\nIf TASK 3 and TASK 4 are successful, one of the batch servers runs TASK 7. \n\nIf TASK 2 fails, one of the batch servers runs TASK 5. \n\nIf TASK 3 fails, one of the available batch servers runs TASK 6. \n\n**Note:** For this walkthrough, we are using Batch1 and Batch2 to explain the concept. Any batch server that has available threads will start to run a waiting task. You must create a batch group to determine or specify which batch job runs on which server.\n\n### Batch processing that uses batch groups\n\nThis example shows how batch jobs can be processed on specific batch servers. \n\nYou have three batch servers: AOS1, AOS2, and AOS3. By default, all the batch servers process tasks from all batch jobs, depending on the number of available threads. \n\nYou create a named batch group, BG1, and configure it to run on AOS2 and AOS3. Therefore, tasks from jobs in BG1 will run only on AOS2 or AOS3, depending on the number available threads. AOS1 won't process tasks from jobs in BG1. Likewise, AOS2 and AOS3 will process tasks from BG1 only. \n\nYou can configure AOS2 and AOS3 to process tasks from other batch groups. These batch groups include the default batch group.\n\n\n\n","nodes":[{"pos":[32,53],"content":"Batch server overview","needQuote":true,"needEscape":true,"nodes":[{"content":"Batch server overview","pos":[0,21]}]},{"pos":[67,156],"content":"This article describes batch processing and batch servers, and how to plan for their use.","needQuote":true,"needEscape":true,"nodes":[{"content":"This article describes batch processing and batch servers, and how to plan for their use.","pos":[0,89]}]},{"pos":[657,678],"content":"Batch server overview","linkify":"Batch server overview","nodes":[{"content":"Batch server overview","pos":[0,21]}]},{"content":"This article describes batch processing and batch servers, and how to plan for their use.","pos":[724,813]},{"content":"The batch framework provides an asynchronous, server-based batch processing environment that can process tasks across multiple instances of Application Object Server (AOS).","pos":[815,987]},{"content":"You should become familiar with the following aspects of the batch framework:","pos":[990,1067]},{"content":"A <bpt id=\"p1\">**</bpt>batch job<ept id=\"p1\">**</ept> is a process that is used to achieve a specific goal.","pos":[1073,1142],"source":"A **batch job** is a process that is used to achieve a specific goal."},{"content":"A batch job consists of one or more batch tasks.","pos":[1143,1191]},{"content":"A <bpt id=\"p1\">**</bpt>batch task<ept id=\"p1\">**</ept> is an activity that is run by a batch job.","pos":[1196,1255],"source":"A **batch task** is an activity that is run by a batch job."},{"content":"You can add batch tasks that have multiple types of dependencies to a batch job.","pos":[1256,1336]},{"content":"You can also configure AOS instances to run multiple threads, each of which runs a task.","pos":[1337,1425]},{"content":"All batch tasks that are waiting to be run can be run by any available AOS instance that is configured as a batch server.","pos":[1426,1547]},{"content":"To improve throughput and reduce overall execution time, you can define a batch job as many tasks and then use a batch server to run the tasks against all available AOS instances.","pos":[1548,1727]},{"content":"A <bpt id=\"p1\">**</bpt>batch group<ept id=\"p1\">**</ept> is an attribute of a batch task.","pos":[1732,1782],"source":"A **batch group** is an attribute of a batch task."},{"content":"A batch group lets the administrator determine or specify which AOS instance runs the task.","pos":[1783,1874]},{"content":"When you create a new task, it's put in the default batch group.","pos":[1875,1939]},{"content":"All batch servers are configured to process the default batch group and the waiting tasks from any job.","pos":[1940,2043]},{"content":"Additionally, you can create a named batch group, and then set an affinity between that batch group and specific AOS instances.","pos":[2044,2171]},{"content":"After you create this affinity, only the specified AOS instances will process tasks from the named batch group, and those AOS instances will process tasks from the named batch group only.","pos":[2172,2359]},{"content":"You can also add the default batch group to the configured servers, if that batch group is required.","pos":[2360,2460]},{"pos":[2465,2495],"content":"Batch server topology planning","linkify":"Batch server topology planning","nodes":[{"content":"Batch server topology planning","pos":[0,30]}]},{"content":"The capacity of a batch server is based on the maximum number of threads that can run concurrently on the AOS instance.","pos":[2496,2615]},{"content":"Each thread runs one batch task.","pos":[2616,2648]},{"content":"You can add complex dependencies between or among tasks.","pos":[2649,2705]},{"content":"You can run these tasks in serial steps or parallel steps, depending on the business logic and requirements.","pos":[2706,2814]},{"content":"All tasks that don't have any dependencies are considered parallel tasks.","pos":[2815,2888]},{"content":"AOS instances that are configured as batch servers periodically check for tasks that are waiting to be processed.","pos":[2889,3002]},{"content":"The batch server assigns each parallel task to a thread and starts to process the thread.","pos":[3003,3092]},{"content":"You can run multiple threads across multiple AOS instances.","pos":[3095,3154]},{"content":"Each AOS instance automatically runs multiple threads, depending on that capacity that is defined in the configuration settings.","pos":[3155,3283]},{"content":"Therefore, parallel tasks from a job can be run on multiple threads across multiple AOS instances.","pos":[3284,3382]},{"content":"A batch server checks for available threads one time per minute.","pos":[3384,3448]},{"content":"Therefore, you might have to wait for a minute before you see that a waiting task is picked up for processing by an available thread.","pos":[3449,3582]},{"pos":[3587,3619],"content":"Batch server management planning","linkify":"Batch server management planning","nodes":[{"content":"Batch server management planning","pos":[0,32]}]},{"content":"All batch servers can be managed from a single location.","pos":[3620,3676]},{"content":"One typical use of batch servers is to load balance jobs across multiple time zones and servers.","pos":[3679,3775]},{"content":"You can define the period when an AOS instance acts as a batch server.","pos":[3776,3846]},{"content":"You can also set the number of threads that the batch server will process during that period.","pos":[3847,3940]},{"content":"The applicable times for the period are based on the user's time zone, not the time zone of the location of the AOS instance.","pos":[3941,4066]},{"content":"The period is based on a scheduled start time and a scheduled end time.","pos":[4067,4138]},{"content":"Because batch servers are also active AOS instances that service requests from Microsoft Dynamics 365 for Finance and Operations clients and other associated components, you must carefully determine when an AOS instance should be available to process batches.","pos":[4141,4400]},{"content":"For example, a batch server is set to process only two batch threads from 8:00 AM to 6:00 PM in the time zone where it's located.","pos":[4403,4532]},{"content":"However, from 6:00 PM to 7:30 AM, the server can be set to process 20 threads.","pos":[4533,4611]},{"pos":[4616,4628],"content":"Walkthroughs","linkify":"Walkthroughs","nodes":[{"content":"Walkthroughs","pos":[0,12]}]},{"content":"The following walkthroughs describe how tasks are processed, and how batch groups can be used to associate batch jobs with batch servers.","pos":[4629,4766]},{"pos":[4772,4807],"content":"Batch processing of dependent tasks","linkify":"Batch processing of dependent tasks","nodes":[{"content":"Batch processing of dependent tasks","pos":[0,35]}]},{"content":"For this example, you've created a job that is called JOB 1.","pos":[4809,4869]},{"content":"As the following diagram shows, the job has seven tasks: TASK 1, TASK 2, TASK 3, TASK 4, TASK 5, TASK 6, and TASK 7.","pos":[4870,4986]},{"content":"A job that has dependent tasks","pos":[4991,5021]},{"content":"The tasks have the following dependencies:","pos":[5070,5112]},{"content":"TASK 1 is the first task.","pos":[5118,5143]},{"content":"TASK 2 runs when TASK 1 is completed (regardless of the success or failure of TASK 1).","pos":[5148,5234]},{"content":"TASK 3 runs when TASK 2 is successful.","pos":[5239,5277]},{"content":"TASK 4 runs when TASK 2 is successful.","pos":[5282,5320]},{"content":"TASK 5 runs when TASK 2 fails.","pos":[5325,5355]},{"content":"TASK 6 runs when TASK 3 fails.","pos":[5360,5390]},{"content":"TASK 7 runs when both TASK 3 and TASK 4 are successful.","pos":[5395,5450]},{"content":"Two batch servers, Batch1 and Batch2, are configured.","pos":[5452,5505]},{"content":"Each server has a capacity of one thread.","pos":[5506,5547]},{"content":"Imagine that Batch1 checks for waiting tasks, assigns TASK 1 to its thread, and starts to run TASK 1.","pos":[5550,5651]},{"content":"Although Batch2 and its single thread are also available, TASK 2 continues to wait until TASK 1 is completed.","pos":[5652,5761]},{"content":"As soon as TASK 1 is completed, TASK 2 is ready to be run.","pos":[5764,5822]},{"content":"This time, imagine that Batch2 checks for waiting tasks, assigns TASK 2 to its thread, and starts to run TASK 2.","pos":[5823,5935]},{"content":"If TASK 2 is successful, TASK 3 and TASK 4 are ready to be run.","pos":[5938,6001]},{"content":"This time, imagine that Batch2 checks for waiting tasks, assigns TASK 3 to its thread, and starts to run TASK 3.","pos":[6002,6114]},{"content":"Batch1 also checks for waiting tasks, assigns TASK 4 to its thread, and starts to run TASK 4.","pos":[6115,6208]},{"content":"If TASK 3 and TASK 4 are successful, one of the batch servers runs TASK 7.","pos":[6211,6285]},{"content":"If TASK 2 fails, one of the batch servers runs TASK 5.","pos":[6288,6342]},{"content":"If TASK 3 fails, one of the available batch servers runs TASK 6.","pos":[6345,6409]},{"content":"<bpt id=\"p1\">**</bpt>Note:<ept id=\"p1\">**</ept> For this walkthrough, we are using Batch1 and Batch2 to explain the concept.","pos":[6412,6498],"source":"**Note:** For this walkthrough, we are using Batch1 and Batch2 to explain the concept."},{"content":"Any batch server that has available threads will start to run a waiting task.","pos":[6499,6576]},{"content":"You must create a batch group to determine or specify which batch job runs on which server.","pos":[6577,6668]},{"pos":[6674,6713],"content":"Batch processing that uses batch groups","linkify":"Batch processing that uses batch groups","nodes":[{"content":"Batch processing that uses batch groups","pos":[0,39]}]},{"content":"This example shows how batch jobs can be processed on specific batch servers.","pos":[6715,6792]},{"content":"You have three batch servers: AOS1, AOS2, and AOS3.","pos":[6795,6846]},{"content":"By default, all the batch servers process tasks from all batch jobs, depending on the number of available threads.","pos":[6847,6961]},{"content":"You create a named batch group, BG1, and configure it to run on AOS2 and AOS3.","pos":[6964,7042]},{"content":"Therefore, tasks from jobs in BG1 will run only on AOS2 or AOS3, depending on the number available threads.","pos":[7043,7150]},{"content":"AOS1 won't process tasks from jobs in BG1.","pos":[7151,7193]},{"content":"Likewise, AOS2 and AOS3 will process tasks from BG1 only.","pos":[7194,7251]},{"content":"You can configure AOS2 and AOS3 to process tasks from other batch groups.","pos":[7254,7327]},{"content":"These batch groups include the default batch group.","pos":[7328,7379]}]}