{"nodes":[{"pos":[32,87],"content":"PerfSDK and multiuser testing with Visual Studio Online","needQuote":true,"needEscape":true,"nodes":[{"content":"PerfSDK and multiuser testing with Visual Studio Online","pos":[0,55]}]},{"pos":[101,291],"content":"Take a tour of Performance SDK and multiuser testing with Visual Studio Online and learn how convert a scenario recorded with Task Recorder into a single user test and then a multiuser test.","needQuote":true,"needEscape":true,"nodes":[{"content":"Take a tour of Performance SDK and multiuser testing with Visual Studio Online and learn how convert a scenario recorded with Task Recorder into a single user test and then a multiuser test.","pos":[0,190]}]},{"pos":[797,852],"content":"PerfSDK and multiuser testing with Visual Studio Online","linkify":"PerfSDK and multiuser testing with Visual Studio Online","nodes":[{"content":"PerfSDK and multiuser testing with Visual Studio Online","pos":[0,55]}]},{"content":"Take a tour of Performance SDK and multiuser testing with Visual Studio Online and learn how convert a scenario recorded with Task Recorder into a single user test and then a multiuser test.","pos":[854,1044]},{"content":"<bpt id=\"p1\">*</bpt>Time:<ept id=\"p1\">*</ept> 30 minutes In this lab, you will take a tour of Performance SDK and multi user testing with Visual Studio Online.","pos":[1046,1167],"source":"*Time:* 30 minutes In this lab, you will take a tour of Performance SDK and multi user testing with Visual Studio Online."},{"content":"You will see how to convert a scenario recorded with Task Recorder and convert it to a single user test and then a multi user test.","pos":[1168,1299]},{"content":"<bpt id=\"p1\">**</bpt>Note:<ept id=\"p1\">**</ept> This lab requires that you access the environment as an administrator.","pos":[1300,1380],"source":"**Note:** This lab requires that you access the environment as an administrator."},{"content":"For more information, refer to the document named <bpt id=\"p1\">[</bpt>Access Microsoft Dynamics 365 for Operations Instances<ept id=\"p1\">](access-instances.md)</ept>.","pos":[1381,1509],"source":" For more information, refer to the document named [Access Microsoft Dynamics 365 for Operations Instances](access-instances.md)."},{"content":"<bpt id=\"p1\">**</bpt>Prerequisites<ept id=\"p1\">**</ept>","pos":[1510,1527],"source":"**Prerequisites**"},{"content":"Visual Studio 2015 Enterprise","pos":[1533,1562]},{"content":"Deployment with Volume Data","pos":[1567,1594]},{"content":"PerfSDK (look for a folder with that name in the C: or F: drive, depending on your environment)","pos":[1599,1694]},{"pos":[1699,1759],"content":"Steps to create a single user C\\# test from an XML recording","linkify":"Steps to create a single user C\\# test from an XML recording","nodes":[{"content":"Steps to create a single user C<ph id=\"ph1\">\\#</ph> test from an XML recording","pos":[0,60],"source":"Steps to create a single user C\\# test from an XML recording"}]},{"pos":[1760,1912],"content":"A video about how to create a single user test can be found here: <bpt id=\"p1\">[</bpt>https://mix.office.com/watch/qtdlasy2rcf3<ept id=\"p1\">](https://mix.office.com/watch/qtdlasy2rcf3)</ept>","source":"A video about how to create a single user test can be found here: [https://mix.office.com/watch/qtdlasy2rcf3](https://mix.office.com/watch/qtdlasy2rcf3)"},{"content":"Create a recording of a scenario that you want to test with Task Recorder.","pos":[1918,1992]},{"content":"Run Visual Studio as Administrator.","pos":[1997,2032]},{"content":"Build the PerfSDKSample project, which is in the PerfSDK folder.","pos":[2033,2097]},{"content":"If you have already done this, skip this step.","pos":[2098,2144]},{"content":"Open <bpt id=\"p1\">**</bpt>Dynamics 365<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Addins<ept id=\"p2\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>C<ph id=\"ph3\">\\#</ph><ept id=\"p3\">**</ept> perf test generator add-in from Visual Studio.","pos":[2149,2246],"source":"Open **Dynamics 365** &gt; **Addins** &gt; **C\\#** perf test generator add-in from Visual Studio."},{"content":"Go to <bpt id=\"p1\">**</bpt>Dynamics 365 <ept id=\"p1\">**</ept><ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Addins<ept id=\"p2\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>Create C<ph id=\"ph3\">\\#</ph> perf test from recording<ept id=\"p3\">**</ept>.","pos":[2247,2331],"source":" Go to **Dynamics 365 **&gt; **Addins** &gt; **Create C\\# perf test from recording**."},{"content":"You should see the following dialog.","pos":[2336,2372]},{"content":"Fill in the required details and click <bpt id=\"p1\">**</bpt>Import<ept id=\"p1\">**</ept>.<bpt id=\"p2\">[</bpt><ph id=\"ph1\">![</ph>perf103a<ept id=\"p2\">](./media/perf103a.png)](./media/perf103a.png)</ept>","pos":[2373,2480],"source":" Fill in the required details and click **Import**.[![perf103a](./media/perf103a.png)](./media/perf103a.png)"},{"content":"You should see generated C<ph id=\"ph1\">\\#</ph> test in Generated folder in the project that you’ve selected.","pos":[2485,2575],"source":"You should see generated C\\# test in Generated folder in the project that you’ve selected."},{"pos":[2580,2636],"content":"Steps to run single user performance test with Perf SDK:","linkify":"Steps to run single user performance test with Perf SDK:","nodes":[{"content":"Steps to run single user performance test with Perf SDK:","pos":[0,56]}]},{"content":"Check that testroot environment variable is set to Perf SDK folder.","pos":[2641,2708]},{"content":"Go to <bpt id=\"p1\">**</bpt>Control Panel<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>System and Security<ept id=\"p2\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>System<ept id=\"p3\">**</ept> <ph id=\"ph3\">&amp;gt;</ph> <bpt id=\"p4\">**</bpt>Advanced System Settings<ept id=\"p4\">**</ept>.","pos":[2709,2812],"source":" Go to **Control Panel** &gt; **System and Security** &gt; **System** &gt; **Advanced System Settings**."},{"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>testroot<ept id=\"p1\">](./media/testroot.jpg)](./media/testroot.jpg)</ept><bpt id=\"p2\">[</bpt><ept id=\"p2\">](./media/perf103c.png)</ept>","pos":[2813,2894],"source":"[![testroot](./media/testroot.jpg)](./media/testroot.jpg)[](./media/perf103c.png)"},{"pos":[2899,3137],"content":"Download <bpt id=\"p1\">*</bpt>selenium-dotnet-strongnamed-2.42.0.zip<ept id=\"p1\">*</ept> and <bpt id=\"p2\">*</bpt>IEDriverServer<ph id=\"ph1\">\\_</ph>Win32<ph id=\"ph2\">\\_</ph>2.42.0.zip<ept id=\"p2\">*</ept> from <bpt id=\"p3\">[</bpt><bpt id=\"p4\">*</bpt>http://selenium-release.storage.googleapis.com/index.html?path=2.42/<ept id=\"p4\">*</ept><ept id=\"p3\">](http://selenium-release.storage.googleapis.com/index.html?path=2.42/)</ept>.","source":"Download *selenium-dotnet-strongnamed-2.42.0.zip* and *IEDriverServer\\_Win32\\_2.42.0.zip* from [*http://selenium-release.storage.googleapis.com/index.html?path=2.42/*](http://selenium-release.storage.googleapis.com/index.html?path=2.42/)."},{"pos":[3153,3319],"content":"Make sure to copy download dll's to the following folder and add a reference to WebDriver.dll to your project<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>perf103d<ept id=\"p1\">](./media/perf103d.png)](./media/perf103d.png)</ept>","source":"Make sure to copy download dll's to the following folder and add a reference to WebDriver.dll to your project[![perf103d](./media/perf103d.png)](./media/perf103d.png)"},{"content":"Generate certificate and install it.","pos":[3324,3360]},{"content":"To generate a certificate file, run the following commands: <bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>generatecert<ept id=\"p1\">](./media/generatecert.jpg)](./media/generatecert.jpg)</ept>When prompted for private key password, select <bpt id=\"p2\">**</bpt>None.<ept id=\"p2\">**</ept>","pos":[3361,3546],"source":" To generate a certificate file, run the following commands: [![generatecert](./media/generatecert.jpg)](./media/generatecert.jpg)When prompted for private key password, select **None.**"},{"content":"You should see the following files: <bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>tempcert<ept id=\"p1\">](./media/tempcert.jpg)](./media/tempcert.jpg)</ept><bpt id=\"p2\">**</bpt>Notable pieces:<ept id=\"p2\">**</ept>","pos":[3547,3659],"source":" You should see the following files: [![tempcert](./media/tempcert.jpg)](./media/tempcert.jpg)**Notable pieces:**"},{"content":"-n “CN=TestAuthCert” is giving a human-readable name to the cert, feel free to tweak for your scenario.","pos":[3664,3767]},{"content":"-eku 1.3.6.1.5.5.7.3.2 is certificate purpose.","pos":[3772,3818]},{"content":"This is a client authentication cert, as opposed to code signing, encryption or something else.","pos":[3819,3914]},{"content":"Next, install <ph id=\"ph1\">\\*</ph>.pfx file (make sure to select Local Machine when you install it)  and copy this certificate file to PerfSDK folder.","pos":[3915,4047],"source":" Next, install \\*.pfx file (make sure to select Local Machine when you install it)  and copy this certificate file to PerfSDK folder."},{"content":"Open powershell window as Administator and run the following command to get a thumbprint of installed certificate: <bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>get-thumbprint<ept id=\"p1\">](./media/get-thumbprint.jpg)](./media/get-thumbprint.jpg)</ept>Put this thumbprint value in <bpt id=\"p2\">**</bpt>CloudEnvironment.Config<ept id=\"p2\">**</ept> file: <bpt id=\"p3\">[</bpt><ph id=\"ph2\">![</ph>config-thumbprint<ept id=\"p3\">](./media/config-thumbprint.jpg)](./media/config-thumbprint.jpg)</ept> The next step is to update <bpt id=\"p4\">**</bpt>wif.config<ept id=\"p4\">**</ept> to make AOS trust this certificate.","pos":[4049,4464],"source":"Open powershell window as Administator and run the following command to get a thumbprint of installed certificate: [![get-thumbprint](./media/get-thumbprint.jpg)](./media/get-thumbprint.jpg)Put this thumbprint value in **CloudEnvironment.Config** file: [![config-thumbprint](./media/config-thumbprint.jpg)](./media/config-thumbprint.jpg) The next step is to update **wif.config** to make AOS trust this certificate."},{"content":"To do that, open IIS and find Dynamics 365 for Operations in the list of sites.","pos":[4465,4544]},{"content":"Click <bpt id=\"p1\">**</bpt>Explore<ept id=\"p1\">**</ept> to open and find a file <bpt id=\"p2\">**</bpt>wif.config<ept id=\"p2\">**</ept>.","pos":[4545,4602],"source":" Click **Explore** to open and find a file **wif.config**."},{"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>wifconfig<ept id=\"p1\">](./media/wifconfig.jpg)](./media/wifconfig.jpg)</ept> Update this file by putting your certificate and authority name: <bpt id=\"p2\">[</bpt><ph id=\"ph2\">![</ph>wif-updated<ept id=\"p2\">](./media/wif-updated.jpg)](./media/wif-updated.jpg)</ept> And restart IIS.","pos":[4603,4812],"source":"[![wifconfig](./media/wifconfig.jpg)](./media/wifconfig.jpg) Update this file by putting your certificate and authority name: [![wif-updated](./media/wif-updated.jpg)](./media/wif-updated.jpg) And restart IIS."},{"content":"Open Sample project in Visual Studio and edit the file PurchaseReq.cs, which is a sample single user test.","pos":[4813,4919]},{"content":"Comment the following lines in this file: <bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>perf103e<ept id=\"p1\">](./media/perf103e.png)](./media/perf103e.png)</ept> Modify your CloudEnvironment.Config file by entering your admin username.","pos":[4920,5093],"source":" Comment the following lines in this file: [![perf103e](./media/perf103e.png)](./media/perf103e.png) Modify your CloudEnvironment.Config file by entering your admin username."},{"content":"The following code is a example.","pos":[5094,5126]},{"content":"<bpt id=\"p1\">**</bpt>Note:<ept id=\"p1\">**</ept> The ConfigName must be DEVFABRIC.","pos":[5127,5170],"source":"**Note:** The ConfigName must be DEVFABRIC."},{"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>perf103f<ept id=\"p1\">](./media/perf103f.png)](./media/perf103f.png)</ept> Enter your endpoint in CloudEnvironment.Config.","pos":[5171,5276],"source":"[![perf103f](./media/perf103f.png)](./media/perf103f.png) Enter your endpoint in CloudEnvironment.Config."},{"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>: If you have an ARR-enabled environment, i.e. you have 2 endpoints like this:","pos":[5277,5363],"source":"**Note**: If you have an ARR-enabled environment, i.e. you have 2 endpoints like this:"},{"pos":[5369,5414],"content":"apr-arr8aos<bpt id=\"p1\">**</bpt>soap<ept id=\"p1\">**</ept>.axcloud.test.dynamics.com","source":"apr-arr8aos**soap**.axcloud.test.dynamics.com"},{"content":"apr-arr8aos.axcloud.test.dynamics.com","pos":[5419,5456]},{"content":"You would need to enter both endpoints in CloudEnvironment.Config: <bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>perf103upd<ept id=\"p1\">](./media/perf103upd.png)](./media/perf103upd.png)</ept> Go to <bpt id=\"p2\">**</bpt>Test<ept id=\"p2\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>Test settings<ept id=\"p3\">**</ept> <ph id=\"ph3\">&amp;gt;</ph> <bpt id=\"p4\">**</bpt>Default processor architecture<ept id=\"p4\">**</ept> and set it to x64.","pos":[5458,5685],"source":"You would need to enter both endpoints in CloudEnvironment.Config: [![perf103upd](./media/perf103upd.png)](./media/perf103upd.png) Go to **Test** &gt; **Test settings** &gt; **Default processor architecture** and set it to x64."},{"content":"Build the solution.","pos":[5686,5705]},{"content":"Go to <bpt id=\"p1\">**</bpt>Test<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Windows<ept id=\"p2\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>Test Explorer<ept id=\"p3\">**</ept> <bpt id=\"p4\">**</bpt>Note:<ept id=\"p4\">**</ept> Sometimes Visual Studio may not update the list of tests.","pos":[5706,5828],"source":" Go to **Test** &gt; **Windows** &gt; **Test Explorer** **Note:** Sometimes Visual Studio may not update the list of tests."},{"content":"In this case, restart Visual Studio and re-open the test Explorer.","pos":[5829,5895]},{"content":"<bpt id=\"p1\">**</bpt>Note:<ept id=\"p1\">**</ept> Your newly created test will be named TestMethod.","pos":[5896,5955],"source":"**Note:** Your newly created test will be named TestMethod."},{"content":"If you change the method name of TestMethod your test will get an individual name.","pos":[5956,6038]},{"content":"Now you can run the test.","pos":[6039,6064]},{"content":"You should see Internet Explorer starting and replaying the scenario that you've recorded.","pos":[6065,6155]},{"pos":[6160,6215],"content":"Steps to create a multiuser test from a singleuser test","linkify":"Steps to create a multiuser test from a singleuser test","nodes":[{"content":"Steps to create a multiuser test from a singleuser test","pos":[0,55]}]},{"content":"To convert a single-user test generated in the previous section to multi-user test, add MS.Dynamics.TestTools.UIHelpers.Core; to your test script and replace the following line in TestSetup method.","pos":[6216,6413]},{"content":"Make sure the values that you have entered during task recording are randomized.","pos":[6571,6651]},{"content":"You may need to use the Data Expansion Tool first to generate test data.","pos":[6652,6724]},{"pos":[6729,6777],"content":"Setup Visual Studio Online for multiuser testing","linkify":"Setup Visual Studio Online for multiuser testing","nodes":[{"content":"Setup Visual Studio Online for multiuser testing","pos":[0,48]}]},{"content":"For this example ProcureToPay.cs will be used.","pos":[6778,6824]},{"content":"You need to go to log in to <bpt id=\"p1\">[</bpt>Visual Studio Online portal<ept id=\"p1\">](https://app.vssps.visualstudio.com/profile/view)</ept> and launch Visual Studio from there.","pos":[6825,6968],"source":" You need to go to log in to [Visual Studio Online portal](https://app.vssps.visualstudio.com/profile/view) and launch Visual Studio from there."},{"content":"Note: you need to do this only once.","pos":[6969,7005]},{"content":"Once you have logged in in VSO, those settings are saved.","pos":[7006,7063]},{"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>vsonline-5<ept id=\"p1\">](./media/vsonline-5-1024x323.jpg)](./media/vsonline-5.jpg)</ept> Open PerfSDK sample project.","pos":[7064,7165],"source":"[![vsonline-5](./media/vsonline-5-1024x323.jpg)](./media/vsonline-5.jpg) Open PerfSDK sample project."},{"content":"Make sure to update UserFormat entry in CloudEnvironment.Config file to reflect admin user url.","pos":[7166,7261]},{"content":"Example: for <bpt id=\"p1\">[</bpt><ph id=\"ph1\">admin@example.com</ph><ept id=\"p1\">]()</ept> use <bpt id=\"p2\">[</bpt>TST<ph id=\"ph2\">\\_</ph>{0}<ph id=\"ph3\">@example.com</ph><ept id=\"p2\">]()</ept> as user format.","pos":[7262,7341],"source":" Example: for [admin@example.com]() use [TST\\_{0}@example.com]() as user format."},{"content":"Also make sure to change the UserCount to the amount of users you want to have in your performance test.","pos":[7342,7446]},{"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>vsonline-12<ept id=\"p1\">](./media/vsonline-12.jpg)](./media/vsonline-12.jpg)</ept> Run this command in PerfSDK folder: <bpt id=\"p2\">**</bpt>MS.Dynamics.Performance.CreateUsers.exe<ept id=\"p2\">**</ept> to create test users for your environment.","pos":[7447,7636],"source":"[![vsonline-12](./media/vsonline-12.jpg)](./media/vsonline-12.jpg) Run this command in PerfSDK folder: **MS.Dynamics.Performance.CreateUsers.exe** to create test users for your environment."},{"content":"You may create as many users as you want to, for this example 150 is used.","pos":[7637,7711]},{"content":"<bpt id=\"p1\">*</bpt>Example: <ept id=\"p1\">*</ept><bpt id=\"p2\">*</bpt>MS.Dynamics.Performance.CreateUsers.exe 150 USMF<ept id=\"p2\">*</ept><bpt id=\"p3\">*</bpt> will create 150 test users for company USMF.<ept id=\"p3\">*</ept>","pos":[7712,7820],"source":"*Example: **MS.Dynamics.Performance.CreateUsers.exe 150 USMF** will create 150 test users for company USMF.*"},{"content":"Make sure that users were created in the system.","pos":[7821,7869]},{"content":"Login to your endpoint as admin user and check.","pos":[7870,7917]},{"pos":[7923,7938],"content":"Testing sandbox","linkify":"Testing sandbox","nodes":[{"content":"Testing sandbox","pos":[0,15]}]},{"content":"This step assumes you have a developer topology.","pos":[7940,7988]},{"content":"Please follow the instructions from previous paragraph.","pos":[7989,8044]},{"content":"There is one additional step you need to do in order to establish trust between your developer topology and/or Visual Studio Online test agent to communicate to sandbox machines: You would need to remote desktop to your AOS machine, copy over .cer file, install it by double-clicking on the file.","pos":[8045,8341]},{"content":"When prompted for certificate store select <bpt id=\"p1\">**</bpt>Personal:<ept id=\"p1\">**</ept> <bpt id=\"p2\">**</bpt><bpt id=\"p3\">[</bpt><ph id=\"ph1\">![</ph>personalstore<ept id=\"p3\">](./media/personalstore.jpg)](./media/personalstore.jpg)</ept><ept id=\"p2\">**</ept>And update file <bpt id=\"p4\">**</bpt>wif.config<ept id=\"p4\">**</ept>.","pos":[8342,8506],"source":" When prompted for certificate store select **Personal:** **[![personalstore](./media/personalstore.jpg)](./media/personalstore.jpg)**And update file **wif.config**."},{"content":"To update file <bpt id=\"p1\">**</bpt>wif.config<ept id=\"p1\">**</ept>, open IIS, find AOSService among websites and click Explore <bpt id=\"p2\">[</bpt><ph id=\"ph1\">![</ph>vsonline-23<ept id=\"p2\">](./media/vsonline-231.jpg)](./media/vsonline-231.jpg)</ept> This action would open Explorer, you should be able to find <bpt id=\"p3\">**</bpt>wif.config<ept id=\"p3\">**</ept> in the opened folder.","pos":[8507,8762],"source":" To update file **wif.config**, open IIS, find AOSService among websites and click Explore [![vsonline-23](./media/vsonline-231.jpg)](./media/vsonline-231.jpg) This action would open Explorer, you should be able to find **wif.config** in the opened folder."},{"content":"Update this file by putting certificate thumbprint and CN values (use the values from certificate you've generated on previous steps): <bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>wif-updated<ept id=\"p1\">](./media/wif-updated.jpg)](./media/wif-updated.jpg)</ept> And restart IIS.","pos":[8763,8981],"source":" Update this file by putting certificate thumbprint and CN values (use the values from certificate you've generated on previous steps): [![wif-updated](./media/wif-updated.jpg)](./media/wif-updated.jpg) And restart IIS."},{"content":"Now you can run performance tests against this topology.","pos":[8982,9038]},{"content":"<bpt id=\"p1\">**</bpt>Note:<ept id=\"p1\">**</ept> if your topology has multiple AOS machines, you need to install certificate and update wif.config on each of those machines.","pos":[9039,9173],"source":"**Note:** if your topology has multiple AOS machines, you need to install certificate and update wif.config on each of those machines."},{"pos":[9178,9198],"content":"Run performance test","linkify":"Run performance test","nodes":[{"content":"Run performance test","pos":[0,20]}]},{"content":"Open ProcureToPay.cs in Visual Studio editor and append the following lines in TestSetup method:","pos":[9199,9295]},{"content":"var testroot = System.Environment.GetEnvironmentVariable(\"DeploymentDir\"); if (string.IsNullOrEmpty(testroot)) { testroot = System.IO.Directory.GetCurrentDirectory(); } Environment.SetEnvironmentVariable(\"testroot\", testroot);","pos":[9761,9987]},{"content":"Double click on file vsonline.testsettings in your solution files, use the following settings (your PerfSDK folder may be different): <bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>vsonline-29<ept id=\"p1\">](./media/vsonline-29.jpg)](./media/vsonline-29.jpg)</ept> In <bpt id=\"p2\">**</bpt>Setup and Cleanup Scripts<ept id=\"p2\">**</ept> select setup.cmd located in %testroot%Visual Studio Onlinesetup.cmd.","pos":[9991,10293],"source":"Double click on file vsonline.testsettings in your solution files, use the following settings (your PerfSDK folder may be different): [![vsonline-29](./media/vsonline-29.jpg)](./media/vsonline-29.jpg) In **Setup and Cleanup Scripts** select setup.cmd located in %testroot%Visual Studio Onlinesetup.cmd."},{"content":"<bpt id=\"p1\">**</bpt>Notable pieces:<ept id=\"p1\">**</ept> you may need to update your deployment configuration to reflect your certificate name (for this demo <bpt id=\"p2\">**</bpt>CsuClient.pfx <ept id=\"p2\">**</ept>is used) and password.","pos":[10294,10455],"source":"**Notable pieces:** you may need to update your deployment configuration to reflect your certificate name (for this demo **CsuClient.pfx **is used) and password."},{"content":"Make sure add <ph id=\"ph1\">\\*</ph>.pfx file you've generated previously and update the following files:","pos":[10456,10541],"source":" Make sure add \\*.pfx file you've generated previously and update the following files:"},{"pos":[10547,10658],"content":"<bpt id=\"p1\">**</bpt>setup.cmd<ept id=\"p1\">**</ept> with %DeploymentDirectory%CloudCtuFakeACSInstall.cmd %DeploymentDirectory%<bpt id=\"p2\">**</bpt>YourCertificate.pfx<ept id=\"p2\">**</ept>","source":"**setup.cmd** with %DeploymentDirectory%CloudCtuFakeACSInstall.cmd %DeploymentDirectory%**YourCertificate.pfx**"},{"pos":[10663,10757],"content":"<bpt id=\"p1\">**</bpt>CloudCtuFakeACSInstall.cmd<ept id=\"p1\">**</ept> with the password of your cert (that should be an empty string)","source":"**CloudCtuFakeACSInstall.cmd** with the password of your cert (that should be an empty string)"},{"content":"In <bpt id=\"p1\">**</bpt>Additional Settings<ept id=\"p1\">**</ept> select <bpt id=\"p2\">**</bpt>Run tests in 64 bit process on 64 bit machine.<ept id=\"p2\">**</ept>","pos":[10759,10843],"source":"In **Additional Settings** select **Run tests in 64 bit process on 64 bit machine.**"},{"content":"To run the test, open the <bpt id=\"p1\">**</bpt>SampleLoadTest.loadtest<ept id=\"p1\">**</ept> file and select <bpt id=\"p2\">**</bpt>Run Load Test<ept id=\"p2\">**</ept>.","pos":[10844,10932],"source":" To run the test, open the **SampleLoadTest.loadtest** file and select **Run Load Test**."},{"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>perf103u<ept id=\"p1\">](./media/perf103u.png)](./media/perf103u.png)</ept> When the test finishes, you should see a summary with transaction results.","pos":[10933,11065],"source":"[![perf103u](./media/perf103u.png)](./media/perf103u.png) When the test finishes, you should see a summary with transaction results."},{"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>perf103v<ept id=\"p1\">](./media/perf103v.png)](./media/perf103v.png)</ept> You can switch to <bpt id=\"p2\">**</bpt>Graphs view<ept id=\"p2\">**</ept> to view different indicators for the test controller and test scenario.","pos":[11066,11229],"source":"[![perf103v](./media/perf103v.png)](./media/perf103v.png) You can switch to **Graphs view** to view different indicators for the test controller and test scenario."},{"content":"<bpt id=\"p1\">**</bpt>Note:<ept id=\"p1\">**</ept> Information about your System under Test is not available in this view.","pos":[11230,11311],"source":"**Note:** Information about your System under Test is not available in this view."},{"content":"To access this information you would have to use LCS to monitor your AOS CPU and memory usage, or set up perfmon directly on the AOS and set up the SQL/Windows Azure portal to monitor SQL DTU usage.","pos":[11312,11510]},{"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>perf103w<ept id=\"p1\">](./media/perf103w.png)](./media/perf103w.png)</ept>","pos":[11511,11568],"source":"[![perf103w](./media/perf103w.png)](./media/perf103w.png)"},{"pos":[11573,11588],"content":"Troubleshooting","linkify":"Troubleshooting","nodes":[{"content":"Troubleshooting","pos":[0,15]}]},{"content":"If you see an error message like this: <bpt id=\"p1\">*</bpt>System.TypeInitializationException: System.TypeInitializationException: The type initializer for 'MS.Dynamics.TestTools.CloudCommonTestUtilities.Authentication.UserManagement' threw an exception. ---<ph id=\"ph1\">&amp;gt;</ph> System.ServiceModel.CommunicationException: An error occurred while making the HTTP request to https://sandbox.ax.dynamics.com/Services/AxUserManagement/Service.svc/ws2007FedHttp. <ept id=\"p1\">*</ept><bpt id=\"p2\">*</bpt>This could be due to the fact that the server certificate is not configured properly with HTTP.SYS in the HTTPS case. This could also be caused by a mismatch of the security binding between the client and the server.<ept id=\"p2\">*</ept><bpt id=\"p3\">*</bpt><ph id=\"ph2\"> ---</ph><ph id=\"ph3\">&amp;gt;</ph> System.Net.WebException: The underlying connection was closed: An unexpected error occurred on a send. ---<ph id=\"ph4\">&amp;gt;</ph> System.IO.IOException: Unable to read data from the transport connection: An existing connection was forcibly closed by the remote host. ---<ph id=\"ph5\">&amp;gt;</ph> System.Net.Sockets.SocketException: An existing connection was forcibly closed by the remote host.<ept id=\"p3\">*</ept>","pos":[11589,12597],"source":"If you see an error message like this: *System.TypeInitializationException: System.TypeInitializationException: The type initializer for 'MS.Dynamics.TestTools.CloudCommonTestUtilities.Authentication.UserManagement' threw an exception. ---&gt; System.ServiceModel.CommunicationException: An error occurred while making the HTTP request to https://sandbox.ax.dynamics.com/Services/AxUserManagement/Service.svc/ws2007FedHttp. **This could be due to the fact that the server certificate is not configured properly with HTTP.SYS in the HTTPS case. This could also be caused by a mismatch of the security binding between the client and the server.** ---&gt; System.Net.WebException: The underlying connection was closed: An unexpected error occurred on a send. ---&gt; System.IO.IOException: Unable to read data from the transport connection: An existing connection was forcibly closed by the remote host. ---&gt; System.Net.Sockets.SocketException: An existing connection was forcibly closed by the remote host.*"},{"content":"you would need to run the following powershell script on your <bpt id=\"p1\">**</bpt>development machine<ept id=\"p1\">**</ept>:","pos":[12598,12684],"source":" you would need to run the following powershell script on your **development machine**:"},{"content":"Set-ItemProperty HKLM:SOFTWAREMicrosoft.NETFrameworkv4.0.30319 -Name SchUseStrongCrypto -Value 1 -Type dword -Force -Confirm:$false if ((Test-Path HKLM:SOFTWAREWow6432NodeMicrosoft.NETFrameworkv4.0.30319)) { Set-ItemProperty HKLM:SOFTWAREWow6432NodeMicrosoft.NETFrameworkv4.0.30319 -Name SchUseStrongCrypto -Value 1 -Type dword -Force -Confirm:$false }","pos":[13402,13754]}],"content":"---\n# required metadata\n\ntitle: PerfSDK and multiuser testing with Visual Studio Online\ndescription: Take a tour of Performance SDK and multiuser testing with Visual Studio Online and learn how convert a scenario recorded with Task Recorder into a single user test and then a multiuser test.\nauthor: RobinARH\nmanager: AnnBe\nms.date: 2015-10-16 20 - 27 - 26\nms.topic: article\nms.prod: \nms.service: Dynamics365Operations\nms.technology: \n\n# optional metadata\n\n# ms.search.form: \n# ROBOTS: \naudience: Developer\n# ms.devlang: \n# ms.reviewer: 2051\nms.search.scope: AX 7.0.0, Operations\n# ms.tgt_pltfrm: \nms.custom: 9954\nms.assetid: e09bd6d3-99b9-4772-ae73-8c46308bb2fc\nms.search.region: Global\n# ms.search.industry: \nms.author: chwolf\nms.dyn365.ops.intro: Feb-16\nms.dyn365.ops.version: AX 7.0.0\n\n---\n\n# PerfSDK and multiuser testing with Visual Studio Online\n\nTake a tour of Performance SDK and multiuser testing with Visual Studio Online and learn how convert a scenario recorded with Task Recorder into a single user test and then a multiuser test.\n\n*Time:* 30 minutes In this lab, you will take a tour of Performance SDK and multi user testing with Visual Studio Online. You will see how to convert a scenario recorded with Task Recorder and convert it to a single user test and then a multi user test. **Note:** This lab requires that you access the environment as an administrator. For more information, refer to the document named [Access Microsoft Dynamics 365 for Operations Instances](access-instances.md). **Prerequisites**\n\n-   Visual Studio 2015 Enterprise\n-   Deployment with Volume Data\n-   PerfSDK (look for a folder with that name in the C: or F: drive, depending on your environment)\n\n## Steps to create a single user C\\# test from an XML recording\nA video about how to create a single user test can be found here: [https://mix.office.com/watch/qtdlasy2rcf3](https://mix.office.com/watch/qtdlasy2rcf3)\n\n1.  Create a recording of a scenario that you want to test with Task Recorder.\n2.  Run Visual Studio as Administrator. Build the PerfSDKSample project, which is in the PerfSDK folder. If you have already done this, skip this step.\n3.  Open **Dynamics 365** &gt; **Addins** &gt; **C\\#** perf test generator add-in from Visual Studio. Go to **Dynamics 365 **&gt; **Addins** &gt; **Create C\\# perf test from recording**.\n4.  You should see the following dialog. Fill in the required details and click **Import**.[![perf103a](./media/perf103a.png)](./media/perf103a.png)\n5.  You should see generated C\\# test in Generated folder in the project that you’ve selected.\n\n## Steps to run single user performance test with Perf SDK:\n-   Check that testroot environment variable is set to Perf SDK folder. Go to **Control Panel** &gt; **System and Security** &gt; **System** &gt; **Advanced System Settings**. [![testroot](./media/testroot.jpg)](./media/testroot.jpg)[](./media/perf103c.png)\n-   Download *selenium-dotnet-strongnamed-2.42.0.zip* and *IEDriverServer\\_Win32\\_2.42.0.zip* from [*http://selenium-release.storage.googleapis.com/index.html?path=2.42/*](http://selenium-release.storage.googleapis.com/index.html?path=2.42/).\n\n<!-- -->\n\n-   Make sure to copy download dll's to the following folder and add a reference to WebDriver.dll to your project[![perf103d](./media/perf103d.png)](./media/perf103d.png)\n-   Generate certificate and install it. To generate a certificate file, run the following commands: [![generatecert](./media/generatecert.jpg)](./media/generatecert.jpg)When prompted for private key password, select **None.** You should see the following files: [![tempcert](./media/tempcert.jpg)](./media/tempcert.jpg)**Notable pieces:**\n-   -n “CN=TestAuthCert” is giving a human-readable name to the cert, feel free to tweak for your scenario.\n-   -eku 1.3.6.1.5.5.7.3.2 is certificate purpose. This is a client authentication cert, as opposed to code signing, encryption or something else. Next, install \\*.pfx file (make sure to select Local Machine when you install it)  and copy this certificate file to PerfSDK folder.\n\nOpen powershell window as Administator and run the following command to get a thumbprint of installed certificate: [![get-thumbprint](./media/get-thumbprint.jpg)](./media/get-thumbprint.jpg)Put this thumbprint value in **CloudEnvironment.Config** file: [![config-thumbprint](./media/config-thumbprint.jpg)](./media/config-thumbprint.jpg) The next step is to update **wif.config** to make AOS trust this certificate. To do that, open IIS and find Dynamics 365 for Operations in the list of sites. Click **Explore** to open and find a file **wif.config**. [![wifconfig](./media/wifconfig.jpg)](./media/wifconfig.jpg) Update this file by putting your certificate and authority name: [![wif-updated](./media/wif-updated.jpg)](./media/wif-updated.jpg) And restart IIS. Open Sample project in Visual Studio and edit the file PurchaseReq.cs, which is a sample single user test. Comment the following lines in this file: [![perf103e](./media/perf103e.png)](./media/perf103e.png) Modify your CloudEnvironment.Config file by entering your admin username. The following code is a example. **Note:** The ConfigName must be DEVFABRIC. [![perf103f](./media/perf103f.png)](./media/perf103f.png) Enter your endpoint in CloudEnvironment.Config. **Note**: If you have an ARR-enabled environment, i.e. you have 2 endpoints like this:\n\n-   apr-arr8aos**soap**.axcloud.test.dynamics.com\n-   apr-arr8aos.axcloud.test.dynamics.com\n\nYou would need to enter both endpoints in CloudEnvironment.Config: [![perf103upd](./media/perf103upd.png)](./media/perf103upd.png) Go to **Test** &gt; **Test settings** &gt; **Default processor architecture** and set it to x64. Build the solution. Go to **Test** &gt; **Windows** &gt; **Test Explorer** **Note:** Sometimes Visual Studio may not update the list of tests. In this case, restart Visual Studio and re-open the test Explorer. **Note:** Your newly created test will be named TestMethod. If you change the method name of TestMethod your test will get an individual name. Now you can run the test. You should see Internet Explorer starting and replaying the scenario that you've recorded.\n\n## Steps to create a multiuser test from a singleuser test\nTo convert a single-user test generated in the previous section to multi-user test, add MS.Dynamics.TestTools.UIHelpers.Core; to your test script and replace the following line in TestSetup method.\n\n    Client = DispatchedClient.DefaultInstance;\n    With\n    DispatchedClientHelper helper = new DispatchedClientHelper();\n    Client = helper.GetClient();\n\nMake sure the values that you have entered during task recording are randomized. You may need to use the Data Expansion Tool first to generate test data.\n\n## Setup Visual Studio Online for multiuser testing\nFor this example ProcureToPay.cs will be used. You need to go to log in to [Visual Studio Online portal](https://app.vssps.visualstudio.com/profile/view) and launch Visual Studio from there. Note: you need to do this only once. Once you have logged in in VSO, those settings are saved. [![vsonline-5](./media/vsonline-5-1024x323.jpg)](./media/vsonline-5.jpg) Open PerfSDK sample project. Make sure to update UserFormat entry in CloudEnvironment.Config file to reflect admin user url. Example: for [admin@example.com]() use [TST\\_{0}@example.com]() as user format. Also make sure to change the UserCount to the amount of users you want to have in your performance test. [![vsonline-12](./media/vsonline-12.jpg)](./media/vsonline-12.jpg) Run this command in PerfSDK folder: **MS.Dynamics.Performance.CreateUsers.exe** to create test users for your environment. You may create as many users as you want to, for this example 150 is used. *Example: **MS.Dynamics.Performance.CreateUsers.exe 150 USMF** will create 150 test users for company USMF.* Make sure that users were created in the system. Login to your endpoint as admin user and check.\n\n### Testing sandbox\n\nThis step assumes you have a developer topology. Please follow the instructions from previous paragraph. There is one additional step you need to do in order to establish trust between your developer topology and/or Visual Studio Online test agent to communicate to sandbox machines: You would need to remote desktop to your AOS machine, copy over .cer file, install it by double-clicking on the file. When prompted for certificate store select **Personal:** **[![personalstore](./media/personalstore.jpg)](./media/personalstore.jpg)**And update file **wif.config**. To update file **wif.config**, open IIS, find AOSService among websites and click Explore [![vsonline-23](./media/vsonline-231.jpg)](./media/vsonline-231.jpg) This action would open Explorer, you should be able to find **wif.config** in the opened folder. Update this file by putting certificate thumbprint and CN values (use the values from certificate you've generated on previous steps): [![wif-updated](./media/wif-updated.jpg)](./media/wif-updated.jpg) And restart IIS. Now you can run performance tests against this topology. **Note:** if your topology has multiple AOS machines, you need to install certificate and update wif.config on each of those machines.\n\n## Run performance test\nOpen ProcureToPay.cs in Visual Studio editor and append the following lines in TestSetup method:\n\n|                                                                                                                                                                                                                                    |\n|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| var testroot = System.Environment.GetEnvironmentVariable(\"DeploymentDir\"); if (string.IsNullOrEmpty(testroot)) { testroot = System.IO.Directory.GetCurrentDirectory(); } Environment.SetEnvironmentVariable(\"testroot\", testroot); |\n\nDouble click on file vsonline.testsettings in your solution files, use the following settings (your PerfSDK folder may be different): [![vsonline-29](./media/vsonline-29.jpg)](./media/vsonline-29.jpg) In **Setup and Cleanup Scripts** select setup.cmd located in %testroot%Visual Studio Onlinesetup.cmd. **Notable pieces:** you may need to update your deployment configuration to reflect your certificate name (for this demo **CsuClient.pfx **is used) and password. Make sure add \\*.pfx file you've generated previously and update the following files:\n\n-   **setup.cmd** with %DeploymentDirectory%CloudCtuFakeACSInstall.cmd %DeploymentDirectory%**YourCertificate.pfx**\n-   **CloudCtuFakeACSInstall.cmd** with the password of your cert (that should be an empty string)\n\nIn **Additional Settings** select **Run tests in 64 bit process on 64 bit machine.** To run the test, open the **SampleLoadTest.loadtest** file and select **Run Load Test**. [![perf103u](./media/perf103u.png)](./media/perf103u.png) When the test finishes, you should see a summary with transaction results. [![perf103v](./media/perf103v.png)](./media/perf103v.png) You can switch to **Graphs view** to view different indicators for the test controller and test scenario. **Note:** Information about your System under Test is not available in this view. To access this information you would have to use LCS to monitor your AOS CPU and memory usage, or set up perfmon directly on the AOS and set up the SQL/Windows Azure portal to monitor SQL DTU usage. [![perf103w](./media/perf103w.png)](./media/perf103w.png)\n\n## Troubleshooting\nIf you see an error message like this: *System.TypeInitializationException: System.TypeInitializationException: The type initializer for 'MS.Dynamics.TestTools.CloudCommonTestUtilities.Authentication.UserManagement' threw an exception. ---&gt; System.ServiceModel.CommunicationException: An error occurred while making the HTTP request to https://sandbox.ax.dynamics.com/Services/AxUserManagement/Service.svc/ws2007FedHttp. **This could be due to the fact that the server certificate is not configured properly with HTTP.SYS in the HTTPS case. This could also be caused by a mismatch of the security binding between the client and the server.** ---&gt; System.Net.WebException: The underlying connection was closed: An unexpected error occurred on a send. ---&gt; System.IO.IOException: Unable to read data from the transport connection: An existing connection was forcibly closed by the remote host. ---&gt; System.Net.Sockets.SocketException: An existing connection was forcibly closed by the remote host.* you would need to run the following powershell script on your **development machine**:\n\n|                                                                                                                                                                                                                                                                                                                                                                  |\n|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| Set-ItemProperty HKLM:SOFTWAREMicrosoft.NETFrameworkv4.0.30319 -Name SchUseStrongCrypto -Value 1 -Type dword -Force -Confirm:$false if ((Test-Path HKLM:SOFTWAREWow6432NodeMicrosoft.NETFrameworkv4.0.30319)) { Set-ItemProperty HKLM:SOFTWAREWow6432NodeMicrosoft.NETFrameworkv4.0.30319 -Name SchUseStrongCrypto -Value 1 -Type dword -Force -Confirm:$false } |\n\n\n\n"}