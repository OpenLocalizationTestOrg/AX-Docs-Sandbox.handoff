{"nodes":[{"pos":[32,155],"content":"Copy a Dynamics 365 for Operations database from SQL Server to a production Azure SQL Database environment | Microsoft Docs","needQuote":true,"needEscape":true,"nodes":[{"content":"Copy a Dynamics 365 for Operations database from SQL Server to a production Azure SQL Database environment | Microsoft Docs","pos":[0,123]}]},{"pos":[169,377],"content":"This topic describes how to move a Dynamics 365 for Operations database from an environment that runs on SQL Server (Tier 1 or one-box) to an environment that runs on an Azure SQL database (Tier 2 or higher).","needQuote":true,"needEscape":true,"nodes":[{"content":"This topic describes how to move a Dynamics 365 for Operations database from an environment that runs on SQL Server (Tier 1 or one-box) to an environment that runs on an Azure SQL database (Tier 2 or higher).","pos":[0,208]}]},{"pos":[816,922],"content":"Copy a Dynamics 365 for Operations database from SQL Server to a production Azure SQL Database environment","linkify":"Copy a Dynamics 365 for Operations database from SQL Server to a production Azure SQL Database environment","nodes":[{"content":"Copy a Dynamics 365 for Operations database from SQL Server to a production Azure SQL Database environment","pos":[0,106]}]},{"content":"This topic describes how to move a Dynamics 365 for Operations database from an environment that runs on SQL Server (Tier 1 or one-box) to an environment that runs on an Azure SQL database (Tier 2 or higher).","pos":[924,1132]},{"pos":[1135,1143],"content":"Overview","linkify":"Overview","nodes":[{"content":"Overview","pos":[0,8]}]},{"content":"This procedure can be used to move a Microsoft Dynamics 365 for Operations database from an environment that runs on Microsoft SQL Server (Tier 1 or one-box) to an environment that runs on a Microsoft Azure SQL database (Tier 2 or higher).","pos":[1154,1393]},{"content":"This process is typically performed before go-live to bring a golden (or seed) database that contains only system configuration data into a production environment.","pos":[1394,1557]},{"content":"This process isn't suitable for all situations.","pos":[1558,1605]},{"content":"For example, you should not use this process to import data for a new legal entity for an existing live deployment.","pos":[1606,1721]},{"content":"In those situations, we recommend that you use <bpt id=\"p1\">[</bpt>process data packages<ept id=\"p1\">](https://docs.microsoft.com/en-us/dynamics365/operations/dev-itpro/lifecycle-services/process-data-packages-lcs-solutions)</ept> or <bpt id=\"p2\">[</bpt>data entity data packages<ept id=\"p2\">](https://docs.microsoft.com/en-us/dynamics365/operations/dev-itpro/data-entities/using-data-entities-and-data-packages)</ept>.","pos":[1722,2065],"source":" In those situations, we recommend that you use [process data packages](https://docs.microsoft.com/en-us/dynamics365/operations/dev-itpro/lifecycle-services/process-data-packages-lcs-solutions) or [data entity data packages](https://docs.microsoft.com/en-us/dynamics365/operations/dev-itpro/data-entities/using-data-entities-and-data-packages)."},{"content":"Here is the supported procedure for bringing a golden database into the production environment:","pos":[2066,2161]},{"content":"A customer or partner exports the database from SQL Server.","pos":[2167,2226]},{"content":"The customer or partner imports the database to a sandbox environment that runs on an Azure SQL database.","pos":[2231,2336]},{"content":"<bpt id=\"p1\">**</bpt>Note:<ept id=\"p1\">**</ept> If you're using Retail components raise a service request of the <bpt id=\"p2\">**</bpt>Other request<ept id=\"p2\">**</ept> type in Microsoft Dynamics Lifecycle Services (LCS) to ask that the Service Engineering Team update the imported database to be reconfigured for the new environment.","pos":[2337,2595],"source":"**Note:** If you're using Retail components raise a service request of the **Other request** type in Microsoft Dynamics Lifecycle Services (LCS) to ask that the Service Engineering Team update the imported database to be reconfigured for the new environment."},{"pos":[2600,2812],"content":"The customer or partner uses a service request of the <bpt id=\"p1\">**</bpt>Other request<ept id=\"p1\">**</ept> type in Microsoft Dynamics Lifecycle Services (LCS) to ask that Microsoft Support update the sandbox database to the production environment.","source":"The customer or partner uses a service request of the **Other request** type in Microsoft Dynamics Lifecycle Services (LCS) to ask that Microsoft Support update the sandbox database to the production environment."},{"content":"Support copies the database from the sandbox environment to the production environment.","pos":[2817,2904]},{"content":"<bpt id=\"p1\">**</bpt>Note:<ept id=\"p1\">**</ept> Microsoft accepts requests to copy a database into a production environment only before go-live.","pos":[2905,3011],"source":"**Note:** Microsoft accepts requests to copy a database into a production environment only before go-live."},{"content":"li<ph id=\"ph1\">&amp;gt;</ph>","pos":[3012,3018],"source":" li&gt;"},{"content":"The process for moving a database involves using the sqlpackage.exe command-line tool to export the database from SQL Server and import it into an Azure SQL database.","pos":[3020,3186]},{"content":"Because the file name extension for the exported data file is .bacpac, the process is often referred to as the bacpac process.","pos":[3187,3313]},{"content":"Here are the high-level steps:","pos":[3314,3344]},{"content":"Create a copy of the source database.","pos":[3350,3387]},{"content":"Run a script to prepare the database.","pos":[3392,3429]},{"content":"Export the database from SQL Server.","pos":[3434,3470]},{"content":"Import the database into an Azure SQL database.","pos":[3475,3522]},{"content":"Run a script to update the database.","pos":[3527,3563]},{"content":"If you encounter issues, see the <bpt id=\"p1\">[</bpt>Known issues and limitations<ept id=\"p1\">](#issues)</ept> section at the end of this topic.","pos":[3565,3671],"source":"If you encounter issues, see the [Known issues and limitations](#issues) section at the end of this topic."},{"content":"It explains how to troubleshoot, gives performance tips, and explains limitations of the copy process.","pos":[3672,3774]},{"pos":[3779,3792],"content":"Prerequisites","linkify":"Prerequisites","nodes":[{"content":"Prerequisites","pos":[0,13]}]},{"content":"The source SQL Server–based environment must be running Microsoft SQL Server 2016 Release to Manufacturing (RTM) (13.0.1601.5) or later.","pos":[3797,3933]},{"content":"The Community Technology Preview (CTP) versions of SQL Server 2016 might cause errors.","pos":[3934,4020]},{"content":"If the source environment is running an earlier version of SQL Server 2016, you must first back up the database and restore it to another environment that is running SQL Server 2016 RTM (13.0.1601.5) or later.","pos":[4021,4230]},{"content":"To import a database into an Azure SQL Database environment, you must install the <bpt id=\"p1\">[</bpt>latest version of Microsoft SQL Server Management Studio<ept id=\"p1\">](https://msdn.microsoft.com/en-us/library/mt238290.aspx)</ept> on the Application Object Server (AOS) computer in <bpt id=\"p2\">**</bpt>that<ept id=\"p2\">**</ept> environment and perform the bacpac import on the AOS computer.","pos":[4235,4554],"source":"To import a database into an Azure SQL Database environment, you must install the [latest version of Microsoft SQL Server Management Studio](https://msdn.microsoft.com/en-us/library/mt238290.aspx) on the Application Object Server (AOS) computer in **that** environment and perform the bacpac import on the AOS computer."},{"content":"There are two reasons for this requirement:","pos":[4555,4598]},{"content":"Because of an Internet Protocol (IP) access restriction on all instances of Dynamics 365 for Operations that run on Azure SQL Database, connections are allowed only from a computer in that environment.","pos":[4607,4808]},{"content":"The version of Management Studio that is installed by default is for a previous version of SQL Server and can't perform the required tasks.","pos":[4817,4956]},{"content":"<bpt id=\"p1\">**</bpt>Important:<ept id=\"p1\">**</ept> If your environment includes Retail components, you must manually store some environment-specific values before you begin.","pos":[4958,5095],"source":"**Important:** If your environment includes Retail components, you must manually store some environment-specific values before you begin."},{"content":"See the <bpt id=\"p1\">[</bpt>Additional steps for Retail environments<ept id=\"p1\">](#retail)</ept> section.","pos":[5096,5164],"source":" See the [Additional steps for Retail environments](#retail) section."},{"pos":[5169,5185],"content":"Before you begin","linkify":"Before you begin","nodes":[{"content":"Before you begin","pos":[0,16]}]},{"content":"Encrypted and environment-specific values can't be imported into a new environment.","pos":[5186,5269]},{"content":"After you've completed the import, you must re-enter some data from your source environment in your target environment.","pos":[5270,5389]},{"pos":[5395,5434],"content":"Document the values of encrypted fields","linkify":"Document the values of encrypted fields","nodes":[{"content":"Document the values of encrypted fields","pos":[0,39]}]},{"content":"Because of a technical limitation that is related to the certificate that is used for data encryption, values that are stored in encrypted fields in a database will be unreadable after that database is imported into a new environment.","pos":[5436,5670]},{"content":"Therefore, after an import, you must manually delete and re-enter values that are stored in encrypted fields.","pos":[5671,5780]},{"content":"New values that are entered in encrypted fields after an import will be readable.","pos":[5781,5862]},{"content":"The following fields are affected.","pos":[5863,5897]},{"content":"(The field names are given in <bpt id=\"p1\">*</bpt>Table<ept id=\"p1\">*</ept>.<bpt id=\"p2\">*</bpt>Field<ept id=\"p2\">*</ept> format.)","pos":[5898,5952],"source":" (The field names are given in *Table*.*Field* format.)"},{"pos":[6432,6452],"content":"<bpt id=\"p1\">**</bpt>Table.field name<ept id=\"p1\">**</ept>","source":"**Table.field name**"},{"pos":[6491,6517],"content":"<bpt id=\"p1\">**</bpt>Where to set the value<ept id=\"p1\">**</ept>","source":"**Where to set the value**"},{"content":"CreditCardAccountSetup.SecureMerchantProperties","pos":[6670,6717]},{"pos":[6729,6809],"content":"Click <bpt id=\"p1\">**</bpt>Accounts receivable<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Payments setup<ept id=\"p2\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>Payment services<ept id=\"p3\">**</ept>.","source":"Click **Accounts receivable** &gt; **Payments setup** &gt; **Payment services**."},{"content":"ExchangeRateProviderConfigurationDetails.Value","pos":[6908,6954]},{"pos":[6967,7055],"content":"Click <bpt id=\"p1\">**</bpt>General ledger<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Currencies<ept id=\"p2\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>Configure exchange rate providers<ept id=\"p3\">**</ept>.","source":"Click **General ledger** &gt; **Currencies** &gt; **Configure exchange rate providers**."},{"content":"FiscalEstablishment<ph id=\"ph1\">\\_</ph>BR.ConsumerEFDocCsc","pos":[7146,7186],"source":"FiscalEstablishment\\_BR.ConsumerEFDocCsc"},{"pos":[7205,7305],"content":"Click <bpt id=\"p1\">**</bpt>Organization administration<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Fiscal establishments<ept id=\"p2\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>Fiscal establishments<ept id=\"p3\">**</ept>.","source":"Click **Organization administration** &gt; **Fiscal establishments** &gt; **Fiscal establishments**."},{"content":"FiscalEstablishmentStaging.CSC","pos":[7384,7414]},{"content":"This field is used by the Data Import/Export Framework","pos":[7443,7497]},{"content":"HcmPersonIdentificationNumber.PersonIdentificationNumber","pos":[7622,7678]},{"content":"Click <bpt id=\"p1\">**</bpt>Human resources<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Workers<ept id=\"p2\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>Workers<ept id=\"p3\">**</ept>.","pos":[7681,7741],"source":"Click **Human resources** &gt; **Workers** &gt; **Workers**."},{"content":"On the <bpt id=\"p1\">**</bpt>Worker<ept id=\"p1\">**</ept> tab, in the <bpt id=\"p2\">**</bpt>Personal information<ept id=\"p2\">**</ept> group, click <bpt id=\"p3\">**</bpt>Identification numbers<ept id=\"p3\">**</ept>.","pos":[7742,7837],"source":" On the **Worker** tab, in the **Personal information** group, click **Identification numbers**."},{"content":"HcmWorkerActionHire.PersonIdentificationNumber","pos":[7860,7906]},{"content":"This field has been obsolete since the February 2016 release.","pos":[7919,7980]},{"content":"It was previously in the <bpt id=\"p1\">**</bpt>Human resources<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Workers<ept id=\"p2\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>Actions<ept id=\"p3\">**</ept> <ph id=\"ph3\">&amp;gt;</ph> <bpt id=\"p4\">**</bpt>All worker actions<ept id=\"p4\">**</ept> form.","pos":[7981,8093],"source":" It was previously in the **Human resources** &gt; **Workers** &gt; **Actions** &gt; **All worker actions** form."},{"content":"SysEmailSMPTPassword.Password","pos":[8098,8127]},{"pos":[8157,8230],"content":"Click <bpt id=\"p1\">**</bpt>System administration<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Email<ept id=\"p2\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>Email parameters<ept id=\"p3\">**</ept>.","source":"Click **System administration** &gt; **Email** &gt; **Email parameters**."},{"content":"SysOAuthUserTokens.EncryptedAccessToken","pos":[8336,8375]},{"content":"This field is used internally by the AOS.","pos":[8395,8436]},{"content":"It can be ignored.","pos":[8437,8455]},{"content":"SysOAuthUserTokens.EncryptedRefr eshToken","pos":[8574,8615]},{"content":"This field is used internally by the AOS.","pos":[8633,8674]},{"content":"It can be ignored.","pos":[8675,8693]},{"pos":[8818,8905],"content":"If you're running Retail components, document encrypted and environment-specific values","linkify":"If you're running Retail components, document encrypted and environment-specific values","nodes":[{"content":"If you're running Retail components, document encrypted and environment-specific values","pos":[0,87]}]},{"content":"The values in the following forms are either environment-specific or encrypted in the database.","pos":[8907,9002]},{"content":"Therefore, all the imported values will be incorrect.","pos":[9003,9056]},{"content":"Accounts receivable <ph id=\"ph1\">&amp;gt;</ph> Payments setup <ph id=\"ph2\">&amp;gt;</ph> Payments services","pos":[9062,9124],"source":"Accounts receivable &gt; Payments setup &gt; Payments services"},{"content":"Retail and commerce <ph id=\"ph1\">&amp;gt;</ph> Channel setup <ph id=\"ph2\">&amp;gt;</ph> POS setup <ph id=\"ph3\">&amp;gt;</ph> POS profiles <ph id=\"ph4\">&amp;gt;</ph> Hardware profiles","pos":[9129,9223],"source":"Retail and commerce &gt; Channel setup &gt; POS setup &gt; POS profiles &gt; Hardware profiles"},{"pos":[9228,9264],"content":"Create a copy of the source database","linkify":"Create a copy of the source database","nodes":[{"content":"Create a copy of the source database","pos":[0,36]}]},{"content":"Before the source SQL Server database can be exported, the database users must be deleted.","pos":[9265,9355]},{"content":"Therefore, you create a copy of the source database to work with, instead of modifying the original database.","pos":[9356,9465]},{"content":"The following script backs up the default AxDB database and then restores it to the same instance under a new name.","pos":[9466,9581]},{"content":"To use this script, first verify that the path D:<ph id=\"ph1\">\\\\</ph>backups exists.","pos":[9582,9648],"source":" To use this script, first verify that the path D:\\\\backups exists."},{"pos":[10117,10153],"content":"Run a script to prepare the database","linkify":"Run a script to prepare the database","nodes":[{"content":"Run a script to prepare the database","pos":[0,36]}]},{"content":"Run the following script against the AxDB<ph id=\"ph1\">\\_</ph>CopyForExport database that you created in the previous step.","pos":[10154,10258],"source":"Run the following script against the AxDB\\_CopyForExport database that you created in the previous step."},{"content":"This script makes the following changes:","pos":[10259,10299]},{"pos":[10305,10416],"content":"Set the <bpt id=\"p1\">**</bpt>SysGlobalConfiguration<ept id=\"p1\">**</ept> flag to inform Dynamics 365 for Operations that the database is Azure-based.","source":"Set the **SysGlobalConfiguration** flag to inform Dynamics 365 for Operations that the database is Azure-based."},{"content":"Remove a reference to tempDB in the XU<ph id=\"ph1\">\\_</ph>DisableEnableNonClusteredIndexes procedure.","pos":[10421,10504],"source":"Remove a reference to tempDB in the XU\\_DisableEnableNonClusteredIndexes procedure."},{"content":"References to tempDB aren't allowed in an Azure SQL database.","pos":[10505,10566]},{"content":"The reference will be re-created later by the database synchronization process.","pos":[10567,10646]},{"content":"Drop users, because Microsoft Windows users are forbidden in Azure SQL databases.","pos":[10651,10732]},{"content":"Other users must be re-created later to correctly link to the appropriate sign-in in the target server.","pos":[10733,10836]},{"content":"A successful export and import of the database requires all these changes.","pos":[10838,10912]},{"pos":[11394,11429],"content":"Export the database from SQL Server","linkify":"Export the database from SQL Server","nodes":[{"content":"Export the database from SQL Server","pos":[0,35]}]},{"pos":[11430,11521],"content":"Next, open a <bpt id=\"p1\">**</bpt>Command Prompt<ept id=\"p1\">**</ept> window as an administrator, and run the following commands.","source":"Next, open a **Command Prompt** window as an administrator, and run the following commands."},{"content":"Here is an explanation of the parameters:","pos":[11759,11800]},{"content":"<bpt id=\"p1\">**</bpt>ssn<ept id=\"p1\">**</ept> (source server name) – The name of the SQL Server to export from.","pos":[11806,11879],"source":"**ssn** (source server name) – The name of the SQL Server to export from."},{"content":"For our purposes, the name should always be <bpt id=\"p1\">**</bpt>localhost<ept id=\"p1\">**</ept><bpt id=\"p2\">*</bpt>.<ept id=\"p2\">*</ept>","pos":[11880,11940],"source":" For our purposes, the name should always be **localhost***.*"},{"pos":[11945,12013],"content":"<bpt id=\"p1\">**</bpt>sdn<ept id=\"p1\">**</ept> (source database name) – The name of the database to export.","source":"**sdn** (source database name) – The name of the database to export."},{"content":"<bpt id=\"p1\">**</bpt>tf<ept id=\"p1\">**</ept> (target file) – The path and name of the file to export to.","pos":[12018,12084],"source":"**tf** (target file) – The path and name of the file to export to."},{"content":"The folder should already exist, but the export process will create the file.","pos":[12085,12162]},{"pos":[12167,12213],"content":"Import the database into an Azure SQL database","linkify":"Import the database into an Azure SQL database","nodes":[{"content":"Import the database into an Azure SQL database","pos":[0,46]}]},{"content":"Copy the .bacpac file that was generated in the previous step to the AOS computer in the target environment.","pos":[12214,12322]},{"content":"A typical golden database .bacpac file will be smaller than 100 MB.","pos":[12323,12390]},{"content":"Therefore, you can copy and paste the file through a Remote Desktop (RDP) window.","pos":[12391,12472]},{"content":"If the .bacpac file is much larger than 100 MB, <bpt id=\"p1\">[</bpt>upload the file to an Azure storage account,<ept id=\"p1\">](https://azure.microsoft.com/en-gb/documentation/articles/storage-use-azcopy/)</ept> and then download it to the target AOS computer.","pos":[12473,12694],"source":" If the .bacpac file is much larger than 100 MB, [upload the file to an Azure storage account,](https://azure.microsoft.com/en-gb/documentation/articles/storage-use-azcopy/) and then download it to the target AOS computer."},{"content":"<bpt id=\"p1\">**</bpt>Note:<ept id=\"p1\">**</ept> Microsoft doesn't provide a storage account as part of your Dynamics 365 for Operations agreement.","pos":[12695,12803],"source":"**Note:** Microsoft doesn't provide a storage account as part of your Dynamics 365 for Operations agreement."},{"content":"You must either purchase a storage account or use a storage account from a separate Azure subscription.","pos":[12804,12907]},{"content":"For performance reasons, we recommend that you put the .bacpac file on drive D on the AOS computer.","pos":[12908,13007]},{"content":"(For more details, see the <bpt id=\"p1\">[</bpt>Known issues<ept id=\"p1\">](#issues)</ept> section.) Open a <bpt id=\"p2\">**</bpt>Command Prompt<ept id=\"p2\">**</ept> window as an administrator, and run the following commands.","pos":[13008,13154],"source":" (For more details, see the [Known issues](#issues) section.) Open a **Command Prompt** window as an administrator, and run the following commands."},{"content":"Here is an explanation of the parameters:","pos":[13485,13526]},{"content":"<bpt id=\"p1\">**</bpt>tsn<ept id=\"p1\">**</ept> (target server name) – The name of the SQL Azure server to import into.","pos":[13532,13611],"source":"**tsn** (target server name) – The name of the SQL Azure server to import into."},{"content":"The name can be found in LCS.","pos":[13612,13641]},{"content":"Add the suffix <bpt id=\"p1\">**</bpt>database.windows.net<ept id=\"p1\">**</ept>.","pos":[13642,13682],"source":" Add the suffix **database.windows.net**."},{"content":"<bpt id=\"p1\">**</bpt>tdn<ept id=\"p1\">**</ept> (target database name) – The name of the database to import into.","pos":[13687,13760],"source":"**tdn** (target database name) – The name of the database to import into."},{"content":"The database should <bpt id=\"p1\">**</bpt>not<ept id=\"p1\">**</ept> already exist.","pos":[13761,13803],"source":" The database should **not** already exist."},{"content":"The import process will create it.","pos":[13804,13838]},{"pos":[13843,13904],"content":"<bpt id=\"p1\">**</bpt>sf<ept id=\"p1\">**</ept> (source file) – The path and file name to import from.","source":"**sf** (source file) – The path and file name to import from."},{"content":"<bpt id=\"p1\">**</bpt>tu<ept id=\"p1\">**</ept> (target user) – The SQL user name for the target Azure SQL database instance.","pos":[13909,13993],"source":"**tu** (target user) – The SQL user name for the target Azure SQL database instance."},{"content":"We recommend that you use the standard <bpt id=\"p1\">**</bpt>sqladmin<ept id=\"p1\">**</ept> user.","pos":[13994,14051],"source":" We recommend that you use the standard **sqladmin** user."},{"content":"You can retrieve the password for this user from your LCS project.","pos":[14052,14118]},{"pos":[14123,14202],"content":"<bpt id=\"p1\">**</bpt>tp<ept id=\"p1\">**</ept> (target password) – The password for the target Azure SQL database user.","source":"**tp** (target password) – The password for the target Azure SQL database user."},{"content":"You will receive the following warning message.","pos":[14204,14251]},{"content":"You can safely ignore it.","pos":[14252,14277]},{"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>Warning message<ept id=\"p1\">](./media/sqlpackagewarning.png)](./media/sqlpackagewarning.png)</ept>","pos":[14278,14360],"source":"[![Warning message](./media/sqlpackagewarning.png)](./media/sqlpackagewarning.png)"},{"pos":[14365,14400],"content":"Run a script to update the database","linkify":"Run a script to update the database","nodes":[{"content":"Run a script to update the database","pos":[0,35]}]},{"content":"Run the following script against the imported database.","pos":[14401,14456]},{"content":"The script performs the following actions:","pos":[14457,14499]},{"content":"Recreate database users.","pos":[14505,14529]},{"content":"Set the correct performance parameters.","pos":[14534,14573]},{"content":"Enable the SQL Query Store feature.","pos":[14578,14613]},{"content":"<bpt id=\"p1\">**</bpt>Note:<ept id=\"p1\">**</ept> You must add the tenant ID to the last three queries.","pos":[14615,14678],"source":"**Note:** You must add the tenant ID to the last three queries."},{"content":"You can find this value by querying the SysServiceConfigurationSetting table in an existing database in the target environment.","pos":[14679,14806]},{"pos":[16564,16588],"content":"Synchronize the database","linkify":"Synchronize the database","nodes":[{"content":"Synchronize the database","pos":[0,24]}]},{"content":"Use Remote Desktop to connect to all the computers in the target environment, and stop the following Windows services by using services.msc.","pos":[16593,16733]},{"content":"These services will have open connections to the Dynamics 365 for Operations database.","pos":[16734,16820]},{"content":"After you stop the services, you can replace the existing Dynamics 365 for Operations database with the newly imported database:","pos":[16821,16949]},{"content":"World wide web publishing service (on all AOS computers)","pos":[16958,17014]},{"content":"Microsoft Dynamics AX Batch Management Service (on non-private AOS computers only)","pos":[17023,17105]},{"content":"Management Reporter 2012 Process Service (on BI computers only)","pos":[17114,17177]},{"content":"In Management Studio on the AOS computer where the bacpac import was performed, run the following script to rename the original database and then rename the newly imported database so that it uses the original database name.","pos":[17183,17407]},{"content":"In this example, the original database was named axdb<ph id=\"ph1\">\\_</ph>123456789, and the newly imported database was named importeddb.","pos":[17408,17527],"source":" In this example, the original database was named axdb\\_123456789, and the newly imported database was named importeddb."},{"content":"<bpt id=\"p1\">**</bpt>Note:<ept id=\"p1\">**</ept> Make sure that the you're using the SQL Server 2016 version of Management Studio.","pos":[17528,17619],"source":"**Note:** Make sure that the you're using the SQL Server 2016 version of Management Studio."},{"content":"Synchronize the database.","pos":[17773,17798]},{"content":"Open a <bpt id=\"p1\">**</bpt>Command Prompt<ept id=\"p1\">**</ept> window as an administrator, and run the following commands.","pos":[17799,17884],"source":" Open a **Command Prompt** window as an administrator, and run the following commands."},{"content":"Use services.msc to restart the services that you stopped earlier:","pos":[18278,18344]},{"content":"World wide web publishing service (on all AOS computers)","pos":[18353,18409]},{"content":"Microsoft Dynamics AX Batch Management Service (on non-private AOS computers only)","pos":[18418,18500]},{"content":"Management Reporter 2012 Process Service (on BI computers only)","pos":[18509,18572]},{"content":"At this point, you can open the Dynamics 365 for Operations application URL and sign in.","pos":[18578,18666]},{"content":"Verify that the program works as you expected, and then drop the original database by running the following script from Management Studio on the AOS computer where the bacpac import was performed.","pos":[18667,18863]},{"pos":[18918,18951],"content":"If you're using Retail components","linkify":"If you're using Retail components","nodes":[{"content":"If you're using Retail components","pos":[0,33]}]},{"pos":[18953,19206],"content":"If you're using Retail components must raise a service request of the <bpt id=\"p1\">**</bpt>Other request<ept id=\"p1\">**</ept> type in Microsoft Dynamics Lifecycle Services (LCS) to ask that the Service Engineering Team update the imported database to be reconfigured for the new environment.","source":"If you're using Retail components must raise a service request of the **Other request** type in Microsoft Dynamics Lifecycle Services (LCS) to ask that the Service Engineering Team update the imported database to be reconfigured for the new environment."},{"pos":[19211,19251],"content":"Raise a service request to copy database","linkify":"Raise a service request to copy database","nodes":[{"content":"Raise a service request to copy database","pos":[0,40]}]},{"content":"To copy the golden database to a production environment, you must submit a service request of the <bpt id=\"p1\">**</bpt>Other request<ept id=\"p1\">**</ept> type through LCS to ask that Microsoft run the copy action.","pos":[19252,19427],"source":"To copy the golden database to a production environment, you must submit a service request of the **Other request** type through LCS to ask that Microsoft run the copy action."},{"content":"<bpt id=\"p1\">**</bpt>Note:<ept id=\"p1\">**</ept> You can't use a request of the <bpt id=\"p2\">**</bpt>Database refresh request<ept id=\"p2\">**</ept> type, because the request involves copying to a production environment.","pos":[19428,19569],"source":"**Note:** You can't use a request of the **Database refresh request** type, because the request involves copying to a production environment."},{"content":"In LCS, click the hamburger icon, and then click <bpt id=\"p1\">**</bpt>Work items<ept id=\"p1\">**</ept>.","pos":[19575,19639],"source":"In LCS, click the hamburger icon, and then click **Work items**."},{"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>Work items<ept id=\"p1\">](./media/lcsworkitemsmenu.png)](./media/lcsworkitemsmenu.png)</ept>","pos":[19640,19715],"source":"[![Work items](./media/lcsworkitemsmenu.png)](./media/lcsworkitemsmenu.png)"},{"content":"On the <bpt id=\"p1\">**</bpt>Work items<ept id=\"p1\">**</ept> page, click <bpt id=\"p2\">**</bpt>Add<ept id=\"p2\">**</ept>, and then click <bpt id=\"p3\">**</bpt>Other request<ept id=\"p3\">**</ept>.","pos":[19720,19796],"source":"On the **Work items** page, click **Add**, and then click **Other request**."},{"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>Other request<ept id=\"p1\">](./media/lcsotherrequest.png)](./media/lcsotherrequest.png)</ept>","pos":[19797,19873],"source":"[![Other request](./media/lcsotherrequest.png)](./media/lcsotherrequest.png)"},{"pos":[19878,19935],"content":"In the <bpt id=\"p1\">**</bpt>Other requests<ept id=\"p1\">**</ept> dialog box, follow these steps:","source":"In the **Other requests** dialog box, follow these steps:"},{"pos":[19944,20013],"content":"In the <bpt id=\"p1\">**</bpt>Environment name<ept id=\"p1\">**</ept> field, select the production environment.","source":"In the **Environment name** field, select the production environment."},{"content":"Set the <bpt id=\"p1\">**</bpt>Preferred downtime start date<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>Preferred downtime end date<ept id=\"p2\">**</ept> fields.","pos":[20022,20107],"source":"Set the **Preferred downtime start date** and **Preferred downtime end date** fields."},{"content":"The end date must be at least one hour after the start date.","pos":[20108,20168]},{"content":"Submit your request at least 24 hours before your preferred downtime window to help guarantee that resources are available to run the request.","pos":[20169,20311]},{"pos":[20320,20584],"content":"In the <bpt id=\"p1\">**</bpt>Request<ept id=\"p1\">**</ept> field, enter the following details: <bpt id=\"p2\">**</bpt>This is a request for a golden database copy from the sandbox environment <ph id=\"ph1\">&amp;lt;</ph>source sandbox environment name<ph id=\"ph2\">&amp;gt;</ph> to production. I acknowledge that this will overwrite the database currently in production.<ept id=\"p2\">**</ept>","source":"In the **Request** field, enter the following details: **This is a request for a golden database copy from the sandbox environment &lt;source sandbox environment name&gt; to production. I acknowledge that this will overwrite the database currently in production.**"},{"pos":[20590,20686],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>Other requests dialog box<ept id=\"p1\">](./media/lcsotherrequestform.png)](./media/lcsotherrequestform.png)</ept>","source":"[![Other requests dialog box](./media/lcsotherrequestform.png)](./media/lcsotherrequestform.png)"},{"pos":[20691,20731],"content":"Additional steps for Retail environments","linkify":"Additional steps for Retail environments","nodes":[{"content":"Additional steps for Retail environments","pos":[0,40]}]},{"content":"If your environment includes Retail components, you must perform additional steps so that the environment will work after the database import.","pos":[20732,20874]},{"pos":[20880,20953],"content":"Re-enter encrypted and environment-specific values in the target database","linkify":"Re-enter encrypted and environment-specific values in the target database","nodes":[{"content":"Re-enter encrypted and environment-specific values in the target database","pos":[0,73]}]},{"content":"The values in the following forms are encrypted in the database, so all the imported values will be incorrect.","pos":[20955,21065]},{"content":"In the target system, enter the values that you documented earlier.","pos":[21066,21133]},{"content":"Accounts receivable <ph id=\"ph1\">&amp;gt;</ph> Payments setup <ph id=\"ph2\">&amp;gt;</ph> Payments services","pos":[21139,21201],"source":"Accounts receivable &gt; Payments setup &gt; Payments services"},{"content":"Retail and commerce <ph id=\"ph1\">&amp;gt;</ph> Channel setup <ph id=\"ph2\">&amp;gt;</ph> POS setup <ph id=\"ph3\">&amp;gt;</ph> POS profiles <ph id=\"ph4\">&amp;gt;</ph> Hardware profiles","pos":[21206,21300],"source":"Retail and commerce &gt; Channel setup &gt; POS setup &gt; POS profiles &gt; Hardware profiles"},{"pos":[21305,21387],"content":"Reenter data from encrypted and environment specific fields in the target database","linkify":"Reenter data from encrypted and environment specific fields in the target database","nodes":[{"content":"Reenter data from encrypted and environment specific fields in the target database","pos":[0,82]}]},{"content":"In the Dynamics 365 for Operations client, enter the values that you documented for the encrypted and environment-specific fields.","pos":[21388,21518]},{"content":"The following fields are affected.","pos":[21519,21553]},{"content":"(The field names are given in <bpt id=\"p1\">*</bpt>Table<ept id=\"p1\">*</ept>.<bpt id=\"p2\">*</bpt>Field<ept id=\"p2\">*</ept> format.)","pos":[21554,21608],"source":" (The field names are given in *Table*.*Field* format.)"},{"pos":[22088,22108],"content":"<bpt id=\"p1\">**</bpt>Table.field name<ept id=\"p1\">**</ept>","source":"**Table.field name**"},{"pos":[22147,22173],"content":"<bpt id=\"p1\">**</bpt>Where to set the value<ept id=\"p1\">**</ept>","source":"**Where to set the value**"},{"content":"CreditCardAccountSetup.SecureMerchantProperties","pos":[22326,22373]},{"pos":[22385,22465],"content":"Click <bpt id=\"p1\">**</bpt>Accounts receivable<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Payments setup<ept id=\"p2\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>Payment services<ept id=\"p3\">**</ept>.","source":"Click **Accounts receivable** &gt; **Payments setup** &gt; **Payment services**."},{"content":"ExchangeRateProviderConfigurationDetails.Value","pos":[22564,22610]},{"pos":[22623,22711],"content":"Click <bpt id=\"p1\">**</bpt>General ledger<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Currencies<ept id=\"p2\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>Configure exchange rate providers<ept id=\"p3\">**</ept>.","source":"Click **General ledger** &gt; **Currencies** &gt; **Configure exchange rate providers**."},{"content":"FiscalEstablishment<ph id=\"ph1\">\\_</ph>BR.ConsumerEFDocCsc","pos":[22802,22842],"source":"FiscalEstablishment\\_BR.ConsumerEFDocCsc"},{"pos":[22861,22961],"content":"Click <bpt id=\"p1\">**</bpt>Organization administration<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Fiscal establishments<ept id=\"p2\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>Fiscal establishments<ept id=\"p3\">**</ept>.","source":"Click **Organization administration** &gt; **Fiscal establishments** &gt; **Fiscal establishments**."},{"content":"FiscalEstablishmentStaging.CSC","pos":[23040,23070]},{"content":"This field is used by the Data Import/Export Framework","pos":[23099,23153]},{"content":"HcmPersonIdentificationNumber.PersonIdentificationNumber","pos":[23278,23334]},{"content":"Click <bpt id=\"p1\">**</bpt>Human resources<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Workers<ept id=\"p2\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>Workers<ept id=\"p3\">**</ept>.","pos":[23337,23397],"source":"Click **Human resources** &gt; **Workers** &gt; **Workers**."},{"content":"On the <bpt id=\"p1\">**</bpt>Worker<ept id=\"p1\">**</ept> tab, in the <bpt id=\"p2\">**</bpt>Personal information<ept id=\"p2\">**</ept> group, click <bpt id=\"p3\">**</bpt>Identification numbers<ept id=\"p3\">**</ept>.","pos":[23398,23493],"source":" On the **Worker** tab, in the **Personal information** group, click **Identification numbers**."},{"content":"HcmWorkerActionHire.PersonIdentificationNumber","pos":[23516,23562]},{"content":"This field has been obsolete since the February 2016 release.","pos":[23575,23636]},{"content":"It was previously in the <bpt id=\"p1\">**</bpt>Human resources<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Workers<ept id=\"p2\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>Actions<ept id=\"p3\">**</ept> <ph id=\"ph3\">&amp;gt;</ph> <bpt id=\"p4\">**</bpt>All worker actions<ept id=\"p4\">**</ept> form.","pos":[23637,23749],"source":" It was previously in the **Human resources** &gt; **Workers** &gt; **Actions** &gt; **All worker actions** form."},{"content":"SysEmailSMPTPassword.Password","pos":[23754,23783]},{"pos":[23813,23886],"content":"Click <bpt id=\"p1\">**</bpt>System administration<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Email<ept id=\"p2\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>Email parameters<ept id=\"p3\">**</ept>.","source":"Click **System administration** &gt; **Email** &gt; **Email parameters**."},{"content":"SysOAuthUserTokens.EncryptedAccessToken","pos":[23992,24031]},{"content":"This field is used internally by the AOS.","pos":[24051,24092]},{"content":"It can be ignored.","pos":[24093,24111]},{"content":"SysOAuthUserTokens.EncryptedRefr eshToken","pos":[24230,24271]},{"content":"This field is used internally by the AOS.","pos":[24289,24330]},{"content":"It can be ignored.","pos":[24331,24349]},{"pos":[24473,24501],"content":"Known issues and limitations","linkify":"Known issues and limitations","nodes":[{"content":"Known issues and limitations","pos":[0,28]}]},{"pos":[24506,24554],"content":"I can't download the Management Studio installer","linkify":"I can't download the Management Studio installer","nodes":[{"content":"I can't download the Management Studio installer","pos":[0,48]}]},{"content":"When you try to download the Management Studio installer, you might receive the following message: \"Your current security settings do not allow this file to be downloaded.\"","pos":[24556,24728]},{"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>Error message<ept id=\"p1\">](./media/securitysettingscannotdownload.png)](./media/securitysettingscannotdownload.png)</ept> To work around this issue, in <bpt id=\"p2\">**</bpt>Internet Options<ept id=\"p2\">**</ept>, on the <bpt id=\"p3\">**</bpt>Security<ept id=\"p3\">**</ept> tab, enable file downloads for the <bpt id=\"p4\">**</bpt>Internet<ept id=\"p4\">**</ept> zone, as shown in the following illustration.","pos":[24729,25001],"source":"[![Error message](./media/securitysettingscannotdownload.png)](./media/securitysettingscannotdownload.png) To work around this issue, in **Internet Options**, on the **Security** tab, enable file downloads for the **Internet** zone, as shown in the following illustration."},{"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>Enable file downloads<ept id=\"p1\">](./media/securitysettingsfix.png)](./media/securitysettingsfix.png)</ept>","pos":[25002,25094],"source":"[![Enable file downloads](./media/securitysettingsfix.png)](./media/securitysettingsfix.png)"},{"pos":[25100,25111],"content":"Performance","linkify":"Performance","nodes":[{"content":"Performance","pos":[0,11]}]},{"content":"The following guidelines can help you achieve optimal performance:","pos":[25113,25179]},{"content":"Always export from a computer that is located in the same Azure data center as the Azure SQL database instance.","pos":[25185,25296]},{"content":"In practice, this guideline means that, when you export a copy of your sandbox database, you should export it from the sandbox AOS computer.","pos":[25297,25437]},{"content":"Always import the .bacpac file locally on the computer that is running the SQL Server instance.","pos":[25442,25537]},{"content":"Don't import it from Management Studio on a remote computer.","pos":[25538,25598]},{"content":"To help improve performance, in a one-box environment (which is also known as a Tier 1 environment) that is hosted in Azure, put the .bacpac file on drive D when you export it.","pos":[25603,25779]},{"content":"For more information about the temporary drive on Azure computers, see the <bpt id=\"p1\">[</bpt>Understanding the temporary drive on Windows Azure Virtual Machines<ept id=\"p1\">](https://blogs.msdn.microsoft.com/mast/2013/12/06/understanding-the-temporary-drive-on-windows-azure-virtual-machines/)</ept> post on the Azure Support Team blog.","pos":[25780,26080],"source":" For more information about the temporary drive on Azure computers, see the [Understanding the temporary drive on Windows Azure Virtual Machines](https://blogs.msdn.microsoft.com/mast/2013/12/06/understanding-the-temporary-drive-on-windows-azure-virtual-machines/) post on the Azure Support Team blog."},{"content":"To help make the import process faster, and to help improve the speed of restore from a .bak file, grant the account that is running the SQL Server Windows service the <bpt id=\"p1\">[</bpt>Instance File Initialization<ept id=\"p1\">](https://msdn.microsoft.com/en-us/library/ms175935.aspx)</ept> right.","pos":[26085,26346],"source":"To help make the import process faster, and to help improve the speed of restore from a .bak file, grant the account that is running the SQL Server Windows service the [Instance File Initialization](https://msdn.microsoft.com/en-us/library/ms175935.aspx) right."},{"content":"To easily implement this guideline for a developer environment, set SQL Server to run as the axlocaladmin account.","pos":[26347,26461]},{"content":"We recommend that you not use the option to export and import from SQL Azure in Management Studio.","pos":[26466,26564]},{"content":"(This option is also known as “Export data tier application”).","pos":[26565,26627]},{"content":"We recommend that you not use this approach, because there can be memory limitations for larger databases.","pos":[26628,26734]}],"content":"---\n# required metadata\n\ntitle: Copy a Dynamics 365 for Operations database from SQL Server to a production Azure SQL Database environment | Microsoft Docs\ndescription: This topic describes how to move a Dynamics 365 for Operations database from an environment that runs on SQL Server (Tier 1 or one-box) to an environment that runs on an Azure SQL database (Tier 2 or higher). \nauthor: MargoC\nmanager: AnnBe\nms.date: 2016-11-16 21:24:46\nms.topic: article\nms.prod: \nms.service: Dynamics365Operations\nms.technology: \n\n# optional metadata\n\n# keywords: \n# ROBOTS: \naudience: IT Pro\n# ms.devlang: \nms.reviewer: 11\nms.suite: Released- Dynamics 365 for Operations version 1611\n# ms.tgt_pltfrm: \nms.custom: 256464\nms.assetid: 10352603-bf25-4b83-97f4-e41fa3aa8724\nms.region: Global\n# ms.industry: \nms.author: tabell\n\n---\n\n# Copy a Dynamics 365 for Operations database from SQL Server to a production Azure SQL Database environment\n\nThis topic describes how to move a Dynamics 365 for Operations database from an environment that runs on SQL Server (Tier 1 or one-box) to an environment that runs on an Azure SQL database (Tier 2 or higher). \n\nOverview\n--------\n\nThis procedure can be used to move a Microsoft Dynamics 365 for Operations database from an environment that runs on Microsoft SQL Server (Tier 1 or one-box) to an environment that runs on a Microsoft Azure SQL database (Tier 2 or higher). This process is typically performed before go-live to bring a golden (or seed) database that contains only system configuration data into a production environment. This process isn't suitable for all situations. For example, you should not use this process to import data for a new legal entity for an existing live deployment. In those situations, we recommend that you use [process data packages](https://docs.microsoft.com/en-us/dynamics365/operations/dev-itpro/lifecycle-services/process-data-packages-lcs-solutions) or [data entity data packages](https://docs.microsoft.com/en-us/dynamics365/operations/dev-itpro/data-entities/using-data-entities-and-data-packages). Here is the supported procedure for bringing a golden database into the production environment:\n\n1.  A customer or partner exports the database from SQL Server.\n2.  The customer or partner imports the database to a sandbox environment that runs on an Azure SQL database. **Note:** If you're using Retail components raise a service request of the **Other request** type in Microsoft Dynamics Lifecycle Services (LCS) to ask that the Service Engineering Team update the imported database to be reconfigured for the new environment.\n3.  The customer or partner uses a service request of the **Other request** type in Microsoft Dynamics Lifecycle Services (LCS) to ask that Microsoft Support update the sandbox database to the production environment.\n4.  Support copies the database from the sandbox environment to the production environment. **Note:** Microsoft accepts requests to copy a database into a production environment only before go-live. li&gt;\n\nThe process for moving a database involves using the sqlpackage.exe command-line tool to export the database from SQL Server and import it into an Azure SQL database. Because the file name extension for the exported data file is .bacpac, the process is often referred to as the bacpac process. Here are the high-level steps:\n\n1.  Create a copy of the source database.\n2.  Run a script to prepare the database.\n3.  Export the database from SQL Server.\n4.  Import the database into an Azure SQL database.\n5.  Run a script to update the database.\n\nIf you encounter issues, see the [Known issues and limitations](#issues) section at the end of this topic. It explains how to troubleshoot, gives performance tips, and explains limitations of the copy process.\n\n## Prerequisites\n-   The source SQL Server–based environment must be running Microsoft SQL Server 2016 Release to Manufacturing (RTM) (13.0.1601.5) or later. The Community Technology Preview (CTP) versions of SQL Server 2016 might cause errors. If the source environment is running an earlier version of SQL Server 2016, you must first back up the database and restore it to another environment that is running SQL Server 2016 RTM (13.0.1601.5) or later.\n-   To import a database into an Azure SQL Database environment, you must install the [latest version of Microsoft SQL Server Management Studio](https://msdn.microsoft.com/en-us/library/mt238290.aspx) on the Application Object Server (AOS) computer in **that** environment and perform the bacpac import on the AOS computer. There are two reasons for this requirement:\n    -   Because of an Internet Protocol (IP) access restriction on all instances of Dynamics 365 for Operations that run on Azure SQL Database, connections are allowed only from a computer in that environment.\n    -   The version of Management Studio that is installed by default is for a previous version of SQL Server and can't perform the required tasks.\n\n**Important:** If your environment includes Retail components, you must manually store some environment-specific values before you begin. See the [Additional steps for Retail environments](#retail) section.\n\n## Before you begin\nEncrypted and environment-specific values can't be imported into a new environment. After you've completed the import, you must re-enter some data from your source environment in your target environment.\n\n### Document the values of encrypted fields\n\nBecause of a technical limitation that is related to the certificate that is used for data encryption, values that are stored in encrypted fields in a database will be unreadable after that database is imported into a new environment. Therefore, after an import, you must manually delete and re-enter values that are stored in encrypted fields. New values that are entered in encrypted fields after an import will be readable. The following fields are affected. (The field names are given in *Table*.*Field* format.)\n\n|                                                          |                                                                                                                                                                                |\n|----------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| **Table.field name**                                     | **Where to set the value**                                                                                                                                                     |\n| CreditCardAccountSetup.SecureMerchantProperties          | Click **Accounts receivable** &gt; **Payments setup** &gt; **Payment services**.                                                                                               |\n| ExchangeRateProviderConfigurationDetails.Value           | Click **General ledger** &gt; **Currencies** &gt; **Configure exchange rate providers**.                                                                                       |\n| FiscalEstablishment\\_BR.ConsumerEFDocCsc                 | Click **Organization administration** &gt; **Fiscal establishments** &gt; **Fiscal establishments**.                                                                           |\n| FiscalEstablishmentStaging.CSC                           | This field is used by the Data Import/Export Framework                                                                                                                         |\n| HcmPersonIdentificationNumber.PersonIdentificationNumber | Click **Human resources** &gt; **Workers** &gt; **Workers**. On the **Worker** tab, in the **Personal information** group, click **Identification numbers**.                   |\n| HcmWorkerActionHire.PersonIdentificationNumber           | This field has been obsolete since the February 2016 release. It was previously in the **Human resources** &gt; **Workers** &gt; **Actions** &gt; **All worker actions** form. |\n| SysEmailSMPTPassword.Password                            | Click **System administration** &gt; **Email** &gt; **Email parameters**.                                                                                                      |\n| SysOAuthUserTokens.EncryptedAccessToken                  | This field is used internally by the AOS. It can be ignored.                                                                                                                   |\n| SysOAuthUserTokens.EncryptedRefr eshToken                | This field is used internally by the AOS. It can be ignored.                                                                                                                   |\n\n \n\n### If you're running Retail components, document encrypted and environment-specific values\n\nThe values in the following forms are either environment-specific or encrypted in the database. Therefore, all the imported values will be incorrect.\n\n-   Accounts receivable &gt; Payments setup &gt; Payments services\n-   Retail and commerce &gt; Channel setup &gt; POS setup &gt; POS profiles &gt; Hardware profiles\n\n## Create a copy of the source database\nBefore the source SQL Server database can be exported, the database users must be deleted. Therefore, you create a copy of the source database to work with, instead of modifying the original database. The following script backs up the default AxDB database and then restores it to the same instance under a new name. To use this script, first verify that the path D:\\\\backups exists.\n\n    BACKUP DATABASE [AxDB] TO DISK = N'D:\\Backups\\axdb_golden.bak' WITH NOFORMAT, NOINIT,\n    NAME = N'AxDB_golden-Full Database Backup', SKIP, NOREWIND, NOUNLOAD, COMPRESSION, STATS = 10\n    GO\n    RESTORE DATABASE [AxDB_CopyForExport] FROM DISK = N'D:\\Backups\\axdb_golden.bak' WITH FILE = 1,\n    MOVE N'AXDBBuild_Data' TO N'F:\\MSSQL_DATA\\AxDB_CopyForExport.mdf',\n    MOVE N'AXDBBuild_Log' TO N'G:\\MSSQL_LOGS\\AxDB_CopyForExport_Log.ldf',\n    NOUNLOAD, STATS = 5\n\n## Run a script to prepare the database\nRun the following script against the AxDB\\_CopyForExport database that you created in the previous step. This script makes the following changes:\n\n-   Set the **SysGlobalConfiguration** flag to inform Dynamics 365 for Operations that the database is Azure-based.\n-   Remove a reference to tempDB in the XU\\_DisableEnableNonClusteredIndexes procedure. References to tempDB aren't allowed in an Azure SQL database. The reference will be re-created later by the database synchronization process.\n-   Drop users, because Microsoft Windows users are forbidden in Azure SQL databases. Other users must be re-created later to correctly link to the appropriate sign-in in the target server.\n\nA successful export and import of the database requires all these changes.\n\n    update sysglobalconfiguration\n    set value = 'SQLAZURE'\n    where name = 'BACKENDDB'\n\n    update sysglobalconfiguration\n    set value = 1\n    where name = 'TEMPTABLEINAXDB'\n\n    drop procedure XU_DisableEnableNonClusteredIndexes\n    drop schema [NT AUTHORITY\\NETWORK SERVICE]\n    drop user [NT AUTHORITY\\NETWORK SERVICE]\n    drop user axdbadmin\n    drop user axdeployuser\n    drop user axmrruntimeuser\n    drop user axretaildatasyncuser\n    drop user axretailruntimeuser\n\n## Export the database from SQL Server\nNext, open a **Command Prompt** window as an administrator, and run the following commands.\n\n    cd C:\\Program Files (x86)\\Microsoft SQL Server\\130\\DAC\\bin\\\n    SqlPackage.exe /a:export /ssn:localhost /sdn:<database to export> /tf:D:\\Exportedbacpac\\my.bacpac /p:CommandTimeout=1200 /p:VerifyFullTextDocumentTypesSupported=false\n\nHere is an explanation of the parameters:\n\n-   **ssn** (source server name) – The name of the SQL Server to export from. For our purposes, the name should always be **localhost***.*\n-   **sdn** (source database name) – The name of the database to export.\n-   **tf** (target file) – The path and name of the file to export to. The folder should already exist, but the export process will create the file.\n\n## Import the database into an Azure SQL database\nCopy the .bacpac file that was generated in the previous step to the AOS computer in the target environment. A typical golden database .bacpac file will be smaller than 100 MB. Therefore, you can copy and paste the file through a Remote Desktop (RDP) window. If the .bacpac file is much larger than 100 MB, [upload the file to an Azure storage account,](https://azure.microsoft.com/en-gb/documentation/articles/storage-use-azcopy/) and then download it to the target AOS computer. **Note:** Microsoft doesn't provide a storage account as part of your Dynamics 365 for Operations agreement. You must either purchase a storage account or use a storage account from a separate Azure subscription. For performance reasons, we recommend that you put the .bacpac file on drive D on the AOS computer. (For more details, see the [Known issues](#issues) section.) Open a **Command Prompt** window as an administrator, and run the following commands.\n\n    cd C:\\Program Files (x86)\\Microsoft SQL Server\\130\\DAC\\bin\\\n\n    SqlPackage.exe /a:import /sf:D:\\Exportedbacpac\\my.bacpac /tsn:<azure sql database server name>.database.windows.net /tu:sqladmin /tp:<password from LCS> /tdn:<New database name> /p:CommandTimeout=1200 /p:DatabaseEdition=Premium /p:DatabaseServiceObjective=P2\n\nHere is an explanation of the parameters:\n\n-   **tsn** (target server name) – The name of the SQL Azure server to import into. The name can be found in LCS. Add the suffix **database.windows.net**.\n-   **tdn** (target database name) – The name of the database to import into. The database should **not** already exist. The import process will create it.\n-   **sf** (source file) – The path and file name to import from.\n-   **tu** (target user) – The SQL user name for the target Azure SQL database instance. We recommend that you use the standard **sqladmin** user. You can retrieve the password for this user from your LCS project.\n-   **tp** (target password) – The password for the target Azure SQL database user.\n\nYou will receive the following warning message. You can safely ignore it. [![Warning message](./media/sqlpackagewarning.png)](./media/sqlpackagewarning.png)\n\n## Run a script to update the database\nRun the following script against the imported database. The script performs the following actions:\n\n-   Recreate database users.\n-   Set the correct performance parameters.\n-   Enable the SQL Query Store feature.\n\n**Note:** You must add the tenant ID to the last three queries. You can find this value by querying the SysServiceConfigurationSetting table in an existing database in the target environment.\n\n    CREATE USER axdeployuser FROM LOGIN axdeployuser\n    EXEC sp_addrolemember 'db_owner', 'axdeployuser'\n\n    CREATE USER axdbadmin WITH PASSWORD = '<password from lcs>'\n    EXEC sp_addrolemember 'db_owner', 'axdbadmin'\n\n    CREATE USER axruntimeuser WITH PASSWORD = '<password from lcs>'\n    EXEC sp_addrolemember 'db_datareader', 'axruntimeuser'\n    EXEC sp_addrolemember 'db_datawriter', 'axruntimeuser'\n\n    CREATE USER axmrruntimeuser WITH PASSWORD = '<password from lcs>'\n    EXEC sp_addrolemember 'ReportingIntegrationUser', 'axmrruntimeuser'\n    EXEC sp_addrolemember 'db_datareader', 'axmrruntimeuser'\n    EXEC sp_addrolemember 'db_datawriter', 'axmrruntimeuser'\n\n    CREATE USER axretailruntimeuser WITH PASSWORD = '<password from lcs>'\n    EXEC sp_addrolemember 'UsersRole', 'axretailruntimeuser'\n    EXEC sp_addrolemember 'ReportUsersRole', 'axretailruntimeuser'\n\n    CREATE USER axretaildatasyncuser WITH PASSWORD = '<password from lcs>'\n    EXEC sp_addrolemember 'DataSyncUsersRole', 'axretaildatasyncuser'\n\n    ALTER DATABASE SCOPED CONFIGURATION  SET MAXDOP=2\n    ALTER DATABASE SCOPED CONFIGURATION  SET LEGACY_CARDINALITY_ESTIMATION=ON\n    ALTER DATABASE SCOPED CONFIGURATION  SET PARAMETER_SNIFFING= ON\n    ALTER DATABASE SCOPED CONFIGURATION  SET QUERY_OPTIMIZER_HOTFIXES=OFF\n    ALTER DATABASE <imported database name> SET COMPATIBILITY_LEVEL = 130;\n    ALTER DATABASE <imported database name> SET QUERY_STORE = ON;\n\n    update [dbo].[SYSSERVICECONFIGURATIONSETTING]\n    set value ='<tenant ID from existing database>'\n    where name = 'TENANTID'\n\n    update dbo.POWERBICONFIG\n    set TENANTID = '<tenant ID from existing database>'\n\n    update dbo.PROVISIONINGMESSAGETABLE\n    set TENANTID = '<tenant ID from existing database>'\n\n## Synchronize the database\n1.  Use Remote Desktop to connect to all the computers in the target environment, and stop the following Windows services by using services.msc. These services will have open connections to the Dynamics 365 for Operations database. After you stop the services, you can replace the existing Dynamics 365 for Operations database with the newly imported database:\n    -   World wide web publishing service (on all AOS computers)\n    -   Microsoft Dynamics AX Batch Management Service (on non-private AOS computers only)\n    -   Management Reporter 2012 Process Service (on BI computers only)\n\n2.  In Management Studio on the AOS computer where the bacpac import was performed, run the following script to rename the original database and then rename the newly imported database so that it uses the original database name. In this example, the original database was named axdb\\_123456789, and the newly imported database was named importeddb. **Note:** Make sure that the you're using the SQL Server 2016 version of Management Studio.\n\n        ALTER DATABASE [axdb_123456789] MODIFY NAME = [axdb_123456789_original]\n        ALTER DATABASE [importeddb] MODIFY NAME = [axdb_123456789]\n\n3.  Synchronize the database. Open a **Command Prompt** window as an administrator, and run the following commands.\n\n        cd F:\\AosService\\WebRoot\\bin\n\n        Microsoft.Dynamics.AX.Deployment.Setup.exe -bindir \"F:\\AosService\\PackagesLocalDirectory\" -metadatadir F:\\AosService\\PackagesLocalDirectory -sqluser axdbadmin -sqlserver <azure sql database server name>.database.windows.net -sqldatabase <database name> -setupmode sync -syncmode fullall -isazuresql true -sqlpwd <sql password> >log.txt 2>&1\n\n4.  Use services.msc to restart the services that you stopped earlier:\n    -   World wide web publishing service (on all AOS computers)\n    -   Microsoft Dynamics AX Batch Management Service (on non-private AOS computers only)\n    -   Management Reporter 2012 Process Service (on BI computers only)\n\n5.  At this point, you can open the Dynamics 365 for Operations application URL and sign in. Verify that the program works as you expected, and then drop the original database by running the following script from Management Studio on the AOS computer where the bacpac import was performed.\n\n        DROP DATABASE [axdb_123456789_original]\n\n### If you're using Retail components\n\nIf you're using Retail components must raise a service request of the **Other request** type in Microsoft Dynamics Lifecycle Services (LCS) to ask that the Service Engineering Team update the imported database to be reconfigured for the new environment.\n\n## Raise a service request to copy database\nTo copy the golden database to a production environment, you must submit a service request of the **Other request** type through LCS to ask that Microsoft run the copy action. **Note:** You can't use a request of the **Database refresh request** type, because the request involves copying to a production environment.\n\n1.  In LCS, click the hamburger icon, and then click **Work items**. [![Work items](./media/lcsworkitemsmenu.png)](./media/lcsworkitemsmenu.png)\n2.  On the **Work items** page, click **Add**, and then click **Other request**. [![Other request](./media/lcsotherrequest.png)](./media/lcsotherrequest.png)\n3.  In the **Other requests** dialog box, follow these steps:\n    1.  In the **Environment name** field, select the production environment.\n    2.  Set the **Preferred downtime start date** and **Preferred downtime end date** fields. The end date must be at least one hour after the start date. Submit your request at least 24 hours before your preferred downtime window to help guarantee that resources are available to run the request.\n    3.  In the **Request** field, enter the following details: **This is a request for a golden database copy from the sandbox environment &lt;source sandbox environment name&gt; to production. I acknowledge that this will overwrite the database currently in production.**\n\n    [![Other requests dialog box](./media/lcsotherrequestform.png)](./media/lcsotherrequestform.png)\n\n## Additional steps for Retail environments\nIf your environment includes Retail components, you must perform additional steps so that the environment will work after the database import.\n\n### Re-enter encrypted and environment-specific values in the target database\n\nThe values in the following forms are encrypted in the database, so all the imported values will be incorrect. In the target system, enter the values that you documented earlier.\n\n-   Accounts receivable &gt; Payments setup &gt; Payments services\n-   Retail and commerce &gt; Channel setup &gt; POS setup &gt; POS profiles &gt; Hardware profiles\n\n## Reenter data from encrypted and environment specific fields in the target database\nIn the Dynamics 365 for Operations client, enter the values that you documented for the encrypted and environment-specific fields. The following fields are affected. (The field names are given in *Table*.*Field* format.)\n\n|                                                          |                                                                                                                                                                                |\n|----------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| **Table.field name**                                     | **Where to set the value**                                                                                                                                                     |\n| CreditCardAccountSetup.SecureMerchantProperties          | Click **Accounts receivable** &gt; **Payments setup** &gt; **Payment services**.                                                                                               |\n| ExchangeRateProviderConfigurationDetails.Value           | Click **General ledger** &gt; **Currencies** &gt; **Configure exchange rate providers**.                                                                                       |\n| FiscalEstablishment\\_BR.ConsumerEFDocCsc                 | Click **Organization administration** &gt; **Fiscal establishments** &gt; **Fiscal establishments**.                                                                           |\n| FiscalEstablishmentStaging.CSC                           | This field is used by the Data Import/Export Framework                                                                                                                         |\n| HcmPersonIdentificationNumber.PersonIdentificationNumber | Click **Human resources** &gt; **Workers** &gt; **Workers**. On the **Worker** tab, in the **Personal information** group, click **Identification numbers**.                   |\n| HcmWorkerActionHire.PersonIdentificationNumber           | This field has been obsolete since the February 2016 release. It was previously in the **Human resources** &gt; **Workers** &gt; **Actions** &gt; **All worker actions** form. |\n| SysEmailSMPTPassword.Password                            | Click **System administration** &gt; **Email** &gt; **Email parameters**.                                                                                                      |\n| SysOAuthUserTokens.EncryptedAccessToken                  | This field is used internally by the AOS. It can be ignored.                                                                                                                   |\n| SysOAuthUserTokens.EncryptedRefr eshToken                | This field is used internally by the AOS. It can be ignored.                                                                                                                   |\n\n \n\n## Known issues and limitations\n### I can't download the Management Studio installer\n\nWhen you try to download the Management Studio installer, you might receive the following message: \"Your current security settings do not allow this file to be downloaded.\" [![Error message](./media/securitysettingscannotdownload.png)](./media/securitysettingscannotdownload.png) To work around this issue, in **Internet Options**, on the **Security** tab, enable file downloads for the **Internet** zone, as shown in the following illustration. [![Enable file downloads](./media/securitysettingsfix.png)](./media/securitysettingsfix.png)\n\n### Performance\n\nThe following guidelines can help you achieve optimal performance:\n\n-   Always export from a computer that is located in the same Azure data center as the Azure SQL database instance. In practice, this guideline means that, when you export a copy of your sandbox database, you should export it from the sandbox AOS computer.\n-   Always import the .bacpac file locally on the computer that is running the SQL Server instance. Don't import it from Management Studio on a remote computer.\n-   To help improve performance, in a one-box environment (which is also known as a Tier 1 environment) that is hosted in Azure, put the .bacpac file on drive D when you export it. For more information about the temporary drive on Azure computers, see the [Understanding the temporary drive on Windows Azure Virtual Machines](https://blogs.msdn.microsoft.com/mast/2013/12/06/understanding-the-temporary-drive-on-windows-azure-virtual-machines/) post on the Azure Support Team blog.\n-   To help make the import process faster, and to help improve the speed of restore from a .bak file, grant the account that is running the SQL Server Windows service the [Instance File Initialization](https://msdn.microsoft.com/en-us/library/ms175935.aspx) right. To easily implement this guideline for a developer environment, set SQL Server to run as the axlocaladmin account.\n-   We recommend that you not use the option to export and import from SQL Azure in Management Studio. (This option is also known as “Export data tier application”). We recommend that you not use this approach, because there can be memory limitations for larger databases.\n\n\n"}