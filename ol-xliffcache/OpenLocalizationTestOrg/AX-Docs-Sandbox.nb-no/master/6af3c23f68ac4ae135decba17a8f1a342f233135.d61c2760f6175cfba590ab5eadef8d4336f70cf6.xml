{"nodes":[{"pos":[32,74],"content":"Build and debug a project | Microsoft Docs","needQuote":true,"needEscape":true,"nodes":[{"content":"Build and debug a project | Microsoft Docs","pos":[0,42]}]},{"pos":[88,341],"content":"In this tutorial, you’ll learn about using the tools in Visual Studio to analyze and debug code in the Fleet Management application. You’ll go through a simple developer scenario in which you will set breakpoints, modify some code, and build the result.","needQuote":true,"needEscape":true,"nodes":[{"content":"In this tutorial, you’ll learn about using the tools in Visual Studio to analyze and debug code in the Fleet Management application. You’ll go through a simple developer scenario in which you will set breakpoints, modify some code, and build the result.","pos":[0,253],"nodes":[{"content":"In this tutorial, you’ll learn about using the tools in Visual Studio to analyze and debug code in the Fleet Management application.","pos":[0,132]},{"content":"You’ll go through a simple developer scenario in which you will set breakpoints, modify some code, and build the result.","pos":[133,253]}]}]},{"pos":[756,781],"content":"Build and debug a project","linkify":"Build and debug a project","nodes":[{"content":"Build and debug a project","pos":[0,25]}]},{"pos":[783,796],"content":"Prerequisites","linkify":"Prerequisites","nodes":[{"content":"Prerequisites","pos":[0,13]}]},{"content":"Previous experience with code and Visual Studio is helpful to get the full benefit of this tutorial.","pos":[812,912]},{"content":"This tutorial requires you to access the Microsoft Dynamics AX environment using Remote Desktop and that you be provisioned as an administrator on the instance.","pos":[913,1073]},{"pos":[1078,1090],"content":"Key concepts","linkify":"Key concepts","nodes":[{"content":"Key concepts","pos":[0,12]}]},{"content":"The debugger in Visual Studio is used to analyze and debug code in Microsoft Dynamics AX.","pos":[1095,1184]},{"content":"The standard features of the Visual Studio debugger are available to use when you're examining the running application.","pos":[1189,1308]},{"content":"These features include modifying values of variables, setting breakpoints, and so on.","pos":[1309,1394]},{"content":"IntelliSense and other features of Visual Studio are vital to efficient code editing and comprehension.","pos":[1399,1502]},{"content":"Development is an iterative process.","pos":[1507,1543]},{"content":"After making modifications to the code, the project will be built, and changes can be tested.","pos":[1544,1637]},{"pos":[1642,1650],"content":"Scenario","linkify":"Scenario","nodes":[{"content":"Scenario","pos":[0,8]}]},{"content":"The rental company has had unfortunate events when customers rent cars using credit cards that are past the expiration dates.","pos":[1651,1776]},{"content":"You, the developer, are tasked with revising the application to help prevent this situation.","pos":[1777,1869]},{"content":"You’ll identify the problem by using the debugger in Visual Studio.","pos":[1870,1937]},{"content":"After the problem is identified, you’ll edit some code to implement a fix.","pos":[1938,2012]},{"content":"Finally, you’ll build the project and validate that the fix was successful.","pos":[2013,2088]},{"pos":[2093,2112],"content":"Run to a breakpoint","linkify":"Run to a breakpoint","nodes":[{"content":"Run to a breakpoint","pos":[0,19]}]},{"content":"On the desktop, double-click the Visual Studio shortcut to open the development environment.","pos":[2117,2209]},{"content":"Open the FleetManagement solution.","pos":[2214,2248]},{"content":"On the <bpt id=\"p1\">**</bpt>File<ept id=\"p1\">**</ept> menu, point to <bpt id=\"p2\">**</bpt>Open<ept id=\"p2\">**</ept>, and then click <bpt id=\"p3\">**</bpt>Project/Solution<ept id=\"p3\">**</ept>.","pos":[2249,2326],"source":" On the **File** menu, point to **Open**, and then click **Project/Solution**."},{"content":"Browse to the desktop, and then open the <bpt id=\"p1\">**</bpt>FleetManagement<ept id=\"p1\">**</ept> folder.","pos":[2331,2399],"source":"Browse to the desktop, and then open the **FleetManagement** folder."},{"content":"If the solution file is not on your computer, the steps to create it are listed in <bpt id=\"p1\">[</bpt>Tutorial: Create a Fleet Management solution file out of the Fleet Management models in the AOT<ept id=\"p1\">](https://community.dynamics.com/ax/b/newdynamicsax/archive/2016/05/19/tutorial-create-a-fleet-management-solution-file-out-of-the-fleet-management-models-in-the-aot)</ept>.","pos":[2400,2746],"source":" If the solution file is not on your computer, the steps to create it are listed in [Tutorial: Create a Fleet Management solution file out of the Fleet Management models in the AOT](https://community.dynamics.com/ax/b/newdynamicsax/archive/2016/05/19/tutorial-create-a-fleet-management-solution-file-out-of-the-fleet-management-models-in-the-aot)."},{"content":"Select the file named <bpt id=\"p1\">**</bpt>FleetManagement<ept id=\"p1\">**</ept>.","pos":[2751,2793],"source":"Select the file named **FleetManagement**."},{"content":"The file type listed is SLN File.","pos":[2794,2827]},{"content":"Click <bpt id=\"p1\">**</bpt>Open<ept id=\"p1\">**</ept>.","pos":[2832,2847],"source":"Click **Open**."},{"content":"Loading the solution may take some time.","pos":[2848,2888]},{"content":"Make the <bpt id=\"p1\">**</bpt>FleetManagement Migrated<ept id=\"p1\">**</ept> project the startup project.","pos":[2893,2959],"source":"Make the **FleetManagement Migrated** project the startup project."},{"content":"In <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, right-click the <bpt id=\"p2\">**</bpt>Fleet Management Migrated<ept id=\"p2\">**</ept> project, and choose <bpt id=\"p3\">**</bpt>Set as StartUp Project<ept id=\"p3\">**</ept> in the context menu.","pos":[2960,3099],"source":" In **Solution Explorer**, right-click the **Fleet Management Migrated** project, and choose **Set as StartUp Project** in the context menu."},{"pos":[3104,3208],"content":"In <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, double-click the <bpt id=\"p2\">**</bpt>Fleet Management migrated<ept id=\"p2\">**</ept> project to display its content.","source":"In **Solution Explorer**, double-click the **Fleet Management migrated** project to display its content."},{"content":"Double-click the <bpt id=\"p1\">**</bpt>Code<ept id=\"p1\">**</ept> folder, and then double click the <bpt id=\"p2\">**</bpt>Classes<ept id=\"p2\">**</ept> folder of the Fleet Management migrated project.","pos":[3213,3333],"source":"Double-click the **Code** folder, and then double click the **Classes** folder of the Fleet Management migrated project."},{"content":"Locate the <bpt id=\"p1\">**</bpt>FMRentailCheckoutProcessor<ept id=\"p1\">**</ept> class.","pos":[3334,3382],"source":" Locate the **FMRentailCheckoutProcessor** class."},{"content":"Right-click this class, and then click <bpt id=\"p1\">**</bpt>Open<ept id=\"p1\">**</ept>.","pos":[3383,3431],"source":" Right-click this class, and then click **Open**."},{"content":"Alternatively, you can use the solution explorer search bar at the top of the solution explorer window.","pos":[3432,3535]},{"content":"As you enter the name in the search bar, you'll see the corresponding artifacts selected in the solution explorer.","pos":[3536,3650]},{"content":"You can now see the X++ code for the class.","pos":[3651,3694]},{"content":"This class has a method named","pos":[3695,3724]},{"content":"Place a breakpoint in this method on the line following the first comment.","pos":[3729,3803]},{"content":"To do this, click in the margin to the left of the line of code where you want the debugger to pause execution.","pos":[3804,3915]},{"content":"You can also click anywhere in the line of code, and then press F9.","pos":[3916,3983]},{"content":"The following illustration shows a breakpoint, which is displayed as a red-filled circle in the margin.","pos":[3984,4087]},{"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>RedCircleMargin<ph id=\"ph2\">\\_</ph>BuildDebugProj<ept id=\"p1\">](media/RedCircleMargin_BuildDebugProj.png)](media/RedCircleMargin_BuildDebugProj.png)</ept> The FinalizeRentalCheckout method is called when a rental transaction is saved.","pos":[4088,4288],"source":"[![RedCircleMargin\\_BuildDebugProj](media/RedCircleMargin_BuildDebugProj.png)](media/RedCircleMargin_BuildDebugProj.png) The FinalizeRentalCheckout method is called when a rental transaction is saved."},{"content":"This method calls the delegate named RentalTransactionAboutTobeFinalizedEvent.","pos":[4289,4367]},{"content":"You can implement an event handler method, which is called by this delegate.","pos":[4368,4444]},{"content":"The method that calls the delegate passes a parameter, named RentalConfirmation, which contains a value that indicates whether the rental should be allowed or blocked.","pos":[4445,4612]},{"content":"If the rental is allowed, the value contains \"true\"; if it's blocked, the value contains \"false\".","pos":[4613,4710]},{"content":"An event handler can change this value, based on any test the developer chooses to implement in code.","pos":[4711,4812]},{"content":"In this case, we'll modify the code to test the expiration date of the credit card.","pos":[4813,4896]},{"content":"Press F5 to start the application for debugging, or, on the <bpt id=\"p1\">**</bpt>Debug<ept id=\"p1\">**</ept> menu, click <bpt id=\"p2\">**</bpt>Start Debugging<ept id=\"p2\">**</ept>.","pos":[4901,5003],"source":"Press F5 to start the application for debugging, or, on the **Debug** menu, click **Start Debugging**."},{"content":"It's important that you start the application in one of these ways.","pos":[5004,5071]},{"content":"If you don't, the Visual Studio debugger won't start, so you won't hit any of the breakpoints you've set.","pos":[5072,5177]},{"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>:The debugger needs to relate code position to source positions.","pos":[5178,5250],"source":"**Note**:The debugger needs to relate code position to source positions."},{"content":"It does this through consuming PDB files produced alongside the assemblies and netmodules.","pos":[5251,5341]},{"content":"The debugger will load symbols from the PDB files as described in the settings in the global tools settings.","pos":[5342,5450]},{"content":"To open the options page containing the setting that controls which symbols load, go to the <bpt id=\"p1\">**</bpt>Tools<ept id=\"p1\">**</ept> menu and choose <bpt id=\"p2\">**</bpt>Options<ept id=\"p2\">**</ept>.","pos":[5451,5581],"source":" To open the options page containing the setting that controls which symbols load, go to the **Tools** menu and choose **Options**."},{"content":"In the <bpt id=\"p1\">**</bpt>Microsoft Dynamics AX<ept id=\"p1\">**</ept> group, select the <bpt id=\"p2\">**</bpt>Debugging<ept id=\"p2\">**</ept> page.","pos":[5582,5652],"source":" In the **Microsoft Dynamics AX** group, select the **Debugging** page."},{"content":"If this option is selected, the system will load symbols from only the PDB files related to the artifacts in the current solution.","pos":[5653,5783]},{"content":"This reduces the startup time significantly, so be sure it’s selected for this lab.","pos":[5784,5867]},{"content":"Be aware that when this option is selected, it won’t be possible to see source code from entities outside of the current solution.","pos":[5868,5998]},{"content":"After a few moments, the browser will start and display the startup object that was selected in the project.","pos":[5999,6107]},{"pos":[6112,6151],"content":"Browse to the <bpt id=\"p1\">**</bpt>Current rentals<ept id=\"p1\">**</ept> page.","source":"Browse to the **Current rentals** page."},{"pos":[6160,6246],"content":"Go to the Dynamics <bpt id=\"p1\">**</bpt>Dashboard<ept id=\"p1\">**</ept> by clicking the Dynamics AX in the upper left corner.","source":"Go to the Dynamics **Dashboard** by clicking the Dynamics AX in the upper left corner."},{"content":"Find the Fleet Management module.","pos":[6255,6288]},{"content":"You can use the Navigation (press Alt+F1), expand the Modules heading and find the <bpt id=\"p1\">**</bpt>Fleet Management<ept id=\"p1\">**</ept> module.","pos":[6289,6400],"source":" You can use the Navigation (press Alt+F1), expand the Modules heading and find the **Fleet Management** module."},{"pos":[6409,6458],"content":"Click the <bpt id=\"p1\">**</bpt>Current rentals<ept id=\"p1\">**</ept> item under Rentals.","source":"Click the **Current rentals** item under Rentals."},{"pos":[6467,6537],"content":"In the action pane, click <bpt id=\"p1\">**</bpt>Options <ph id=\"ph1\">&amp;gt;</ph> Change view <ph id=\"ph2\">&amp;gt;</ph> Line view<ept id=\"p1\">**</ept>.","source":"In the action pane, click **Options &gt; Change view &gt; Line view**."},{"pos":[6546,6635],"content":"When the page is displayed, click <bpt id=\"p1\">**</bpt>Show list<ept id=\"p1\">**</ept> in the Show/Hide list (or press Ctrl+F8).","source":"When the page is displayed, click **Show list** in the Show/Hide list (or press Ctrl+F8)."},{"content":"Make a change to any existing rental.","pos":[6641,6678]},{"content":"For example, click <bpt id=\"p1\">**</bpt>Edit<ept id=\"p1\">**</ept>, and change the time that the rental period started.","pos":[6679,6759],"source":" For example, click **Edit**, and change the time that the rental period started."},{"content":"Click <bpt id=\"p1\">**</bpt>Save<ept id=\"p1\">**</ept> to force a validation of the rental record.","pos":[6764,6822],"source":"Click **Save** to force a validation of the rental record."},{"content":"The method in which you placed a breakpoint is called.","pos":[6823,6877]},{"content":"Execution pauses at the line of code that contains the breakpoint.","pos":[6878,6944]},{"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>ForceValidation<ph id=\"ph2\">\\_</ph>BuildDebugProj<ept id=\"p1\">](media/ForceValidation_BuildDebugProj.png)](media/ForceValidation_BuildDebugProj.png)</ept> While the application is paused at a breakpoint, you can examine the application state.","pos":[6945,7153],"source":"[![ForceValidation\\_BuildDebugProj](media/ForceValidation_BuildDebugProj.png)](media/ForceValidation_BuildDebugProj.png) While the application is paused at a breakpoint, you can examine the application state."},{"content":"Use the same techniques that you typically would for any application developed with Visual Studio.","pos":[7154,7252]},{"content":"For example, place the cursor over a variable to see its value in a tooltip.","pos":[7253,7329]},{"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>Tooltip<ph id=\"ph2\">\\_</ph>BuildDebugProj<ept id=\"p1\">](media/Tooltip_BuildDebugProj.png)](media/Tooltip_BuildDebugProj.png)</ept>","pos":[7330,7426],"source":"[![Tooltip\\_BuildDebugProj](media/Tooltip_BuildDebugProj.png)](media/Tooltip_BuildDebugProj.png)"},{"content":"The other debugging tools in Visual Studio are available as well.","pos":[7431,7496]},{"content":"For example, the <bpt id=\"p1\">**</bpt>Locals<ept id=\"p1\">**</ept> window shows all of the local variables for the location where execution has stopped.","pos":[7497,7610],"source":" For example, the **Locals** window shows all of the local variables for the location where execution has stopped."},{"content":"Click the <bpt id=\"p1\">**</bpt>Locals<ept id=\"p1\">**</ept> tab at the bottom of Visual Studio, and expand the <bpt id=\"p2\">**</bpt>fmrentalrecord<ept id=\"p2\">**</ept> variable.","pos":[7611,7711],"source":" Click the **Locals** tab at the bottom of Visual Studio, and expand the **fmrentalrecord** variable."},{"content":"You will see the internal state of the record, showing the values of all the fields in the record.","pos":[7712,7810]},{"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>InternalState<ph id=\"ph2\">\\_</ph>BuildDebugProj<ept id=\"p1\">](media/InternalState_BuildDebugProj.png)](media/InternalState_BuildDebugProj.png)</ept> Notice the value of the <bpt id=\"p2\">**</bpt>Vehicle<ept id=\"p2\">**</ept> property of the <bpt id=\"p3\">**</bpt>fmrentalrecord<ept id=\"p3\">**</ept> variable.","pos":[7811,8006],"source":"[![InternalState\\_BuildDebugProj](media/InternalState_BuildDebugProj.png)](media/InternalState_BuildDebugProj.png) Notice the value of the **Vehicle** property of the **fmrentalrecord** variable."},{"content":"This property is a foreign key field in the <bpt id=\"p1\">**</bpt>FMRental<ept id=\"p1\">**</ept> table.","pos":[8007,8070],"source":" This property is a foreign key field in the **FMRental** table."},{"content":"The debugger allows us to peek into the related record in the FMVehicle table.","pos":[8071,8149]},{"content":"It shows values that belong to the <bpt id=\"p1\">**</bpt>AutoIdentification<ept id=\"p1\">**</ept> field group.","pos":[8150,8220],"source":" It shows values that belong to the **AutoIdentification** field group."},{"content":"The <bpt id=\"p1\">**</bpt>Breakpoints<ept id=\"p1\">**</ept> window lists all of the breakpoints that have been set.","pos":[8225,8300],"source":"The **Breakpoints** window lists all of the breakpoints that have been set."},{"content":"Click the <bpt id=\"p1\">**</bpt>Breakpoints<ept id=\"p1\">**</ept> tab to see its content.","pos":[8301,8350],"source":" Click the **Breakpoints** tab to see its content."},{"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>Breakpoint<ph id=\"ph2\">\\_</ph>BuildDebugProj<ept id=\"p1\">](media/Breakpoint_BuildDebugProj.png)](media/Breakpoint_BuildDebugProj.png)</ept>","pos":[8351,8456],"source":"[![Breakpoint\\_BuildDebugProj](media/Breakpoint_BuildDebugProj.png)](media/Breakpoint_BuildDebugProj.png)"},{"content":"Press F10 a few times to step through the code, line-by-line, and use the full complement of debugger features.","pos":[8461,8572]},{"content":"Notice that the <bpt id=\"p1\">**</bpt>Locals<ept id=\"p1\">**</ept> window updates the values of variables immediately with each statement that's executed.","pos":[8573,8687],"source":" Notice that the **Locals** window updates the values of variables immediately with each statement that's executed."},{"pos":[8692,8739],"content":"On the toolbar, click <bpt id=\"p1\">**</bpt>Continue<ept id=\"p1\">**</ept>, or press F5","source":"On the toolbar, click **Continue**, or press F5"},{"content":"Close Internet Explorer to close the <bpt id=\"p1\">**</bpt>Fleet Management<ept id=\"p1\">**</ept> application.","pos":[8744,8814],"source":"Close Internet Explorer to close the **Fleet Management** application."},{"content":"Visual Studio will exit the debugging mode.","pos":[8815,8858]},{"content":"An alternative is to choose <bpt id=\"p1\">**</bpt>Stop Debugging<ept id=\"p1\">**</ept> from the <bpt id=\"p2\">**</bpt>Debug<ept id=\"p2\">**</ept> menu.","pos":[8859,8930],"source":" An alternative is to choose **Stop Debugging** from the **Debug** menu."},{"content":"This will leave Internet Explorer open, allowing the next debugging session to start faster.","pos":[8931,9023]},{"pos":[9028,9051],"content":"Add the validation code","linkify":"Add the validation code","nodes":[{"content":"Add the validation code","pos":[0,23]}]},{"content":"In the <bpt id=\"p1\">**</bpt>FinalizeRentalCheckout<ept id=\"p1\">**</ept> method, you saw that the developer added code to call the delegate that’s used to determine the validity of the rental.","pos":[9052,9205],"source":"In the **FinalizeRentalCheckout** method, you saw that the developer added code to call the delegate that’s used to determine the validity of the rental."},{"content":"To solve the problem of expired credit cards, you’ll add an event handler, which you’ll use to verify that that the credit card isn’t expired.","pos":[9206,9348]},{"content":"To simplify the lab, the handler will be added in the same file that contains the delegate.","pos":[9349,9440]},{"content":"Use the following code as inspiration.","pos":[9441,9479]},{"content":"Rather than copying and pasting the code, type it in manually to see the IntelliSense features in action.","pos":[9480,9585]},{"content":"These features add to the high level of productivity that Visual Studio users expect.","pos":[9586,9671]},{"content":"The preceding code is straightforward.","pos":[11087,11125]},{"content":"The method is marked as handler for the relevant delegate by using the <bpt id=\"p1\">**</bpt>SubscribesTo<ept id=\"p1\">**</ept> attribute, as shown.","pos":[11126,11234],"source":" The method is marked as handler for the relevant delegate by using the **SubscribesTo** attribute, as shown."},{"content":"In the code, the customer record is retrieved, and then the credit card date is compared to today's date.","pos":[11235,11340]},{"content":"If the expiration date of the credit card is in the past, the event handler sets a value in the <bpt id=\"p1\">**</bpt>RentalConfirmation<ept id=\"p1\">**</ept> structure to signal that the customer isn't eligible to rent a vehicle.","pos":[11341,11531],"source":" If the expiration date of the credit card is in the past, the event handler sets a value in the **RentalConfirmation** structure to signal that the customer isn't eligible to rent a vehicle."},{"content":"The idea is that any number of handlers can subscribe to the delegate.","pos":[11532,11602]},{"content":"If any handler determines that a rental should not proceed, it sets the <bpt id=\"p1\">**</bpt>OkToRent<ept id=\"p1\">**</ept> flag to false.","pos":[11603,11702],"source":" If any handler determines that a rental should not proceed, it sets the **OkToRent** flag to false."},{"content":"A superior implementation might refrain from doing any analysis if it determines that the <bpt id=\"p1\">**</bpt>OkToRent<ept id=\"p1\">**</ept> flag has already been set to false.","pos":[11703,11841],"source":" A superior implementation might refrain from doing any analysis if it determines that the **OkToRent** flag has already been set to false."},{"content":"Be sure that you're working in the FMRentalCheckoutProcessor.xpp file.","pos":[11847,11917]},{"content":"Begin by adding the new event handler definition to the FMRentalCheckoutProcessor class.","pos":[11918,12006]},{"content":"Add the following code on an empty line just above the brace (}) that marks the end of the class definition.","pos":[12007,12115]},{"content":"Add the attributes to the beginning of the event handler.","pos":[12248,12305]},{"content":"These attributes indicate which delegate the event handler is subscribing to.","pos":[12306,12383]},{"content":"Now, add the code that checks the credit card expiration value.","pos":[12768,12831]},{"content":"The completed method should look similar to the following code.","pos":[12832,12895]},{"content":"Make sure the handler and the delegate are separated by exactly one blank line.","pos":[14446,14525]},{"pos":[14530,14578],"content":"On the toolbar in Visual Studio, click <bpt id=\"p1\">**</bpt>Save<ept id=\"p1\">**</ept>.","source":"On the toolbar in Visual Studio, click **Save**."},{"content":"After you're satisfied with the code, build the code for the Fleet Management Migrated project.","pos":[14583,14678]},{"content":"To do this, in <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, right-click the <bpt id=\"p2\">**</bpt>FleetManagement Migrated<ept id=\"p2\">**</ept> project name, and then click <bpt id=\"p3\">**</bpt>Build<ept id=\"p3\">**</ept>.","pos":[14679,14801],"source":" To do this, in **Solution Explorer**, right-click the **FleetManagement Migrated** project name, and then click **Build**."},{"content":"You may see errors or warnings if the code isn't correct.","pos":[14802,14859]},{"content":"If so, correct the code, and build again until all warnings and errors have been resolved.","pos":[14860,14950]},{"content":"You're now ready to validate that the revision works as intended.","pos":[14951,15016]},{"pos":[15021,15077],"content":"On the <bpt id=\"p1\">**</bpt>Debug<ept id=\"p1\">**</ept> menu, click <bpt id=\"p2\">**</bpt>Delete All Breakpoints<ept id=\"p2\">**</ept>.","source":"On the **Debug** menu, click **Delete All Breakpoints**."},{"content":"Place a new breakpoint in the event-handler method at the line that contains the following statement:","pos":[15082,15183]},{"content":"Start the Fleet Management sample with debugging active by pressing F5.","pos":[15234,15305]},{"content":"Browse to the <bpt id=\"p1\">**</bpt>Current rentals<ept id=\"p1\">**</ept> page, as described starting in step 11 of the previous section.","pos":[15310,15407],"source":"Browse to the **Current rentals** page, as described starting in step 11 of the previous section."},{"content":"Select one of the reservations, and click <bpt id=\"p1\">**</bpt>Edit<ept id=\"p1\">**</ept>.","pos":[15408,15459],"source":" Select one of the reservations, and click **Edit**."},{"content":"In the <bpt id=\"p1\">**</bpt>Customer<ept id=\"p1\">**</ept> drop-down list, select Adrian Lannin from the list, and then click <bpt id=\"p2\">**</bpt>Save<ept id=\"p2\">**</ept>.","pos":[15464,15560],"source":"In the **Customer** drop-down list, select Adrian Lannin from the list, and then click **Save**."},{"content":"Execution pauses at the breakpoint that you set in the event-handler method.","pos":[15561,15637]},{"content":"Press F10 three times to step through the code block.","pos":[15642,15695]},{"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>StepCodeBlock<ph id=\"ph2\">\\_</ph>BuildDebugProj<ept id=\"p1\">](media/StepCodeBlock_BuildDebugProj.png)](media/StepCodeBlock_BuildDebugProj.png)</ept>","pos":[15696,15810],"source":"[![StepCodeBlock\\_BuildDebugProj](media/StepCodeBlock_BuildDebugProj.png)](media/StepCodeBlock_BuildDebugProj.png)"},{"content":"To see the code map for the call stacks, right-click in the code editor, and then click <bpt id=\"p1\">**</bpt>Show Call Stack on Code Map<ept id=\"p1\">**</ept>.","pos":[15815,15935],"source":"To see the code map for the call stacks, right-click in the code editor, and then click **Show Call Stack on Code Map**."},{"content":"You may want to add a comment to the call stack, step through the code, and watch as the code map changes accordingly.","pos":[15936,16054]},{"content":"Press F5 to continue.","pos":[16059,16080]},{"content":"You'll see that the customer has been disallowed.","pos":[16081,16130]},{"content":"In the same rental, change the customer name to Phil Spencer, and then click <bpt id=\"p1\">**</bpt>Update<ept id=\"p1\">**</ept>.","pos":[16135,16223],"source":"In the same rental, change the customer name to Phil Spencer, and then click **Update**."},{"content":"This time, the transaction is allowed.","pos":[16224,16262]},{"content":"Close Internet Explorer.","pos":[16267,16291]},{"content":"Comment out the <bpt id=\"p1\">**</bpt>SubscribesTo<ept id=\"p1\">**</ept> attribute on the <bpt id=\"p2\">**</bpt>RentalFinalizedEventHandler<ept id=\"p2\">**</ept> method.","pos":[16296,16385],"source":"Comment out the **SubscribesTo** attribute on the **RentalFinalizedEventHandler** method."},{"content":"This step ensures that the credit card test will no longer run as you work on the remaining tutorials.","pos":[16386,16488]},{"pos":[16493,16507],"content":"Best practices","linkify":"Best practices","nodes":[{"content":"Best practices","pos":[0,14]}]},{"content":"Earlier in this tutorial, you had the opportunity to add code to the project and build the solution with your changes.","pos":[16508,16626]},{"content":"The build process may not have been successful, requiring you to refer to the error window.","pos":[16627,16718]},{"content":"Using this window, you can get to the error by clicking on the line that describes the error.","pos":[16719,16812]},{"content":"You may have noticed some diagnostic messages that don’t represent compilation errors.","pos":[16813,16899]},{"content":"These are diagnostics from the <bpt id=\"p1\">**</bpt>Best Practice<ept id=\"p1\">**</ept> checker.","pos":[16900,16957],"source":" These are diagnostics from the **Best Practice** checker."},{"content":"This tool will check for instances where the developer has violated a known best practice, and display a warning when one is found.","pos":[16958,17089]},{"content":"The Best Practice rules apply to both code constructs and metadata.","pos":[17090,17157]},{"content":"Each software development organization is likely to have its own set of best practices that they enforce.","pos":[17158,17263]},{"content":"They may want to disregard some of the existing best practice checks.","pos":[17264,17333]},{"content":"To support this, the set of reported best practice diagnostics can be modified by the individual developer.","pos":[17334,17441]},{"content":"To demonstrate this, complete the following steps:","pos":[17442,17492]},{"content":"On the <bpt id=\"p1\">**</bpt>View<ept id=\"p1\">**</ept> menu, click <bpt id=\"p2\">**</bpt>Error List<ept id=\"p2\">**</ept>.","pos":[17498,17541],"source":"On the **View** menu, click **Error List**."},{"content":"You should see a small number of best practice warnings.","pos":[17542,17598]},{"content":"On the <bpt id=\"p1\">**</bpt>DYNAMICS AX<ept id=\"p1\">**</ept> menu, click <bpt id=\"p2\">**</bpt>Options<ept id=\"p2\">**</ept>.","pos":[17603,17650],"source":"On the **DYNAMICS AX** menu, click **Options**."},{"content":"In the <bpt id=\"p1\">**</bpt>Dynamics AX<ept id=\"p1\">**</ept> group, choose <bpt id=\"p2\">**</bpt>Best Practices<ept id=\"p2\">**</ept>.","pos":[17651,17707],"source":" In the **Dynamics AX** group, choose **Best Practices**."},{"content":"In the <bpt id=\"p1\">**</bpt>Model<ept id=\"p1\">**</ept> drop-down list, make sure that the <bpt id=\"p2\">**</bpt>Fleet Management<ept id=\"p2\">**</ept> model is selected.","pos":[17712,17803],"source":"In the **Model** drop-down list, make sure that the **Fleet Management** model is selected."},{"content":"The best practice rules apply to a particular model.","pos":[17804,17856]},{"content":"Mark the selections for some of the sets of Best Practice rules.","pos":[17861,17925]},{"content":"For example, if you select the entry for <bpt id=\"p1\">**</bpt>CodeStyleRules<ept id=\"p1\">**</ept>, best practice guidelines for variables will be examined.","pos":[17926,18043],"source":" For example, if you select the entry for **CodeStyleRules**, best practice guidelines for variables will be examined."},{"content":"After you've updated the selections, click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept>.","pos":[18044,18094],"source":" After you've updated the selections, click **OK**."},{"content":"Rebuild the Fleet Management Migrated project by right-clicking the project name and then clicking <bpt id=\"p1\">**</bpt>Rebuild<ept id=\"p1\">**</ept>.","pos":[18099,18210],"source":"Rebuild the Fleet Management Migrated project by right-clicking the project name and then clicking **Rebuild**."},{"content":"You'll notice that the violations of the best practice rules that you specified appear in the <bpt id=\"p1\">**</bpt>Error list<ept id=\"p1\">**</ept> window.","pos":[18211,18327],"source":" You'll notice that the violations of the best practice rules that you specified appear in the **Error list** window."},{"content":"Because Microsoft can’t know all of the best practice checks that a development organization wants to use, the <bpt id=\"p1\">**</bpt>Best Practice<ept id=\"p1\">**</ept> system is extensible.","pos":[18329,18479],"source":"Because Microsoft can’t know all of the best practice checks that a development organization wants to use, the **Best Practice** system is extensible."},{"content":"You author new best practice rules and add them to the system.","pos":[18480,18542]},{"content":"This is done by creating a class in C<ph id=\"ph1\">\\#</ph> that identifies the problem; the class is compiled, and the assembly is selected in the dialog that appears when you click <bpt id=\"p1\">**</bpt>Install Extension<ept id=\"p1\">**</ept> in the <bpt id=\"p2\">**</bpt>Options<ept id=\"p2\">**</ept> window.","pos":[18543,18754],"source":" This is done by creating a class in C\\# that identifies the problem; the class is compiled, and the assembly is selected in the dialog that appears when you click **Install Extension** in the **Options** window."},{"content":"An example of how to implement a best practice rule can be found in the <bpt id=\"p1\">**</bpt>C:<ph id=\"ph1\">\\\\</ph>FMLab<ph id=\"ph2\">\\\\</ph>Code Best Practice Example<ept id=\"p1\">**</ept> folder.","pos":[18755,18876],"source":" An example of how to implement a best practice rule can be found in the **C:\\\\FMLab\\\\Code Best Practice Example** folder."}],"content":"---\n# required metadata\n\ntitle: Build and debug a project | Microsoft Docs\ndescription: In this tutorial, you’ll learn about using the tools in Visual Studio to analyze and debug code in the Fleet Management application. You’ll go through a simple developer scenario in which you will set breakpoints, modify some code, and build the result. \nauthor: annbe\nmanager: AnnBe\nms.date: 2015-12-13 01:58:01\nms.topic: article\nms.prod: \nms.service: Dynamics365Operations\nms.technology: \n\n# optional metadata\n\n# keywords: \n# ROBOTS: \naudience: Developer\n# ms.devlang: \n# ms.reviewer: \nms.suite: Released- Dynamics AX 7.0.0\n# ms.tgt_pltfrm: \nms.custom: 26731\nms.assetid: d5a83a22-9479-47eb-b108-1b9d7fd5a066\n# ms.region: \n# ms.industry: \nms.author: pvillads\n\n---\n\n# Build and debug a project\n\nPrerequisites\n-------------\n\nPrevious experience with code and Visual Studio is helpful to get the full benefit of this tutorial. This tutorial requires you to access the Microsoft Dynamics AX environment using Remote Desktop and that you be provisioned as an administrator on the instance.\n\n## Key concepts\n-   The debugger in Visual Studio is used to analyze and debug code in Microsoft Dynamics AX.\n-   The standard features of the Visual Studio debugger are available to use when you're examining the running application. These features include modifying values of variables, setting breakpoints, and so on.\n-   IntelliSense and other features of Visual Studio are vital to efficient code editing and comprehension.\n-   Development is an iterative process. After making modifications to the code, the project will be built, and changes can be tested.\n\n## Scenario\nThe rental company has had unfortunate events when customers rent cars using credit cards that are past the expiration dates. You, the developer, are tasked with revising the application to help prevent this situation. You’ll identify the problem by using the debugger in Visual Studio. After the problem is identified, you’ll edit some code to implement a fix. Finally, you’ll build the project and validate that the fix was successful.\n\n## Run to a breakpoint\n1.  On the desktop, double-click the Visual Studio shortcut to open the development environment.\n2.  Open the FleetManagement solution. On the **File** menu, point to **Open**, and then click **Project/Solution**.\n3.  Browse to the desktop, and then open the **FleetManagement** folder. If the solution file is not on your computer, the steps to create it are listed in [Tutorial: Create a Fleet Management solution file out of the Fleet Management models in the AOT](https://community.dynamics.com/ax/b/newdynamicsax/archive/2016/05/19/tutorial-create-a-fleet-management-solution-file-out-of-the-fleet-management-models-in-the-aot).\n4.  Select the file named **FleetManagement**. The file type listed is SLN File.\n5.  Click **Open**. Loading the solution may take some time.\n6.  Make the **FleetManagement Migrated** project the startup project. In **Solution Explorer**, right-click the **Fleet Management Migrated** project, and choose **Set as StartUp Project** in the context menu.\n7.  In **Solution Explorer**, double-click the **Fleet Management migrated** project to display its content.\n8.  Double-click the **Code** folder, and then double click the **Classes** folder of the Fleet Management migrated project. Locate the **FMRentailCheckoutProcessor** class. Right-click this class, and then click **Open**. Alternatively, you can use the solution explorer search bar at the top of the solution explorer window. As you enter the name in the search bar, you'll see the corresponding artifacts selected in the solution explorer. You can now see the X++ code for the class. This class has a method named\n9.  Place a breakpoint in this method on the line following the first comment. To do this, click in the margin to the left of the line of code where you want the debugger to pause execution. You can also click anywhere in the line of code, and then press F9. The following illustration shows a breakpoint, which is displayed as a red-filled circle in the margin. [![RedCircleMargin\\_BuildDebugProj](media/RedCircleMargin_BuildDebugProj.png)](media/RedCircleMargin_BuildDebugProj.png) The FinalizeRentalCheckout method is called when a rental transaction is saved. This method calls the delegate named RentalTransactionAboutTobeFinalizedEvent. You can implement an event handler method, which is called by this delegate. The method that calls the delegate passes a parameter, named RentalConfirmation, which contains a value that indicates whether the rental should be allowed or blocked. If the rental is allowed, the value contains \"true\"; if it's blocked, the value contains \"false\". An event handler can change this value, based on any test the developer chooses to implement in code. In this case, we'll modify the code to test the expiration date of the credit card.\n10. Press F5 to start the application for debugging, or, on the **Debug** menu, click **Start Debugging**. It's important that you start the application in one of these ways. If you don't, the Visual Studio debugger won't start, so you won't hit any of the breakpoints you've set. **Note**:The debugger needs to relate code position to source positions. It does this through consuming PDB files produced alongside the assemblies and netmodules. The debugger will load symbols from the PDB files as described in the settings in the global tools settings. To open the options page containing the setting that controls which symbols load, go to the **Tools** menu and choose **Options**. In the **Microsoft Dynamics AX** group, select the **Debugging** page. If this option is selected, the system will load symbols from only the PDB files related to the artifacts in the current solution. This reduces the startup time significantly, so be sure it’s selected for this lab. Be aware that when this option is selected, it won’t be possible to see source code from entities outside of the current solution. After a few moments, the browser will start and display the startup object that was selected in the project.\n11. Browse to the **Current rentals** page.\n    1.  Go to the Dynamics **Dashboard** by clicking the Dynamics AX in the upper left corner.\n    2.  Find the Fleet Management module. You can use the Navigation (press Alt+F1), expand the Modules heading and find the **Fleet Management** module.\n    3.  Click the **Current rentals** item under Rentals.\n    4.  In the action pane, click **Options &gt; Change view &gt; Line view**.\n    5.  When the page is displayed, click **Show list** in the Show/Hide list (or press Ctrl+F8).\n\n12. Make a change to any existing rental. For example, click **Edit**, and change the time that the rental period started.\n13. Click **Save** to force a validation of the rental record. The method in which you placed a breakpoint is called. Execution pauses at the line of code that contains the breakpoint. [![ForceValidation\\_BuildDebugProj](media/ForceValidation_BuildDebugProj.png)](media/ForceValidation_BuildDebugProj.png) While the application is paused at a breakpoint, you can examine the application state. Use the same techniques that you typically would for any application developed with Visual Studio. For example, place the cursor over a variable to see its value in a tooltip. [![Tooltip\\_BuildDebugProj](media/Tooltip_BuildDebugProj.png)](media/Tooltip_BuildDebugProj.png)\n14. The other debugging tools in Visual Studio are available as well. For example, the **Locals** window shows all of the local variables for the location where execution has stopped. Click the **Locals** tab at the bottom of Visual Studio, and expand the **fmrentalrecord** variable. You will see the internal state of the record, showing the values of all the fields in the record. [![InternalState\\_BuildDebugProj](media/InternalState_BuildDebugProj.png)](media/InternalState_BuildDebugProj.png) Notice the value of the **Vehicle** property of the **fmrentalrecord** variable. This property is a foreign key field in the **FMRental** table. The debugger allows us to peek into the related record in the FMVehicle table. It shows values that belong to the **AutoIdentification** field group.\n15. The **Breakpoints** window lists all of the breakpoints that have been set. Click the **Breakpoints** tab to see its content. [![Breakpoint\\_BuildDebugProj](media/Breakpoint_BuildDebugProj.png)](media/Breakpoint_BuildDebugProj.png)\n16. Press F10 a few times to step through the code, line-by-line, and use the full complement of debugger features. Notice that the **Locals** window updates the values of variables immediately with each statement that's executed.\n17. On the toolbar, click **Continue**, or press F5\n18. Close Internet Explorer to close the **Fleet Management** application. Visual Studio will exit the debugging mode. An alternative is to choose **Stop Debugging** from the **Debug** menu. This will leave Internet Explorer open, allowing the next debugging session to start faster.\n\n## Add the validation code\nIn the **FinalizeRentalCheckout** method, you saw that the developer added code to call the delegate that’s used to determine the validity of the rental. To solve the problem of expired credit cards, you’ll add an event handler, which you’ll use to verify that that the credit card isn’t expired. To simplify the lab, the handler will be added in the same file that contains the delegate. Use the following code as inspiration. Rather than copying and pasting the code, type it in manually to see the IntelliSense features in action. These features add to the high level of productivity that Visual Studio users expect.\n\n    [SubscribesTo(classstr(FMRentalCheckoutProcessor), \n        delegatestr(FMRentalCheckoutProcessor, RentalTransactionAboutTobeFinalizedEvent))]\n    public static void RentalFinalizedEventHandler(FMRental rentalrecord, Struct rentalConfirmation)\n    {\n        FMPaymentInformation paymentInfo;\n        date ccExpiryDate, lastDayOfExpiryMonth;\n        str s;\n\n        select firstonly * from paymentInfo where paymentinfo.RecId == rentalRecord.PaymentInformationId;\n\n        if (paymentInfo)\n        {\n            // Check if the payment info is valid\n            // For now, we will check if the credit card is expired\n            // Credit cards expire on the last day of the month indicated\n            ccExpiryDate = mkdate(1, str2int(paymentInfo.ExpirationMonth), paymentInfo.ExpirationYear);\n            lastDayOfExpiryMonth = endmth(ccExpiryDate);\n            \n            if (lastDayOfExpiryMonth < today())\n            {\n                rentalConfirmation.value('OktoRent', false);\n                s = \"Credit card validation failed for rental \";\n            }\n            else\n            {\n                s = \"Credit card validation succeeded for rental \";\n            }\n\n            info (s + rentalrecord.RentalId);\n        }\n        else\n        {\n            rentalConfirmation.value('OktoRent', false);\n            info (\"No Credit card available for \" + rentalrecord.RentalId);\n        }\n    }\n\nThe preceding code is straightforward. The method is marked as handler for the relevant delegate by using the **SubscribesTo** attribute, as shown. In the code, the customer record is retrieved, and then the credit card date is compared to today's date. If the expiration date of the credit card is in the past, the event handler sets a value in the **RentalConfirmation** structure to signal that the customer isn't eligible to rent a vehicle. The idea is that any number of handlers can subscribe to the delegate. If any handler determines that a rental should not proceed, it sets the **OkToRent** flag to false. A superior implementation might refrain from doing any analysis if it determines that the **OkToRent** flag has already been set to false.\n\n1.  Be sure that you're working in the FMRentalCheckoutProcessor.xpp file. Begin by adding the new event handler definition to the FMRentalCheckoutProcessor class. Add the following code on an empty line just above the brace (}) that marks the end of the class definition.\n\n        public static void RentalFinalizedEventHandler(FMRental rentalrecord, Struct rentalConfirmation)\n        {\n\n        }\n\n2.  Add the attributes to the beginning of the event handler. These attributes indicate which delegate the event handler is subscribing to.\n\n            [SubscribesTo(classstr(FMRentalCheckoutProcessor),\n               delegatestr(FMRentalCheckoutProcessor, RentalTransactionAboutTobeFinalizedEvent))]\n               public static void RentalFinalizedEventHandler(FMRental rentalrecord, Struct \n                                                                           RentalConfirmation)\n            {\n\n            }\n\n3.  Now, add the code that checks the credit card expiration value. The completed method should look similar to the following code.\n\n        [SubscribesTo(classstr(FMRentalCheckoutProcessor), \n            delegatestr(FMRentalCheckoutProcessor, RentalTransactionAboutTobeFinalizedEvent))]\n        public static void RentalFinalizedEventHandler(FMRental rentalrecord, Struct rentalConfirmation)\n        {\n            FMPaymentInformation paymentInfo;\n            date ccExpiryDate, lastDayOfExpiryMonth;\n            str s;\n\n            select firstonly * from PaymentInfo where paymentinfo.RecId == rentalRecord.PaymentInformationId;\n\n            if (paymentInfo)\n            {\n                // Check if the payment info is valid\n                // For now we will check if the credit card is expired\n                // Credit cards expire on the last day of the month indicated\n                ccExpiryDate = mkdate(1, str2int(paymentInfo.ExpirationMonth), paymentInfo.ExpirationYear);\n                lastDayOfExpiryMonth = endmth(ccExpiryDate);\n                \n                if (lastDayOfExpiryMonth < today())\n                {\n                    rentalConfirmation.value('OktoRent', false);\n                    s = \"Credit card validation failed for rental \";\n                }\n                else\n                {\n                    s = \"Credit card validation succeeded for rental \";\n                }\n\n                info (s + rentalrecord.RentalId);\n            }\n            else\n            {\n                rentalConfirmation.value('OktoRent', false);\n                info (\"No Credit card available for \" + rentalrecord.RentalId);\n            }\n        }\n\n4.  Make sure the handler and the delegate are separated by exactly one blank line.\n5.  On the toolbar in Visual Studio, click **Save**.\n6.  After you're satisfied with the code, build the code for the Fleet Management Migrated project. To do this, in **Solution Explorer**, right-click the **FleetManagement Migrated** project name, and then click **Build**. You may see errors or warnings if the code isn't correct. If so, correct the code, and build again until all warnings and errors have been resolved. You're now ready to validate that the revision works as intended.\n7.  On the **Debug** menu, click **Delete All Breakpoints**.\n8.  Place a new breakpoint in the event-handler method at the line that contains the following statement:\n\n        if (lastDayOfExpiryMonth < today())\n\n9.  Start the Fleet Management sample with debugging active by pressing F5.\n10. Browse to the **Current rentals** page, as described starting in step 11 of the previous section. Select one of the reservations, and click **Edit**.\n11. In the **Customer** drop-down list, select Adrian Lannin from the list, and then click **Save**. Execution pauses at the breakpoint that you set in the event-handler method.\n12. Press F10 three times to step through the code block. [![StepCodeBlock\\_BuildDebugProj](media/StepCodeBlock_BuildDebugProj.png)](media/StepCodeBlock_BuildDebugProj.png)\n13. To see the code map for the call stacks, right-click in the code editor, and then click **Show Call Stack on Code Map**. You may want to add a comment to the call stack, step through the code, and watch as the code map changes accordingly.\n14. Press F5 to continue. You'll see that the customer has been disallowed.\n15. In the same rental, change the customer name to Phil Spencer, and then click **Update**. This time, the transaction is allowed.\n16. Close Internet Explorer.\n17. Comment out the **SubscribesTo** attribute on the **RentalFinalizedEventHandler** method. This step ensures that the credit card test will no longer run as you work on the remaining tutorials.\n\n## Best practices\nEarlier in this tutorial, you had the opportunity to add code to the project and build the solution with your changes. The build process may not have been successful, requiring you to refer to the error window. Using this window, you can get to the error by clicking on the line that describes the error. You may have noticed some diagnostic messages that don’t represent compilation errors. These are diagnostics from the **Best Practice** checker. This tool will check for instances where the developer has violated a known best practice, and display a warning when one is found. The Best Practice rules apply to both code constructs and metadata. Each software development organization is likely to have its own set of best practices that they enforce. They may want to disregard some of the existing best practice checks. To support this, the set of reported best practice diagnostics can be modified by the individual developer. To demonstrate this, complete the following steps:\n\n1.  On the **View** menu, click **Error List**. You should see a small number of best practice warnings.\n2.  On the **DYNAMICS AX** menu, click **Options**. In the **Dynamics AX** group, choose **Best Practices**.\n3.  In the **Model** drop-down list, make sure that the **Fleet Management** model is selected. The best practice rules apply to a particular model.\n4.  Mark the selections for some of the sets of Best Practice rules. For example, if you select the entry for **CodeStyleRules**, best practice guidelines for variables will be examined. After you've updated the selections, click **OK**.\n5.  Rebuild the Fleet Management Migrated project by right-clicking the project name and then clicking **Rebuild**. You'll notice that the violations of the best practice rules that you specified appear in the **Error list** window.\n\nBecause Microsoft can’t know all of the best practice checks that a development organization wants to use, the **Best Practice** system is extensible. You author new best practice rules and add them to the system. This is done by creating a class in C\\# that identifies the problem; the class is compiled, and the assembly is selected in the dialog that appears when you click **Install Extension** in the **Options** window. An example of how to implement a best practice rule can be found in the **C:\\\\FMLab\\\\Code Best Practice Example** folder.\n\n"}