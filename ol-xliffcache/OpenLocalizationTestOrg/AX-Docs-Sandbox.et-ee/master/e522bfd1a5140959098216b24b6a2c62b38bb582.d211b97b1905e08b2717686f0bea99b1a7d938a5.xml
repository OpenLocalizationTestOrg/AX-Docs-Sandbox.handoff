{"nodes":[{"pos":[32,84],"content":"Deployment with continuous build and test automation","needQuote":true,"needEscape":true,"nodes":[{"content":"Deployment with continuous build and test automation","pos":[0,52]}]},{"pos":[98,204],"content":"This wiki describes how to deploy a developer topology that supports continuous build and test automation.","needQuote":true,"needEscape":true,"nodes":[{"content":"This wiki describes how to deploy a developer topology that supports continuous build and test automation.","pos":[0,106]}]},{"pos":[719,771],"content":"Deployment with continuous build and test automation","linkify":"Deployment with continuous build and test automation","nodes":[{"content":"Deployment with continuous build and test automation","pos":[0,52]}]},{"content":"This wiki describes how to deploy a developer topology that supports continuous build and test automation.","pos":[773,879]},{"content":"Prerequisite: This requires a Visual Studio Team Services (VSTS) account for cloud VM deployment.","pos":[881,978]},{"pos":[983,991],"content":"Workflow","linkify":"Workflow","nodes":[{"content":"Workflow","pos":[0,8]}]},{"content":"After you have configured a VSTS subscription in Lifecycle Services (LCS), you can trigger Developer Topology Deployment to set up Developer and Build VMs.","pos":[992,1147]},{"content":"In this deployment, the Developer VM is configured with workspace mapping to develop against a VSTS project.","pos":[1148,1256]},{"content":"The Build VM is auto-configured with the build agent/controller to build modules  VSTS project and to execute automated tests with external endpoint for validation.","pos":[1257,1421]},{"content":"For more information on writing custom test code or generating automated test code to integrate with build infrastructure, see <bpt id=\"p1\">[</bpt>Testing and validations<ept id=\"p1\">](testing-validation.md)</ept>.","pos":[1422,1598],"source":" For more information on writing custom test code or generating automated test code to integrate with build infrastructure, see [Testing and validations](testing-validation.md)."},{"content":"A typical workflow or usage scenario is shown below.","pos":[1599,1651]},{"pos":[1654,1717],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>build12<ept id=\"p1\">](./media/build12-1024x693.jpg)](./media/build12.jpg)</ept>","source":"[![build12](./media/build12-1024x693.jpg)](./media/build12.jpg)"},{"pos":[1722,1763],"content":"Set up Visual Studio Team Services (VSTS)","linkify":"Set up Visual Studio Team Services (VSTS)","nodes":[{"content":"Set up Visual Studio Team Services (VSTS)","pos":[0,41]}]},{"pos":[1764,1903],"content":"Compare VSTS features required for your organization: <bpt id=\"p1\">&lt;</bpt>https://www.visualstudio.com/products/visual-studio-team-services-feature-matrix-vs<ept id=\"p1\">&gt;</ept>","source":"Compare VSTS features required for your organization: <https://www.visualstudio.com/products/visual-studio-team-services-feature-matrix-vs>"},{"content":"<bpt id=\"p1\">**</bpt>TFVC vs GIT<ept id=\"p1\">**</ept>: For RTW, we only support TFVC as source control repository that can be configured in VSTS project connected to LCS.","pos":[1909,2041],"source":"**TFVC vs GIT**: For RTW, we only support TFVC as source control repository that can be configured in VSTS project connected to LCS."},{"content":"Git is not supported.","pos":[2042,2063]},{"content":"<bpt id=\"p1\">**</bpt>Suspend current builds:<ept id=\"p1\">**</ept> If you are deploying the build agent on an existing VSTS project which already has build definition created, please ensure you do not have any active triggers to queue the build.","pos":[2068,2274],"source":"**Suspend current builds:** If you are deploying the build agent on an existing VSTS project which already has build definition created, please ensure you do not have any active triggers to queue the build."},{"content":"Additionally, make sure there are no builds scheduled / queued against the build pool.","pos":[2275,2361]},{"pos":[2372,2444],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>BuildTriggers<ept id=\"p1\">](./media/buildtriggers.jpg)](./media/buildtriggers.jpg)</ept>","source":"[![BuildTriggers](./media/buildtriggers.jpg)](./media/buildtriggers.jpg)"},{"content":"<bpt id=\"p1\">**</bpt>Free VSTS account provides only one build agent<ept id=\"p1\">**</ept>.","pos":[2454,2506],"source":"**Free VSTS account provides only one build agent**."},{"content":"Using free VSTS account and deploying new build VM with another build agent will fail as your account is not provisioned for more than one build agent.","pos":[2507,2658]},{"pos":[2660,2822],"content":"To use more than one build agents, setup your VSTS account with Azure billing: <bpt id=\"p1\">&lt;</bpt>https://www.visualstudio.com/get-started/setup/set-up-billing-for-your-account-vs<ept id=\"p1\">&gt;</ept>","source":"To use more than one build agents, setup your VSTS account with Azure billing: <https://www.visualstudio.com/get-started/setup/set-up-billing-for-your-account-vs>"},{"pos":[2825,2881],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>VSTS1<ept id=\"p1\">](./media/vsts1-300x155.jpg)](./media/vsts1.jpg)</ept>","source":"[![VSTS1](./media/vsts1-300x155.jpg)](./media/vsts1.jpg)"},{"content":"After your account is linked with the Azure subscription.","pos":[2887,2944]},{"content":"Follow the instructions in the Azure management portal to provision more build agents - <bpt id=\"p1\">&lt;</bpt>https://www.visualstudio.com/en-us/get-started/setup/get-more-build-or-load-testing-vs<ept id=\"p1\">&gt;</ept>","pos":[2945,3121],"source":" Follow the instructions in the Azure management portal to provision more build agents - <https://www.visualstudio.com/en-us/get-started/setup/get-more-build-or-load-testing-vs>"},{"pos":[3123,3179],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>VSTS2<ept id=\"p1\">](./media/vsts2-300x151.jpg)](./media/vsts2.jpg)</ept>","source":"[![VSTS2](./media/vsts2-300x151.jpg)](./media/vsts2.jpg)"},{"content":"Note: make sure you increase “Private Agents” under PAID option.","pos":[3182,3246]},{"pos":[3249,3305],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>VSTS3<ept id=\"p1\">](./media/vsts3-300x191.jpg)](./media/vsts3.jpg)</ept>","source":"[![VSTS3](./media/vsts3-300x191.jpg)](./media/vsts3.jpg)"},{"pos":[3311,3428],"content":"<bpt id=\"p1\">**</bpt>Build Agent Pool role and permissions:<ept id=\"p1\">**</ept> <bpt id=\"p2\">&lt;</bpt>https://msdn.microsoft.com/library/vs/alm/build/agents/admin#agent-pools<ept id=\"p2\">&gt;</ept>","source":"**Build Agent Pool role and permissions:** <https://msdn.microsoft.com/library/vs/alm/build/agents/admin#agent-pools>"},{"content":"Once build agents are added, add user (who will be deploying build VM from LCS) to “Agent Pool Administrators” role.","pos":[3430,3546]},{"pos":[3549,3597],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>VSTS4<ept id=\"p1\">](./media/vsts4.jpg)](./media/vsts4.jpg)</ept>","source":"[![VSTS4](./media/vsts4.jpg)](./media/vsts4.jpg)"},{"pos":[3603,3761],"content":"<bpt id=\"p1\">**</bpt>Manage agent:<ept id=\"p1\">**</ept> If you have multiple agents configured and want to delete one, select the agent and use the delete button to the right of the status column.","source":"**Manage agent:** If you have multiple agents configured and want to delete one, select the agent and use the delete button to the right of the status column."},{"pos":[3767,3821],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>build14<ept id=\"p1\">](./media/build14.jpg)](./media/build14.jpg)</ept>","source":"[![build14](./media/build14.jpg)](./media/build14.jpg)"},{"content":"<bpt id=\"p1\">**</bpt>Deleting Default Pool:<ept id=\"p1\">**</ept> If for some reason you have deleted the default pool, please do not create a new pool with the name \"Default\".","pos":[3827,3964],"source":"**Deleting Default Pool:** If for some reason you have deleted the default pool, please do not create a new pool with the name \"Default\"."},{"content":"Instead create a new pool with the different name and pass the pool name from the \"Advanced Settings\" customization from LCS during deployment.","pos":[3965,4108]},{"content":"<bpt id=\"p1\">**</bpt>Personal access token:<ept id=\"p1\">**</ept> This token is used for all Lifecycle Services (LCS) background actions, including upgrade and deployment.","pos":[4113,4245],"source":"**Personal access token:** This token is used for all Lifecycle Services (LCS) background actions, including upgrade and deployment."},{"content":"When a user initiates actions from LCS, LCS expects that users will be added to VSTS.","pos":[4246,4331]},{"content":"The user must authorize LCS access to VSTS on behalf of the user.","pos":[4332,4397]},{"content":"Until the projects users authorize with VSTS, you will see the below message in action center:","pos":[4398,4492]},{"pos":[4495,4606],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>VSTS setup in LCS<ph id=\"ph2\">\\_</ph>May27<ept id=\"p1\">](./media/vsts-setup-in-lcs_may27-300x216.jpg)](./media/vsts-setup-in-lcs_may27.jpg)</ept>","source":"[![VSTS setup in LCS\\_May27](./media/vsts-setup-in-lcs_may27-300x216.jpg)](./media/vsts-setup-in-lcs_may27.jpg)"},{"pos":[4611,4645],"content":"Deploy Developer topology from LCS","linkify":"Deploy Developer topology from LCS","nodes":[{"content":"Deploy Developer topology from LCS","pos":[0,34]}]},{"content":"LCS provides an option to deploy a Development topology environment.","pos":[4646,4714]},{"content":"With this option, you can deploy developer and build VMs in the cloud that are connected to your Visual Studio Team System  (VSTS) project.","pos":[4715,4854]},{"pos":[4860,4908],"content":"VSTS credential setup and linking to LCS project","linkify":"VSTS credential setup and linking to LCS project","nodes":[{"content":"VSTS credential setup and linking to LCS project","pos":[0,48]}]},{"pos":[4914,5039],"content":"Login to the LCS portal to connect to VSTS and your LCS project at <bpt id=\"p1\">[</bpt>https://lcs.dynamics.com/<ept id=\"p1\">](https://lcs.dynamics.com/en/)</ept>.","source":"Login to the LCS portal to connect to VSTS and your LCS project at [https://lcs.dynamics.com/](https://lcs.dynamics.com/en/)."},{"content":"Select a project that you are working on.","pos":[5044,5085]},{"pos":[5090,5126],"content":"Click the <bpt id=\"p1\">**</bpt>Project Settings<ept id=\"p1\">**</ept> tile.","source":"Click the **Project Settings** tile."},{"pos":[5131,5250],"content":"Select <bpt id=\"p1\">**</bpt>Visual Studio Team Services<ept id=\"p1\">**</ept> and enter the VSTS URL where the source code for your module project is located.","source":"Select **Visual Studio Team Services** and enter the VSTS URL where the source code for your module project is located."},{"pos":[5255,5331],"content":"Specify the VSTS link, authorize, and then click <bpt id=\"p1\">**</bpt>Choose default project<ept id=\"p1\">**</ept>.","source":"Specify the VSTS link, authorize, and then click **Choose default project**."},{"pos":[5336,5413],"content":"<bpt id=\"p1\">**</bpt>Note:<ept id=\"p1\">**</ept> We currently support VSTF as source control and do not support Git.","source":"**Note:** We currently support VSTF as source control and do not support Git."},{"pos":[5420,5474],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>VSTS<ept id=\"p1\">](./media/vsts-1024x792.jpg)](./media/vsts.jpg)</ept>","source":"[![VSTS](./media/vsts-1024x792.jpg)](./media/vsts.jpg)"},{"pos":[5480,5526],"content":"Check-in migrated or new module code into VSTS","linkify":"Check-in migrated or new module code into VSTS","nodes":[{"content":"Check-in migrated or new module code into VSTS","pos":[0,46]}]},{"content":"As part of code Migration process or development activities, we expect you to check-in your model source files and the associated test model source files into VSTS.","pos":[5528,5692]},{"content":"If you have migrated your code using the LCS migration service, this is automatically done for you.","pos":[5693,5792]},{"content":"If you have not checked in any code into VSTS and work on direct check-in, you must follow certain guidelines for the VSTS folder structure.","pos":[5793,5933]},{"content":"This will help with setting up correct build definition.","pos":[5934,5990]},{"content":"All modules should be added to root folder <bpt id=\"p1\">**</bpt>Metadata<ept id=\"p1\">**</ept>.","pos":[5991,6047],"source":" All modules should be added to root folder **Metadata**."},{"content":"Under each module, there should be two folders.","pos":[6048,6095]},{"content":"One folder contains all models.","pos":[6096,6127]},{"content":"The other folder should contain descriptor XML for that module.","pos":[6128,6191]},{"pos":[6194,6251],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>image009<ept id=\"p1\">](./media/image009.png)](./media/image009.png)</ept>","source":"[![image009](./media/image009.png)](./media/image009.png)"},{"pos":[6259,6309],"content":"Deploy developer topology (Developer and Build VM)","linkify":"Deploy developer topology (Developer and Build VM)","nodes":[{"content":"Deploy developer topology (Developer and Build VM)","pos":[0,50]}]},{"content":"In the LCS portal, select the project that is connected to VSTS.","pos":[6315,6379]},{"pos":[6384,6454],"content":"In the <bpt id=\"p1\">**</bpt>Environments<ept id=\"p1\">**</ept> pane, click <bpt id=\"p2\">**</bpt><ph id=\"ph1\">+</ph><ept id=\"p2\">**</ept> to deploy a new environment.","source":"In the **Environments** pane, click **+** to deploy a new environment."},{"pos":[6460,6517],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>image011<ept id=\"p1\">](./media/image011.png)](./media/image011.png)</ept>","source":"[![image011](./media/image011.png)](./media/image011.png)"},{"pos":[6527,6589],"content":"In the <bpt id=\"p1\">**</bpt>Select environment topology<ept id=\"p1\">**</ept> pane, select <bpt id=\"p2\">**</bpt>Azure<ept id=\"p2\">**</ept>.","source":"In the **Select environment topology** pane, select **Azure**."},{"pos":[6595,6652],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>image012<ept id=\"p1\">](./media/image012.png)](./media/image012.png)</ept>","source":"[![image012](./media/image012.png)](./media/image012.png)"},{"content":"Proceed to deploy a DEV/TEST environment.","pos":[6662,6703]},{"content":"Depending on your LCS project type, some deployment steps described below may vary.","pos":[6712,6795]},{"pos":[6801,6941],"content":"On the <bpt id=\"p1\">**</bpt>Deploy environment<ept id=\"p1\">**</ept> pane, enter the environment name for the deployment, and select the number of instances for <bpt id=\"p2\">**</bpt>Developer<ept id=\"p2\">**</ept> VMs.","source":"On the **Deploy environment** pane, enter the environment name for the deployment, and select the number of instances for **Developer** VMs."},{"content":"<bpt id=\"p1\">**</bpt>Note:<ept id=\"p1\">**</ept> You can only deploy one Build VM and one Developer VM.","pos":[6946,7010],"source":"**Note:** You can only deploy one Build VM and one Developer VM."},{"content":"If you don’t want to deploy a Developer VM, then set instances count to zero.","pos":[7011,7088]},{"content":"If you want multiple Developer VMs then deploy new environment per developer VM.","pos":[7089,7169]},{"pos":[7175,7235],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>Deploy<ept id=\"p1\">](./media/deploy-1024x669.jpg)](./media/deploy.jpg)</ept>","source":"[![Deploy](./media/deploy-1024x669.jpg)](./media/deploy.jpg)"},{"pos":[7245,7312],"content":"Click <bpt id=\"p1\">**</bpt>Advanced settings<ept id=\"p1\">**</ept>, select <bpt id=\"p2\">**</bpt>Visual Studio Team Services<ept id=\"p2\">**</ept>","source":"Click **Advanced settings**, select **Visual Studio Team Services**"},{"content":"Build Agent Name: Friendly name for build agent on VSTS","pos":[7321,7376]},{"content":"Build Agent Pool: specify build agent pool name which should be used for build machine deployment.","pos":[7385,7483]},{"content":"Make sure VSTS contains at least one agent pool.","pos":[7484,7532]},{"content":"By default, there will be the default pool.","pos":[7533,7576]},{"content":"If you have deleted the default pool then build deployment will fail.","pos":[7577,7646]},{"content":"Branch Name: Specify your VSTS source code branch which will be default source code sync location for the build VM.","pos":[7655,7770]},{"content":"Default branch is \"Trunk<ph id=\"ph1\">\\\\</ph>Main\".","pos":[7771,7803],"source":" Default branch is \"Trunk\\\\Main\"."},{"pos":[7813,7879],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>Settings<ept id=\"p1\">](./media/settings-1024x389.jpg)](./media/settings.jpg)</ept>","source":"[![Settings](./media/settings-1024x389.jpg)](./media/settings.jpg)"},{"content":"After the settings are verified, click <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept> to start the deployment.","pos":[7885,7957],"source":"After the settings are verified, click **Next** to start the deployment."},{"content":"You can see progress of deployment under <bpt id=\"p1\">**</bpt>Environments<ept id=\"p1\">**</ept>.","pos":[7958,8016],"source":" You can see progress of deployment under **Environments**."},{"content":"After the deployment is complete, you can use Remote Desktop to view Developer and Build VM.","pos":[8021,8113]},{"pos":[8118,8148],"content":"Use a Developer VM environment","linkify":"Use a Developer VM environment","nodes":[{"content":"Use a Developer VM environment","pos":[0,30]}]},{"content":"When a Developer VM gets deployed, it’s auto-configured with a workspace that will be used to synchronize your code from source control (VSTS).","pos":[8149,8292]},{"content":"As this Developer VM has Dynamics 365 for Operations deployed on it, it can also be used as a test VM.","pos":[8293,8395]},{"pos":[8401,8443],"content":"Configure Visual Studio to connect to VSTS","linkify":"Configure Visual Studio to connect to VSTS","nodes":[{"content":"Configure Visual Studio to connect to VSTS","pos":[0,42]}]},{"content":"When you open Visual Studio the first time on a Developer VM, connect to VSTS using your credentials.","pos":[8445,8546]},{"pos":[8552,8610],"content":"Open <bpt id=\"p1\">**</bpt>Team explorer<ept id=\"p1\">**</ept> and click <bpt id=\"p2\">**</bpt>Select Team projects<ept id=\"p2\">**</ept>.","source":"Open **Team explorer** and click **Select Team projects**."},{"content":"Enter the VSTS URL and click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept>.","pos":[8615,8651],"source":"Enter the VSTS URL and click **OK**."},{"content":"You will be prompted for your VSTS username and password.","pos":[8652,8709]},{"pos":[8714,8816],"content":"After you are logged into the VSTS, your <bpt id=\"p1\">**</bpt>Default workspace<ept id=\"p1\">**</ept> that you will use for your development.","source":"After you are logged into the VSTS, your **Default workspace** that you will use for your development."},{"pos":[8822,8879],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>image023<ept id=\"p1\">](./media/image023.png)](./media/image023.png)</ept>","source":"[![image023](./media/image023.png)](./media/image023.png)"},{"pos":[8884,8915],"content":"Test integration with the build","linkify":"Test integration with the build","nodes":[{"content":"Test integration with the build","pos":[0,31]}]},{"content":"There are two ways to integrate test as part of build process for testing and validation:","pos":[8916,9005]},{"content":"SysTest framework based unit and component level tests.","pos":[9011,9066]},{"content":"Generate code from Task Recorder recording XML for automated test execution.","pos":[9071,9147]},{"pos":[9149,9311],"content":"The details of these two approaches are mentioned in the <bpt id=\"p1\">[</bpt>Testing and validation. <ept id=\"p1\">](testing-validation.md)</ept>Review this article for testing and validation strategy.","source":"The details of these two approaches are mentioned in the [Testing and validation. ](testing-validation.md)Review this article for testing and validation strategy."},{"pos":[9316,9344],"content":"Use the Build VM environment","linkify":"Use the Build VM environment","nodes":[{"content":"Use the Build VM environment","pos":[0,28]}]},{"content":"When a Build VM is deployed in Developer topology through LCS, it is pre-configured and ready to start a build.","pos":[9345,9456]},{"content":"You can change the default configuration at any time from the Visual Studio IDE or the VSTS interface.","pos":[9457,9559]},{"content":"On a Build VM, the module source code is synchronized to the build machine for easy build setup.","pos":[9560,9656]},{"content":"The build machine is also auto-configured with default settings for build agent, build controller, build process template, and build definition.","pos":[9657,9801]},{"content":"Tests that are integrated with build definition are executed after the build is successful.","pos":[9802,9893]},{"pos":[9899,9953],"content":"Review a pre-configured customizable build environment","linkify":"Review a pre-configured customizable build environment","nodes":[{"content":"Review a pre-configured customizable build environment","pos":[0,54]}]},{"content":"The build VM contains the vNext build agent which was released as part of TFS 2015.","pos":[9955,10038]},{"content":"When you deploy the Build VM, the build agent is configured by default to connect and sync with the VSTS project.","pos":[10039,10152]},{"content":"As a part of the Build VM configuration, the default build definition is also created and configured, as shown below.","pos":[10153,10270]},{"pos":[10273,10333],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>Build1<ept id=\"p1\">](./media/build1-1024x488.jpg)](./media/build1.jpg)</ept>","source":"[![Build1](./media/build1-1024x488.jpg)](./media/build1.jpg)"},{"content":"Default build definition contains multiple tasks to perform specific operation, as described below.","pos":[10336,10435]},{"content":"Configure the predefined variables parameters that will be passed to the build.","pos":[10441,10520]},{"content":"To set up a clean database for every build execution, provide the name of the database backup file for the <bpt id=\"p1\">**</bpt>DatabaseBackupToRestore<ept id=\"p1\">**</ept> variable.","pos":[10521,10665],"source":" To set up a clean database for every build execution, provide the name of the database backup file for the **DatabaseBackupToRestore** variable."},{"content":"The packages folder is restored at every build with a copy of a clean package folder.","pos":[10666,10751]},{"pos":[10757,10817],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>build2<ept id=\"p1\">](./media/build2-1024x678.jpg)](./media/build2.jpg)</ept>","source":"[![build2](./media/build2-1024x678.jpg)](./media/build2.jpg)"},{"content":"Build the solution to discover and build all modules under \"Trunk/Main\" branch as shown below.","pos":[10827,10921]},{"pos":[10927,10987],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>Build3<ept id=\"p1\">](./media/build3-1024x456.jpg)](./media/build3.jpg)</ept>","source":"[![Build3](./media/build3-1024x456.jpg)](./media/build3.jpg)"},{"content":"Use \"Deploy Report\" task to generate reports and deploy on build VM.","pos":[10997,11065]},{"content":"Use \"Database Sync\" task to synchronize the database to local SQL on build VM.","pos":[11070,11148]},{"content":"After the build is successful, create a deployable package that can be used to update sandbox/ staging environment.","pos":[11153,11268]},{"pos":[11274,11334],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>Build4<ept id=\"p1\">](./media/build4-1024x462.jpg)](./media/build4.jpg)</ept>","source":"[![Build4](./media/build4-1024x462.jpg)](./media/build4.jpg)"},{"content":"\"Copy and publish build artifacts\" uploads the deployable package to VSTS artifacts location.","pos":[11344,11437]},{"pos":[11443,11503],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>build5<ept id=\"p1\">](./media/build5-1024x439.jpg)](./media/build5.jpg)</ept>","source":"[![build5](./media/build5-1024x439.jpg)](./media/build5.jpg)"},{"content":"For test execution, there are three default tasks \"Test Setup\", \"Execute Test\" and \"Test End\".","pos":[11513,11607]},{"pos":[11613,11673],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>build7<ept id=\"p1\">](./media/build7-1024x457.jpg)](./media/build7.jpg)</ept>","source":"[![build7](./media/build7-1024x457.jpg)](./media/build7.jpg)"},{"content":"The default build is scheduled to trigger start every day at 5 P.M.","pos":[11683,11750]},{"content":"You can change trigger as per your team's need to \"Continuous\" for each check-in.","pos":[11751,11832]},{"pos":[11838,11898],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>build8<ept id=\"p1\">](./media/build8-1024x491.jpg)](./media/build8.jpg)</ept>","source":"[![build8](./media/build8-1024x491.jpg)](./media/build8.jpg)"},{"content":"You can make changes to the default configuration, and the build VM will be ready to trigger a build.","pos":[11900,12001]},{"pos":[12006,12067],"content":"Start a build and verify the build and test execution results","linkify":"Start a build and verify the build and test execution results","nodes":[{"content":"Start a build and verify the build and test execution results","pos":[0,61]}]},{"content":"After you review the default build configuration, you can manually trigger a build from Visual Studio IDE or VSTS web interface.","pos":[12068,12196]},{"content":"Open your browser and connect to the VSTS URL.","pos":[12202,12248]},{"content":"Login using your credentials.","pos":[12253,12282]},{"pos":[12287,12363],"content":"On the home page, under <bpt id=\"p1\">**</bpt>Recent projects and solutions<ept id=\"p1\">**</ept>, select a project.","source":"On the home page, under **Recent projects and solutions**, select a project."},{"pos":[12368,12409],"content":"From top links options, select <bpt id=\"p1\">**</bpt>BUILD<ept id=\"p1\">**</ept>.","source":"From top links options, select **BUILD**."},{"content":"On the left panel, select the default build definition instance.","pos":[12414,12478]},{"pos":[12483,12626],"content":"Right-click and select <bpt id=\"p1\">**</bpt>Queue Build<ept id=\"p1\">**</ept> to trigger a build for your module and test module that is already checked into the VSTS source control.","source":"Right-click and select **Queue Build** to trigger a build for your module and test module that is already checked into the VSTS source control."},{"pos":[12628,12685],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>image045<ept id=\"p1\">](./media/image045.png)](./media/image045.png)</ept>","source":"[![image045](./media/image045.png)](./media/image045.png)"},{"content":"Success or failure for the build will display, as shown by the following examples.","pos":[12688,12770]},{"content":"View all builds.","pos":[12771,12787]},{"pos":[12790,12850],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>build9<ept id=\"p1\">](./media/build9-1024x443.jpg)](./media/build9.jpg)</ept>","source":"[![build9](./media/build9-1024x443.jpg)](./media/build9.jpg)"},{"content":"Select specific completed build and view success/ failure details.","pos":[12853,12919]},{"pos":[12922,13041],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>build10<ept id=\"p1\">](./media/build10-1024x446.jpg)](./media/build10.jpg)</ept> Click on Test link to visualize test execution failure.","source":"[![build10](./media/build10-1024x446.jpg)](./media/build10.jpg) Click on Test link to visualize test execution failure."},{"pos":[13044,13107],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>build11<ept id=\"p1\">](./media/build11-1024x455.jpg)](./media/build11.jpg)</ept>","source":"[![build11](./media/build11-1024x455.jpg)](./media/build11.jpg)"}],"content":"---\n# required metadata\n\ntitle: Deployment with continuous build and test automation\ndescription: This wiki describes how to deploy a developer topology that supports continuous build and test automation.\nauthor: RobinARH\nmanager: AnnBe\nms.date: 2016-04-12 18 - 43 - 07\nms.topic: article\nms.prod: \nms.service: Dynamics365Operations\nms.technology: \n\n# optional metadata\n\n# ms.search.form: \n# ROBOTS: \naudience: Developer\n# ms.devlang: \n# ms.reviewer: robinr\nms.search.scope: AX 7.0.0, Operations\n# ms.tgt_pltfrm: \nms.custom: 13171\nms.assetid: 300b7ebe-c320-4a2f-89a9-33635c7108d2\nms.search.region: Global\n# ms.search.industry: \nms.author: shailesn\nms.search.validFrom: 2016-02-28\nms.dyn365.ops.version: AX 7.0.0\n\n---\n\n# Deployment with continuous build and test automation\n\nThis wiki describes how to deploy a developer topology that supports continuous build and test automation.\n\nPrerequisite: This requires a Visual Studio Team Services (VSTS) account for cloud VM deployment.\n\n## Workflow\nAfter you have configured a VSTS subscription in Lifecycle Services (LCS), you can trigger Developer Topology Deployment to set up Developer and Build VMs. In this deployment, the Developer VM is configured with workspace mapping to develop against a VSTS project. The Build VM is auto-configured with the build agent/controller to build modules  VSTS project and to execute automated tests with external endpoint for validation. For more information on writing custom test code or generating automated test code to integrate with build infrastructure, see [Testing and validations](testing-validation.md). A typical workflow or usage scenario is shown below. \n\n[![build12](./media/build12-1024x693.jpg)](./media/build12.jpg)\n\n## Set up Visual Studio Team Services (VSTS)\nCompare VSTS features required for your organization: <https://www.visualstudio.com/products/visual-studio-team-services-feature-matrix-vs>\n\n-   **TFVC vs GIT**: For RTW, we only support TFVC as source control repository that can be configured in VSTS project connected to LCS. Git is not supported.\n-   **Suspend current builds:** If you are deploying the build agent on an existing VSTS project which already has build definition created, please ensure you do not have any active triggers to queue the build. Additionally, make sure there are no builds scheduled / queued against the build pool. \n    \n    [![BuildTriggers](./media/buildtriggers.jpg)](./media/buildtriggers.jpg)\n    \n-   **Free VSTS account provides only one build agent**. Using free VSTS account and deploying new build VM with another build agent will fail as your account is not provisioned for more than one build agent.\n\nTo use more than one build agents, setup your VSTS account with Azure billing: <https://www.visualstudio.com/get-started/setup/set-up-billing-for-your-account-vs> \n\n[![VSTS1](./media/vsts1-300x155.jpg)](./media/vsts1.jpg)\n\n-   After your account is linked with the Azure subscription. Follow the instructions in the Azure management portal to provision more build agents - <https://www.visualstudio.com/en-us/get-started/setup/get-more-build-or-load-testing-vs>\n\n[![VSTS2](./media/vsts2-300x151.jpg)](./media/vsts2.jpg) \n\nNote: make sure you increase “Private Agents” under PAID option. \n\n[![VSTS3](./media/vsts3-300x191.jpg)](./media/vsts3.jpg)\n\n-   **Build Agent Pool role and permissions:** <https://msdn.microsoft.com/library/vs/alm/build/agents/admin#agent-pools>\n\nOnce build agents are added, add user (who will be deploying build VM from LCS) to “Agent Pool Administrators” role. \n\n[![VSTS4](./media/vsts4.jpg)](./media/vsts4.jpg)\n\n-   **Manage agent:** If you have multiple agents configured and want to delete one, select the agent and use the delete button to the right of the status column.\n\n    [![build14](./media/build14.jpg)](./media/build14.jpg)\n\n-   **Deleting Default Pool:** If for some reason you have deleted the default pool, please do not create a new pool with the name \"Default\". Instead create a new pool with the different name and pass the pool name from the \"Advanced Settings\" customization from LCS during deployment.\n-   **Personal access token:** This token is used for all Lifecycle Services (LCS) background actions, including upgrade and deployment. When a user initiates actions from LCS, LCS expects that users will be added to VSTS. The user must authorize LCS access to VSTS on behalf of the user. Until the projects users authorize with VSTS, you will see the below message in action center: \n\n[![VSTS setup in LCS\\_May27](./media/vsts-setup-in-lcs_may27-300x216.jpg)](./media/vsts-setup-in-lcs_may27.jpg)\n\n## Deploy Developer topology from LCS\nLCS provides an option to deploy a Development topology environment. With this option, you can deploy developer and build VMs in the cloud that are connected to your Visual Studio Team System  (VSTS) project.\n\n### VSTS credential setup and linking to LCS project\n\n1.  Login to the LCS portal to connect to VSTS and your LCS project at [https://lcs.dynamics.com/](https://lcs.dynamics.com/en/).\n2.  Select a project that you are working on.\n3.  Click the **Project Settings** tile.\n4.  Select **Visual Studio Team Services** and enter the VSTS URL where the source code for your module project is located.\n5.  Specify the VSTS link, authorize, and then click **Choose default project**.\n6.  **Note:** We currently support VSTF as source control and do not support Git. \n\n    [![VSTS](./media/vsts-1024x792.jpg)](./media/vsts.jpg)\n\n### Check-in migrated or new module code into VSTS\n\nAs part of code Migration process or development activities, we expect you to check-in your model source files and the associated test model source files into VSTS. If you have migrated your code using the LCS migration service, this is automatically done for you. If you have not checked in any code into VSTS and work on direct check-in, you must follow certain guidelines for the VSTS folder structure. This will help with setting up correct build definition. All modules should be added to root folder **Metadata**. Under each module, there should be two folders. One folder contains all models. The other folder should contain descriptor XML for that module. \n\n[![image009](./media/image009.png)](./media/image009.png)  \n\n### Deploy developer topology (Developer and Build VM)\n\n1.  In the LCS portal, select the project that is connected to VSTS.\n2.  In the **Environments** pane, click **+** to deploy a new environment.\n\n    [![image011](./media/image011.png)](./media/image011.png)\n    \n3.  In the **Select environment topology** pane, select **Azure**.\n\n    [![image012](./media/image012.png)](./media/image012.png)\n    \n4.  Proceed to deploy a DEV/TEST environment.\n    -   Depending on your LCS project type, some deployment steps described below may vary.\n\n5.  On the **Deploy environment** pane, enter the environment name for the deployment, and select the number of instances for **Developer** VMs.\n6.  **Note:** You can only deploy one Build VM and one Developer VM. If you don’t want to deploy a Developer VM, then set instances count to zero. If you want multiple Developer VMs then deploy new environment per developer VM.\n\n    [![Deploy](./media/deploy-1024x669.jpg)](./media/deploy.jpg)\n    \n7.  Click **Advanced settings**, select **Visual Studio Team Services**\n    1.  Build Agent Name: Friendly name for build agent on VSTS\n    2.  Build Agent Pool: specify build agent pool name which should be used for build machine deployment. Make sure VSTS contains at least one agent pool. By default, there will be the default pool. If you have deleted the default pool then build deployment will fail.\n    3.  Branch Name: Specify your VSTS source code branch which will be default source code sync location for the build VM. Default branch is \"Trunk\\\\Main\".\n    \n    [![Settings](./media/settings-1024x389.jpg)](./media/settings.jpg)\n\n8.  After the settings are verified, click **Next** to start the deployment. You can see progress of deployment under **Environments**.\n9.  After the deployment is complete, you can use Remote Desktop to view Developer and Build VM.\n\n## Use a Developer VM environment\nWhen a Developer VM gets deployed, it’s auto-configured with a workspace that will be used to synchronize your code from source control (VSTS). As this Developer VM has Dynamics 365 for Operations deployed on it, it can also be used as a test VM.\n\n### Configure Visual Studio to connect to VSTS\n\nWhen you open Visual Studio the first time on a Developer VM, connect to VSTS using your credentials.\n\n1.  Open **Team explorer** and click **Select Team projects**.\n2.  Enter the VSTS URL and click **OK**. You will be prompted for your VSTS username and password.\n3.  After you are logged into the VSTS, your **Default workspace** that you will use for your development.\n\n    [![image023](./media/image023.png)](./media/image023.png)\n\n## Test integration with the build\nThere are two ways to integrate test as part of build process for testing and validation:\n\n-   SysTest framework based unit and component level tests.\n-   Generate code from Task Recorder recording XML for automated test execution.\n\nThe details of these two approaches are mentioned in the [Testing and validation. ](testing-validation.md)Review this article for testing and validation strategy.\n\n## Use the Build VM environment\nWhen a Build VM is deployed in Developer topology through LCS, it is pre-configured and ready to start a build. You can change the default configuration at any time from the Visual Studio IDE or the VSTS interface. On a Build VM, the module source code is synchronized to the build machine for easy build setup. The build machine is also auto-configured with default settings for build agent, build controller, build process template, and build definition. Tests that are integrated with build definition are executed after the build is successful.\n\n### Review a pre-configured customizable build environment\n\nThe build VM contains the vNext build agent which was released as part of TFS 2015. When you deploy the Build VM, the build agent is configured by default to connect and sync with the VSTS project. As a part of the Build VM configuration, the default build definition is also created and configured, as shown below. \n\n[![Build1](./media/build1-1024x488.jpg)](./media/build1.jpg) \n\nDefault build definition contains multiple tasks to perform specific operation, as described below.\n\n1.  Configure the predefined variables parameters that will be passed to the build. To set up a clean database for every build execution, provide the name of the database backup file for the **DatabaseBackupToRestore** variable. The packages folder is restored at every build with a copy of a clean package folder.\n\n    [![build2](./media/build2-1024x678.jpg)](./media/build2.jpg)\n    \n2.  Build the solution to discover and build all modules under \"Trunk/Main\" branch as shown below.\n\n    [![Build3](./media/build3-1024x456.jpg)](./media/build3.jpg)\n    \n3.  Use \"Deploy Report\" task to generate reports and deploy on build VM.\n4.  Use \"Database Sync\" task to synchronize the database to local SQL on build VM.\n5.  After the build is successful, create a deployable package that can be used to update sandbox/ staging environment.\n\n    [![Build4](./media/build4-1024x462.jpg)](./media/build4.jpg)\n    \n6.  \"Copy and publish build artifacts\" uploads the deployable package to VSTS artifacts location.\n\n    [![build5](./media/build5-1024x439.jpg)](./media/build5.jpg)\n    \n7.  For test execution, there are three default tasks \"Test Setup\", \"Execute Test\" and \"Test End\".\n\n    [![build7](./media/build7-1024x457.jpg)](./media/build7.jpg)\n    \n8.  The default build is scheduled to trigger start every day at 5 P.M. You can change trigger as per your team's need to \"Continuous\" for each check-in.\n\n    [![build8](./media/build8-1024x491.jpg)](./media/build8.jpg)\n\nYou can make changes to the default configuration, and the build VM will be ready to trigger a build.\n\n## Start a build and verify the build and test execution results\nAfter you review the default build configuration, you can manually trigger a build from Visual Studio IDE or VSTS web interface.\n\n1.  Open your browser and connect to the VSTS URL.\n2.  Login using your credentials.\n3.  On the home page, under **Recent projects and solutions**, select a project.\n4.  From top links options, select **BUILD**.\n5.  On the left panel, select the default build definition instance.\n6.  Right-click and select **Queue Build** to trigger a build for your module and test module that is already checked into the VSTS source control.\n\n[![image045](./media/image045.png)](./media/image045.png) \n\nSuccess or failure for the build will display, as shown by the following examples. View all builds. \n\n[![build9](./media/build9-1024x443.jpg)](./media/build9.jpg) \n\nSelect specific completed build and view success/ failure details. \n\n[![build10](./media/build10-1024x446.jpg)](./media/build10.jpg) Click on Test link to visualize test execution failure. \n\n[![build11](./media/build11-1024x455.jpg)](./media/build11.jpg)\n\n"}