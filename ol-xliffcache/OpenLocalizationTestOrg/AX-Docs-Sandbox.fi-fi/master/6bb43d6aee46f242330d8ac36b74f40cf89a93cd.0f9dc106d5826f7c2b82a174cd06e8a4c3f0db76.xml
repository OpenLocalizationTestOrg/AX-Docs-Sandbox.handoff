{"nodes":[{"pos":[32,77],"content":"Configure Power BI integration for workspaces","needQuote":true,"needEscape":true,"nodes":[{"content":"Configure Power BI integration for workspaces","pos":[0,45]}]},{"pos":[91,367],"content":"This tutorial describes the configuration that is required for a new Microsoft Dynamics 365 for Operations environment to support integration with PowerBI.com. This configuration enables workspaces to show the Power BI control and lets users pin visualizations to a workspace.","needQuote":true,"needEscape":true,"nodes":[{"content":"This tutorial describes the configuration that is required for a new Microsoft Dynamics 365 for Operations environment to support integration with PowerBI.com. This configuration enables workspaces to show the Power BI control and lets users pin visualizations to a workspace.","pos":[0,276],"nodes":[{"content":"This tutorial describes the configuration that is required for a new Microsoft Dynamics 365 for Operations environment to support integration with PowerBI.com.","pos":[0,159]},{"content":"This configuration enables workspaces to show the Power BI control and lets users pin visualizations to a workspace.","pos":[160,276]}]}]},{"pos":[899,944],"content":"Configure Power BI integration for workspaces","linkify":"Configure Power BI integration for workspaces","nodes":[{"content":"Configure Power BI integration for workspaces","pos":[0,45]}]},{"content":"This tutorial describes the configuration that is required for a new Microsoft Dynamics 365 for Operations environment to support integration with PowerBI.com.","pos":[946,1105]},{"content":"This configuration enables workspaces to show the Power BI control and lets users pin visualizations to a workspace.","pos":[1106,1222]},{"content":"Microsoft Dynamics 365 for Operations supports Power BI visualizations that are pinned directly to workspaces.","pos":[1224,1334]},{"content":"This functionality requires a one-time configuration for each tenant to help guarantee that Dynamics 365 for Operations and Power BI can communicate and authenticate correctly.","pos":[1335,1511]},{"pos":[1514,1621],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>PowerBI control in Reservation Management Workspace<ept id=\"p1\">](./media/fleetws-1024x578.png)](./media/fleetws.png)</ept>","source":"[![PowerBI control in Reservation Management Workspace](./media/fleetws-1024x578.png)](./media/fleetws.png)"},{"content":"Both Dynamics 365 for Operations and PowerBI.com are cloud-based services.","pos":[1624,1698]},{"content":"In order for a Dynamics 365 for Operations workspace to display a Power BI tile, the Dynamics 365 for Operations server must contact the Power BI service on behalf of a user and must have a visualization drawn in the Dynamics 365 for Operations workspace.","pos":[1699,1954]},{"content":"This flow between Dynamics 365 for Operations and the Power BI service is based on the OAuth 2.0 Authorization Code Grant Flow.","pos":[1955,2082]},{"pos":[2087,2126],"content":"The OAuth Authorization Code Grant Flow","linkify":"The OAuth Authorization Code Grant Flow","nodes":[{"content":"The OAuth Authorization Code Grant Flow","pos":[0,39]}]},{"content":"This section describes the authorization flow between Dynamics 365 for Operations and the PowerBI.com service during authentication and when visualizations are presented to a user.","pos":[2127,2307]},{"content":"The following diagram shows the authorization flow and is based on the assumption that you've completed the configuration that this article describes.","pos":[2308,2458]},{"pos":[2461,2521],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>OAuthFlow<ept id=\"p1\">](./media/oauthflow.png)](./media/oauthflow.png)</ept>","source":"[![OAuthFlow](./media/oauthflow.png)](./media/oauthflow.png)"},{"content":"When a user visits a workspace in Dynamics 365 for Operations for the first time, the Power BI banner prompts the user to start the first-time connection.","pos":[2527,2681]},{"content":"If the user agrees to start the first-time connection, an OAuth 2.0 Authorization Code Grant Flow is started.","pos":[2682,2791]},{"content":"Dynamics 365 for Operations redirects the user agent to the Microsoft Azure Active Directory (AAD) authorization endpoint.","pos":[2796,2918]},{"content":"The user is authenticated and consents, if consent is required.","pos":[2919,2982]},{"content":"Because the user is running Dynamics 365 for Operations, he or she is already signed in to AAD.","pos":[2983,3078]},{"content":"Therefore, the user doesn't have to enter his or her credentials again.","pos":[3079,3150]},{"content":"The AAD authorization endpoint redirects the AAD agent back to the client application together with an authorization code.","pos":[3155,3277]},{"content":"The user agent returns the authorization code to the client applicationâ€™s redirect URL.","pos":[3278,3365]},{"content":"The application redirect URL is a parameter that is maintained in your Power BI configuration, as described later in this article.","pos":[3366,3496]},{"content":"Now that Dynamics 365 for Operations has an authorization code on behalf of the user, it requests an access token from the AAD token issuance endpoint.","pos":[3501,3652]},{"content":"Dynamics 365 for Operations presents the authorization code to prove that the user has consented.","pos":[3653,3750]},{"content":"The AAD token issuance endpoint returns an access token and a refresh token.","pos":[3755,3831]},{"content":"Dynamics 365 for Operations must have the access tokento request a visualization from Power BI.","pos":[3832,3927]},{"content":"Access tokens expire after a short time.","pos":[3928,3968]},{"content":"The refresh token can be used to request a new token.","pos":[3969,4022]},{"content":"Dynamics 365 for Operations uses the access token to authenticate to the Web API that is provided by Power BI.","pos":[4027,4137]},{"content":"Dynamics 365 for Operations uses the Web API to request that Power BI visualizations be displayed on behalf of the user.","pos":[4138,4258]},{"content":"After the client application is authenticated, the Power BI Web API returns the requested visualization to the user.","pos":[4263,4379]},{"content":"Note that Power BI returns only the data that the user is allowed to see.","pos":[4380,4453]},{"content":"Because the Power BI Web API detects that the user is connecting via Dynamics 365 for Operations, it can correctly resolve the user.","pos":[4454,4586]},{"content":"The user sees Power BI visualizations in the Dynamics 365 for Operations workspace.","pos":[4591,4674]},{"content":"For subsequent visits, this entire flow doesn't have to occur.","pos":[4676,4738]},{"content":"Because Dynamics 365 for Operations has the access token on behalf of the user, steps 1 through 4 don't have to be repeated.","pos":[4739,4863]},{"pos":[4868,4881],"content":"Prerequisites","linkify":"Prerequisites","nodes":[{"content":"Prerequisites","pos":[0,13]}]},{"content":"At least one AAD account in your tenant must be registered with PowerBI.com.","pos":[4886,4962]},{"pos":[4971,5098],"content":"Follow the instructions at <bpt id=\"p1\">&lt;</bpt>https://powerbi.microsoft.com/en-us/documentation/powerbi-developer-sign-up-for-power-bi-service/<ept id=\"p1\">&gt;</ept>.","source":"Follow the instructions at <https://powerbi.microsoft.com/en-us/documentation/powerbi-developer-sign-up-for-power-bi-service/>."},{"pos":[5107,5183],"content":"After you've created your AAD account, sign in to <bpt id=\"p1\">&lt;</bpt>https://app.powerbi.com<ept id=\"p1\">&gt;</ept>.","source":"After you've created your AAD account, sign in to <https://app.powerbi.com>."},{"content":"At least one user must sign in to PowerBI.com before the configuration can be completed.","pos":[5192,5280]},{"content":"You must have AAD administrator privileges.","pos":[5285,5328]},{"content":"You must be assigned to the System Administrator role in Dynamics 365 for Operations.","pos":[5333,5418]},{"content":"You must be using the same tenant for both your deployment and the user logon.","pos":[5423,5501]},{"content":"For example, if the environment was deployed under the contosoax7.onmicrosoft.com tenant, the user logon for both Dynamics 365 for Operations and Power BI should be in the format <ph id=\"ph1\">myname@contosoax7.onmicrosoft.com</ph>.","pos":[5502,5715],"source":" For example, if the environment was deployed under the contosoax7.onmicrosoft.com tenant, the user logon for both Dynamics 365 for Operations and Power BI should be in the format myname@contosoax7.onmicrosoft.com."},{"pos":[5720,5805],"content":"Register your Dynamics 365 for Operations deployment as a web app in the Azure portal","linkify":"Register your Dynamics 365 for Operations deployment as a web app in the Azure portal","nodes":[{"content":"Register your Dynamics 365 for Operations deployment as a web app in the Azure portal","pos":[0,85]}]},{"content":"The Power BI application programming interface (API) is available for consumption by any client or web application that is registered with AAD.","pos":[5806,5949]},{"content":"Therefore, the first step is to register your Dynamics 365 for Operations deployment as a web app.","pos":[5950,6048]},{"content":"To complete this step, you must have access to an AAD account that has administrator privileges for the tenant that Dynamics 365 for Operations was deployed for.","pos":[6049,6210]},{"content":"For instructions about how to register your web app, see <bpt id=\"p1\">&lt;</bpt>https://powerbi.microsoft.com/en-us/documentation/powerbi-developer-register-a-web-app/<ept id=\"p1\">&gt;</ept>.","pos":[6211,6358],"source":" For instructions about how to register your web app, see <https://powerbi.microsoft.com/en-us/documentation/powerbi-developer-register-a-web-app/>."},{"content":"<bpt id=\"p1\">**</bpt>Important:<ept id=\"p1\">**</ept> Observe the following guidelines when you register your web app:","pos":[6359,6438],"source":"**Important:** Observe the following guidelines when you register your web app:"},{"content":"Use the following values when you create your web app:","pos":[6444,6498]},{"content":"<bpt id=\"p1\">**</bpt>Sign-in URL:<ept id=\"p1\">**</ept> This URL is the same as your deployment URL, but <bpt id=\"p2\">**</bpt>oauth<ept id=\"p2\">**</ept> is added to the end.","pos":[6507,6603],"source":"**Sign-in URL:** This URL is the same as your deployment URL, but **oauth** is added to the end."},{"content":"<bpt id=\"p1\">**</bpt>Example:<ept id=\"p1\">**</ept> http://contosoax7.cloud.dynamics.com/oauth","pos":[6604,6659],"source":"**Example:** http://contosoax7.cloud.dynamics.com/oauth"},{"content":"<bpt id=\"p1\">**</bpt>App ID URI:<ept id=\"p1\">**</ept> This value is mandatory, but isn't required for the workspace integration.","pos":[6668,6758],"source":"**App ID URI:** This value is mandatory, but isn't required for the workspace integration."},{"content":"Make sure that this App ID URI is a mock URI like https://contosoAX, since using the URL of your deployment can cause sign-in issues in other AAD applications such as the Excel Add-in.","pos":[6759,6943]},{"content":"<bpt id=\"p1\">**</bpt>Example:<ept id=\"p1\">**</ept> http://contosoax7testenv/","pos":[6944,6982],"source":"**Example:** http://contosoax7testenv/"},{"content":"<bpt id=\"p1\">**</bpt>Reply URL:<ept id=\"p1\">**</ept> This URL is the same as your deployment URL, but <bpt id=\"p2\">**</bpt>oauth<ept id=\"p2\">**</ept> is added to the end.","pos":[6991,7085],"source":"**Reply URL:** This URL is the same as your deployment URL, but **oauth** is added to the end."},{"content":"<bpt id=\"p1\">**</bpt>Example:<ept id=\"p1\">**</ept> http://contosoax7.cloud.dynamics.com/oauth","pos":[7086,7141],"source":"**Example:** http://contosoax7.cloud.dynamics.com/oauth"},{"content":"If you have multiple deployments, you can use the same web app and add additional deployments.","pos":[7146,7240]},{"content":"Add the URL of each deployment to the <bpt id=\"p1\">**</bpt>Reply<ept id=\"p1\">**</ept> <bpt id=\"p2\">**</bpt>URL<ept id=\"p2\">**</ept> list on the <bpt id=\"p3\">**</bpt>Configuration<ept id=\"p3\">**</ept> tab for your web app.","pos":[7241,7348],"source":" Add the URL of each deployment to the **Reply** **URL** list on the **Configuration** tab for your web app."},{"pos":[7353,7503],"content":"If you use the deployment URL as the <bpt id=\"p1\">**</bpt>App ID URL<ept id=\"p1\">**</ept> value, you will cause an error when authentication through Microsoft Power Query for Excel occurs.","source":"If you use the deployment URL as the **App ID URL** value, you will cause an error when authentication through Microsoft Power Query for Excel occurs."},{"content":"Write down the <bpt id=\"p1\">**</bpt>Client ID<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>Secret Key<ept id=\"p2\">**</ept> values as they appear in the Azure portal, and keep this information in a safe place.","pos":[7508,7641],"source":"Write down the **Client ID** and **Secret Key** values as they appear in the Azure portal, and keep this information in a safe place."},{"content":"You will have to enter these values on the Dynamics 365 for Operations <bpt id=\"p1\">**</bpt>Power BI configuration<ept id=\"p1\">**</ept> page later.","pos":[7642,7751],"source":" You will have to enter these values on the Dynamics 365 for Operations **Power BI configuration** page later."},{"content":"When you try to give permission to the Power BI service, if you don't see <bpt id=\"p1\">**</bpt>Power BI Service<ept id=\"p1\">**</ept> in the <bpt id=\"p2\">**</bpt>Permissions to other applications<ept id=\"p2\">**</ept> list, you must sign up for the Power BI service by using the account of a member of your tenant.","pos":[7756,7992],"source":"When you try to give permission to the Power BI service, if you don't see **Power BI Service** in the **Permissions to other applications** list, you must sign up for the Power BI service by using the account of a member of your tenant."},{"content":"To sign up for the Power BI service, you must have at least one organizational user in your AAD tenant.","pos":[7993,8096]},{"content":"For information about how to create new AAD users, see <bpt id=\"p1\">[</bpt>Create or edit users in Azure AD<ept id=\"p1\">](https://msdn.microsoft.com/en-us/library/azure/hh967632.aspx)</ept>.","pos":[8097,8249],"source":" For information about how to create new AAD users, see [Create or edit users in Azure AD](https://msdn.microsoft.com/en-us/library/azure/hh967632.aspx)."},{"content":"If you must create a new AAD user for this purpose, go to <bpt id=\"p1\">[</bpt>https://powerbi.microsoft.com,<ept id=\"p1\">](https://powerbi.microsoft.com)</ept> and sign up for a Power BI account.","pos":[8250,8407],"source":" If you must create a new AAD user for this purpose, go to [https://powerbi.microsoft.com,](https://powerbi.microsoft.com) and sign up for a Power BI account."},{"content":"After your tenant has at least one account that is registered with Power BI, the Power BI service will appear as one of the options for permissions to your Dynamics 365 for Operations web application.","pos":[8408,8608]},{"pos":[8613,8663],"content":"Configure the environment for Power BI integration","linkify":"Configure the environment for Power BI integration","nodes":[{"content":"Configure the environment for Power BI integration","pos":[0,50]}]},{"content":"The following procedure must be completed by a Dynamics 365 for Operations system administrator.","pos":[8664,8760]},{"content":"By default, the Power BI configuration is disabled.","pos":[8761,8812]},{"content":"Sign in to Dynamics 365 for Operations by using an account that has the System Administrator role.","pos":[8818,8916]},{"pos":[8921,9030],"content":"Click <bpt id=\"p1\">**</bpt>System administration<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Setup<ept id=\"p2\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>Power BI<ept id=\"p3\">**</ept> to open the <bpt id=\"p4\">**</bpt>Power BI configuration<ept id=\"p4\">**</ept> page.","source":"Click **System administration** &gt; **Setup** &gt; **Power BI** to open the **Power BI configuration** page."},{"pos":[9036,9172],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>PowerBI Configuration Form<ept id=\"p1\">](./media/powerbiconfig2-903x1024.png)](./media/powerbiconfig2.png)</ept> Power BI configuration page<ph id=\"ph2\">\\[</ph>/caption<ph id=\"ph3\">\\]</ph>","source":"[![PowerBI Configuration Form](./media/powerbiconfig2-903x1024.png)](./media/powerbiconfig2.png) Power BI configuration page\\[/caption\\]"},{"pos":[9178,9220],"content":"Click the <bpt id=\"p1\">**</bpt>Edit<ept id=\"p1\">**</ept> button to make changes.","source":"Click the **Edit** button to make changes."},{"content":"Specify the following values for the fields on this page:","pos":[9225,9282]},{"pos":[9291,9330],"content":"<bpt id=\"p1\">**</bpt>Enabled:<ept id=\"p1\">**</ept> Set the option to <bpt id=\"p2\">**</bpt>Yes<ept id=\"p2\">**</ept>.","source":"**Enabled:** Set the option to **Yes**."},{"pos":[9339,9466],"content":"<bpt id=\"p1\">**</bpt>Azure AD authority URI:<ept id=\"p1\">**</ept> The correct value, <bpt id=\"p2\">**</bpt>https://login.windows.net<ept id=\"p2\">**</ept>, should already be entered when you open the page.","source":"**Azure AD authority URI:** The correct value, **https://login.windows.net**, should already be entered when you open the page."},{"pos":[9475,9602],"content":"<bpt id=\"p1\">**</bpt>Azure AD Power BI resource URI:<ept id=\"p1\">**</ept> The correct value, <bpt id=\"p2\">**</bpt>https://analysis.windows.net/powerbi/api<ept id=\"p2\">**</ept>, should already be entered.","source":"**Azure AD Power BI resource URI:** The correct value, **https://analysis.windows.net/powerbi/api**, should already be entered."},{"pos":[9611,9709],"content":"<bpt id=\"p1\">**</bpt>Azure AD Tenant:<ept id=\"p1\">**</ept> The correct value, <bpt id=\"p2\">**</bpt>contosoax7.onmicrosoft.com<ept id=\"p2\">**</ept>, should already be entered.","source":"**Azure AD Tenant:** The correct value, **contosoax7.onmicrosoft.com**, should already be entered."},{"pos":[9718,9789],"content":"<bpt id=\"p1\">**</bpt>Client ID:<ept id=\"p1\">**</ept> Enter the <bpt id=\"p2\">**</bpt>Client ID<ept id=\"p2\">**</ept> value that you recorded earlier.","source":"**Client ID:** Enter the **Client ID** value that you recorded earlier."},{"pos":[9798,9876],"content":"<bpt id=\"p1\">**</bpt>Application key:<ept id=\"p1\">**</ept> Enter the <bpt id=\"p2\">**</bpt>Secret Key<ept id=\"p2\">**</ept> value that you recorded earlier.","source":"**Application key:** Enter the **Secret Key** value that you recorded earlier."},{"pos":[9885,9996],"content":"<bpt id=\"p1\">**</bpt>Redirect URL:<ept id=\"p1\">**</ept> The correct value, the root URL of your deployment plus <bpt id=\"p2\">**</bpt>oauth<ept id=\"p2\">**</ept>, should already be entered.","source":"**Redirect URL:** The correct value, the root URL of your deployment plus **oauth**, should already be entered."},{"pos":[10005,10116],"content":"<bpt id=\"p1\">**</bpt>Power BI API Address:<ept id=\"p1\">**</ept> The correct value, <bpt id=\"p2\">**</bpt>https://api.powerbi.com/beta/myorg<ept id=\"p2\">**</ept>, should already be entered.","source":"**Power BI API Address:** The correct value, **https://api.powerbi.com/beta/myorg**, should already be entered."},{"pos":[10125,10198],"content":"<bpt id=\"p1\">**</bpt>Apply tile filter:<ept id=\"p1\">**</ept> The correct value, <bpt id=\"p2\">**</bpt>Yes<ept id=\"p2\">**</ept>, should already be set.","source":"**Apply tile filter:** The correct value, **Yes**, should already be set."},{"pos":[10207,10289],"content":"<bpt id=\"p1\">**</bpt>Tile filter table:<ept id=\"p1\">**</ept> The correct value, <bpt id=\"p2\">**</bpt>Entities<ept id=\"p2\">**</ept>, should already be entered.","source":"**Tile filter table:** The correct value, **Entities**, should already be entered."},{"pos":[10298,10375],"content":"<bpt id=\"p1\">**</bpt>Tile filter column:<ept id=\"p1\">**</ept> The correct value, <bpt id=\"p2\">**</bpt>ID<ept id=\"p2\">**</ept>, should already be entered.","source":"**Tile filter column:** The correct value, **ID**, should already be entered."},{"pos":[10381,10417],"content":"Click <bpt id=\"p1\">**</bpt>Save<ept id=\"p1\">**</ept> to save your changes.","source":"Click **Save** to save your changes."},{"pos":[10422,10477],"content":"Connect to Power BI from Dynamics AX for the first time","linkify":"Connect to Power BI from Dynamics AX for the first time","nodes":[{"content":"Connect to Power BI from Dynamics AX for the first time","pos":[0,55]}]},{"content":"Users will now see the Power BI control in specific workspaces.","pos":[10478,10541]},{"content":"(The control must be added as part of the development process.","pos":[10542,10604]},{"content":"By default, the control isn't added to all workspaces.) The first time that users use the control, they must confirm that they authorize access to their Power BI visualizations.","pos":[10605,10782]},{"content":"To test your configuration, you can use the <bpt id=\"p1\">**</bpt>Reservation management<ept id=\"p1\">**</ept> workspace.","pos":[10783,10864],"source":" To test your configuration, you can use the **Reservation management** workspace."},{"content":"On the dashboard page, click the <bpt id=\"p1\">**</bpt>Reservation management<ept id=\"p1\">**</ept> tile.","pos":[10870,10935],"source":"On the dashboard page, click the **Reservation management** tile."},{"content":"Alternatively, to use menus, click <bpt id=\"p1\">**</bpt>Fleet management<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Workspaces<ept id=\"p2\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>Reservation management<ept id=\"p3\">**</ept>.","pos":[10936,11044],"source":" Alternatively, to use menus, click **Fleet management** &gt; **Workspaces** &gt; **Reservation management**."},{"content":"The Power BI banner appears, as shown in the following screen shot.","pos":[11045,11112]},{"pos":[11118,11225],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>PowerBI control in Reservation Management Workspace<ept id=\"p1\">](./media/fleetws-1024x578.png)](./media/fleetws.png)</ept>","source":"[![PowerBI control in Reservation Management Workspace](./media/fleetws-1024x578.png)](./media/fleetws.png)"},{"content":"In the Power BI banner, click <bpt id=\"p1\">**</bpt>Get started<ept id=\"p1\">**</ept>.","pos":[11231,11277],"source":"In the Power BI banner, click **Get started**."},{"content":"If this is the first time that you've started Power BI from Dynamics 365 for Operations, you're prompted to authorize sign-in to Power BI from the Dynamics 365 for Operations client.","pos":[11278,11460]},{"content":"Click <bpt id=\"p1\">**</bpt>Click here to provide authorization to Power BI<ept id=\"p1\">**</ept>.","pos":[11461,11519],"source":" Click **Click here to provide authorization to Power BI**."},{"pos":[11529,11609],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>PowerBI Authorization<ept id=\"p1\">](./media/authorization.png)](./media/authorization.png)</ept>","source":"[![PowerBI Authorization](./media/authorization.png)](./media/authorization.png)"},{"content":"Because you're already signed in to AAD in Dynamics 365 for Operations, you don't have to enter your credentials again.","pos":[11615,11734]},{"content":"A new tab appears, where you're prompted to authorize the connection between Dynamics 365 for Operations and Power BI.","pos":[11735,11853]},{"content":"You can now return to the original tab.","pos":[11854,11893]},{"content":"The <bpt id=\"p1\">**</bpt>Add / remove Power BI tiles<ept id=\"p1\">**</ept> slider dialog opens.","pos":[11898,11954],"source":"The **Add / remove Power BI tiles** slider dialog opens."},{"content":"The tabs on the left show your dashboards, and the related visualizations appear on the right.","pos":[11955,12049]},{"content":"You can now select visualizations to add (pin) to the workspace.","pos":[12050,12114]},{"pos":[12120,12190],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>Pinning Slider<ept id=\"p1\">](./media/pinning-836x1024.png)](./media/pinning.png)</ept>","source":"[![Pinning Slider](./media/pinning-836x1024.png)](./media/pinning.png)"},{"pos":[12196,12257],"content":"After you've finished selecting visualizations, click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept>.","source":"After you've finished selecting visualizations, click **OK**."},{"pos":[12262,12270],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[12272,12401],"content":"<bpt id=\"p1\">[</bpt>Sign up for Power BI service<ept id=\"p1\">](https://powerbi.microsoft.com/en-us/documentation/powerbi-developer-sign-up-for-power-bi-service/)</ept>","source":"[Sign up for Power BI service](https://powerbi.microsoft.com/en-us/documentation/powerbi-developer-sign-up-for-power-bi-service/)"}],"content":"---\n# required metadata\n\ntitle: Configure Power BI integration for workspaces\ndescription: This tutorial describes the configuration that is required for a new Microsoft Dynamics 365 for Operations environment to support integration with PowerBI.com. This configuration enables workspaces to show the Power BI control and lets users pin visualizations to a workspace.\nauthor: clwesene\nmanager: AnnBe\nms.date: 2015-12-14 17 - 08 - 48\nms.topic: article\nms.prod: \nms.service: Dynamics365Operations\nms.technology: \n\n# optional metadata\n\nms.search.form: PowerBIConfiguration\n# ROBOTS: \naudience: IT Pro\n# ms.devlang: \nms.reviewer: annbe\nms.search.scope: AX 7.0.0, Operations, Core\n# ms.tgt_pltfrm: \nms.custom: 27661\nms.assetid: 861cfa94-c6f3-4c84-89ac-22c78bf6b7a4\nms.search.region: Global\n# ms.search.industry: \nms.author: cwesene\nms.search.validFrom: 2016-02-28\nms.dyn365.ops.version: AX 7.0.0\n\n---\n\n# Configure Power BI integration for workspaces\n\nThis tutorial describes the configuration that is required for a new Microsoft Dynamics 365 for Operations environment to support integration with PowerBI.com. This configuration enables workspaces to show the Power BI control and lets users pin visualizations to a workspace.\n\nMicrosoft Dynamics 365 for Operations supports Power BI visualizations that are pinned directly to workspaces. This functionality requires a one-time configuration for each tenant to help guarantee that Dynamics 365 for Operations and Power BI can communicate and authenticate correctly. \n\n[![PowerBI control in Reservation Management Workspace](./media/fleetws-1024x578.png)](./media/fleetws.png) \n\nBoth Dynamics 365 for Operations and PowerBI.com are cloud-based services. In order for a Dynamics 365 for Operations workspace to display a Power BI tile, the Dynamics 365 for Operations server must contact the Power BI service on behalf of a user and must have a visualization drawn in the Dynamics 365 for Operations workspace. This flow between Dynamics 365 for Operations and the Power BI service is based on the OAuth 2.0 Authorization Code Grant Flow.\n\n## The OAuth Authorization Code Grant Flow\nThis section describes the authorization flow between Dynamics 365 for Operations and the PowerBI.com service during authentication and when visualizations are presented to a user. The following diagram shows the authorization flow and is based on the assumption that you've completed the configuration that this article describes. \n\n[![OAuthFlow](./media/oauthflow.png)](./media/oauthflow.png)\n\n1.  When a user visits a workspace in Dynamics 365 for Operations for the first time, the Power BI banner prompts the user to start the first-time connection. If the user agrees to start the first-time connection, an OAuth 2.0 Authorization Code Grant Flow is started.\n2.  Dynamics 365 for Operations redirects the user agent to the Microsoft Azure Active Directory (AAD) authorization endpoint. The user is authenticated and consents, if consent is required. Because the user is running Dynamics 365 for Operations, he or she is already signed in to AAD. Therefore, the user doesn't have to enter his or her credentials again.\n3.  The AAD authorization endpoint redirects the AAD agent back to the client application together with an authorization code. The user agent returns the authorization code to the client applicationâ€™s redirect URL. The application redirect URL is a parameter that is maintained in your Power BI configuration, as described later in this article.\n4.  Now that Dynamics 365 for Operations has an authorization code on behalf of the user, it requests an access token from the AAD token issuance endpoint. Dynamics 365 for Operations presents the authorization code to prove that the user has consented.\n5.  The AAD token issuance endpoint returns an access token and a refresh token. Dynamics 365 for Operations must have the access tokento request a visualization from Power BI. Access tokens expire after a short time. The refresh token can be used to request a new token.\n6.  Dynamics 365 for Operations uses the access token to authenticate to the Web API that is provided by Power BI. Dynamics 365 for Operations uses the Web API to request that Power BI visualizations be displayed on behalf of the user.\n7.  After the client application is authenticated, the Power BI Web API returns the requested visualization to the user. Note that Power BI returns only the data that the user is allowed to see. Because the Power BI Web API detects that the user is connecting via Dynamics 365 for Operations, it can correctly resolve the user.\n8.  The user sees Power BI visualizations in the Dynamics 365 for Operations workspace.\n\nFor subsequent visits, this entire flow doesn't have to occur. Because Dynamics 365 for Operations has the access token on behalf of the user, steps 1 through 4 don't have to be repeated.\n\n## Prerequisites\n-   At least one AAD account in your tenant must be registered with PowerBI.com.\n    -   Follow the instructions at <https://powerbi.microsoft.com/en-us/documentation/powerbi-developer-sign-up-for-power-bi-service/>.\n    -   After you've created your AAD account, sign in to <https://app.powerbi.com>.\n    -   At least one user must sign in to PowerBI.com before the configuration can be completed.\n-   You must have AAD administrator privileges.\n-   You must be assigned to the System Administrator role in Dynamics 365 for Operations.\n-   You must be using the same tenant for both your deployment and the user logon. For example, if the environment was deployed under the contosoax7.onmicrosoft.com tenant, the user logon for both Dynamics 365 for Operations and Power BI should be in the format myname@contosoax7.onmicrosoft.com.\n\n## Register your Dynamics 365 for Operations deployment as a web app in the Azure portal\nThe Power BI application programming interface (API) is available for consumption by any client or web application that is registered with AAD. Therefore, the first step is to register your Dynamics 365 for Operations deployment as a web app. To complete this step, you must have access to an AAD account that has administrator privileges for the tenant that Dynamics 365 for Operations was deployed for. For instructions about how to register your web app, see <https://powerbi.microsoft.com/en-us/documentation/powerbi-developer-register-a-web-app/>. **Important:** Observe the following guidelines when you register your web app:\n\n-   Use the following values when you create your web app:\n    -   **Sign-in URL:** This URL is the same as your deployment URL, but **oauth** is added to the end. **Example:** http://contosoax7.cloud.dynamics.com/oauth\n    -   **App ID URI:** This value is mandatory, but isn't required for the workspace integration. Make sure that this App ID URI is a mock URI like https://contosoAX, since using the URL of your deployment can cause sign-in issues in other AAD applications such as the Excel Add-in. **Example:** http://contosoax7testenv/\n    -   **Reply URL:** This URL is the same as your deployment URL, but **oauth** is added to the end. **Example:** http://contosoax7.cloud.dynamics.com/oauth\n-   If you have multiple deployments, you can use the same web app and add additional deployments. Add the URL of each deployment to the **Reply** **URL** list on the **Configuration** tab for your web app.\n-   If you use the deployment URL as the **App ID URL** value, you will cause an error when authentication through Microsoft Power Query for Excel occurs.\n-   Write down the **Client ID** and **Secret Key** values as they appear in the Azure portal, and keep this information in a safe place. You will have to enter these values on the Dynamics 365 for Operations **Power BI configuration** page later.\n-   When you try to give permission to the Power BI service, if you don't see **Power BI Service** in the **Permissions to other applications** list, you must sign up for the Power BI service by using the account of a member of your tenant. To sign up for the Power BI service, you must have at least one organizational user in your AAD tenant. For information about how to create new AAD users, see [Create or edit users in Azure AD](https://msdn.microsoft.com/en-us/library/azure/hh967632.aspx). If you must create a new AAD user for this purpose, go to [https://powerbi.microsoft.com,](https://powerbi.microsoft.com) and sign up for a Power BI account. After your tenant has at least one account that is registered with Power BI, the Power BI service will appear as one of the options for permissions to your Dynamics 365 for Operations web application.\n\n## Configure the environment for Power BI integration\nThe following procedure must be completed by a Dynamics 365 for Operations system administrator. By default, the Power BI configuration is disabled.\n\n1.  Sign in to Dynamics 365 for Operations by using an account that has the System Administrator role.\n2.  Click **System administration** &gt; **Setup** &gt; **Power BI** to open the **Power BI configuration** page.\n\n    [![PowerBI Configuration Form](./media/powerbiconfig2-903x1024.png)](./media/powerbiconfig2.png) Power BI configuration page\\[/caption\\]\n\n3.  Click the **Edit** button to make changes.\n4.  Specify the following values for the fields on this page:\n    -   **Enabled:** Set the option to **Yes**.\n    -   **Azure AD authority URI:** The correct value, **https://login.windows.net**, should already be entered when you open the page.\n    -   **Azure AD Power BI resource URI:** The correct value, **https://analysis.windows.net/powerbi/api**, should already be entered.\n    -   **Azure AD Tenant:** The correct value, **contosoax7.onmicrosoft.com**, should already be entered.\n    -   **Client ID:** Enter the **Client ID** value that you recorded earlier.\n    -   **Application key:** Enter the **Secret Key** value that you recorded earlier.\n    -   **Redirect URL:** The correct value, the root URL of your deployment plus **oauth**, should already be entered.\n    -   **Power BI API Address:** The correct value, **https://api.powerbi.com/beta/myorg**, should already be entered.\n    -   **Apply tile filter:** The correct value, **Yes**, should already be set.\n    -   **Tile filter table:** The correct value, **Entities**, should already be entered.\n    -   **Tile filter column:** The correct value, **ID**, should already be entered.\n\n5.  Click **Save** to save your changes.\n\n## Connect to Power BI from Dynamics AX for the first time\nUsers will now see the Power BI control in specific workspaces. (The control must be added as part of the development process. By default, the control isn't added to all workspaces.) The first time that users use the control, they must confirm that they authorize access to their Power BI visualizations. To test your configuration, you can use the **Reservation management** workspace.\n\n1.  On the dashboard page, click the **Reservation management** tile. Alternatively, to use menus, click **Fleet management** &gt; **Workspaces** &gt; **Reservation management**. The Power BI banner appears, as shown in the following screen shot.\n\n    [![PowerBI control in Reservation Management Workspace](./media/fleetws-1024x578.png)](./media/fleetws.png)\n\n2.  In the Power BI banner, click **Get started**. If this is the first time that you've started Power BI from Dynamics 365 for Operations, you're prompted to authorize sign-in to Power BI from the Dynamics 365 for Operations client. Click **Click here to provide authorization to Power BI**.\n    \n    [![PowerBI Authorization](./media/authorization.png)](./media/authorization.png)\n\n3.  Because you're already signed in to AAD in Dynamics 365 for Operations, you don't have to enter your credentials again. A new tab appears, where you're prompted to authorize the connection between Dynamics 365 for Operations and Power BI. You can now return to the original tab.\n4.  The **Add / remove Power BI tiles** slider dialog opens. The tabs on the left show your dashboards, and the related visualizations appear on the right. You can now select visualizations to add (pin) to the workspace.\n\n    [![Pinning Slider](./media/pinning-836x1024.png)](./media/pinning.png)\n\n5.  After you've finished selecting visualizations, click **OK**.\n\n\n# See also\n\n[Sign up for Power BI service](https://powerbi.microsoft.com/en-us/documentation/powerbi-developer-sign-up-for-power-bi-service/)\n\n"}