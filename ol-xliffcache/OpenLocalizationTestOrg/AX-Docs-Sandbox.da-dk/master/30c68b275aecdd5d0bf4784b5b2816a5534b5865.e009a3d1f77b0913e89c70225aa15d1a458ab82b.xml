{"nodes":[{"pos":[32,98],"content":"Join Enterprise Portal servers into a single server farm (AX 2012)","needQuote":true,"needEscape":true,"nodes":[{"content":"Join Enterprise Portal servers into a single server farm (AX 2012)","pos":[0,66]}]},{"pos":[112,231],"content":"This article explains how to join Enterprise Portal servers (for Microsoft Dynamics AX 2012) into a single server farm.","needQuote":true,"needEscape":true,"nodes":[{"content":"This article explains how to join Enterprise Portal servers (for Microsoft Dynamics AX 2012) into a single server farm.","pos":[0,119]}]},{"pos":[700,766],"content":"Join Enterprise Portal servers into a single server farm (AX 2012)","linkify":"Join Enterprise Portal servers into a single server farm (AX 2012)","nodes":[{"content":"Join Enterprise Portal servers into a single server farm (AX 2012)","pos":[0,66]}]},{"content":"This article explains how to join Enterprise Portal servers (for Microsoft Dynamics AX 2012) into a single server farm.","pos":[768,887]},{"content":"When Microsoft Dynamics Lifecycle Services (LCS) deploys Enterprise Portal (EP) servers, each EP server is deployed into its own server farm.","pos":[890,1031]},{"content":"The steps in this article show how to join all EP servers into a single server farm.","pos":[1032,1116]},{"content":"The basic idea is to keep the server farm on one EP server and join all the other EP servers to that farm.","pos":[1117,1223]},{"content":"The information in this article is based on the following assumptions:","pos":[1224,1294]},{"pos":[1300,1396],"content":"<bpt id=\"p1\">*</bpt>N<ept id=\"p1\">*</ept> EP servers are deployed by LCS, and these servers are labeled EP-01, EP-02, EP-03...EP-0<bpt id=\"p2\">*</bpt>N<ept id=\"p2\">*</ept>.","source":"*N* EP servers are deployed by LCS, and these servers are labeled EP-01, EP-02, EP-03...EP-0*N*."},{"content":"The load balancer is named AzureILB01.","pos":[1401,1439]},{"content":"You're using EP-01 as the single server farm, and all the other EP servers will join that farm.","pos":[1444,1539]},{"pos":[1544,1552],"content":"Overview","linkify":"Overview","nodes":[{"content":"Overview","pos":[0,8]}]},{"content":"The following image shows the process for joining EP servers into a single server farm.","pos":[1553,1640]},{"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>ProcessFlow<ph id=\"ph2\">\\_</ph>ConfigureEPServersInFarm<ept id=\"p1\">](./media/processflow_configureepserversinfarm.png)](./media/processflow_configureepserversinfarm.png)</ept>","pos":[1641,1783],"source":"[![ProcessFlow\\_ConfigureEPServersInFarm](./media/processflow_configureepserversinfarm.png)](./media/processflow_configureepserversinfarm.png)"},{"pos":[1788,1828],"content":"Put EP servers into a single server farm","linkify":"Put EP servers into a single server farm","nodes":[{"content":"Put EP servers into a single server farm","pos":[0,40]}]},{"content":"Log on to EP-01 by using the Dynamics Installer User service account.","pos":[1833,1902]},{"content":"Start Microsoft SharePoint 2013 Central Administration.","pos":[1907,1962]},{"pos":[1967,2038],"content":"Go to <bpt id=\"p1\">**</bpt>System settings<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Configure alternate access mappings<ept id=\"p2\">**</ept>.","source":"Go to **System settings** &gt; **Configure alternate access mappings**."},{"content":"Click <bpt id=\"p1\">**</bpt>Add Internal URLs<ept id=\"p1\">**</ept>.","pos":[2043,2071],"source":"Click **Add Internal URLs**."},{"content":"The following screen shot shows how to add a mapping for EP-02 on port 81, which is the port that the EP site is created on.","pos":[2072,2196]},{"content":"Repeat this step for every EP server that is deployed by LCS.<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>AddInternalURLs<ept id=\"p1\">](./media/addinternalurls.png)](./media/addinternalurls.png)</ept>","pos":[2197,2336],"source":" Repeat this step for every EP server that is deployed by LCS.[![AddInternalURLs](./media/addinternalurls.png)](./media/addinternalurls.png)"},{"pos":[2341,2398],"content":"Click <bpt id=\"p1\">**</bpt>Edit Public URLs<ept id=\"p1\">**</ept>, and enter appropriate values:","source":"Click **Edit Public URLs**, and enter appropriate values:"},{"pos":[2407,2456],"content":"<bpt id=\"p1\">**</bpt>Default:<ept id=\"p1\">**</ept> Use the load balancer URL + port 81.","source":"**Default:** Use the load balancer URL + port 81."},{"pos":[2465,2544],"content":"<bpt id=\"p1\">**</bpt>Intranet:<ept id=\"p1\">**</ept> Use EP-01 (the SharePoint server farm virtual machine) + port 81.","source":"**Intranet:** Use EP-01 (the SharePoint server farm virtual machine) + port 81."},{"pos":[2553,2609],"content":"<bpt id=\"p1\">**</bpt>Internet:<ept id=\"p1\">**</ept> Use the publicly registered URL + port 81.","source":"**Internet:** Use the publicly registered URL + port 81."},{"pos":[2615,2702],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>EditPublicZoneURLs<ept id=\"p1\">](./media/editpubliczoneurls.png)](./media/editpubliczoneurls.png)</ept>","source":"[![EditPublicZoneURLs](./media/editpubliczoneurls.png)](./media/editpubliczoneurls.png)"},{"content":"Open Registry Editor (regedit), and create the following registry key:","pos":[2707,2777]},{"pos":[2786,2865],"content":"<bpt id=\"p1\">**</bpt>Path:<ept id=\"p1\">**</ept> HKEY<ph id=\"ph1\">\\_</ph>LOCAL<ph id=\"ph2\">\\_</ph>MACHINE<ph id=\"ph3\">\\\\</ph>SYSTEM<ph id=\"ph4\">\\\\</ph>CurrentControlSet<ph id=\"ph5\">\\\\</ph>Contro<ph id=\"ph6\">\\\\</ph>Lsa<ph id=\"ph7\">\\\\</ph>MSV1<ph id=\"ph8\">\\_</ph>0","source":"**Path:** HKEY\\_LOCAL\\_MACHINE\\\\SYSTEM\\\\CurrentControlSet\\\\Contro\\\\Lsa\\\\MSV1\\_0"},{"pos":[2874,2953],"content":"<bpt id=\"p1\">**</bpt>Key details, key value:<ept id=\"p1\">**</ept> The load balancer name and the fully qualified name","source":"**Key details, key value:** The load balancer name and the fully qualified name"},{"pos":[2959,3037],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>EditMultiString<ept id=\"p1\">](./media/editmultistring.png)](./media/editmultistring.png)</ept>","source":"[![EditMultiString](./media/editmultistring.png)](./media/editmultistring.png)"},{"pos":[3042,3156],"content":"Open a <bpt id=\"p1\">**</bpt>Command Prompt<ept id=\"p1\">**</ept> window, and get the IP address of the local machine by running the <bpt id=\"p2\">**</bpt>ipconfig<ept id=\"p2\">**</ept> command.","source":"Open a **Command Prompt** window, and get the IP address of the local machine by running the **ipconfig** command."},{"content":"In Notepad, open the C:<ph id=\"ph1\">\\\\</ph>Windows<ph id=\"ph2\">\\\\</ph>System32<ph id=\"ph3\">\\\\</ph>drivers<ph id=\"ph4\">\\\\</ph>etc<ph id=\"ph5\">\\\\</ph>hosts file, and map the load balancer name to the local machine IP address.","pos":[3161,3294],"source":"In Notepad, open the C:\\\\Windows\\\\System32\\\\drivers\\\\etc\\\\hosts file, and map the load balancer name to the local machine IP address."},{"content":"This mapping is used to test that the local EP server is working.<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>NotePad<ept id=\"p1\">](./media/notepad.png)](./media/notepad.png)</ept>","pos":[3295,3414],"source":" This mapping is used to test that the local EP server is working.[![NotePad](./media/notepad.png)](./media/notepad.png)"},{"content":"Repeat steps 6 through 8 on every EP server that is deployed by LCS.","pos":[3419,3487]},{"content":"Log on to the EP-02 server by using the Dynamics Installer User service account.","pos":[3492,3572]},{"content":"Go to the drive where the Dynamics installer is stored (this drive is most likely drive F).","pos":[3577,3668]},{"content":"Right-click <bpt id=\"p1\">**</bpt>Setup<ept id=\"p1\">**</ept>, click <bpt id=\"p2\">**</bpt>Run as administrator<ept id=\"p2\">**</ept>, and then follow these steps:","pos":[3669,3752],"source":" Right-click **Setup**, click **Run as administrator**, and then follow these steps:"},{"pos":[3761,3812],"content":"Click <bpt id=\"p1\">**</bpt>Install Microsoft Dynamics AX components<ept id=\"p1\">**</ept>.","source":"Click **Install Microsoft Dynamics AX components**."},{"pos":[3821,3861],"content":"On the <bpt id=\"p1\">**</bpt>Welcome<ept id=\"p1\">**</ept> page, click <bpt id=\"p2\">**</bpt>Next<ept id=\"p2\">**</ept>.","source":"On the **Welcome** page, click **Next**."},{"pos":[3870,3930],"content":"Click <bpt id=\"p1\">**</bpt>Add or modify components<ept id=\"p1\">**</ept>, and then click <bpt id=\"p2\">**</bpt>Next<ept id=\"p2\">**</ept>.","source":"Click **Add or modify components**, and then click **Next**."},{"content":"Under <bpt id=\"p1\">**</bpt>Web server components<ept id=\"p1\">**</ept>, select the <bpt id=\"p2\">**</bpt>Enterprise Portal<ept id=\"p2\">**</ept> check box.","pos":[3939,4015],"source":"Under **Web server components**, select the **Enterprise Portal** check box."},{"content":"Click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept> to acknowledge that you want to install EP, and then click <bpt id=\"p2\">**</bpt>Next<ept id=\"p2\">**</ept>.","pos":[4016,4097],"source":" Click **OK** to acknowledge that you want to install EP, and then click **Next**."},{"pos":[4106,4177],"content":"Make sure that there are no validation errors, and then click <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept>.","source":"Make sure that there are no validation errors, and then click **Next**."},{"pos":[4186,4244],"content":"Enter the BC proxy user password, and then click <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept>.","source":"Enter the BC proxy user password, and then click **Next**."},{"content":"On the **Configure a Web site for Enterprise Portal **page, select the web application.","pos":[4253,4340]},{"pos":[4349,4416],"content":"Select the <bpt id=\"p1\">**</bpt>Configure for Windows SharePoint Services<ept id=\"p1\">**</ept> check box.","source":"Select the **Configure for Windows SharePoint Services** check box."},{"pos":[4425,4519],"content":"Select the <bpt id=\"p1\">**</bpt>Restart IIS after installation is completed<ept id=\"p1\">**</ept> check box, and then click <bpt id=\"p2\">**</bpt>Next<ept id=\"p2\">**</ept>.","source":"Select the **Restart IIS after installation is completed** check box, and then click **Next**."},{"pos":[4525,4639],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>Configure a Web site for EP<ept id=\"p1\">](./media/configure-a-web-site-for-ep.png)](./media/configure-a-web-site-for-ep.png)</ept>","source":"[![Configure a Web site for EP](./media/configure-a-web-site-for-ep.png)](./media/configure-a-web-site-for-ep.png)"},{"pos":[4644,4695],"content":"Click <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept> until the installation is completed.","source":"Click **Next** until the installation is completed."},{"content":"Repeat steps 10 through 12 on servers EP-03 through EP-0<bpt id=\"p1\">*</bpt>N<ept id=\"p1\">*</ept>.","pos":[4700,4760],"source":"Repeat steps 10 through 12 on servers EP-03 through EP-0*N*."},{"content":"(You must re-install EP on every EP server, except the single server where the farm is configured.","pos":[4761,4859]},{"content":"In our example, this server is EP-01.)","pos":[4860,4898]},{"pos":[4903,4964],"content":"Follow these steps on every EP server, EP-01 through EP-0<bpt id=\"p1\">*</bpt>N<ept id=\"p1\">*</ept>:","source":"Follow these steps on every EP server, EP-01 through EP-0*N*:"},{"content":"Open the Internet Information Services (IIS) administration console (inetmgr).","pos":[4973,5051]},{"pos":[5060,5101],"content":"Go to <bpt id=\"p1\">**</bpt>Sites<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>SharePoint – 81<ept id=\"p2\">**</ept>.","source":"Go to **Sites** &gt; **SharePoint – 81**."},{"pos":[5110,5156],"content":"Right-click, and then click <bpt id=\"p1\">**</bpt>Edit bindings<ept id=\"p1\">**</ept>.","source":"Right-click, and then click **Edit bindings**."},{"pos":[5165,5235],"content":"Double-click the binding to open the <bpt id=\"p1\">**</bpt>Edit Site Binding<ept id=\"p1\">**</ept> dialog box.","source":"Double-click the binding to open the **Edit Site Binding** dialog box."},{"pos":[5245,5302],"content":"In the <bpt id=\"p1\">**</bpt>Host name<ept id=\"p1\">**</ept> field, enter the load balancer name.","source":"In the **Host name** field, enter the load balancer name."},{"pos":[5308,5392],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>Edit Site Binding<ept id=\"p1\">](./media/edit-site-binding.png)](./media/edit-site-binding.png)</ept>","source":"[![Edit Site Binding](./media/edit-site-binding.png)](./media/edit-site-binding.png)"},{"content":"Follow these validation steps on every EP server:","pos":[5397,5446]},{"pos":[5455,5516],"content":"In a <bpt id=\"p1\">**</bpt>Command Prompt<ept id=\"p1\">**</ept> window, run the <bpt id=\"p2\">**</bpt>iisreset<ept id=\"p2\">**</ept> command.","source":"In a **Command Prompt** window, run the **iisreset** command."},{"pos":[5525,5602],"content":"Start Internet Explorer, and go to <bpt id=\"p1\">**</bpt>http://AzureILB01:81/sites/DynamicsAx<ept id=\"p1\">**</ept>.","source":"Start Internet Explorer, and go to **http://AzureILB01:81/sites/DynamicsAx**."},{"content":"Make sure that the Role Center page is rendered without error.","pos":[5611,5673]},{"pos":[5678,5703],"content":"Configure AppFabric cache","linkify":"Configure AppFabric cache","nodes":[{"content":"Configure AppFabric cache","pos":[0,25]}]},{"content":"Log on to the EP-01 server by using the Dynamics Install User service account.","pos":[5708,5786]},{"pos":[5791,5873],"content":"Open a Microsoft Windows PowerShell <bpt id=\"p1\">**</bpt>Command Prompt<ept id=\"p1\">**</ept> window as an administrator.","source":"Open a Microsoft Windows PowerShell **Command Prompt** window as an administrator."},{"pos":[5878,5997],"content":"Run the <bpt id=\"p1\">**</bpt>Use-CacheCluster<ept id=\"p1\">**</ept> command to set the context of your Windows PowerShell session to a specific cache cluster.","source":"Run the **Use-CacheCluster** command to set the context of your Windows PowerShell session to a specific cache cluster."},{"content":"Run the <bpt id=\"p1\">**</bpt>New-Cache<ept id=\"p1\">**</ept> command to create a new named cache.","pos":[6002,6060],"source":"Run the **New-Cache** command to create a new named cache."},{"content":"Make a note of the name that you specify.","pos":[6061,6102]},{"content":"(You'll enter this cache name in the next procedure.)","pos":[6103,6156]},{"content":"Run the <bpt id=\"p1\">**</bpt>Grant-CacheAllowedClientAccount<ept id=\"p1\">**</ept> command, and specify the .NET Business Connector proxy.","pos":[6161,6260],"source":"Run the **Grant-CacheAllowedClientAccount** command, and specify the .NET Business Connector proxy."},{"content":"(This is the account that is used by the EP application pool).","pos":[6261,6323]},{"pos":[6328,6389],"content":"Run the following command: <bpt id=\"p1\">**</bpt>Set-CacheConfig -Secondaries 1<ept id=\"p1\">**</ept>","source":"Run the following command: **Set-CacheConfig -Secondaries 1**"},{"content":"When you're prompted for the cache name, enter the name from step 4.","pos":[6398,6466]},{"pos":[6475,6535],"content":"When you're asked whether you want to continue, enter <bpt id=\"p1\">**</bpt>Y<ept id=\"p1\">**</ept>.","source":"When you're asked whether you want to continue, enter **Y**."},{"content":"If step 6 causes an error, try to run the commands in the following order:","pos":[6541,6615]},{"content":"stop-cachecluster","pos":[6624,6641]},{"content":"Set-CacheConfig -Secondaries 1","pos":[6650,6680]},{"content":"Export the configuration by running the <bpt id=\"p1\">**</bpt>Export-CacheClusterConfig<ept id=\"p1\">**</ept> command.","pos":[6686,6764],"source":"Export the configuration by running the **Export-CacheClusterConfig** command."},{"content":"Specify a name for the file.","pos":[6765,6793]},{"content":"This file can be saved anywhere on the local computer.","pos":[6794,6848]},{"pos":[6853,6972],"content":"Open the file that you just created, and add the following configuration to the <bpt id=\"p1\">**</bpt><ph id=\"ph1\">&amp;lt;</ph>advancedProperties<ph id=\"ph2\">&amp;gt;</ph><ept id=\"p1\">**</ept> section.","source":"Open the file that you just created, and add the following configuration to the **&lt;advancedProperties&gt;** section."},{"pos":[7038,7205],"content":"Import the configuration by running the following command: <bpt id=\"p1\">**</bpt>Import-CacheClusterConfig c:<ph id=\"ph1\">\\\\</ph>newConfig.xml<ept id=\"p1\">**</ept> When you're asked whether you want to continue, enter <bpt id=\"p2\">**</bpt>Y<ept id=\"p2\">**</ept>.","source":"Import the configuration by running the following command: **Import-CacheClusterConfig c:\\\\newConfig.xml** When you're asked whether you want to continue, enter **Y**."},{"pos":[7210,7268],"content":"Run the <bpt id=\"p1\">**</bpt>Start-CacheCluster<ept id=\"p1\">**</ept> command to start the cache.","source":"Run the **Start-CacheCluster** command to start the cache."},{"content":"In Notepad, open the web.config file (C:<ph id=\"ph1\">\\\\</ph>inetpub<ph id=\"ph2\">\\\\</ph>wwwroot<ph id=\"ph3\">\\\\</ph>wss<ph id=\"ph4\">\\\\</ph>VirtualDirectories<ph id=\"ph5\">\\\\</ph>81<ph id=\"ph6\">\\\\</ph>web.config) in admin mode.","pos":[7273,7388],"source":"In Notepad, open the web.config file (C:\\\\inetpub\\\\wwwroot\\\\wss\\\\VirtualDirectories\\\\81\\\\web.config) in admin mode."},{"content":"Locate the <bpt id=\"p1\">**</bpt><ph id=\"ph1\">&amp;lt;</ph>configSections<ph id=\"ph2\">&amp;gt;</ph><ept id=\"p1\">**</ept> section.","pos":[7393,7439],"source":"Locate the **&lt;configSections&gt;** section."},{"content":"Add the following <bpt id=\"p1\">**</bpt>section<ept id=\"p1\">**</ept> element.","pos":[7440,7478],"source":" Add the following **section** element."},{"pos":[7765,7876],"content":"Add the following <bpt id=\"p1\">**</bpt>dataCacheClient<ept id=\"p1\">**</ept> element to the web.config file after the <bpt id=\"p2\">**</bpt><ph id=\"ph1\">&amp;lt;</ph>/configSections<ph id=\"ph2\">&amp;gt;</ph><ept id=\"p2\">**</ept> tag.","source":"Add the following **dataCacheClient** element to the web.config file after the **&lt;/configSections&gt;** tag."},{"content":"Replace every instance of “Host<ph id=\"ph1\">\\_</ph>server<ph id=\"ph2\">\\_</ph>name” with the name of an EP server.","pos":[7886,7963],"source":"Replace every instance of “Host\\_server\\_name” with the name of an EP server."},{"pos":[7972,8062],"content":"Replace “default” with the name that you specified when you ran the <bpt id=\"p1\">**</bpt>New-Cache<ept id=\"p1\">**</ept> command.","source":"Replace “default” with the name that you specified when you ran the **New-Cache** command."},{"content":"Repeat steps 12 through 14 on every EP server that is deployed by LCS.","pos":[8707,8777]},{"pos":[8782,8873],"content":"On the EP-01 server, in a Windows PowerShell window, run the <bpt id=\"p1\">**</bpt>stop-cachecluster<ept id=\"p1\">**</ept> command.","source":"On the EP-01 server, in a Windows PowerShell window, run the **stop-cachecluster** command."},{"pos":[8878,8917],"content":"Run the <bpt id=\"p1\">**</bpt>start-cachecluster<ept id=\"p1\">**</ept> command.","source":"Run the **start-cachecluster** command."},{"pos":[8922,8940],"content":"Validate AppFabric","linkify":"Validate AppFabric","nodes":[{"content":"Validate AppFabric","pos":[0,18]}]},{"content":"On one of the EP servers, in the Windows Services console, verify that AppFabricCachingService is running.","pos":[8945,9051]},{"pos":[9056,9128],"content":"Open a Windows PowerShell <bpt id=\"p1\">**</bpt>Command Prompt<ept id=\"p1\">**</ept> window as an administrator.","source":"Open a Windows PowerShell **Command Prompt** window as an administrator."},{"content":"Run the <bpt id=\"p1\">**</bpt>Get-CacheStatistics<ept id=\"p1\">**</ept> default command.","pos":[9133,9181],"source":"Run the **Get-CacheStatistics** default command."},{"content":"The result should show all zeros.","pos":[9182,9215]},{"pos":[9220,9298],"content":"Restart the web service on the EP server by running the <bpt id=\"p1\">**</bpt>iisereset<ept id=\"p1\">**</ept> command.","source":"Restart the web service on the EP server by running the **iisereset** command."},{"pos":[9303,9332],"content":"Open EP, and go to <bpt id=\"p1\">**</bpt>Sales<ept id=\"p1\">**</ept>.","source":"Open EP, and go to **Sales**."},{"content":"Run the <bpt id=\"p1\">**</bpt>Get-CacheStatistics<ept id=\"p1\">**</ept> default command again, and verify that the cache shows values.","pos":[9337,9431],"source":"Run the **Get-CacheStatistics** default command again, and verify that the cache shows values."},{"content":"This result indicates that cache distribution is working.","pos":[9432,9489]},{"pos":[9494,9502],"content":"Clean up","linkify":"Clean up","nodes":[{"content":"Clean up","pos":[0,8]}]},{"content":"Because every EP server was deployed into its own server farm, after you join all the servers into a single farm, the databases that were created for other EP server farms must be removed from SQL.","pos":[9503,9700]},{"content":"Spfarm<ph id=\"ph1\">\\_</ph>admincontent<ph id=\"ph2\">\\_</ph>ep-02","pos":[9706,9733],"source":"Spfarm\\_admincontent\\_ep-02"},{"content":"Spfarm<ph id=\"ph1\">\\_</ph>admincontent<ph id=\"ph2\">\\_</ph>ep-03","pos":[9738,9765],"source":"Spfarm\\_admincontent\\_ep-03"},{"content":"…","pos":[9770,9771]},{"pos":[9776,9805],"content":"Spfarm<ph id=\"ph1\">\\_</ph>admincontent<ph id=\"ph2\">\\_</ph>ep-0<bpt id=\"p1\">*</bpt>N<ept id=\"p1\">*</ept>","source":"Spfarm\\_admincontent\\_ep-0*N*"},{"content":"Spfarm<ph id=\"ph1\">\\_</ph>config<ph id=\"ph2\">\\_</ph>ep-02","pos":[9810,9831],"source":"Spfarm\\_config\\_ep-02"},{"content":"Spfarm<ph id=\"ph1\">\\_</ph>config<ph id=\"ph2\">\\_</ph> ep-03","pos":[9836,9858],"source":"Spfarm\\_config\\_ ep-03"},{"content":"…","pos":[9863,9864]},{"pos":[9869,9892],"content":"Spfarm<ph id=\"ph1\">\\_</ph>config<ph id=\"ph2\">\\_</ph>ep-0<bpt id=\"p1\">*</bpt>N<ept id=\"p1\">*</ept>","source":"Spfarm\\_config\\_ep-0*N*"},{"content":"WSS<ph id=\"ph1\">\\_</ph>Content<ph id=\"ph2\">\\_</ph><ph id=\"ph3\">\\*</ph>","pos":[9897,9913],"source":"WSS\\_Content\\_\\*"},{"content":"To learn the name of the WSS<ph id=\"ph1\">\\_</ph>Content<ph id=\"ph2\">\\_</ph><ph id=\"ph3\">\\*</ph> database for a particular site, follow these steps.","pos":[9915,10008],"source":"To learn the name of the WSS\\_Content\\_\\* database for a particular site, follow these steps."},{"content":"Start SharePoint Central Administration.","pos":[10014,10054]},{"pos":[10059,10122],"content":"Go to <bpt id=\"p1\">**</bpt>Application management<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>View site collection<ept id=\"p2\">**</ept>.","source":"Go to **Application management** &gt; **View site collection**."},{"content":"In the upper-right corner, select the site that is hosted on port 81.","pos":[10127,10196]},{"content":"The result screen should indicate which database is used for the selected site.","pos":[10197,10276]},{"content":"Delete all WSS<ph id=\"ph1\">\\_</ph>Content<ph id=\"ph2\">\\_</ph><ph id=\"ph3\">\\*</ph> databases that aren't used by the server that site 81 is created on.","pos":[10281,10377],"source":"Delete all WSS\\_Content\\_\\* databases that aren't used by the server that site 81 is created on."},{"content":"In this case, keep the WSS<ph id=\"ph1\">\\_</ph>Content<ph id=\"ph2\">\\_</ph><ph id=\"ph3\">\\*</ph> database that is used by EP-01, and delete every other database that has a name that starts with WSS<ph id=\"ph4\">\\_</ph>Content<ph id=\"ph5\">\\_</ph><ph id=\"ph6\">\\*</ph>.","pos":[10378,10532],"source":" In this case, keep the WSS\\_Content\\_\\* database that is used by EP-01, and delete every other database that has a name that starts with WSS\\_Content\\_\\*."}],"content":"---\n# required metadata\n\ntitle: Join Enterprise Portal servers into a single server farm (AX 2012)\ndescription: This article explains how to join Enterprise Portal servers (for Microsoft Dynamics AX 2012) into a single server farm. \nauthor: aneesmsft\nmanager: AnnBe\nms.date: 04/04/2017\nms.topic: article\nms.prod: \nms.service: Lifecycle Services\nms.technology: \n\n# optional metadata\n\n# ms.search.form: \n# ROBOTS: \naudience: IT Pro\n# ms.devlang: \nms.reviewer: RobinARH\nms.search.scope: AX 2012\n# ms.tgt_pltfrm: \nms.custom: 27431\nms.assetid: 05316e9d-818e-4f4b-901c-2e67fe8edfd1\nms.search.region: Global\n# ms.search.industry: \nms.author: aneesa\nms.search.validFrom: \nms.dyn365.ops.version: 2012\n\n---\n\n# Join Enterprise Portal servers into a single server farm (AX 2012)\n\nThis article explains how to join Enterprise Portal servers (for Microsoft Dynamics AX 2012) into a single server farm. \n\nWhen Microsoft Dynamics Lifecycle Services (LCS) deploys Enterprise Portal (EP) servers, each EP server is deployed into its own server farm. The steps in this article show how to join all EP servers into a single server farm. The basic idea is to keep the server farm on one EP server and join all the other EP servers to that farm. The information in this article is based on the following assumptions:\n\n-   *N* EP servers are deployed by LCS, and these servers are labeled EP-01, EP-02, EP-03...EP-0*N*.\n-   The load balancer is named AzureILB01.\n-   You're using EP-01 as the single server farm, and all the other EP servers will join that farm.\n\n## Overview\nThe following image shows the process for joining EP servers into a single server farm. [![ProcessFlow\\_ConfigureEPServersInFarm](./media/processflow_configureepserversinfarm.png)](./media/processflow_configureepserversinfarm.png)\n\n## Put EP servers into a single server farm\n1.  Log on to EP-01 by using the Dynamics Installer User service account.\n2.  Start Microsoft SharePoint 2013 Central Administration.\n3.  Go to **System settings** &gt; **Configure alternate access mappings**.\n4.  Click **Add Internal URLs**. The following screen shot shows how to add a mapping for EP-02 on port 81, which is the port that the EP site is created on. Repeat this step for every EP server that is deployed by LCS.[![AddInternalURLs](./media/addinternalurls.png)](./media/addinternalurls.png)\n5.  Click **Edit Public URLs**, and enter appropriate values:\n    -   **Default:** Use the load balancer URL + port 81.\n    -   **Intranet:** Use EP-01 (the SharePoint server farm virtual machine) + port 81.\n    -   **Internet:** Use the publicly registered URL + port 81.\n\n    [![EditPublicZoneURLs](./media/editpubliczoneurls.png)](./media/editpubliczoneurls.png)\n6.  Open Registry Editor (regedit), and create the following registry key:\n    -   **Path:** HKEY\\_LOCAL\\_MACHINE\\\\SYSTEM\\\\CurrentControlSet\\\\Contro\\\\Lsa\\\\MSV1\\_0\n    -   **Key details, key value:** The load balancer name and the fully qualified name\n\n    [![EditMultiString](./media/editmultistring.png)](./media/editmultistring.png)\n7.  Open a **Command Prompt** window, and get the IP address of the local machine by running the **ipconfig** command.\n8.  In Notepad, open the C:\\\\Windows\\\\System32\\\\drivers\\\\etc\\\\hosts file, and map the load balancer name to the local machine IP address. This mapping is used to test that the local EP server is working.[![NotePad](./media/notepad.png)](./media/notepad.png)\n9.  Repeat steps 6 through 8 on every EP server that is deployed by LCS.\n10. Log on to the EP-02 server by using the Dynamics Installer User service account.\n11. Go to the drive where the Dynamics installer is stored (this drive is most likely drive F). Right-click **Setup**, click **Run as administrator**, and then follow these steps:\n    1.  Click **Install Microsoft Dynamics AX components**.\n    2.  On the **Welcome** page, click **Next**.\n    3.  Click **Add or modify components**, and then click **Next**.\n    4.  Under **Web server components**, select the **Enterprise Portal** check box. Click **OK** to acknowledge that you want to install EP, and then click **Next**.\n    5.  Make sure that there are no validation errors, and then click **Next**.\n    6.  Enter the BC proxy user password, and then click **Next**.\n    7.  On the **Configure a Web site for Enterprise Portal **page, select the web application.\n    8.  Select the **Configure for Windows SharePoint Services** check box.\n    9.  Select the **Restart IIS after installation is completed** check box, and then click **Next**.\n\n    [![Configure a Web site for EP](./media/configure-a-web-site-for-ep.png)](./media/configure-a-web-site-for-ep.png)\n12. Click **Next** until the installation is completed.\n13. Repeat steps 10 through 12 on servers EP-03 through EP-0*N*. (You must re-install EP on every EP server, except the single server where the farm is configured. In our example, this server is EP-01.)\n14. Follow these steps on every EP server, EP-01 through EP-0*N*:\n    1.  Open the Internet Information Services (IIS) administration console (inetmgr).\n    2.  Go to **Sites** &gt; **SharePoint – 81**.\n    3.  Right-click, and then click **Edit bindings**.\n    4.  Double-click the binding to open the **Edit Site Binding** dialog box.\n    5.   In the **Host name** field, enter the load balancer name.\n\n    [![Edit Site Binding](./media/edit-site-binding.png)](./media/edit-site-binding.png)\n15. Follow these validation steps on every EP server:\n    1.  In a **Command Prompt** window, run the **iisreset** command.\n    2.  Start Internet Explorer, and go to **http://AzureILB01:81/sites/DynamicsAx**.\n    3.  Make sure that the Role Center page is rendered without error.\n\n## Configure AppFabric cache\n1.  Log on to the EP-01 server by using the Dynamics Install User service account.\n2.  Open a Microsoft Windows PowerShell **Command Prompt** window as an administrator.\n3.  Run the **Use-CacheCluster** command to set the context of your Windows PowerShell session to a specific cache cluster.\n4.  Run the **New-Cache** command to create a new named cache. Make a note of the name that you specify. (You'll enter this cache name in the next procedure.)\n5.  Run the **Grant-CacheAllowedClientAccount** command, and specify the .NET Business Connector proxy. (This is the account that is used by the EP application pool).\n6.  Run the following command: **Set-CacheConfig -Secondaries 1**\n    1.  When you're prompted for the cache name, enter the name from step 4.\n    2.  When you're asked whether you want to continue, enter **Y**.\n\n7.  If step 6 causes an error, try to run the commands in the following order:\n    1.  stop-cachecluster\n    2.  Set-CacheConfig -Secondaries 1\n\n8.  Export the configuration by running the **Export-CacheClusterConfig** command. Specify a name for the file. This file can be saved anywhere on the local computer.\n9.  Open the file that you just created, and add the following configuration to the **&lt;advancedProperties&gt;** section.\n\n        <transportProperties maxBufferSize=\"1000000000\" />\n\n10. Import the configuration by running the following command: **Import-CacheClusterConfig c:\\\\newConfig.xml** When you're asked whether you want to continue, enter **Y**.\n11. Run the **Start-CacheCluster** command to start the cache.\n12. In Notepad, open the web.config file (C:\\\\inetpub\\\\wwwroot\\\\wss\\\\VirtualDirectories\\\\81\\\\web.config) in admin mode.\n13. Locate the **&lt;configSections&gt;** section. Add the following **section** element.\n\n    ```\n    <section name=\"dataCacheClient\" type=\"Microsoft.ApplicationServer.Caching.DataCacheClientSection, Microsoft.ApplicationServer.Caching.Core, Version=1.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35\" allowLocation=\"true\" allowDefinition=\"Everywhere\" />\n    ```\n\n14. Add the following **dataCacheClient** element to the web.config file after the **&lt;/configSections&gt;** tag.\n\n    1.  Replace every instance of “Host\\_server\\_name” with the name of an EP server.\n    2.  Replace “default” with the name that you specified when you ran the **New-Cache** command.\n\n    <!-- -->\n\n        <!-- velocity -->\n        <dataCacheClient dataCacheServiceAccountType=\"DomainAccount\">\n        <localCache isEnabled=\"false\" />\n        <hosts>\n        <!--List of hosts -->\n        <!-- Replace highlighted with your own EP server name -->\n        <host name=\"EP-01\" cachePort=\"22233\" /> \n        <host name=\"EP-02\" cachePort=\"22233\" />  \n        <host name=\"EP-03\" cachePort=\"22233\" /> \n        <host name=\"EP-0N\" cachePort=\"22233\" /> \n        </hosts>\n        </dataCacheClient>\n        <Microsoft.Dynamics>\n        <AppFabricCaching CacheName=\"default\" />\n        </Microsoft.Dynamics>\n        <!-- velocity -->\n\n15. Repeat steps 12 through 14 on every EP server that is deployed by LCS.\n16. On the EP-01 server, in a Windows PowerShell window, run the **stop-cachecluster** command.\n17. Run the **start-cachecluster** command.\n\n## Validate AppFabric\n1.  On one of the EP servers, in the Windows Services console, verify that AppFabricCachingService is running.\n2.  Open a Windows PowerShell **Command Prompt** window as an administrator.\n3.  Run the **Get-CacheStatistics** default command. The result should show all zeros.\n4.  Restart the web service on the EP server by running the **iisereset** command.\n5.  Open EP, and go to **Sales**.\n6.  Run the **Get-CacheStatistics** default command again, and verify that the cache shows values. This result indicates that cache distribution is working.\n\n## Clean up\nBecause every EP server was deployed into its own server farm, after you join all the servers into a single farm, the databases that were created for other EP server farms must be removed from SQL.\n\n-   Spfarm\\_admincontent\\_ep-02\n-   Spfarm\\_admincontent\\_ep-03\n-   …\n-   Spfarm\\_admincontent\\_ep-0*N*\n-   Spfarm\\_config\\_ep-02\n-   Spfarm\\_config\\_ ep-03\n-   …\n-   Spfarm\\_config\\_ep-0*N*\n-   WSS\\_Content\\_\\*\n\nTo learn the name of the WSS\\_Content\\_\\* database for a particular site, follow these steps.\n\n1.  Start SharePoint Central Administration.\n2.  Go to **Application management** &gt; **View site collection**.\n3.  In the upper-right corner, select the site that is hosted on port 81. The result screen should indicate which database is used for the selected site.\n4.  Delete all WSS\\_Content\\_\\* databases that aren't used by the server that site 81 is created on. In this case, keep the WSS\\_Content\\_\\* database that is used by EP-01, and delete every other database that has a name that starts with WSS\\_Content\\_\\*.\n\n\n"}