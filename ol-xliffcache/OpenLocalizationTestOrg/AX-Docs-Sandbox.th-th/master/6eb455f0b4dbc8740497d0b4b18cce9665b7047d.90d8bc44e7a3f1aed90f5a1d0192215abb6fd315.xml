{"nodes":[{"pos":[32,63],"content":"Develop composite data entities","needQuote":true,"needEscape":true,"nodes":[{"content":"Develop composite data entities","pos":[0,31]}]},{"pos":[77,213],"content":"A composite entity is a concept that allows you to build a single entity by leveraging multiple entities that are related to each other.","needQuote":true,"needEscape":true,"nodes":[{"content":"A composite entity is a concept that allows you to build a single entity by leveraging multiple entities that are related to each other.","pos":[0,136]}]},{"pos":[729,760],"content":"Develop composite data entities","linkify":"Develop composite data entities","nodes":[{"content":"Develop composite data entities","pos":[0,31]}]},{"content":"A composite entity is a concept that allows you to build a single entity by leveraging multiple entities that are related to each other.","pos":[762,898]},{"pos":[901,928],"content":"What is a composite entity?","linkify":"What is a composite entity?","nodes":[{"content":"What is a composite entity?","pos":[0,27]}]},{"content":"Composite entity is concept that allows you to build a single entity by leveraging multiple entities that are related to each other.","pos":[958,1090]},{"content":"The concept is heavily used in scenarios where an entity can be represented as a single document, like Sales header/line, Invoice header/line and Vendor Catalog.","pos":[1091,1252]},{"content":"This concept is applicable in asynchronous integration scenarios rather than synchronous OData scenarios, and it will only be supported from a data management platform.","pos":[1253,1421]},{"content":"There is no programmatic interface for composite entities in X++.","pos":[1422,1487]},{"content":"It is only supported for a data management platform that is part of XML file-based imports/exports.","pos":[1488,1587]},{"pos":[1592,1599],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"content":"Sales Header and Sales Line are two different entities in the system.","pos":[1600,1669]},{"content":"In case the customer requirement suggests that header and lines are part of a single document, then these two entities can be merged as a composite entity.","pos":[1670,1825]},{"content":"Sample sales order entity: The composite entity (MySalesTableCompositeEntity) represents a sales orders document which is comprised of Sales Order header entity (MySalesTableEntity) and Sales Order Line entity (MySalesTableLineEntity).","pos":[1826,2061]},{"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>DevelopingCompositeEntities (17)<ept id=\"p1\">](./media/developingcompositeentities-17-1024x290.png)](./media/developingcompositeentities-17.png)</ept> Based on the linked entities, these entities can be exposed as an XML document with embedded element tags for entities.","pos":[2062,2316],"source":"[![DevelopingCompositeEntities (17)](./media/developingcompositeentities-17-1024x290.png)](./media/developingcompositeentities-17.png) Based on the linked entities, these entities can be exposed as an XML document with embedded element tags for entities."},{"content":"XML is the only way to expose a composite entity in data management.","pos":[2317,2385]},{"content":"Each node in the XML represents attributes from an individual entity.","pos":[3047,3116]},{"content":"For example - <ph id=\"ph1\">&amp;lt;</ph>MySalesTableEntity SalesID=\"SO1\" CurrencyCode=\"USD\" CustAccount=\"Acc001\"<ph id=\"ph2\">&amp;gt;</ph> SalesId, CurrencyCode and CustAccount are attributes from MySalesTableEntity.","pos":[3117,3289],"source":" For example - &lt;MySalesTableEntity SalesID=\"SO1\" CurrencyCode=\"USD\" CustAccount=\"Acc001\"&gt; SalesId, CurrencyCode and CustAccount are attributes from MySalesTableEntity."},{"pos":[3294,3323],"content":"Building the composite entity","linkify":"Building the composite entity","nodes":[{"content":"Building the composite entity","pos":[0,29]}]},{"content":"There is a node for composite data entities under Data model.","pos":[3324,3385]},{"content":"Let’s take the example of MySalesTableEntity.","pos":[3386,3431]},{"pos":[3437,3513],"content":"Step 1: Identify and create the individual entities for the composite entity","linkify":"Step 1: Identify and create the individual entities for the composite entity","nodes":[{"content":"Step 1: Identify and create the individual entities for the composite entity","pos":[0,76]}]},{"content":"Make sure that the entities are related to each other.","pos":[3515,3569]},{"content":"In this example the individual entities are MySalesTableEntity and MySalesLineEntity.","pos":[3570,3655]},{"pos":[3661,3710],"content":"Step 2: Add relations between individual entities","linkify":"Step 2: Add relations between individual entities","nodes":[{"content":"Step 2: Add relations between individual entities","pos":[0,49]}]},{"content":"Add a relation to parent entity in the relations node.","pos":[3712,3766]},{"content":"Example – MySalesLineEntity has relationship to MySalesTableEntity.","pos":[3767,3834]},{"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>DevelopingCompositeEntities (18)<ept id=\"p1\">](./media/developingcompositeentities-18.png)](./media/developingcompositeentities-18.png)</ept>","pos":[3836,3961],"source":"[![DevelopingCompositeEntities (18)](./media/developingcompositeentities-18.png)](./media/developingcompositeentities-18.png)"},{"pos":[3967,4004],"content":"Step 3: Create a new composite entity","linkify":"Step 3: Create a new composite entity","nodes":[{"content":"Step 3: Create a new composite entity","pos":[0,37]}]},{"pos":[4010,4095],"content":"Add a new <bpt id=\"p1\">**</bpt>Dynamics 365<ept id=\"p1\">**</ept> artifact item of type <bpt id=\"p2\">**</bpt>Composite entity<ept id=\"p2\">**</ept> to the project.","source":"Add a new **Dynamics 365** artifact item of type **Composite entity** to the project."},{"content":"In designer mode, right-click the entity and select <bpt id=\"p1\">**</bpt>New Root Data Entity Reference<ept id=\"p1\">**</ept>.","pos":[4100,4187],"source":"In designer mode, right-click the entity and select **New Root Data Entity Reference**."},{"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>DevelopingCompositeEntities (2)<ept id=\"p1\">](./media/developingcompositeentities-2.png)](./media/developingcompositeentities-2.png)</ept>","pos":[4188,4310],"source":"[![DevelopingCompositeEntities (2)](./media/developingcompositeentities-2.png)](./media/developingcompositeentities-2.png)"},{"content":"Set the data entity to parent data entity.","pos":[4315,4357]},{"content":"In this case its MySalesTableEntity.","pos":[4358,4394]},{"content":"Right-click the parent entity node and select <bpt id=\"p1\">**</bpt>New Embedded Data Entity Reference<ept id=\"p1\">**</ept>.","pos":[4399,4484],"source":"Right-click the parent entity node and select **New Embedded Data Entity Reference**."},{"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>DevelopingCompositeEntities (3)<ept id=\"p1\">](./media/developingcompositeentities-3.png)](./media/developingcompositeentities-3.png)</ept>","pos":[4485,4607],"source":"[![DevelopingCompositeEntities (3)](./media/developingcompositeentities-3.png)](./media/developingcompositeentities-3.png)"},{"content":"Set the embedded data entity as the child entity.","pos":[4612,4661]},{"content":"In this case it is MySalesLineEntity.","pos":[4662,4699]},{"content":"Set the <bpt id=\"p1\">**</bpt>Relation<ept id=\"p1\">**</ept> property from the drop-down list on the embedded data entity properties.","pos":[4704,4797],"source":"Set the **Relation** property from the drop-down list on the embedded data entity properties."},{"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>DevelopingCompositeEntities (4)<ept id=\"p1\">](./media/developingcompositeentities-4.png)](./media/developingcompositeentities-4.png)</ept>","pos":[4799,4921],"source":"[![DevelopingCompositeEntities (4)](./media/developingcompositeentities-4.png)](./media/developingcompositeentities-4.png)"},{"content":"Composite entity supports multi-level child entities.","pos":[4926,4979]},{"pos":[4985,5036],"content":"Step 4: Create relationships between staging tables","linkify":"Step 4: Create relationships between staging tables","nodes":[{"content":"Step 4: Create relationships between staging tables","pos":[0,51]}]},{"content":"You need to create relationships between the parent and child entity staging tables based on the natural keys.","pos":[5038,5148]},{"content":"For example, staging tables for MySalesTable and MySalesLine are linked by SalesID, DefinitionGroup, and ExecutionId.","pos":[5149,5266]},{"content":"Add a foreign key relation on MySalesLineStaging table.","pos":[5272,5327]},{"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>DevelopingCompositeEntities (5)<ept id=\"p1\">](./media/developingcompositeentities-5.png)](./media/developingcompositeentities-5.png)</ept>","pos":[5329,5451],"source":"[![DevelopingCompositeEntities (5)](./media/developingcompositeentities-5.png)](./media/developingcompositeentities-5.png)"},{"content":"Add two columns, RowId and ParentRowId (type int), on all the staging tables associated with the composite data entity.","pos":[5456,5575]},{"content":"Refer to SysCompositeHeaderStaging table for the columns properties.","pos":[5576,5644]},{"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>DevelopingCompositeEntities (7)<ept id=\"p1\">](./media/developingcompositeentities-7.png)](./media/developingcompositeentities-7.png)</ept>","pos":[5645,5767],"source":"[![DevelopingCompositeEntities (7)](./media/developingcompositeentities-7.png)](./media/developingcompositeentities-7.png)"},{"content":"These columns are used to define runtime relationships during the target data movement.","pos":[5769,5856]},{"content":"Create a cluster index on the staging tables which includes RowId, ParentRowid,DefinitionGroup, and ExecutionId.","pos":[5862,5974]},{"content":"This is for performance reasons.","pos":[5975,6007]},{"content":"Compile and synchronize the artifacts.","pos":[6012,6050]},{"pos":[6056,6097],"content":"Step 5: Set up the metadata for DMFEntity","linkify":"Step 5: Set up the metadata for DMFEntity","nodes":[{"content":"Step 5: Set up the metadata for DMFEntity","pos":[0,41]}]},{"content":"For local testing the composite entity metadata needs to be refreshed.","pos":[6099,6169]},{"content":"Go to <bpt id=\"p1\">**</bpt>DIXF Parameters <ph id=\"ph1\">&amp;gt;</ph> Entity settings<ept id=\"p1\">**</ept>.","pos":[6175,6222],"source":"Go to **DIXF Parameters &gt; Entity settings**."},{"content":"Click <bpt id=\"p1\">**</bpt>Refresh entity list<ept id=\"p1\">**</ept>.","pos":[6223,6253],"source":" Click **Refresh entity list**."},{"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>DevelopingCompositeEntities (8)<ept id=\"p1\">](./media/developingcompositeentities-8-1024x212.png)](./media/developingcompositeentities-8.png)</ept>","pos":[6255,6386],"source":"[![DevelopingCompositeEntities (8)](./media/developingcompositeentities-8-1024x212.png)](./media/developingcompositeentities-8.png)"},{"content":"Alternately, you can write the following job to refresh the composite entity list metadata.","pos":[6391,6482]},{"content":"Execute the job.","pos":[6546,6562]},{"content":"This refreshes the metadata required for the entity lookup.","pos":[6563,6622]},{"content":"<bpt id=\"p1\">**</bpt>Note:<ept id=\"p1\">**</ept> Currently this is a workaround.","pos":[6624,6665],"source":"**Note:** Currently this is a workaround."},{"content":"In the future a feature will be enabled to refresh the list at compile/sync time.","pos":[6666,6747]},{"pos":[6753,6784],"content":"Step 6: Test the entity locally","linkify":"Step 6: Test the entity locally","nodes":[{"content":"Step 6: Test the entity locally","pos":[0,31]}]},{"content":"We recommend that you import and export the data as a normal entity from DIXF standard process.","pos":[6786,6881]},{"content":"Refer to the following the steps for importing and exporting entity.","pos":[6882,6950]},{"content":"<bpt id=\"p1\">**</bpt>Note:<ept id=\"p1\">**</ept> The source types of XML-Attribute or XML-Element are supported for composite entity.","pos":[6951,7045],"source":"**Note:** The source types of XML-Attribute or XML-Element are supported for composite entity."},{"pos":[7050,7075],"content":"Import a composite entity","linkify":"Import a composite entity","nodes":[{"content":"Import a composite entity","pos":[0,25]}]},{"pos":[7080,7097],"content":"Click <bpt id=\"p1\">**</bpt>Import<ept id=\"p1\">**</ept>.","source":"Click **Import**."},{"pos":[7102,7162],"content":"Enter <bpt id=\"p1\">**</bpt>Name<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>Source data format<ept id=\"p2\">**</ept>, and <bpt id=\"p3\">**</bpt>Entity name<ept id=\"p3\">**</ept>.","source":"Enter **Name**, **Source data format**, and **Entity name**."},{"pos":[7167,7233],"content":"The <bpt id=\"p1\">**</bpt>Source data format<ept id=\"p1\">**</ept> is either xml-attribute or xml-element.","source":"The **Source data format** is either xml-attribute or xml-element."},{"pos":[7238,7259],"content":"Click <bpt id=\"p1\">**</bpt>Import now<ept id=\"p1\">**</ept>.","source":"Click **Import now**."},{"content":"The number of records created/updated/pending are shown.","pos":[7264,7320]},{"pos":[7325,7350],"content":"Export a composite entity","linkify":"Export a composite entity","nodes":[{"content":"Export a composite entity","pos":[0,25]}]},{"pos":[7355,7372],"content":"Click <bpt id=\"p1\">**</bpt>Export<ept id=\"p1\">**</ept>.","source":"Click **Export**."},{"pos":[7377,7437],"content":"Enter <bpt id=\"p1\">**</bpt>Name<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>Source data format<ept id=\"p2\">**</ept>, <bpt id=\"p3\">**</bpt>and Entity name<ept id=\"p3\">**</ept>.","source":"Enter **Name**, **Source data format**, **and Entity name**."},{"pos":[7442,7482],"content":"Click <bpt id=\"p1\">**</bpt>Add entity<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>Export now<ept id=\"p2\">**</ept>.","source":"Click **Add entity** and **Export now**."},{"pos":[7487,7514],"content":"Click <bpt id=\"p1\">**</bpt>Download package<ept id=\"p1\">**</ept>.","source":"Click **Download package**."},{"pos":[7519,7553],"content":"General troubleshooting guidelines","linkify":"General troubleshooting guidelines","nodes":[{"content":"General troubleshooting guidelines","pos":[0,34]}]},{"content":"Issue: The exported composite XML file is not imported.","pos":[7558,7613]},{"content":"The scenario that produces this is:","pos":[7614,7649]},{"content":"Export a file for composite entity.","pos":[7658,7693]},{"content":"Import the same file.","pos":[7702,7723]},{"content":"Mapping fails and the file is not imported.","pos":[7732,7775]},{"content":"Root cause:","pos":[7780,7791]},{"content":"Check if the exported file has lines or related child entity information.","pos":[7800,7873]},{"content":"If there no lines or related child entity information, then the lines will not be mapped during import.","pos":[7882,7985]},{"content":"Resolution:","pos":[7990,8001]},{"content":"Create a sample file with all of the child entities.","pos":[8010,8062]},{"content":"Use this file for initial mapping only.","pos":[8071,8110]},{"content":"When the mapping is successful, import the actual file which does not have the line data into the entity.","pos":[8119,8224]},{"content":"Use reimport or upload a new file.","pos":[8225,8259]},{"content":"This should import files with partial data (blank child records), depending on the validity of the records.","pos":[8268,8375]}],"content":"---\n# required metadata\n\ntitle: Develop composite data entities\ndescription: A composite entity is a concept that allows you to build a single entity by leveraging multiple entities that are related to each other. \nauthor: RobinARH\nmanager: AnnBe\nms.date: 2015-12-04 23 - 51 - 24\nms.topic: article\nms.prod: \nms.service: Dynamics365Operations\nms.technology: \n\n# optional metadata\n\n# ms.search.form: \n# ROBOTS: \naudience: Developer\n# ms.devlang: \nms.reviewer: RobinARH\nms.search.scope: AX 7.0.0, Operations\n# ms.tgt_pltfrm: \nms.custom: 18411\nms.assetid: 1cb19868-cbfd-4f45-bc47-39b9f303583d\nms.search.region: Global\n# ms.search.industry: \nms.author: kuntalme\nms.search.validFrom: 2016-02-28\nms.dyn365.ops.version: AX 7.0.0\n\n---\n\n# Develop composite data entities\n\nA composite entity is a concept that allows you to build a single entity by leveraging multiple entities that are related to each other. \n\nWhat is a composite entity?\n---------------------------\n\nComposite entity is concept that allows you to build a single entity by leveraging multiple entities that are related to each other. The concept is heavily used in scenarios where an entity can be represented as a single document, like Sales header/line, Invoice header/line and Vendor Catalog. This concept is applicable in asynchronous integration scenarios rather than synchronous OData scenarios, and it will only be supported from a data management platform. There is no programmatic interface for composite entities in X++. It is only supported for a data management platform that is part of XML file-based imports/exports.\n\n## Example\nSales Header and Sales Line are two different entities in the system. In case the customer requirement suggests that header and lines are part of a single document, then these two entities can be merged as a composite entity. Sample sales order entity: The composite entity (MySalesTableCompositeEntity) represents a sales orders document which is comprised of Sales Order header entity (MySalesTableEntity) and Sales Order Line entity (MySalesTableLineEntity). [![DevelopingCompositeEntities (17)](./media/developingcompositeentities-17-1024x290.png)](./media/developingcompositeentities-17.png) Based on the linked entities, these entities can be exposed as an XML document with embedded element tags for entities. XML is the only way to expose a composite entity in data management.\n\n    <?xml version=\"1.0\" encoding=\"utf-8\"?>\n    <Document>\n\n    <MySalesTableEntity SalesID=\"SO1\" CurrencyCode=\"USD\" CustAccount=\"Acc001\">\n    <MySalesLineEntity SalesPrice=\"2.00\" QtyOrdered=\"10.00\" LineAmount=\"20.00\" ItemId=\"1000\" LineNum=\"1.00\" SalesID=\"SO1\"/>\n    <MySalesLineEntity SalesPrice=\"2.00\" QtyOrdered=\"10.00\" LineAmount=\"20.00\" ItemId=\"4401\" LineNum=\"2.00\" SalesID=\"SO1\"/>\n    </MySalesTableEntity>\n\n    <MySalesTableEntity SalesID=\"SO2\" CurrencyCode=\"USD\" CustAccount=\"Acc002\">\n    <MySalesLineEntity SalesPrice=\"2.00\" QtyOrdered=\"10.00\" LineAmount=\"20.00\" ItemId=\"4402\" LineNum=\"1.00\" SalesID=\"SO2\"/>\n    </MySalesTableEntity>\n\n    </Document>\n\nEach node in the XML represents attributes from an individual entity. For example - &lt;MySalesTableEntity SalesID=\"SO1\" CurrencyCode=\"USD\" CustAccount=\"Acc001\"&gt; SalesId, CurrencyCode and CustAccount are attributes from MySalesTableEntity.\n\n## Building the composite entity\nThere is a node for composite data entities under Data model. Let’s take the example of MySalesTableEntity.\n\n### Step 1: Identify and create the individual entities for the composite entity\n\nMake sure that the entities are related to each other. In this example the individual entities are MySalesTableEntity and MySalesLineEntity.\n\n### Step 2: Add relations between individual entities\n\nAdd a relation to parent entity in the relations node. Example – MySalesLineEntity has relationship to MySalesTableEntity.  [![DevelopingCompositeEntities (18)](./media/developingcompositeentities-18.png)](./media/developingcompositeentities-18.png)\n\n### Step 3: Create a new composite entity\n\n1.  Add a new **Dynamics 365** artifact item of type **Composite entity** to the project.\n2.  In designer mode, right-click the entity and select **New Root Data Entity Reference**. [![DevelopingCompositeEntities (2)](./media/developingcompositeentities-2.png)](./media/developingcompositeentities-2.png)\n3.  Set the data entity to parent data entity. In this case its MySalesTableEntity.\n4.  Right-click the parent entity node and select **New Embedded Data Entity Reference**. [![DevelopingCompositeEntities (3)](./media/developingcompositeentities-3.png)](./media/developingcompositeentities-3.png)\n5.  Set the embedded data entity as the child entity. In this case it is MySalesLineEntity.\n6.  Set the **Relation** property from the drop-down list on the embedded data entity properties.  [![DevelopingCompositeEntities (4)](./media/developingcompositeentities-4.png)](./media/developingcompositeentities-4.png)\n7.  Composite entity supports multi-level child entities.\n\n### Step 4: Create relationships between staging tables\n\nYou need to create relationships between the parent and child entity staging tables based on the natural keys. For example, staging tables for MySalesTable and MySalesLine are linked by SalesID, DefinitionGroup, and ExecutionId.\n\n1.  Add a foreign key relation on MySalesLineStaging table.  [![DevelopingCompositeEntities (5)](./media/developingcompositeentities-5.png)](./media/developingcompositeentities-5.png)\n2.  Add two columns, RowId and ParentRowId (type int), on all the staging tables associated with the composite data entity. Refer to SysCompositeHeaderStaging table for the columns properties. [![DevelopingCompositeEntities (7)](./media/developingcompositeentities-7.png)](./media/developingcompositeentities-7.png)\n\nThese columns are used to define runtime relationships during the target data movement.\n\n-   Create a cluster index on the staging tables which includes RowId, ParentRowid,DefinitionGroup, and ExecutionId. This is for performance reasons.\n-   Compile and synchronize the artifacts.\n\n### Step 5: Set up the metadata for DMFEntity\n\nFor local testing the composite entity metadata needs to be refreshed.\n\n1.  Go to **DIXF Parameters &gt; Entity settings**. Click **Refresh entity list**.  [![DevelopingCompositeEntities (8)](./media/developingcompositeentities-8-1024x212.png)](./media/developingcompositeentities-8.png)\n2.  Alternately, you can write the following job to refresh the composite entity list metadata.\n\n        DMFDataPopulation::refreshCompositeEntityList();\n\n3.  Execute the job. This refreshes the metadata required for the entity lookup.\n\n**Note:** Currently this is a workaround. In the future a feature will be enabled to refresh the list at compile/sync time.\n\n### Step 6: Test the entity locally\n\nWe recommend that you import and export the data as a normal entity from DIXF standard process. Refer to the following the steps for importing and exporting entity. **Note:** The source types of XML-Attribute or XML-Element are supported for composite entity.\n\n## Import a composite entity\n1.  Click **Import**.\n2.  Enter **Name**, **Source data format**, and **Entity name**.\n3.  The **Source data format** is either xml-attribute or xml-element.\n4.  Click **Import now**.\n5.  The number of records created/updated/pending are shown.\n\n## Export a composite entity\n1.  Click **Export**.\n2.  Enter **Name**, **Source data format**, **and Entity name**.\n3.  Click **Add entity** and **Export now**.\n4.  Click **Download package**.\n\n## General troubleshooting guidelines\n-   Issue: The exported composite XML file is not imported. The scenario that produces this is:\n    -   Export a file for composite entity.\n    -   Import the same file.\n    -   Mapping fails and the file is not imported.\n-   Root cause:\n    -   Check if the exported file has lines or related child entity information.\n    -   If there no lines or related child entity information, then the lines will not be mapped during import.\n-   Resolution:\n    -   Create a sample file with all of the child entities.\n    -   Use this file for initial mapping only.\n    -   When the mapping is successful, import the actual file which does not have the line data into the entity. Use reimport or upload a new file.\n    -   This should import files with partial data (blank child records), depending on the validity of the records.\n\n\n"}