{"content":"---\n# required metadata\n\ntitle: Add a custom control to an MPOS screen layout\ndescription: This topic explains how to add a new custom control to a Modern POS (MPOS) screen layout.\nauthor: josaw1\nmanager: AnnBe\nms.date: 06/20/2017\nms.topic: article\nms.prod: \nms.service: dynamics-365-retail\nms.technology: \n\n# optional metadata\n\n# ms.search.form: \n# ROBOTS: \naudience: Developer\n# ms.devlang: \n# ms.reviewer: josaw1\nms.search.scope: AX 7.0.0, Operations, Retail, UnifiedOperations\n# ms.tgt_pltfrm: \nms.custom: 65801\nms.assetid: 99079d81-fde2-4432-8cee-82bbcc3bd57e\nms.search.region: Global\n# ms.search.industry: \nms.author: mumani\nms.search.validFrom: 2016-02-28\nms.dyn365.ops.version: AX 7.0.0, Retail July 2017 update\n\n---\n\n# Add a custom control to an MPOS screen layout\n\n[!include[banner](../includes/banner.md)]\n\n\nThis topic explains how to add a new custom control to a Modern POS (MPOS) screen layout.\n\nScenario\n--------\n\nYou want to provide the cashier and manager more information about sales. For example, you want to add information to the transaction page, such as the total quantity that was purchased and the number of voided lines in the transaction. You can use a custom control to add this information.\n\n## Add the custom control\n1.  Start Microsoft Visual Studio as an administrator.\n2.  Open the Modern POS (MPOS) solution. The location of the folder for the solution depends on your solution topology.\n3.  In the POS.App project, in the Views\\\\Controls folder, add a new HTML page, and name it **CustomControl.html**.\n4.  In the POS.App project, in the Views\\\\Controls folder, add new TypeScript file, and name it **CustomControl.ts**.\n5.  Open the CustomControl.html file, and replace the existing code with the following code. This code adds two new properties and binds them to the **CustomControlOptions** class.\n\n        <!DOCTYPE html>\n            <html>\n                <head>\n                    <meta charset=\"utf-8\" />\n                    <title>CustomControl</title>\n                </head>\n                <body>\n                    <div data-bind=\"customControlInternal: 'CustomControlOptions'\">\n                        <div class=\"panel marginBottom1 marginTop05 primaryPanelBackgroundColor highContrastBorderThin height01\">\n                            <div class=\"row padTop1 padBottom0\">\n                                <div class=\"secondaryFontColor\"><h4>Total quantities:</h4></div>\n                                <div class=\"textRight\"><h4 data-bind=\"text: _quantities\" class=\"wrapText\"></h4></div>\n                            </div>\n                            <div class=\"row padTop1 padBottom0\">\n                                <div class=\"secondaryFontColor\"><h4>Voided lines:</h4></div>\n                                <div class=\"textRight\"><h4 data-bind=\"text: _voidedLines\" class=\"wrapText\"></h4></div>\n                            </div>\n                        </div>\n                    </div>\n                </body>\n            </html>\n\n6.  Open the CustomControl.ts file, and add the following code. There are two methods. One method retrieves the total quantities, and the other retrieves the voided quantities. The values are assigned to private variables that are bound to the user interface on the HTML page.\n\n        ///<reference path='K:\\RainMainStab\\7.0.1265.3014\\retail\\Services\\RetailSDK\\Code\\POS\\SharedApp\\Views\\Controls\\UserControl.ts'/>\n        module Commerce.Controls {\n            \"use strict\";\n            /**\n            * Options passed to the custom control.\n            * To pass more variables, change here and at the caller CartView.html (options: { data: ... })\n            */\n            export interface ICustomControlOptions {\n                data: Proxy.Entities.Cart;\n            }\n            /*** User control for rendering custom control. */\n            export class CustomControl extends UserControl {\n                // Observable that is binded to the control's UI\n                // See ExtraControl.html (data-bind=\"text: _quantities\")\n                private _quantities: Observable<number>;\n                private _voidedLines: Observable<number>;\n                /*** Initializes a new instance of the ExtraControlOptions class.  This is called every time the cart is changed.  */\n                constructor(options: ICustomControlOptions) {\n                super();\n                options = options || { data: undefined };\n                // Calculate the total quantities at lines and set to the observable.\n                this._quantities = ko.observable(this.getTotalQuantity(options.data));\n                this._voidedLines = ko.observable(this.getVoidedQuantity(options.data));\n            }\n            private getTotalQuantity(cart: Proxy.Entities.Cart): number {\n                var totalQuantity: number = 0;\n                if (ObjectExtensions.isNullOrUndefined(cart) || !ArrayExtensions.hasElements(cart.CartLines)) {\n                    return totalQuantity;\n                }\n                cart.CartLines.forEach((cartLine: Proxy.Entities.CartLine) => {\n                    if (!cartLine.IsVoided) {\n                        totalQuantity = totalQuantity + cartLine.Quantity;\n                } });\n                return totalQuantity;\n            }\n            private getVoidedQuantity(cart: Proxy.Entities.Cart): number {\n                var voidedQuantity: number = 0;\n                if (ObjectExtensions.isNullOrUndefined(cart) || !ArrayExtensions.hasElements(cart.CartLines)) {\n                    return voidedQuantity;\n                }\n                cart.CartLines.forEach((cartLine: Proxy.Entities.CartLine) => {\n                    if (cartLine.IsVoided) {\n                        voidedQuantity = voidedQuantity + 1;\n                }});\n                return voidedQuantity;\n            }  }\n        }\n\n7.  Compile the project.\n8.  Before you deploy MPOS, you must add the new custom control in the screen layout designer and set the relative URL. Sign in to the client, and go to **Retail** &gt; **Channel setup** &gt; **POS setup** &gt; **POS** &gt; **Screen layouts**.\n9.  Select the **F2MP16:9M** screen layout, and then, on the Action Pane, click the **Designer** button.\n10. If you're prompted to install the designer tool, click **Open**, and follow the installation instructions.\n11. After the installation is completed, you're prompted for your Microsoft Azure Active Directory (Azure AD) credentials. Provide them to start the designer.\n12. In the designer, drag the custom control to the transaction page.\n13. Right-click the custom control on the transaction page, and then click **Customize**.\n14. Set the relative URI to **Views/Controls/CustomControl.html**, and then click **OK**.\n15. In the designer, click the **Close** button.\n16. When you're prompted to save your changes, click **Yes**.\n17. Go to **Retail** &gt; **Retail IT** &gt; **Distribution schedule**.\n18. Select the **Registers** (**1090**) job, and then click **Run now**.\n19. After the job has finished running, deploy MPOS from Visual Studio by clicking the **Deploy** button.\n\n## Validate the customization\n1.  Sign in to MPOS by using **000160** as the operator ID and **123** as the password.\n2.  On the welcome screen, click the **Current transaction** button.\n3.  Add any item to the transaction, and verify that the total quantity is shown correctly in the custom control.\n4.  Void any line in the transaction, and verify that the voided line count is shown correctly in the custom control.\n\n\n\n\n","nodes":[{"pos":[4,720],"content":"# required metadata\n\ntitle: Add a custom control to an MPOS screen layout\ndescription: This topic explains how to add a new custom control to a Modern POS (MPOS) screen layout.\nauthor: josaw1\nmanager: AnnBe\nms.date: 06/20/2017\nms.topic: article\nms.prod: \nms.service: dynamics-365-retail\nms.technology: \n\n# optional metadata\n\n# ms.search.form: \n# ROBOTS: \naudience: Developer\n# ms.devlang: \n# ms.reviewer: josaw1\nms.search.scope: AX 7.0.0, Operations, Retail, UnifiedOperations\n# ms.tgt_pltfrm: \nms.custom: 65801\nms.assetid: 99079d81-fde2-4432-8cee-82bbcc3bd57e\nms.search.region: Global\n# ms.search.industry: \nms.author: mumani\nms.search.validFrom: 2016-02-28\nms.dyn365.ops.version: AX 7.0.0, Retail July 2017 update\n","nodes":[{"content":"Add a custom control to an MPOS screen layout","nodes":[{"pos":[0,45],"content":"Add a custom control to an MPOS screen layout","nodes":[{"content":"Add a custom control to an MPOS screen layout","pos":[0,45]}]}],"path":["title"]},{"content":"This topic explains how to add a new custom control to a Modern POS (MPOS) screen layout.","nodes":[{"pos":[0,89],"content":"This topic explains how to add a new custom control to a Modern POS (MPOS) screen layout.","nodes":[{"content":"This topic explains how to add a new custom control to a Modern POS (MPOS) screen layout.","pos":[0,89]}]}],"path":["description"]}],"header":"# required metadata\n","yml":true},{"pos":[728,773],"content":"Add a custom control to an MPOS screen layout","linkify":"Add a custom control to an MPOS screen layout","nodes":[{"content":"Add a custom control to an MPOS screen layout","pos":[0,45]}]},{"content":"This topic explains how to add a new custom control to a Modern POS (MPOS) screen layout.","pos":[819,908]},{"pos":[910,918],"content":"Scenario","linkify":"Scenario","nodes":[{"content":"Scenario","pos":[0,8]}]},{"content":"You want to provide the cashier and manager more information about sales.","pos":[929,1002]},{"content":"For example, you want to add information to the transaction page, such as the total quantity that was purchased and the number of voided lines in the transaction.","pos":[1003,1165]},{"content":"You can use a custom control to add this information.","pos":[1166,1219]},{"pos":[1224,1246],"content":"Add the custom control","linkify":"Add the custom control","nodes":[{"content":"Add the custom control","pos":[0,22]}]},{"content":"Start Microsoft Visual Studio as an administrator.","pos":[1251,1301]},{"content":"Open the Modern POS (MPOS) solution.","pos":[1306,1342]},{"content":"The location of the folder for the solution depends on your solution topology.","pos":[1343,1421]},{"pos":[1426,1537],"content":"In the POS.App project, in the Views<ph id=\"ph1\">\\\\</ph>Controls folder, add a new HTML page, and name it <bpt id=\"p1\">**</bpt>CustomControl.html<ept id=\"p1\">**</ept>.","source":"In the POS.App project, in the Views\\\\Controls folder, add a new HTML page, and name it **CustomControl.html**."},{"pos":[1542,1655],"content":"In the POS.App project, in the Views<ph id=\"ph1\">\\\\</ph>Controls folder, add new TypeScript file, and name it <bpt id=\"p1\">**</bpt>CustomControl.ts<ept id=\"p1\">**</ept>.","source":"In the POS.App project, in the Views\\\\Controls folder, add new TypeScript file, and name it **CustomControl.ts**."},{"content":"Open the CustomControl.html file, and replace the existing code with the following code.","pos":[1660,1748]},{"content":"This code adds two new properties and binds them to the <bpt id=\"p1\">**</bpt>CustomControlOptions<ept id=\"p1\">**</ept> class.","pos":[1749,1836],"source":" This code adds two new properties and binds them to the **CustomControlOptions** class."},{"content":"Open the CustomControl.ts file, and add the following code.","pos":[2993,3052]},{"content":"There are two methods.","pos":[3053,3075]},{"content":"One method retrieves the total quantities, and the other retrieves the voided quantities.","pos":[3076,3165]},{"content":"The values are assigned to private variables that are bound to the user interface on the HTML page.","pos":[3166,3265]},{"content":"Compile the project.","pos":[5838,5858]},{"content":"Before you deploy MPOS, you must add the new custom control in the screen layout designer and set the relative URL.","pos":[5863,5978]},{"content":"Sign in to the client, and go to <bpt id=\"p1\">**</bpt>Retail<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Channel setup<ept id=\"p2\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>POS setup<ept id=\"p3\">**</ept> <ph id=\"ph3\">&amp;gt;</ph> <bpt id=\"p4\">**</bpt>POS<ept id=\"p4\">**</ept> <ph id=\"ph4\">&amp;gt;</ph> <bpt id=\"p5\">**</bpt>Screen layouts<ept id=\"p5\">**</ept>.","pos":[5979,6102],"source":" Sign in to the client, and go to **Retail** &gt; **Channel setup** &gt; **POS setup** &gt; **POS** &gt; **Screen layouts**."},{"pos":[6107,6207],"content":"Select the <bpt id=\"p1\">**</bpt>F2MP16:9M<ept id=\"p1\">**</ept> screen layout, and then, on the Action Pane, click the <bpt id=\"p2\">**</bpt>Designer<ept id=\"p2\">**</ept> button.","source":"Select the **F2MP16:9M** screen layout, and then, on the Action Pane, click the **Designer** button."},{"pos":[6212,6318],"content":"If you're prompted to install the designer tool, click <bpt id=\"p1\">**</bpt>Open<ept id=\"p1\">**</ept>, and follow the installation instructions.","source":"If you're prompted to install the designer tool, click **Open**, and follow the installation instructions."},{"content":"After the installation is completed, you're prompted for your Microsoft Azure Active Directory (Azure AD) credentials.","pos":[6323,6441]},{"content":"Provide them to start the designer.","pos":[6442,6477]},{"content":"In the designer, drag the custom control to the transaction page.","pos":[6482,6547]},{"pos":[6552,6637],"content":"Right-click the custom control on the transaction page, and then click <bpt id=\"p1\">**</bpt>Customize<ept id=\"p1\">**</ept>.","source":"Right-click the custom control on the transaction page, and then click **Customize**."},{"pos":[6642,6727],"content":"Set the relative URI to <bpt id=\"p1\">**</bpt>Views/Controls/CustomControl.html<ept id=\"p1\">**</ept>, and then click <bpt id=\"p2\">**</bpt>OK<ept id=\"p2\">**</ept>.","source":"Set the relative URI to **Views/Controls/CustomControl.html**, and then click **OK**."},{"pos":[6732,6776],"content":"In the designer, click the <bpt id=\"p1\">**</bpt>Close<ept id=\"p1\">**</ept> button.","source":"In the designer, click the **Close** button."},{"pos":[6781,6838],"content":"When you're prompted to save your changes, click <bpt id=\"p1\">**</bpt>Yes<ept id=\"p1\">**</ept>.","source":"When you're prompted to save your changes, click **Yes**."},{"pos":[6843,6910],"content":"Go to <bpt id=\"p1\">**</bpt>Retail<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Retail IT<ept id=\"p2\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>Distribution schedule<ept id=\"p3\">**</ept>.","source":"Go to **Retail** &gt; **Retail IT** &gt; **Distribution schedule**."},{"pos":[6915,6983],"content":"Select the <bpt id=\"p1\">**</bpt>Registers<ept id=\"p1\">**</ept> (<bpt id=\"p2\">**</bpt>1090<ept id=\"p2\">**</ept>) job, and then click <bpt id=\"p3\">**</bpt>Run now<ept id=\"p3\">**</ept>.","source":"Select the **Registers** (**1090**) job, and then click **Run now**."},{"pos":[6988,7089],"content":"After the job has finished running, deploy MPOS from Visual Studio by clicking the <bpt id=\"p1\">**</bpt>Deploy<ept id=\"p1\">**</ept> button.","source":"After the job has finished running, deploy MPOS from Visual Studio by clicking the **Deploy** button."},{"pos":[7094,7120],"content":"Validate the customization","linkify":"Validate the customization","nodes":[{"content":"Validate the customization","pos":[0,26]}]},{"pos":[7125,7208],"content":"Sign in to MPOS by using <bpt id=\"p1\">**</bpt>000160<ept id=\"p1\">**</ept> as the operator ID and <bpt id=\"p2\">**</bpt>123<ept id=\"p2\">**</ept> as the password.","source":"Sign in to MPOS by using **000160** as the operator ID and **123** as the password."},{"pos":[7213,7277],"content":"On the welcome screen, click the <bpt id=\"p1\">**</bpt>Current transaction<ept id=\"p1\">**</ept> button.","source":"On the welcome screen, click the **Current transaction** button."},{"content":"Add any item to the transaction, and verify that the total quantity is shown correctly in the custom control.","pos":[7282,7391]},{"content":"Void any line in the transaction, and verify that the voided line count is shown correctly in the custom control.","pos":[7396,7509]}]}