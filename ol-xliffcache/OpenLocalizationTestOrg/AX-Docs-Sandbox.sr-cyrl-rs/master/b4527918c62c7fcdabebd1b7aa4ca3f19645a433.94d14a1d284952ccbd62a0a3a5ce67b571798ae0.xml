{"content":"---\n# required metadata\n\ntitle: Copy Dynamics 365 for Operations database - Azure SQL to SQL Server\ndescription: This topic provides information about how to export a Microsoft Dynamics 365 for Operations database from an Azure-based environment, and then import it to a SQL Server-based environment.  \nauthor: MargoC\nmanager: AnnBe\nms.date: 04/04/2017\nms.topic: article\nms.prod: \nms.service: Dynamics365Operations\nms.technology: \n\n# optional metadata\n\n# ms.search.form: \n# ROBOTS: \naudience: Developer, IT Pro\n# ms.devlang: \nms.reviewer: annbe\nms.search.scope: AX 7.0.0, Operations\n# ms.tgt_pltfrm: \nms.custom: 203764\nms.assetid: 45efdabf-1714-4ba4-9a9d-217143a6c6e0\nms.search.region: Global\n# ms.search.industry: \nms.author: tabell\nms.search.validFrom: 2016-05-31\nms.dyn365.ops.version: AX 7.0.1\n\n---\n\n# Copy a Dynamics 365 for Operations database from Azure SQL Database to a SQL Server environment\n\n[!include[banner](../includes/banner.md)]\n\nThis topic provides information about how to export a Microsoft Dynamics 365 for Operations database from an Azure-based environment, and then import it to a SQL Server-based environment.  \n\nOverview\n--------\n\nMoving a database involves using the sqlpackage.exe command line tool to export a database from Azure SQL Database and then import the database to Microsoft SQL Server 2016. Because the file extension for the exported data is .bacpac, the process for moving a database is commonly referred to as the *bacpac process*. The high-level process for a database move is:\n\n-   Create a duplicate of the source database.\n-   Run a SQL Server script to prepare the database.\n-   Export the database from the Azure SQL database.\n-   Import the database to SQL Server 2016.\n-   Run a SQL script to update the database.\n\n**Important notes for customers running Retail environments:**\n\n-   Developer environments are not supported as a target for Retail.\n-   If you want to perform this activity for Retail, contact [Microsoft support for details](../lifecycle-services/lcs-support.md).\n\n## Prerequisites\nThe following prerequisites are required before you can move a database.\n\n-   Only a database to which the customer has SQL access to can be copied. If you must copy the production environment then first copy the production environment to the sandbox environment, and work from the sandbox environment.\n-   The destination SQL Server environment must be running SQL Server 2016 RTM (13.00.1601.5) or higher. The CTP versions of SQL Server 2016 may cause errors during the import process.\n-   To export a database from a sandbox environment you must install the [latest SQL Server Management Studio](https://msdn.microsoft.com/en-us/library/mt238290.aspx) to the AOS machine in that environment and perform the bacpac export on that AOS machine. This is for two reasons. First, there is an IP access restriction on the sandbox SQL Server instance, which only allows a connection from a machine within that environment. Second, the version of SQL Server Management Studio installed by default is for a previous version of SQL Server and can't complete the tasks required.\n\n## Before you begin\nEncrypted and environment-specific values can't be imported into a new environment. After you've completed the import, you must re-enter some data from your source environment in your target environment.\n\n### Document the values of encrypted fields\n\nBecause of a technical limitation that is related to the certificate that is used for data encryption, values that are stored in encrypted fields in a database will be unreadable after that database is imported into a new environment. Therefore, after an import, you must manually delete and re-enter values that are stored in encrypted fields. New values that are entered in encrypted fields after an import will be readable. The following fields are affected. (The field names are given in *Table*.*Field* format.)\n\n|                                                          |                                                                                                                                                                                |\n|----------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| **Table.field name**                                     | **Where to set the value**                                                                                                                                                     |\n| CreditCardAccountSetup.SecureMerchantProperties          | Click **Accounts receivable** &gt; **Payments setup** &gt; **Payment services**.                                                                                               |\n| ExchangeRateProviderConfigurationDetails.Value           | Click **General ledger** &gt; **Currencies** &gt; **Configure exchange rate providers**.                                                                                       |\n| FiscalEstablishment\\_BR.ConsumerEFDocCsc                 | Click **Organization administration** &gt; **Fiscal establishments** &gt; **Fiscal establishments**.                                                                           |\n| FiscalEstablishmentStaging.CSC                           | This field is used by the Data Import/Export Framework                                                                                                                         |\n| HcmPersonIdentificationNumber.PersonIdentificationNumber | Click **Human resources** &gt; **Workers** &gt; **Workers**. On the **Worker** tab, in the **Personal information** group, click **Identification numbers**.                   |\n| HcmWorkerActionHire.PersonIdentificationNumber           | This field has been obsolete since the February 2016 release. It was previously in the **Human resources** &gt; **Workers** &gt; **Actions** &gt; **All worker actions** form. |\n| SysEmailSMPTPassword.Password                            | Click **System administration** &gt; **Email** &gt; **Email parameters**.                                                                                                      |\n| SysOAuthUserTokens.EncryptedAccessToken                  | This field is used internally by the AOS. It can be ignored.                                                                                                                   |\n| SysOAuthUserTokens.EncryptedRefr eshToken                | This field is used internally by the AOS. It can be ignored.                                                                                                                   |\n\n \n\n### If you're running Retail components, document encrypted and environment-specific values\n\nThe values in the following forms are either environment-specific or encrypted in the database. Therefore, all the imported values will be incorrect.\n\n-   Accounts receivable &gt; Payments setup &gt; Payments services\n-   Retail and commerce &gt; Channel setup &gt; POS setup &gt; POS profiles &gt; Hardware profiles\n\n## Copy the source database\nBecause you will need to disable change tracking and delete the users from the database before you can export, you should create a copy of the source Azure SQL database that you will export. Then, you can work with a copy instead of deleting information from the original database. The following SQL statement will create a copy of the database **axdb\\_mySourceDatabaseToCopy** called **MyNewCopy**. Edit this script with your own database names.\n\n    CREATE DATABASE MyNewCopy AS COPY OF axdb_mySourceDatabaseToCopy\n\nNote that this command will execute asynchronously, meaning that it will appear to complete after 1 minute, but actually it is running in the background. For more information, refer to [CREATE DATABASE (Azure SQL Database)](https://msdn.microsoft.com/en-us/library/dn268335.aspx). To monitor the progress of the copy operation, execute the following query against the MASTER database within the same instance.\n\n    SELECT * FROM sys.dm_database_copies\n\n## Prepare the copied database\nRun the following script against the copied database to remove change tracking, SQL Database users, and a system view. The script will also correct system flags, remove references to the previous environment, withhold batches, and remove email configuration. These changes are all required to successfully export and import the database and to ensure that when the AOS is started in the target environment, nothing will automatically start running. **Note:** You must update the following ALTER DATABASE command with your database copy name.\n\n    --Prepare a database in SQL Azure for export to SQL Server.\n    --Disable change tracking on tables where it is enabled.\n    declare\n    @SQL varchar(1000)\n    set quoted_identifier off\n    declare changeTrackingCursor CURSOR for\n    select 'ALTER TABLE ' + t.name + ' DISABLE CHANGE_TRACKING'\n    from sys.change_tracking_tables c, sys.tables t\n    where t.object_id = c.object_id\n    OPEN changeTrackingCursor\n    FETCH changeTrackingCursor into @SQL\n    WHILE @@Fetch_Status = 0\n    BEGIN\n    exec(@SQL)\n    FETCH changeTrackingCursor into @SQL\n    END\n    CLOSE changeTrackingCursor\n    DEALLOCATE changeTrackingCursor\n     \n    --Disable change tracking on the database itself.\n    ALTER DATABASE\n    -- SET THE NAME OF YOUR DATABASE BELOW\n    MyNewCopy\n    set CHANGE_TRACKING = OFF\n    --Remove the database level users from the database\n    --these will be recreated after importing in SQL Server.\n    declare\n    @userSQL varchar(1000)\n    set quoted_identifier off\n    declare userCursor CURSOR for\n    select 'DROP USER ' + name\n    from sys.sysusers\n    where issqlrole = 0 and hasdbaccess = 1 and name <> 'dbo'\n    OPEN userCursor\n    FETCH userCursor into @userSQL\n    WHILE @@Fetch_Status = 0\n    BEGIN\n    exec(@userSQL)\n    FETCH userCursor into @userSQL\n    END\n    CLOSE userCursor\n    DEALLOCATE userCursor\n    --Delete the SYSSQLRESOURCESTATSVIEW view as it has an Azure-specific definition in it.\n    --We will run db synch later to recreate the correct view for SQL Server.\n    if(1=(select 1 from sys.views where name = 'SYSSQLRESOURCESTATSVIEW'))\n    DROP VIEW SYSSQLRESOURCESTATSVIEW\n    --Next, set system parameters ready for being a SQL Server Database.\n    update sysglobalconfiguration\n    set value = 'SQLSERVER'\n    where name = 'BACKENDDB'\n    update sysglobalconfiguration\n    set value = 0\n    where name = 'TEMPTABLEINAXDB'\n    --Clean up the batch server configuration, server sessions, and printers from the previous environment.\n    TRUNCATE TABLE SYSSERVERCONFIG\n    TRUNCATE TABLE SYSSERVERSESSIONS\n    TRUNCATE TABLE SYSCORPNETPRINTERS\n    --Remove records which could lead to accidentally sending an email externally.\n    UPDATE SysEmailParameters\n    SET SMTPRELAYSERVERNAME = ''\n    GO\n    UPDATE LogisticsElectronicAddress\n    SET LOCATOR = ''\n    WHERE Locator LIKE '%@%'\n    GO\n    TRUNCATE TABLE PrintMgmtSettings\n    TRUNCATE TABLE PrintMgmtDocInstance\n    --Set any waiting, executing, ready, or canceling batches to withhold.\n    UPDATE BatchJob\n    SET STATUS = 0\n    WHERE STATUS IN (1,2,5,7)\n    GO\n\n## Export the database\nOpen a command prompt as an Administrator, and then execute the following commands.\n\n    cd C:\\Program Files (x86)\\Microsoft SQL Server\\130\\DAC\\bin\n\n    SqlPackage.exe /a:export /ssn:<server>.database.windows.net /sdn:<database to export> /tf:D:\\Exportedbacpac\\my.bacpac /p:CommandTimeout=1200 /p:VerifyFullTextDocumentTypesSupported=false /sp:<sql password> /su:<sql user>\n\nThe following list provides an explanation of the parameters:\n\n-   ssn (source server name): The name of the SQL Azure server from which you will export.\n-   sdn (source database name): The name of the database that you will export.\n-   tf (target file): The path and file name that you will export to.\n-   sp (source password): The SQL password for source SQL Server.\n-   su (source user): The SQL user name for the source SQL Server. We recommend that you use the **sqladmin** user, which the deployment will have created on every Dynamics SQL instance. You can retrieve the password for this user from your Lifecycle Services (LCS) project.\n\nAfter the export completes, delete the copied database.\n\n    DROP DATABASE [MyNewCopy]\n\n## Import the database\nWhen you import the database, we recommend that you:\n\n-   Retain a copy of the existing AxDB database, to allow you to revert to it later if needed.\n-   Import the new database with a new name, for example AxDB\\_fromProd.\n\nCopy the \\*.bacpac file to the local machine from which you will import to ensure the best performane. Open a command prompt as Administrator and run the following commands.\n\n    cd C:\\Program Files (x86)\\Microsoft SQL Server\\130\\DAC\\bin\n\n    SqlPackage.exe /a:import /sf:D:\\Exportedbacpac\\my.bacpac /tsn:localhost /tdn:<target database name> /p:CommandTimeout=1200\n\nThe following list provides an explanation of the parameters:\n\n-   tsn (target server name): The name of the SQL Server that you will import to.\n-   tdn (target database name): The name of the database that you will import to. The database should **not** already exist.\n-   sf (source file) The path and file name to import from.\n\n**Note:** During import, the user name and password are not required because SQL Server will default to Windows authentication for the currently logged on user.\n\n## Update the database\nExecute the following SQL script against the imported database. This will add back the users that were deleted from the source database earlier, correctly linking them to the SQL logins for this SQL instance.\n\n    CREATE USER axdeployuser FROM LOGIN axdeployuser\n    EXEC sp_addrolemember 'db_owner', 'axdeployuser'\n\n    CREATE USER axdbadmin FROM LOGIN axdbadmin\n    EXEC sp_addrolemember 'db_owner', 'axdbadmin'\n\n    CREATE USER axmrruntimeuser FROM LOGIN axmrruntimeuser\n    EXEC sp_addrolemember 'db_datareader', 'axmrruntimeuser'\n    EXEC sp_addrolemember 'db_datawriter', 'axmrruntimeuser'\n\n    CREATE USER axretaildatasyncuser FROM LOGIN axretaildatasyncuser\n    EXEC sp_addrolemember 'DataSyncUsersRole', 'axretaildatasyncuser'\n\n    CREATE USER axretailruntimeuser FROM LOGIN axretailruntimeuser\n    EXEC sp_addrolemember 'UsersRole', 'axretailruntimeuser'\n    EXEC sp_addrolemember 'ReportUsersRole', 'axretailruntimeuser'\n\n    CREATE USER [NT AUTHORITY\\NETWORK SERVICE] FROM LOGIN [NT AUTHORITY\\NETWORK SERVICE]\n    EXEC sp_addrolemember 'db_owner', 'NT AUTHORITY\\NETWORK SERVICE'\n\n### Reset the Financial Reporting database\n\nIf using Financial Reporting (formerly Management Reporter) then follow the steps to reset the financial reporting database in [Resetting the financial reporting data mart after restoring a database](../analytics/reset-financial-reporting-datamart-after-restore.md).\n\n## Start using the new database\nTo switch the environment and use the new database, stop the services in the following list, rename the AxDB database to AxDB\\_orig, and then rename your newly imported database AxDB. Restart the services in the following list:\n\n-   World wide web publishing service\n-   Dynamics 365 for Operations Batch Management service\n-   Management Reporter 2012 Process service\n\nTo switch back to the original database, reverse the step above. Stop the services, rename the databases, and then start the services.\n\n## Reenter data from encrypted and environment specific fields in the target database\nIn the Dynamics 365 for Operations client, enter the values that you documented for the encrypted and environment-specific fields. The following fields are affected. (The field names are given in *Table*.*Field* format.)\n\n|                                                          |                                                                                                                                                                                |\n|----------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| **Table.field name**                                     | **Where to set the value**                                                                                                                                                     |\n| CreditCardAccountSetup.SecureMerchantProperties          | Click **Accounts receivable** &gt; **Payments setup** &gt; **Payment services**.                                                                                               |\n| ExchangeRateProviderConfigurationDetails.Value           | Click **General ledger** &gt; **Currencies** &gt; **Configure exchange rate providers**.                                                                                       |\n| FiscalEstablishment\\_BR.ConsumerEFDocCsc                 | Click **Organization administration** &gt; **Fiscal establishments** &gt; **Fiscal establishments**.                                                                           |\n| FiscalEstablishmentStaging.CSC                           | This field is used by the Data Import/Export Framework                                                                                                                         |\n| HcmPersonIdentificationNumber.PersonIdentificationNumber | Click **Human resources** &gt; **Workers** &gt; **Workers**. On the **Worker** tab, in the **Personal information** group, click **Identification numbers**.                   |\n| HcmWorkerActionHire.PersonIdentificationNumber           | This field has been obsolete since the February 2016 release. It was previously in the **Human resources** &gt; **Workers** &gt; **Actions** &gt; **All worker actions** form. |\n| SysEmailSMPTPassword.Password                            | Click **System administration** &gt; **Email** &gt; **Email parameters**.                                                                                                      |\n| SysOAuthUserTokens.EncryptedAccessToken                  | This field is used internally by the AOS. It can be ignored.                                                                                                                   |\n| SysOAuthUserTokens.EncryptedRefr eshToken                | This field is used internally by the AOS. It can be ignored.                                                                                                                   |\n\n## Known issues\n### Cannot drop users in source database\n\nWhen dropping users in the source database, the user **axdbadmin** or **axdeployuser** may fail to delete as they are currently owner of the full-text catalog. This occurs if the database was originally created in CTP7 or CTP8. To resolve this, change the owner to the dbo user using the transact-SQL command [ALTER AUTHORIZATION](https://msdn.microsoft.com/en-us/library/ms187359.aspx).\n\n    ALTER AUTHORIZATION ON Fulltext Catalog:: TO [dbo]; \n\n### Can't download SQL Server Management Studio installation files\n\nWhen you attempt to download the SQL Management Studio install, you might receive the following error. [![SecuritySettingsCannotDownload](./media/securitysettingscannotdownload.png)](./media/securitysettingscannotdownload.png)         To work around this issue, enable file download for the **Internet Zone**, on the **Security** tab in **Internet Options** as shown below. [![SecuritySettingsFix](./media/securitysettingsfix.png)](./media/securitysettingsfix.png)\n\n### Database synchronization fails\n\nWhen you synchronize the database against the newly imported database from Visual Studio, the synchronization might fail with the following error:\n> *\"Failed to open SQL connection* *syncengine.exe exited with code -1.\"* \n\nAlso, in the Windows application log, you will find this message logged under event ID 140: \n> *Object Server Database Synchronizer:* *The internal system table version number stored in the database is higher than the version supported by the kernel (141/138). Use a newer Microsoft Dynamics kernel, or start Microsoft Dynamics using the -REPAIR command line parameter to enforce synchronization.* \n\nThis can occur when the platform build number of the current environment is lower than the platform build number of the source environment. Depending on your circumstances, either upgrade the current environmentâ€™s platform to match the source environment, by using the **Updates** tiles on the LCS **Environment** page, or adjust the expected version in the database by using the following query.\n\n    UPDATE SQLSYSTEMVARIABLES\n\n    SET VALUE = 138\n\n    WHERE PARM = 'SYSTABVERSION'\n\n**Note:** The value 138 in the query above is taken from the event log message that was expecting 138 in this particular environment.\n\n### Performance\n\nRefer to the following guidelines for optimal performance:\n\n-   Always export a database from a virtual machine that is located in the same Azure data center as the Azure SQL database. If you are exporting a copy of your sandbox database, export it from the Sandbox AOS machine.\n-   Always import the .bacpac locally on the machine that is running the SQL Server instance. Do not import from SQL Server Management Studio on a remote machine.\n-   On a Dynamics 365 for Operations one-box environment, also known as a tier 1 environment, which is hosted in Azure, place the bacpac file on the D: drive when importing for increased performance. Read more about the temporary drive in Azure machines in the blog post [Understanding the temporary drive on Windows Azure Virtual Machines](https://blogs.msdn.microsoft.com/mast/2013/12/06/understanding-the-temporary-drive-on-windows-azure-virtual-machines/).\n-   Grant the account running the SQL Server Windows service the [Instance File Initialization](https://msdn.microsoft.com/en-us/library/ms175935.aspx) rights. This can speed up the import process and improve the speed of restore from a \\*.bak file. A simple way to do this in a Developer environment is to set SQL Server to run as the axlocaladmin account.\n-   From SQL Azure, do not select Export data tier application in SQL Server Management Studio because there can be a memory limitation for larger databases.\n\n\n\n\n","nodes":[{"pos":[4,798],"content":"# required metadata\n\ntitle: Copy Dynamics 365 for Operations database - Azure SQL to SQL Server\ndescription: This topic provides information about how to export a Microsoft Dynamics 365 for Operations database from an Azure-based environment, and then import it to a SQL Server-based environment.  \nauthor: MargoC\nmanager: AnnBe\nms.date: 04/04/2017\nms.topic: article\nms.prod: \nms.service: Dynamics365Operations\nms.technology: \n\n# optional metadata\n\n# ms.search.form: \n# ROBOTS: \naudience: Developer, IT Pro\n# ms.devlang: \nms.reviewer: annbe\nms.search.scope: AX 7.0.0, Operations\n# ms.tgt_pltfrm: \nms.custom: 203764\nms.assetid: 45efdabf-1714-4ba4-9a9d-217143a6c6e0\nms.search.region: Global\n# ms.search.industry: \nms.author: tabell\nms.search.validFrom: 2016-05-31\nms.dyn365.ops.version: AX 7.0.1\n","nodes":[{"content":"Copy Dynamics 365 for Operations database - Azure SQL to SQL Server","nodes":[{"pos":[0,67],"content":"Copy Dynamics 365 for Operations database - Azure SQL to SQL Server","nodes":[{"content":"Copy Dynamics 365 for Operations database - Azure SQL to SQL Server","pos":[0,67]}]}],"path":["title"]},{"content":"This topic provides information about how to export a Microsoft Dynamics 365 for Operations database from an Azure-based environment, and then import it to a SQL Server-based environment.","nodes":[{"pos":[0,187],"content":"This topic provides information about how to export a Microsoft Dynamics 365 for Operations database from an Azure-based environment, and then import it to a SQL Server-based environment.","nodes":[{"content":"This topic provides information about how to export a Microsoft Dynamics 365 for Operations database from an Azure-based environment, and then import it to a SQL Server-based environment.","pos":[0,187]}]}],"path":["description"]}],"header":"# required metadata\n","yml":true},{"pos":[806,901],"content":"Copy a Dynamics 365 for Operations database from Azure SQL Database to a SQL Server environment","linkify":"Copy a Dynamics 365 for Operations database from Azure SQL Database to a SQL Server environment","nodes":[{"content":"Copy a Dynamics 365 for Operations database from Azure SQL Database to a SQL Server environment","pos":[0,95]}]},{"content":"This topic provides information about how to export a Microsoft Dynamics 365 for Operations database from an Azure-based environment, and then import it to a SQL Server-based environment.","pos":[946,1133]},{"pos":[1137,1145],"content":"Overview","linkify":"Overview","nodes":[{"content":"Overview","pos":[0,8]}]},{"content":"Moving a database involves using the sqlpackage.exe command line tool to export a database from Azure SQL Database and then import the database to Microsoft SQL Server 2016.","pos":[1156,1329]},{"content":"Because the file extension for the exported data is .bacpac, the process for moving a database is commonly referred to as the <bpt id=\"p1\">*</bpt>bacpac process<ept id=\"p1\">*</ept>.","pos":[1330,1473],"source":" Because the file extension for the exported data is .bacpac, the process for moving a database is commonly referred to as the *bacpac process*."},{"content":"The high-level process for a database move is:","pos":[1474,1520]},{"content":"Create a duplicate of the source database.","pos":[1526,1568]},{"content":"Run a SQL Server script to prepare the database.","pos":[1573,1621]},{"content":"Export the database from the Azure SQL database.","pos":[1626,1674]},{"content":"Import the database to SQL Server 2016.","pos":[1679,1718]},{"content":"Run a SQL script to update the database.","pos":[1723,1763]},{"pos":[1765,1827],"content":"<bpt id=\"p1\">**</bpt>Important notes for customers running Retail environments:<ept id=\"p1\">**</ept>","source":"**Important notes for customers running Retail environments:**"},{"content":"Developer environments are not supported as a target for Retail.","pos":[1833,1897]},{"pos":[1902,2029],"content":"If you want to perform this activity for Retail, contact <bpt id=\"p1\">[</bpt>Microsoft support for details<ept id=\"p1\">](../lifecycle-services/lcs-support.md)</ept>.","source":"If you want to perform this activity for Retail, contact [Microsoft support for details](../lifecycle-services/lcs-support.md)."},{"pos":[2034,2047],"content":"Prerequisites","linkify":"Prerequisites","nodes":[{"content":"Prerequisites","pos":[0,13]}]},{"content":"The following prerequisites are required before you can move a database.","pos":[2048,2120]},{"content":"Only a database to which the customer has SQL access to can be copied.","pos":[2126,2196]},{"content":"If you must copy the production environment then first copy the production environment to the sandbox environment, and work from the sandbox environment.","pos":[2197,2350]},{"content":"The destination SQL Server environment must be running SQL Server 2016 RTM (13.00.1601.5) or higher.","pos":[2355,2455]},{"content":"The CTP versions of SQL Server 2016 may cause errors during the import process.","pos":[2456,2535]},{"content":"To export a database from a sandbox environment you must install the <bpt id=\"p1\">[</bpt>latest SQL Server Management Studio<ept id=\"p1\">](https://msdn.microsoft.com/en-us/library/mt238290.aspx)</ept> to the AOS machine in that environment and perform the bacpac export on that AOS machine.","pos":[2540,2792],"source":"To export a database from a sandbox environment you must install the [latest SQL Server Management Studio](https://msdn.microsoft.com/en-us/library/mt238290.aspx) to the AOS machine in that environment and perform the bacpac export on that AOS machine."},{"content":"This is for two reasons.","pos":[2793,2817]},{"content":"First, there is an IP access restriction on the sandbox SQL Server instance, which only allows a connection from a machine within that environment.","pos":[2818,2965]},{"content":"Second, the version of SQL Server Management Studio installed by default is for a previous version of SQL Server and can't complete the tasks required.","pos":[2966,3117]},{"pos":[3122,3138],"content":"Before you begin","linkify":"Before you begin","nodes":[{"content":"Before you begin","pos":[0,16]}]},{"content":"Encrypted and environment-specific values can't be imported into a new environment.","pos":[3139,3222]},{"content":"After you've completed the import, you must re-enter some data from your source environment in your target environment.","pos":[3223,3342]},{"pos":[3348,3387],"content":"Document the values of encrypted fields","linkify":"Document the values of encrypted fields","nodes":[{"content":"Document the values of encrypted fields","pos":[0,39]}]},{"content":"Because of a technical limitation that is related to the certificate that is used for data encryption, values that are stored in encrypted fields in a database will be unreadable after that database is imported into a new environment.","pos":[3389,3623]},{"content":"Therefore, after an import, you must manually delete and re-enter values that are stored in encrypted fields.","pos":[3624,3733]},{"content":"New values that are entered in encrypted fields after an import will be readable.","pos":[3734,3815]},{"content":"The following fields are affected.","pos":[3816,3850]},{"content":"(The field names are given in <bpt id=\"p1\">*</bpt>Table<ept id=\"p1\">*</ept>.<bpt id=\"p2\">*</bpt>Field<ept id=\"p2\">*</ept> format.)","pos":[3851,3905],"source":" (The field names are given in *Table*.*Field* format.)"},{"pos":[4385,4405],"content":"<bpt id=\"p1\">**</bpt>Table.field name<ept id=\"p1\">**</ept>","source":"**Table.field name**"},{"pos":[4444,4470],"content":"<bpt id=\"p1\">**</bpt>Where to set the value<ept id=\"p1\">**</ept>","source":"**Where to set the value**"},{"content":"CreditCardAccountSetup.SecureMerchantProperties","pos":[4623,4670]},{"pos":[4682,4762],"content":"Click <bpt id=\"p1\">**</bpt>Accounts receivable<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Payments setup<ept id=\"p2\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>Payment services<ept id=\"p3\">**</ept>.","source":"Click **Accounts receivable** &gt; **Payments setup** &gt; **Payment services**."},{"content":"ExchangeRateProviderConfigurationDetails.Value","pos":[4861,4907]},{"pos":[4920,5008],"content":"Click <bpt id=\"p1\">**</bpt>General ledger<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Currencies<ept id=\"p2\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>Configure exchange rate providers<ept id=\"p3\">**</ept>.","source":"Click **General ledger** &gt; **Currencies** &gt; **Configure exchange rate providers**."},{"content":"FiscalEstablishment<ph id=\"ph1\">\\_</ph>BR.ConsumerEFDocCsc","pos":[5099,5139],"source":"FiscalEstablishment\\_BR.ConsumerEFDocCsc"},{"pos":[5158,5258],"content":"Click <bpt id=\"p1\">**</bpt>Organization administration<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Fiscal establishments<ept id=\"p2\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>Fiscal establishments<ept id=\"p3\">**</ept>.","source":"Click **Organization administration** &gt; **Fiscal establishments** &gt; **Fiscal establishments**."},{"content":"FiscalEstablishmentStaging.CSC","pos":[5337,5367]},{"content":"This field is used by the Data Import/Export Framework","pos":[5396,5450]},{"content":"HcmPersonIdentificationNumber.PersonIdentificationNumber","pos":[5575,5631]},{"content":"Click <bpt id=\"p1\">**</bpt>Human resources<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Workers<ept id=\"p2\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>Workers<ept id=\"p3\">**</ept>.","pos":[5634,5694],"source":"Click **Human resources** &gt; **Workers** &gt; **Workers**."},{"content":"On the <bpt id=\"p1\">**</bpt>Worker<ept id=\"p1\">**</ept> tab, in the <bpt id=\"p2\">**</bpt>Personal information<ept id=\"p2\">**</ept> group, click <bpt id=\"p3\">**</bpt>Identification numbers<ept id=\"p3\">**</ept>.","pos":[5695,5790],"source":" On the **Worker** tab, in the **Personal information** group, click **Identification numbers**."},{"content":"HcmWorkerActionHire.PersonIdentificationNumber","pos":[5813,5859]},{"content":"This field has been obsolete since the February 2016 release.","pos":[5872,5933]},{"content":"It was previously in the <bpt id=\"p1\">**</bpt>Human resources<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Workers<ept id=\"p2\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>Actions<ept id=\"p3\">**</ept> <ph id=\"ph3\">&amp;gt;</ph> <bpt id=\"p4\">**</bpt>All worker actions<ept id=\"p4\">**</ept> form.","pos":[5934,6046],"source":" It was previously in the **Human resources** &gt; **Workers** &gt; **Actions** &gt; **All worker actions** form."},{"content":"SysEmailSMPTPassword.Password","pos":[6051,6080]},{"pos":[6110,6183],"content":"Click <bpt id=\"p1\">**</bpt>System administration<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Email<ept id=\"p2\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>Email parameters<ept id=\"p3\">**</ept>.","source":"Click **System administration** &gt; **Email** &gt; **Email parameters**."},{"content":"SysOAuthUserTokens.EncryptedAccessToken","pos":[6289,6328]},{"content":"This field is used internally by the AOS.","pos":[6348,6389]},{"content":"It can be ignored.","pos":[6390,6408]},{"content":"SysOAuthUserTokens.EncryptedRefr eshToken","pos":[6527,6568]},{"content":"This field is used internally by the AOS.","pos":[6586,6627]},{"content":"It can be ignored.","pos":[6628,6646]},{"pos":[6771,6858],"content":"If you're running Retail components, document encrypted and environment-specific values","linkify":"If you're running Retail components, document encrypted and environment-specific values","nodes":[{"content":"If you're running Retail components, document encrypted and environment-specific values","pos":[0,87]}]},{"content":"The values in the following forms are either environment-specific or encrypted in the database.","pos":[6860,6955]},{"content":"Therefore, all the imported values will be incorrect.","pos":[6956,7009]},{"content":"Accounts receivable <ph id=\"ph1\">&amp;gt;</ph> Payments setup <ph id=\"ph2\">&amp;gt;</ph> Payments services","pos":[7015,7077],"source":"Accounts receivable &gt; Payments setup &gt; Payments services"},{"content":"Retail and commerce <ph id=\"ph1\">&amp;gt;</ph> Channel setup <ph id=\"ph2\">&amp;gt;</ph> POS setup <ph id=\"ph3\">&amp;gt;</ph> POS profiles <ph id=\"ph4\">&amp;gt;</ph> Hardware profiles","pos":[7082,7176],"source":"Retail and commerce &gt; Channel setup &gt; POS setup &gt; POS profiles &gt; Hardware profiles"},{"pos":[7181,7205],"content":"Copy the source database","linkify":"Copy the source database","nodes":[{"content":"Copy the source database","pos":[0,24]}]},{"content":"Because you will need to disable change tracking and delete the users from the database before you can export, you should create a copy of the source Azure SQL database that you will export.","pos":[7206,7396]},{"content":"Then, you can work with a copy instead of deleting information from the original database.","pos":[7397,7487]},{"content":"The following SQL statement will create a copy of the database <bpt id=\"p1\">**</bpt>axdb<ph id=\"ph1\">\\_</ph>mySourceDatabaseToCopy<ept id=\"p1\">**</ept> called <bpt id=\"p2\">**</bpt>MyNewCopy<ept id=\"p2\">**</ept>.","pos":[7488,7605],"source":" The following SQL statement will create a copy of the database **axdb\\_mySourceDatabaseToCopy** called **MyNewCopy**."},{"content":"Edit this script with your own database names.","pos":[7606,7652]},{"content":"Note that this command will execute asynchronously, meaning that it will appear to complete after 1 minute, but actually it is running in the background.","pos":[7724,7877]},{"content":"For more information, refer to <bpt id=\"p1\">[</bpt>CREATE DATABASE (Azure SQL Database)<ept id=\"p1\">](https://msdn.microsoft.com/en-us/library/dn268335.aspx)</ept>.","pos":[7878,8004],"source":" For more information, refer to [CREATE DATABASE (Azure SQL Database)](https://msdn.microsoft.com/en-us/library/dn268335.aspx)."},{"content":"To monitor the progress of the copy operation, execute the following query against the MASTER database within the same instance.","pos":[8005,8133]},{"pos":[8180,8207],"content":"Prepare the copied database","linkify":"Prepare the copied database","nodes":[{"content":"Prepare the copied database","pos":[0,27]}]},{"content":"Run the following script against the copied database to remove change tracking, SQL Database users, and a system view.","pos":[8208,8326]},{"content":"The script will also correct system flags, remove references to the previous environment, withhold batches, and remove email configuration.","pos":[8327,8466]},{"content":"These changes are all required to successfully export and import the database and to ensure that when the AOS is started in the target environment, nothing will automatically start running.","pos":[8467,8656]},{"content":"<bpt id=\"p1\">**</bpt>Note:<ept id=\"p1\">**</ept> You must update the following ALTER DATABASE command with your database copy name.","pos":[8657,8749],"source":"**Note:** You must update the following ALTER DATABASE command with your database copy name."},{"pos":[11314,11333],"content":"Export the database","linkify":"Export the database","nodes":[{"content":"Export the database","pos":[0,19]}]},{"content":"Open a command prompt as an Administrator, and then execute the following commands.","pos":[11334,11417]},{"content":"The following list provides an explanation of the parameters:","pos":[11709,11770]},{"content":"ssn (source server name): The name of the SQL Azure server from which you will export.","pos":[11776,11862]},{"content":"sdn (source database name): The name of the database that you will export.","pos":[11867,11941]},{"content":"tf (target file): The path and file name that you will export to.","pos":[11946,12011]},{"content":"sp (source password): The SQL password for source SQL Server.","pos":[12016,12077]},{"content":"su (source user): The SQL user name for the source SQL Server.","pos":[12082,12144]},{"content":"We recommend that you use the <bpt id=\"p1\">**</bpt>sqladmin<ept id=\"p1\">**</ept> user, which the deployment will have created on every Dynamics SQL instance.","pos":[12145,12264],"source":" We recommend that you use the **sqladmin** user, which the deployment will have created on every Dynamics SQL instance."},{"content":"You can retrieve the password for this user from your Lifecycle Services (LCS) project.","pos":[12265,12352]},{"content":"After the export completes, delete the copied database.","pos":[12354,12409]},{"pos":[12445,12464],"content":"Import the database","linkify":"Import the database","nodes":[{"content":"Import the database","pos":[0,19]}]},{"content":"When you import the database, we recommend that you:","pos":[12465,12517]},{"content":"Retain a copy of the existing AxDB database, to allow you to revert to it later if needed.","pos":[12523,12613]},{"content":"Import the new database with a new name, for example AxDB<ph id=\"ph1\">\\_</ph>fromProd.","pos":[12618,12686],"source":"Import the new database with a new name, for example AxDB\\_fromProd."},{"content":"Copy the <ph id=\"ph1\">\\*</ph>.bacpac file to the local machine from which you will import to ensure the best performane.","pos":[12688,12790],"source":"Copy the \\*.bacpac file to the local machine from which you will import to ensure the best performane."},{"content":"Open a command prompt as Administrator and run the following commands.","pos":[12791,12861]},{"content":"The following list provides an explanation of the parameters:","pos":[13055,13116]},{"content":"tsn (target server name): The name of the SQL Server that you will import to.","pos":[13122,13199]},{"content":"tdn (target database name): The name of the database that you will import to.","pos":[13204,13281]},{"content":"The database should <bpt id=\"p1\">**</bpt>not<ept id=\"p1\">**</ept> already exist.","pos":[13282,13324],"source":" The database should **not** already exist."},{"content":"sf (source file) The path and file name to import from.","pos":[13329,13384]},{"pos":[13386,13546],"content":"<bpt id=\"p1\">**</bpt>Note:<ept id=\"p1\">**</ept> During import, the user name and password are not required because SQL Server will default to Windows authentication for the currently logged on user.","source":"**Note:** During import, the user name and password are not required because SQL Server will default to Windows authentication for the currently logged on user."},{"pos":[13551,13570],"content":"Update the database","linkify":"Update the database","nodes":[{"content":"Update the database","pos":[0,19]}]},{"content":"Execute the following SQL script against the imported database.","pos":[13571,13634]},{"content":"This will add back the users that were deleted from the source database earlier, correctly linking them to the SQL logins for this SQL instance.","pos":[13635,13779]},{"pos":[14667,14705],"content":"Reset the Financial Reporting database","linkify":"Reset the Financial Reporting database","nodes":[{"content":"Reset the Financial Reporting database","pos":[0,38]}]},{"pos":[14707,14973],"content":"If using Financial Reporting (formerly Management Reporter) then follow the steps to reset the financial reporting database in <bpt id=\"p1\">[</bpt>Resetting the financial reporting data mart after restoring a database<ept id=\"p1\">](../analytics/reset-financial-reporting-datamart-after-restore.md)</ept>.","source":"If using Financial Reporting (formerly Management Reporter) then follow the steps to reset the financial reporting database in [Resetting the financial reporting data mart after restoring a database](../analytics/reset-financial-reporting-datamart-after-restore.md)."},{"pos":[14978,15006],"content":"Start using the new database","linkify":"Start using the new database","nodes":[{"content":"Start using the new database","pos":[0,28]}]},{"content":"To switch the environment and use the new database, stop the services in the following list, rename the AxDB database to AxDB<ph id=\"ph1\">\\_</ph>orig, and then rename your newly imported database AxDB.","pos":[15007,15190],"source":"To switch the environment and use the new database, stop the services in the following list, rename the AxDB database to AxDB\\_orig, and then rename your newly imported database AxDB."},{"content":"Restart the services in the following list:","pos":[15191,15234]},{"content":"World wide web publishing service","pos":[15240,15273]},{"content":"Dynamics 365 for Operations Batch Management service","pos":[15278,15330]},{"content":"Management Reporter 2012 Process service","pos":[15335,15375]},{"content":"To switch back to the original database, reverse the step above.","pos":[15377,15441]},{"content":"Stop the services, rename the databases, and then start the services.","pos":[15442,15511]},{"pos":[15516,15598],"content":"Reenter data from encrypted and environment specific fields in the target database","linkify":"Reenter data from encrypted and environment specific fields in the target database","nodes":[{"content":"Reenter data from encrypted and environment specific fields in the target database","pos":[0,82]}]},{"content":"In the Dynamics 365 for Operations client, enter the values that you documented for the encrypted and environment-specific fields.","pos":[15599,15729]},{"content":"The following fields are affected.","pos":[15730,15764]},{"content":"(The field names are given in <bpt id=\"p1\">*</bpt>Table<ept id=\"p1\">*</ept>.<bpt id=\"p2\">*</bpt>Field<ept id=\"p2\">*</ept> format.)","pos":[15765,15819],"source":" (The field names are given in *Table*.*Field* format.)"},{"pos":[16299,16319],"content":"<bpt id=\"p1\">**</bpt>Table.field name<ept id=\"p1\">**</ept>","source":"**Table.field name**"},{"pos":[16358,16384],"content":"<bpt id=\"p1\">**</bpt>Where to set the value<ept id=\"p1\">**</ept>","source":"**Where to set the value**"},{"content":"CreditCardAccountSetup.SecureMerchantProperties","pos":[16537,16584]},{"pos":[16596,16676],"content":"Click <bpt id=\"p1\">**</bpt>Accounts receivable<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Payments setup<ept id=\"p2\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>Payment services<ept id=\"p3\">**</ept>.","source":"Click **Accounts receivable** &gt; **Payments setup** &gt; **Payment services**."},{"content":"ExchangeRateProviderConfigurationDetails.Value","pos":[16775,16821]},{"pos":[16834,16922],"content":"Click <bpt id=\"p1\">**</bpt>General ledger<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Currencies<ept id=\"p2\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>Configure exchange rate providers<ept id=\"p3\">**</ept>.","source":"Click **General ledger** &gt; **Currencies** &gt; **Configure exchange rate providers**."},{"content":"FiscalEstablishment<ph id=\"ph1\">\\_</ph>BR.ConsumerEFDocCsc","pos":[17013,17053],"source":"FiscalEstablishment\\_BR.ConsumerEFDocCsc"},{"pos":[17072,17172],"content":"Click <bpt id=\"p1\">**</bpt>Organization administration<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Fiscal establishments<ept id=\"p2\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>Fiscal establishments<ept id=\"p3\">**</ept>.","source":"Click **Organization administration** &gt; **Fiscal establishments** &gt; **Fiscal establishments**."},{"content":"FiscalEstablishmentStaging.CSC","pos":[17251,17281]},{"content":"This field is used by the Data Import/Export Framework","pos":[17310,17364]},{"content":"HcmPersonIdentificationNumber.PersonIdentificationNumber","pos":[17489,17545]},{"content":"Click <bpt id=\"p1\">**</bpt>Human resources<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Workers<ept id=\"p2\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>Workers<ept id=\"p3\">**</ept>.","pos":[17548,17608],"source":"Click **Human resources** &gt; **Workers** &gt; **Workers**."},{"content":"On the <bpt id=\"p1\">**</bpt>Worker<ept id=\"p1\">**</ept> tab, in the <bpt id=\"p2\">**</bpt>Personal information<ept id=\"p2\">**</ept> group, click <bpt id=\"p3\">**</bpt>Identification numbers<ept id=\"p3\">**</ept>.","pos":[17609,17704],"source":" On the **Worker** tab, in the **Personal information** group, click **Identification numbers**."},{"content":"HcmWorkerActionHire.PersonIdentificationNumber","pos":[17727,17773]},{"content":"This field has been obsolete since the February 2016 release.","pos":[17786,17847]},{"content":"It was previously in the <bpt id=\"p1\">**</bpt>Human resources<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Workers<ept id=\"p2\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>Actions<ept id=\"p3\">**</ept> <ph id=\"ph3\">&amp;gt;</ph> <bpt id=\"p4\">**</bpt>All worker actions<ept id=\"p4\">**</ept> form.","pos":[17848,17960],"source":" It was previously in the **Human resources** &gt; **Workers** &gt; **Actions** &gt; **All worker actions** form."},{"content":"SysEmailSMPTPassword.Password","pos":[17965,17994]},{"pos":[18024,18097],"content":"Click <bpt id=\"p1\">**</bpt>System administration<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Email<ept id=\"p2\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>Email parameters<ept id=\"p3\">**</ept>.","source":"Click **System administration** &gt; **Email** &gt; **Email parameters**."},{"content":"SysOAuthUserTokens.EncryptedAccessToken","pos":[18203,18242]},{"content":"This field is used internally by the AOS.","pos":[18262,18303]},{"content":"It can be ignored.","pos":[18304,18322]},{"content":"SysOAuthUserTokens.EncryptedRefr eshToken","pos":[18441,18482]},{"content":"This field is used internally by the AOS.","pos":[18500,18541]},{"content":"It can be ignored.","pos":[18542,18560]},{"pos":[18681,18693],"content":"Known issues","linkify":"Known issues","nodes":[{"content":"Known issues","pos":[0,12]}]},{"pos":[18698,18734],"content":"Cannot drop users in source database","linkify":"Cannot drop users in source database","nodes":[{"content":"Cannot drop users in source database","pos":[0,36]}]},{"content":"When dropping users in the source database, the user <bpt id=\"p1\">**</bpt>axdbadmin<ept id=\"p1\">**</ept> or <bpt id=\"p2\">**</bpt>axdeployuser<ept id=\"p2\">**</ept> may fail to delete as they are currently owner of the full-text catalog.","pos":[18736,18895],"source":"When dropping users in the source database, the user **axdbadmin** or **axdeployuser** may fail to delete as they are currently owner of the full-text catalog."},{"content":"This occurs if the database was originally created in CTP7 or CTP8.","pos":[18896,18963]},{"content":"To resolve this, change the owner to the dbo user using the transact-SQL command <bpt id=\"p1\">[</bpt>ALTER AUTHORIZATION<ept id=\"p1\">](https://msdn.microsoft.com/en-us/library/ms187359.aspx)</ept>.","pos":[18964,19123],"source":" To resolve this, change the owner to the dbo user using the transact-SQL command [ALTER AUTHORIZATION](https://msdn.microsoft.com/en-us/library/ms187359.aspx)."},{"pos":[19187,19249],"content":"Can't download SQL Server Management Studio installation files","linkify":"Can't download SQL Server Management Studio installation files","nodes":[{"content":"Can't download SQL Server Management Studio installation files","pos":[0,62]}]},{"content":"When you attempt to download the SQL Management Studio install, you might receive the following error.","pos":[19251,19353]},{"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>SecuritySettingsCannotDownload<ept id=\"p1\">](./media/securitysettingscannotdownload.png)](./media/securitysettingscannotdownload.png)</ept>         To work around this issue, enable file download for the <bpt id=\"p2\">**</bpt>Internet Zone<ept id=\"p2\">**</ept>, on the <bpt id=\"p3\">**</bpt>Security<ept id=\"p3\">**</ept> tab in <bpt id=\"p4\">**</bpt>Internet Options<ept id=\"p4\">**</ept> as shown below.","pos":[19354,19624],"source":"[![SecuritySettingsCannotDownload](./media/securitysettingscannotdownload.png)](./media/securitysettingscannotdownload.png)         To work around this issue, enable file download for the **Internet Zone**, on the **Security** tab in **Internet Options** as shown below."},{"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>SecuritySettingsFix<ept id=\"p1\">](./media/securitysettingsfix.png)](./media/securitysettingsfix.png)</ept>","pos":[19625,19715],"source":"[![SecuritySettingsFix](./media/securitysettingsfix.png)](./media/securitysettingsfix.png)"},{"pos":[19721,19751],"content":"Database synchronization fails","linkify":"Database synchronization fails","nodes":[{"content":"Database synchronization fails","pos":[0,30]}]},{"content":"When you synchronize the database against the newly imported database from Visual Studio, the synchronization might fail with the following error:","pos":[19753,19899]},{"pos":[19902,19973],"content":"<bpt id=\"p1\">*</bpt>\"Failed to open SQL connection<ept id=\"p1\">*</ept> <bpt id=\"p2\">*</bpt>syncengine.exe exited with code -1.\"<ept id=\"p2\">*</ept>","source":"*\"Failed to open SQL connection* *syncengine.exe exited with code -1.\"*"},{"content":"Also, in the Windows application log, you will find this message logged under event ID 140:","pos":[19976,20067]},{"pos":[20071,20373],"content":"<bpt id=\"p1\">*</bpt>Object Server Database Synchronizer:<ept id=\"p1\">*</ept> <bpt id=\"p2\">*</bpt>The internal system table version number stored in the database is higher than the version supported by the kernel (141/138). Use a newer Microsoft Dynamics kernel, or start Microsoft Dynamics using the -REPAIR command line parameter to enforce synchronization.<ept id=\"p2\">*</ept>","source":"*Object Server Database Synchronizer:* *The internal system table version number stored in the database is higher than the version supported by the kernel (141/138). Use a newer Microsoft Dynamics kernel, or start Microsoft Dynamics using the -REPAIR command line parameter to enforce synchronization.*"},{"content":"This can occur when the platform build number of the current environment is lower than the platform build number of the source environment.","pos":[20376,20515]},{"content":"Depending on your circumstances, either upgrade the current environmentâ€™s platform to match the source environment, by using the <bpt id=\"p1\">**</bpt>Updates<ept id=\"p1\">**</ept> tiles on the LCS <bpt id=\"p2\">**</bpt>Environment<ept id=\"p2\">**</ept> page, or adjust the expected version in the database by using the following query.","pos":[20516,20772],"source":" Depending on your circumstances, either upgrade the current environmentâ€™s platform to match the source environment, by using the **Updates** tiles on the LCS **Environment** page, or adjust the expected version in the database by using the following query."},{"pos":[20860,20993],"content":"<bpt id=\"p1\">**</bpt>Note:<ept id=\"p1\">**</ept> The value 138 in the query above is taken from the event log message that was expecting 138 in this particular environment.","source":"**Note:** The value 138 in the query above is taken from the event log message that was expecting 138 in this particular environment."},{"pos":[20999,21010],"content":"Performance","linkify":"Performance","nodes":[{"content":"Performance","pos":[0,11]}]},{"content":"Refer to the following guidelines for optimal performance:","pos":[21012,21070]},{"content":"Always export a database from a virtual machine that is located in the same Azure data center as the Azure SQL database.","pos":[21076,21196]},{"content":"If you are exporting a copy of your sandbox database, export it from the Sandbox AOS machine.","pos":[21197,21290]},{"content":"Always import the .bacpac locally on the machine that is running the SQL Server instance.","pos":[21295,21384]},{"content":"Do not import from SQL Server Management Studio on a remote machine.","pos":[21385,21453]},{"content":"On a Dynamics 365 for Operations one-box environment, also known as a tier 1 environment, which is hosted in Azure, place the bacpac file on the D: drive when importing for increased performance.","pos":[21458,21653]},{"content":"Read more about the temporary drive in Azure machines in the blog post <bpt id=\"p1\">[</bpt>Understanding the temporary drive on Windows Azure Virtual Machines<ept id=\"p1\">](https://blogs.msdn.microsoft.com/mast/2013/12/06/understanding-the-temporary-drive-on-windows-azure-virtual-machines/)</ept>.","pos":[21654,21914],"source":" Read more about the temporary drive in Azure machines in the blog post [Understanding the temporary drive on Windows Azure Virtual Machines](https://blogs.msdn.microsoft.com/mast/2013/12/06/understanding-the-temporary-drive-on-windows-azure-virtual-machines/)."},{"content":"Grant the account running the SQL Server Windows service the <bpt id=\"p1\">[</bpt>Instance File Initialization<ept id=\"p1\">](https://msdn.microsoft.com/en-us/library/ms175935.aspx)</ept> rights.","pos":[21919,22074],"source":"Grant the account running the SQL Server Windows service the [Instance File Initialization](https://msdn.microsoft.com/en-us/library/ms175935.aspx) rights."},{"content":"This can speed up the import process and improve the speed of restore from a <ph id=\"ph1\">\\*</ph>.bak file.","pos":[22075,22164],"source":" This can speed up the import process and improve the speed of restore from a \\*.bak file."},{"content":"A simple way to do this in a Developer environment is to set SQL Server to run as the axlocaladmin account.","pos":[22165,22272]},{"content":"From SQL Azure, do not select Export data tier application in SQL Server Management Studio because there can be a memory limitation for larger databases.","pos":[22277,22430]}]}