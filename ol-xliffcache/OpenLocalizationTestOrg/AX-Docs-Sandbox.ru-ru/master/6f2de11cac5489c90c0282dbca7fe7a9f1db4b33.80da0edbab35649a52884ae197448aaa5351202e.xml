{"nodes":[{"pos":[32,102],"content":"Migrate an upgraded Dynamics AX 2012 R3 sales cube to the entity store","needQuote":true,"needEscape":true,"nodes":[{"content":"Migrate an upgraded Dynamics AX 2012 R3 sales cube to the entity store","pos":[0,70]}]},{"pos":[116,346],"content":"In this tutorial, you'll migrate an upgraded Microsoft Dynamics AX 2012 R3 cube schema to the entity store in Microsoft Dynamics 365 for Operations. You'll use the sales cube that was included in Dynamics AX 2012 R3 as an example.","needQuote":true,"needEscape":true,"nodes":[{"content":"In this tutorial, you'll migrate an upgraded Microsoft Dynamics AX 2012 R3 cube schema to the entity store in Microsoft Dynamics 365 for Operations. You'll use the sales cube that was included in Dynamics AX 2012 R3 as an example.","pos":[0,230],"nodes":[{"content":"In this tutorial, you'll migrate an upgraded Microsoft Dynamics AX 2012 R3 cube schema to the entity store in Microsoft Dynamics 365 for Operations.","pos":[0,148]},{"content":"You'll use the sales cube that was included in Dynamics AX 2012 R3 as an example.","pos":[149,230]}]}]},{"pos":[876,946],"content":"Migrate an upgraded Dynamics AX 2012 R3 sales cube to the entity store","linkify":"Migrate an upgraded Dynamics AX 2012 R3 sales cube to the entity store","nodes":[{"content":"Migrate an upgraded Dynamics AX 2012 R3 sales cube to the entity store","pos":[0,70]}]},{"content":"In this tutorial, you'll migrate an upgraded Microsoft Dynamics AX 2012 R3 cube schema to the entity store in Microsoft Dynamics 365 for Operations.","pos":[948,1096]},{"content":"You'll use the sales cube that was included in Dynamics AX 2012 R3 as an example.","pos":[1097,1178]},{"content":"The entity store will support near real-time Microsoft Power BI integration scenarios, as shown in the following diagram.","pos":[1180,1301]},{"content":"For an overview of Power BI integration with entity store, see <bpt id=\"p1\">[</bpt>Power BI integration with entity store<ept id=\"p1\">](https://blogs.msdn.microsoft.com/dynamicsaxbi/2016/06/09/power-bi-integration-with-entity-store-in-dynamics-ax-7-may-update/)</ept>.","pos":[1302,1532],"source":" For an overview of Power BI integration with entity store, see [Power BI integration with entity store](https://blogs.msdn.microsoft.com/dynamicsaxbi/2016/06/09/power-bi-integration-with-entity-store-in-dynamics-ax-7-may-update/)."},{"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>Power BI Architecture diagram<ept id=\"p1\">](./media/powerbiarchitecture.png)](./media/powerbiarchitecture.png)</ept>","pos":[1533,1633],"source":"[![Power BI Architecture diagram](./media/powerbiarchitecture.png)](./media/powerbiarchitecture.png)"},{"pos":[1638,1710],"content":"New Power BI features included in the May 2016 and November 2016 updates","linkify":"New Power BI features included in the May 2016 and November 2016 updates","nodes":[{"content":"New Power BI features included in the May 2016 and November 2016 updates","pos":[0,72]}]},{"content":"This tutorial requires the Dynamics 365 for Operations May 2016 update or later.","pos":[1711,1791]},{"content":"You will use the following new capabilities in this tutorial:","pos":[1792,1853]},{"content":"Stage an aggregate measurement in the entity store and refresh the data from Dynamics AX.","pos":[1859,1948]},{"content":"You might prefer this option over in-memory real time aggregate measurements when:","pos":[1949,2031]},{"content":"You upgrade a Dynamics AX 2012 cube.","pos":[2040,2076]},{"content":"Your aggregate measurements are very large.","pos":[2085,2128]},{"content":"Data freshness (latency) from a few minutes up to a few hours is acceptable for reporting.","pos":[2137,2227]},{"content":"Use the batch framework to schedule a recurring refresh.","pos":[2232,2288]},{"content":"For this release, only a full refresh is enabled.","pos":[2289,2338]},{"content":"Create reports using Power BI desktop in a developer/test environment.","pos":[2343,2413]},{"content":"Leverage the direct query option when creating Power BI content.","pos":[2418,2482]},{"content":"For example, you can create larger models without relying on OData as the data refresh mechanism.","pos":[2483,2580]},{"content":"Migrate reports from your development environment to a production environment using Lifecycle Services (LCS).","pos":[2585,2694]},{"content":"As a partner or an ISV you can distribute Power BI content as part of an LCS solution to your customers.","pos":[2699,2803]},{"pos":[2808,3005],"content":"<bpt id=\"p1\">**</bpt>If you're using the November update (platform release 1611)<ept id=\"p1\">**</ept> or later, some steps in this document are part of the process to refresh the entity store - you do not need to perform them manually.","source":"**If you're using the November update (platform release 1611)** or later, some steps in this document are part of the process to refresh the entity store - you do not need to perform them manually."},{"pos":[3010,3058],"content":"Change upgraded aggregate measurement properties","linkify":"Change upgraded aggregate measurement properties","nodes":[{"content":"Change upgraded aggregate measurement properties","pos":[0,48]}]},{"content":"As part of the code upgrade process, analysis services projects from the Application Object Tree (AOT) in Dynamics AX 2012 can be migrated to the new aggregate measurements metadata format.","pos":[3059,3248]},{"content":"Launch Visual Studio and create a new project in Application Suite.","pos":[3254,3321]},{"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>: You can create a model and include the customized aggregate measurement within that model.","pos":[3322,3422],"source":"**Note**: You can create a model and include the customized aggregate measurement within that model."},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Customization: Overlayering and extensions<ept id=\"p1\">](..\\extensibility\\customization-overlayering-extensions.md)</ept>.","pos":[3423,3553],"source":" For more information, see [Customization: Overlayering and extensions](..\\extensibility\\customization-overlayering-extensions.md)."},{"content":"Open Application Explorer.","pos":[3558,3584]},{"content":"Navigate to <bpt id=\"p1\">**</bpt>Analytics<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Perspectives<ept id=\"p2\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>Aggregate measurements<ept id=\"p3\">**</ept>.","pos":[3585,3665],"source":" Navigate to **Analytics** &gt; **Perspectives** &gt; **Aggregate measurements**."},{"content":"You will notice a set of aggregate measurements that were upgraded from Dynamics AX 2012 R3, as well as the measurements that ship in the current version of Dynamics 365 for Operations.","pos":[3666,3851]},{"content":"Select <bpt id=\"p1\">**</bpt>SalesCube<ept id=\"p1\">**</ept>.","pos":[3856,3877],"source":"Select **SalesCube**."},{"content":"Right-click and select <bpt id=\"p1\">**</bpt>Duplicate in project<ept id=\"p1\">**</ept>.","pos":[3878,3926],"source":" Right-click and select **Duplicate in project**."},{"pos":[3931,4017],"content":"An aggregate measurement with the name <bpt id=\"p1\">**</bpt>SalesCubeCopy<ept id=\"p1\">**</ept> will be added to the project.","source":"An aggregate measurement with the name **SalesCubeCopy** will be added to the project."},{"content":"Rename this measurement.","pos":[4022,4046]},{"content":"Select <bpt id=\"p1\">**</bpt>SalesCubeCopy<ept id=\"p1\">**</ept> in Solution Explorer.","pos":[4047,4093],"source":" Select **SalesCubeCopy** in Solution Explorer."},{"content":"Right-click and select <bpt id=\"p1\">**</bpt>Rename<ept id=\"p1\">**</ept>.","pos":[4094,4128],"source":" Right-click and select **Rename**."},{"content":"Enter <bpt id=\"p1\">**</bpt>SalesCubeV2<ept id=\"p1\">**</ept> as the new name.","pos":[4129,4167],"source":" Enter **SalesCubeV2** as the new name."},{"content":"Double-click <bpt id=\"p1\">**</bpt>SalesCubeV2<ept id=\"p1\">**</ept> to launch the Aggregate measurement designer.","pos":[4172,4246],"source":"Double-click **SalesCubeV2** to launch the Aggregate measurement designer."},{"content":"Notice the structure of the aggregate measurement that was migrated from Dynamics AX 2012.","pos":[4247,4337]},{"content":"The Sales cube in Dynamics AX 2012 encompassed a broad subject area related to Sales.","pos":[4342,4427]},{"content":"In this case, let’s create a smaller, more focused Power BI model using the metadata that was upgraded.","pos":[4428,4531]},{"content":"Expand the <bpt id=\"p1\">**</bpt>Sales Order Lines<ept id=\"p1\">**</ept> measure group and review the list of measures and dimension references.","pos":[4532,4636],"source":" Expand the **Sales Order Lines** measure group and review the list of measures and dimension references."},{"content":"<bpt id=\"p1\">**</bpt>Note:<ept id=\"p1\">**</ept> Leveraging the modeling capabilities you can quickly make a few enhancements to this model.","pos":[4637,4738],"source":"**Note:** Leveraging the modeling capabilities you can quickly make a few enhancements to this model."},{"content":"Suggestions for improvements:","pos":[4739,4768]},{"content":"Replace views/tables that have been used to model the measure group (and/or dimensions) with an entity.","pos":[4777,4880]},{"content":"You can model an entity using the underlying view and replace the view with the corresponding entity.","pos":[4881,4982]},{"content":"This will enable you to leverage upcoming features such as incremental refresh and security.","pos":[4983,5075]},{"content":"Remove unwanted dimension references by adding the corresponding field to the attributes node.","pos":[5084,5178]},{"content":"For example, the Sizes dimension reference can be removed because the <bpt id=\"p1\">**</bpt>Size<ept id=\"p1\">**</ept> field in the measure group is sufficiently descriptive.","pos":[5179,5313],"source":" For example, the Sizes dimension reference can be removed because the **Size** field in the measure group is sufficiently descriptive."},{"content":"This will improve the runtime performance of queries as well as refresh times.","pos":[5314,5392]},{"content":"Select the <bpt id=\"p1\">**</bpt>SalesCubeV2<ept id=\"p1\">**</ept> root node in the Aggregate measurement designer.","pos":[5398,5473],"source":"Select the **SalesCubeV2** root node in the Aggregate measurement designer."},{"content":"Right-click and select <bpt id=\"p1\">**</bpt>Properties<ept id=\"p1\">**</ept>.","pos":[5474,5512],"source":" Right-click and select **Properties**."},{"content":"During upgrade, aggregate measurements are set to the legacy property flag, <bpt id=\"p1\">**</bpt>SSASCube<ept id=\"p1\">**</ept>.","pos":[5517,5606],"source":"During upgrade, aggregate measurements are set to the legacy property flag, **SSASCube**."},{"content":"You need to change this property to one of two supported usage types.","pos":[5607,5676]},{"content":"Previously, <bpt id=\"p1\">**</bpt>InMemoryRealTime<ept id=\"p1\">**</ept> was supported as usage for aggregate measurements.","pos":[5677,5760],"source":" Previously, **InMemoryRealTime** was supported as usage for aggregate measurements."},{"content":"<bpt id=\"p1\">**</bpt>StagedEntityStore<ept id=\"p1\">**</ept> is supported as a new usage type.","pos":[5761,5816],"source":"**StagedEntityStore** is supported as a new usage type."},{"content":"<bpt id=\"p1\">**</bpt>Note:<ept id=\"p1\">**</ept> Modify the usage property to InMemoryRealTime if you plan to use the Aggregate measurement for embedded BI scenarios as well as Power BI integration.","pos":[5817,5976],"source":"**Note:** Modify the usage property to InMemoryRealTime if you plan to use the Aggregate measurement for embedded BI scenarios as well as Power BI integration."},{"content":"If you are using the Aggregate measurement only for Power BI or Cortana Intelligence Suite integration, select <bpt id=\"p1\">**</bpt>StagedEntityStore<ept id=\"p1\">**</ept>.","pos":[5977,6110],"source":" If you are using the Aggregate measurement only for Power BI or Cortana Intelligence Suite integration, select **StagedEntityStore**."},{"content":"Save the project.","pos":[6115,6132]},{"content":"Right-click the project in Solution Explorer and select <bpt id=\"p1\">**</bpt>Rebuild<ept id=\"p1\">**</ept>.","pos":[6133,6201],"source":" Right-click the project in Solution Explorer and select **Rebuild**."},{"content":"After the rebuild operation is finished, save the project, and then close Visual Studio.","pos":[6206,6294]},{"content":"This completes the development work.","pos":[6295,6331]},{"content":"You will author reports as a report developer or a power user.","pos":[6332,6394]},{"pos":[6399,6423],"content":"Refresh the entity store","linkify":"Refresh the entity store","nodes":[{"content":"Refresh the entity store","pos":[0,24]}]},{"content":"As an administrator you can configure the refresh of the aggregate measurement using the client.","pos":[6424,6520]},{"content":"Launch the Dynamics AX client and navigate to <bpt id=\"p1\">**</bpt>System Administration<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Setup<ept id=\"p2\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>Entity Store<ept id=\"p3\">**</ept>.","pos":[6526,6635],"source":"Launch the Dynamics AX client and navigate to **System Administration** &gt; **Setup** &gt; **Entity Store**."},{"content":"The <bpt id=\"p1\">**</bpt>Entity Store<ept id=\"p1\">**</ept> form shows a list of aggregate measurements that are available for deployment to the entity store.","pos":[6636,6755],"source":" The **Entity Store** form shows a list of aggregate measurements that are available for deployment to the entity store."},{"content":"Notice that <bpt id=\"p1\">**</bpt>Sales Cube<ept id=\"p1\">**</ept> (which was upgraded from Dynamics AX 2012) is not available for deployment to the entity store.","pos":[6760,6882],"source":"Notice that **Sales Cube** (which was upgraded from Dynamics AX 2012) is not available for deployment to the entity store."},{"content":"<bpt id=\"p1\">**</bpt>SalesCubeV2<ept id=\"p1\">**</ept>, which you created in the previous step, can be deployed to the entity store.","pos":[6883,6976],"source":"**SalesCubeV2**, which you created in the previous step, can be deployed to the entity store."},{"content":"Select <bpt id=\"p1\">**</bpt>SalesCubeV2<ept id=\"p1\">**</ept> from the list, and click the <bpt id=\"p2\">**</bpt>Refresh<ept id=\"p2\">**</ept> button.","pos":[6981,7052],"source":"Select **SalesCubeV2** from the list, and click the **Refresh** button."},{"content":"The <bpt id=\"p1\">**</bpt>Refresh<ept id=\"p1\">**</ept> dialog box will display.","pos":[7053,7093],"source":" The **Refresh** dialog box will display."},{"content":"Expand the <bpt id=\"p1\">**</bpt>Run in the background<ept id=\"p1\">**</ept> tab.","pos":[7094,7135],"source":" Expand the **Run in the background** tab."},{"content":"Provide a descriptive name in the <bpt id=\"p1\">**</bpt>Task description<ept id=\"p1\">**</ept> field.","pos":[7140,7201],"source":"Provide a descriptive name in the **Task description** field."},{"content":"Optionally, you can select the <bpt id=\"p1\">**</bpt>Recurrence<ept id=\"p1\">**</ept> tab and create a recurring schedule instead of a one-time refresh.","pos":[7202,7314],"source":" Optionally, you can select the **Recurrence** tab and create a recurring schedule instead of a one-time refresh."},{"content":"Click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept>.","pos":[7315,7328],"source":" Click **OK**."},{"content":"The system will create a batch job for refresh of the aggregate measurement in the entity store.","pos":[7333,7429]},{"pos":[7434,7492],"content":"Authoring a report on Sales by State with Power BI desktop","linkify":"Authoring a report on Sales by State with Power BI desktop","nodes":[{"content":"Authoring a report on Sales by State with Power BI desktop","pos":[0,58]}]},{"pos":[7493,7675],"content":"This step requires that you the install Power BI desktop tool that can be downloaded from <bpt id=\"p1\">[</bpt>Microsoft Power BI Desktop<ept id=\"p1\">](http://www.microsoft.com/en-us/download/details.aspx?id=45331)</ept>.","source":"This step requires that you the install Power BI desktop tool that can be downloaded from [Microsoft Power BI Desktop](http://www.microsoft.com/en-us/download/details.aspx?id=45331)."},{"content":"Launch Power BI desktop.","pos":[7681,7705]},{"content":"You may need to apply updates.","pos":[7706,7736]},{"content":"A welcome page will display.","pos":[7737,7765]},{"content":"Click <bpt id=\"p1\">**</bpt>Get data<ept id=\"p1\">**</ept>.","pos":[7766,7785],"source":" Click **Get data**."},{"pos":[7790,7897],"content":"Alternatively, when Power BI desktop launches, on the <bpt id=\"p1\">**</bpt>Home<ept id=\"p1\">**</ept> tab select <bpt id=\"p2\">**</bpt>Get Data<ept id=\"p2\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>SQL Server<ept id=\"p3\">**</ept>.","source":"Alternatively, when Power BI desktop launches, on the **Home** tab select **Get Data** &gt; **SQL Server**."},{"content":"In the <bpt id=\"p1\">**</bpt>SQL Server Database<ept id=\"p1\">**</ept> dialog box, enter the server name and the name of the entity store database.","pos":[7902,8009],"source":"In the **SQL Server Database** dialog box, enter the server name and the name of the entity store database."},{"content":"If you deployed a developer environment, you can enter “.”","pos":[8010,8068]},{"content":"as the server name and <bpt id=\"p1\">**</bpt>AxDW<ept id=\"p1\">**</ept> as the database name.","pos":[8069,8122],"source":" as the server name and **AxDW** as the database name."},{"content":"If you are working in a test environment, you need to get these parameters from your system administrator","pos":[8123,8228]},{"content":"Select the <bpt id=\"p1\">**</bpt>DirectQuery<ept id=\"p1\">**</ept> option.","pos":[8233,8267],"source":"Select the **DirectQuery** option."},{"content":"In this exercise, you will create Power BI reports that are executed directly on the entity store.","pos":[8268,8366]},{"content":"If you had used the <bpt id=\"p1\">**</bpt>Import<ept id=\"p1\">**</ept> option, Power BI would cache data from the entity store and you would need to periodically refresh the Power BI model.","pos":[8367,8516],"source":" If you had used the **Import** option, Power BI would cache data from the entity store and you would need to periodically refresh the Power BI model."},{"content":"<bpt id=\"p1\">**</bpt>Import mode is currently not supported with reports written using entity store<ept id=\"p1\">**</ept>.","pos":[8517,8600],"source":"**Import mode is currently not supported with reports written using entity store**."},{"content":"Click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept>.","pos":[8601,8614],"source":" Click **OK**."},{"content":"Next you will see the <bpt id=\"p1\">**</bpt>Navigator<ept id=\"p1\">**</ept> dialog box.","pos":[8619,8666],"source":"Next you will see the **Navigator** dialog box."},{"content":"Navigator enables you to select tables and views from the entity store that you want to report on.","pos":[8667,8765]},{"content":"Enter <bpt id=\"p1\">**</bpt>Sales<ept id=\"p1\">**</ept> in the search box.","pos":[8766,8800],"source":" Enter **Sales** in the search box."},{"content":"The system will filter entities that are related to the <bpt id=\"p1\">**</bpt>SalesCubeV2<ept id=\"p1\">**</ept> aggregate measurement that was previously created.","pos":[8801,8923],"source":" The system will filter entities that are related to the **SalesCubeV2** aggregate measurement that was previously created."},{"content":"<bpt id=\"p1\">**</bpt>Note:<ept id=\"p1\">**</ept> The entity store stages the aggregate measurements that have been created.","pos":[8924,9008],"source":"**Note:** The entity store stages the aggregate measurements that have been created."},{"content":"While entities within each aggregate measurement are prefixed and stored as individual tables, Power BI desktop enables you to combine data from multiple aggregate measurements.","pos":[9009,9186]},{"content":"You will create a report that shows sales by state.","pos":[9191,9242]},{"content":"Select <bpt id=\"p1\">**</bpt>SalesCubeV2<ph id=\"ph1\">\\_</ph>Customer<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>SalesCubeV2<ph id=\"ph2\">\\_</ph>CustomerInvoices<ept id=\"p2\">**</ept> from Navigator and click <bpt id=\"p3\">**</bpt>Load<ept id=\"p3\">**</ept>.","pos":[9243,9348],"source":" Select **SalesCubeV2\\_Customer** and **SalesCubeV2\\_CustomerInvoices** from Navigator and click **Load**."},{"pos":[9353,9503],"content":"You will notice Power BI designer with <bpt id=\"p1\">**</bpt>Fields<ept id=\"p1\">**</ept> present in the entities that you have chosen (on the far right), as well as available visualization.","source":"You will notice Power BI designer with **Fields** present in the entities that you have chosen (on the far right), as well as available visualization."},{"pos":[9509,9624],"content":"Create a surrogate key that links customers and invoices (applies to platform versions before November 2016 update)","linkify":"Create a surrogate key that links customers and invoices (applies to platform versions before November 2016 update)","nodes":[{"content":"Create a surrogate key that links customers and invoices (applies to platform versions before November 2016 update)","pos":[0,115]}]},{"content":"<bpt id=\"p1\">**</bpt>Note:<ept id=\"p1\">**</ept> You do not need to perform this step if you are working on the November 2016 release of the platform or later.","pos":[9626,9746],"source":"**Note:** You do not need to perform this step if you are working on the November 2016 release of the platform or later."},{"content":"Surrogate keys are generated in aggregate measurements staged into entity store.","pos":[9747,9827]},{"content":"Power BI desktop does not enable you to relate table joins using multiple fields (also known as, composite keys).","pos":[9828,9941]},{"content":"The <bpt id=\"p1\">**</bpt>SalesCubeV2<ph id=\"ph1\">\\_</ph>Customer<ept id=\"p1\">**</ept> entity does not have a surrogate key (such as AX RecID) defined in it.","pos":[9942,10042],"source":" The **SalesCubeV2\\_Customer** entity does not have a surrogate key (such as AX RecID) defined in it."},{"content":"Next, you will create a surrogate key that enables relating a customer entity to invoices.","pos":[10043,10133]},{"content":"Select the ellipsis (…) icon next to the <bpt id=\"p1\">**</bpt>SalesCubeV2<ph id=\"ph1\">\\_</ph>CustomerInvoices<ept id=\"p1\">**</ept> entity.","pos":[10139,10221],"source":"Select the ellipsis (…) icon next to the **SalesCubeV2\\_CustomerInvoices** entity."},{"content":"Right-click and select <bpt id=\"p1\">**</bpt>New Column<ept id=\"p1\">**</ept>.","pos":[10222,10260],"source":" Right-click and select **New Column**."},{"pos":[10265,10329],"content":"Enter the following expression in the <bpt id=\"p1\">**</bpt>Formula editor<ept id=\"p1\">**</ept> window.","source":"Enter the following expression in the **Formula editor** window."},{"content":"<bpt id=\"p1\">**</bpt>Note:<ept id=\"p1\">**</ept> When you enter the first few letters of the field name or function, the editor will display a list of candidate fields.","pos":[10469,10598],"source":"**Note:** When you enter the first few letters of the field name or function, the editor will display a list of candidate fields."},{"content":"This is called a type-ahead feature.","pos":[10599,10635]},{"content":"You can either copy and paste this expression or use the type-ahead feature.","pos":[10636,10712]},{"content":"When completed, your formula should look similar to the following.","pos":[10718,10784]},{"pos":[10786,10863],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>Power BI Formula<ept id=\"p1\">](./media/powerbiformula.png)](./media/powerbiformula.png)</ept>","source":"[![Power BI Formula](./media/powerbiformula.png)](./media/powerbiformula.png)"},{"content":"Notice that a new field, <bpt id=\"p1\">**</bpt>FKCustomer<ept id=\"p1\">**</ept>, is shown in the list of fields for the <bpt id=\"p2\">**</bpt>SalesCubeV2<ph id=\"ph1\">\\_</ph>CustomerInvoices<ept id=\"p2\">**</ept> table.","pos":[10869,10989],"source":"Notice that a new field, **FKCustomer**, is shown in the list of fields for the **SalesCubeV2\\_CustomerInvoices** table."},{"content":"Because this field is used to relate two tables, you can hide it from end users by right-clicking the field and selecting the <bpt id=\"p1\">**</bpt>Hide<ept id=\"p1\">**</ept> option.","pos":[10990,11132],"source":" Because this field is used to relate two tables, you can hide it from end users by right-clicking the field and selecting the **Hide** option."},{"content":"Next, create a similar field in the <bpt id=\"p1\">**</bpt>SalesCubeV2<ph id=\"ph1\">\\_</ph>Customer<ept id=\"p1\">**</ept> table.","pos":[11137,11205],"source":"Next, create a similar field in the **SalesCubeV2\\_Customer** table."},{"content":"Select the ellipsis (…) icon next to <bpt id=\"p1\">**</bpt>SalesCubeV2<ph id=\"ph1\">\\_</ph>Customer<ept id=\"p1\">**</ept> entity.","pos":[11206,11276],"source":" Select the ellipsis (…) icon next to **SalesCubeV2\\_Customer** entity."},{"content":"Right-click and select <bpt id=\"p1\">**</bpt>New Column<ept id=\"p1\">**</ept>.","pos":[11277,11315],"source":" Right-click and select **New Column**."},{"pos":[11320,11384],"content":"Enter the following expression in the <bpt id=\"p1\">**</bpt>Formula editor<ept id=\"p1\">**</ept> window.","source":"Enter the following expression in the **Formula editor** window."},{"content":"Notice that the field <bpt id=\"p1\">**</bpt>FKCustomer<ept id=\"p1\">**</ept> is shown in the list of fields for the <bpt id=\"p2\">**</bpt>SalesCubeV2<ph id=\"ph1\">\\_</ph>Customer<ept id=\"p2\">**</ept> table.","pos":[11508,11616],"source":"Notice that the field **FKCustomer** is shown in the list of fields for the **SalesCubeV2\\_Customer** table."},{"content":"Because this field is used for relating two tables, you can hide it from end users by right-clicking the field and selecting the <bpt id=\"p1\">**</bpt>Hide<ept id=\"p1\">**</ept> option.","pos":[11617,11762],"source":" Because this field is used for relating two tables, you can hide it from end users by right-clicking the field and selecting the **Hide** option."},{"pos":[11768,11797],"content":"Relate invoices and customers","linkify":"Relate invoices and customers","nodes":[{"content":"Relate invoices and customers","pos":[0,29]}]},{"content":"<bpt id=\"p1\">**</bpt>Note:<ept id=\"p1\">**</ept> If you are on the November 2016 version of the platform or later, you can relate the surrogate keys already created within entity store.","pos":[11799,11945],"source":"**Note:** If you are on the November 2016 version of the platform or later, you can relate the surrogate keys already created within entity store."},{"content":"If not, you must relate the surrogate keys that you created manually.","pos":[11946,12015]},{"content":"Next you will create a relationship between <bpt id=\"p1\">**</bpt>SalesCubeV2<ph id=\"ph1\">\\_</ph>CustomerInvoices<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>SalesCubeV2<ph id=\"ph2\">\\_</ph>Customers<ept id=\"p2\">**</ept> entities.","pos":[12016,12134],"source":" Next you will create a relationship between **SalesCubeV2\\_CustomerInvoices** and **SalesCubeV2\\_Customers** entities."},{"content":"Click the <bpt id=\"p1\">**</bpt>Manage Relationships<ept id=\"p1\">**</ept> button on the Power BI ribbon.","pos":[12140,12205],"source":"Click the **Manage Relationships** button on the Power BI ribbon."},{"content":"You will see the <bpt id=\"p1\">**</bpt>Manage Relationships<ept id=\"p1\">**</ept> dialog box.","pos":[12206,12259],"source":" You will see the **Manage Relationships** dialog box."},{"content":"Click the <bpt id=\"p1\">**</bpt>New<ept id=\"p1\">**</ept> button.","pos":[12260,12285],"source":" Click the **New** button."},{"content":"In the <bpt id=\"p1\">**</bpt>Create Relationship<ept id=\"p1\">**</ept> dialog box, select <bpt id=\"p2\">**</bpt>SalesCubeV2CustomerInvoices<ept id=\"p2\">**</ept> as the first table in the drop-down list.","pos":[12290,12413],"source":"In the **Create Relationship** dialog box, select **SalesCubeV2CustomerInvoices** as the first table in the drop-down list."},{"content":"Scroll to the right and select the <bpt id=\"p1\">**</bpt>FKCustomer<ept id=\"p1\">**</ept> field as the column to relate to.","pos":[12414,12497],"source":" Scroll to the right and select the **FKCustomer** field as the column to relate to."},{"content":"In the second drop-down list select <bpt id=\"p1\">**</bpt>SalesCubeV2Customer<ept id=\"p1\">**</ept> as the table.","pos":[12502,12575],"source":"In the second drop-down list select **SalesCubeV2Customer** as the table."},{"content":"Scroll to the right and select <bpt id=\"p1\">**</bpt>FKCustomer<ept id=\"p1\">**</ept> as the column to relate to.","pos":[12576,12649],"source":" Scroll to the right and select **FKCustomer** as the column to relate to."},{"content":"Select the <bpt id=\"p1\">**</bpt>Make this relationship active<ept id=\"p1\">**</ept> option if it is not already selected.","pos":[12654,12736],"source":"Select the **Make this relationship active** option if it is not already selected."},{"content":"Click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept> to continue.","pos":[12737,12762],"source":" Click **OK** to continue."},{"content":"You will notice the newly created relationship in the <bpt id=\"p1\">**</bpt>Manage Relationships<ept id=\"p1\">**</ept> dialog box.","pos":[12767,12857],"source":"You will notice the newly created relationship in the **Manage Relationships** dialog box."},{"content":"Click the <bpt id=\"p1\">**</bpt>Close<ept id=\"p1\">**</ept> button.","pos":[12858,12885],"source":" Click the **Close** button."},{"pos":[12891,12921],"content":"Create a Sales by state report","linkify":"Create a Sales by state report","nodes":[{"content":"Create a Sales by state report","pos":[0,30]}]},{"content":"To create a report that shows sales by customer group, drag the <bpt id=\"p1\">**</bpt>CustomerInvoiceAmountAccountingCurrency<ept id=\"p1\">**</ept> field from the <bpt id=\"p2\">**</bpt>SalesCubeV2<ph id=\"ph1\">\\_</ph>CustomerIncoices<ept id=\"p2\">**</ept> table and drop it on the Power BI desktop canvas.","pos":[12927,13133],"source":"To create a report that shows sales by customer group, drag the **CustomerInvoiceAmountAccountingCurrency** field from the **SalesCubeV2\\_CustomerIncoices** table and drop it on the Power BI desktop canvas."},{"content":"Next, drag the <bpt id=\"p1\">**</bpt>CustomerGroupName<ept id=\"p1\">**</ept> field in the <bpt id=\"p2\">**</bpt>SalesCubeV2<ph id=\"ph1\">\\_</ph>Customer<ept id=\"p2\">**</ept> table to the same grid.","pos":[13134,13233],"source":" Next, drag the **CustomerGroupName** field in the **SalesCubeV2\\_Customer** table to the same grid."},{"content":"Change the chart type to a doughnut chart.","pos":[13238,13280]},{"content":"You should see a report similar to the following.","pos":[13281,13330]},{"pos":[13332,13425],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">![</ph>Power BI Doughnut Chart<ept id=\"p1\">](./media/doughnut-chart-1024x733.png)](./media/doughnut-chart.png)</ept>","source":"[![Power BI Doughnut Chart](./media/doughnut-chart-1024x733.png)](./media/doughnut-chart.png)"},{"content":"You can create additional visuals using the Power BI desktop.","pos":[13431,13492]},{"content":"When you save, you will notice that the file has a <bpt id=\"p1\">**</bpt>PBIX<ept id=\"p1\">**</ept> extension.","pos":[13493,13563],"source":" When you save, you will notice that the file has a **PBIX** extension."},{"content":"Save the report to your desktop.","pos":[13568,13600]},{"content":"At this point the report is fully functional (with data from your environment) and you can continue to use the Power BI desktop or upload this report to PowerBI.com and continue with data exploration.","pos":[13605,13805]},{"content":"Next, you will migrate this report to a production environment using LCS so that you can see this report with production data and share it with other users.","pos":[13810,13966]},{"pos":[13971,14003],"content":"Publish the report and the model","linkify":"Publish the report and the model","nodes":[{"content":"Publish the report and the model","pos":[0,32]}]},{"content":"Publishing a report and model requires uploading the report to Lifecycle Services, migrating the aggregate measurement to your production environment, configuring the client to point to the correct LCS library, and publishing your reports in your production environment.","pos":[14004,14274]},{"pos":[14280,14319],"content":"Upload the report to Lifecycle Services","linkify":"Upload the report to Lifecycle Services","nodes":[{"content":"Upload the report to Lifecycle Services","pos":[0,39]}]},{"content":"Microsoft Dynamics Lifecycle Services (LCS) is the tool used to migrate development artifacts from developer to production environments.","pos":[14321,14457]},{"content":"In the May 2016 update, LCS supports migrating PBIX files (authored using the entity store) between environments.","pos":[14458,14571]},{"content":"Launch LCS (<bpt id=\"p1\">[</bpt>http://lcs.dynamics.com<ept id=\"p1\">](http://lcs.dynamics.com/)</ept>) from the developer environment.","pos":[14577,14673],"source":"Launch LCS ([http://lcs.dynamics.com](http://lcs.dynamics.com/)) from the developer environment."},{"content":"If you haven’t created a project in the LCS environment, create a project.","pos":[14674,14748]},{"content":"Scroll to the right and you will notice the <bpt id=\"p1\">**</bpt>Asset Library<ept id=\"p1\">**</ept> icon.","pos":[14753,14820],"source":"Scroll to the right and you will notice the **Asset Library** icon."},{"content":"Click the icon and launch <bpt id=\"p1\">**</bpt>Asset Library<ept id=\"p1\">**</ept>.","pos":[14821,14865],"source":" Click the icon and launch **Asset Library**."},{"pos":[14867,14992],"content":"Notice that the asset library enables adding <bpt id=\"p1\">**</bpt>PowerBI report models<ept id=\"p1\">**</ept> (PBIX files) as implementation artifacts to a project.","source":"Notice that the asset library enables adding **PowerBI report models** (PBIX files) as implementation artifacts to a project."},{"content":"Select the plus (+) icon to add a new asset.","pos":[14998,15042]},{"content":"Provide a name and a description.","pos":[15047,15080]},{"content":"Click <bpt id=\"p1\">**</bpt>Upload<ept id=\"p1\">**</ept> and then locate the file that you saved in an earlier step.","pos":[15081,15157],"source":" Click **Upload** and then locate the file that you saved in an earlier step."},{"content":"After you successfully upload the file, click <bpt id=\"p1\">**</bpt>Confirm<ept id=\"p1\">**</ept>.","pos":[15162,15220],"source":"After you successfully upload the file, click **Confirm**."},{"content":"Notice that the file is uploaded into LCS as an implementation asset.","pos":[15221,15290]},{"content":"LCS supports managing versions and releases for Power BI reports.","pos":[15291,15356]},{"content":"You can maintain several versions and publish reports to other environments, just as you would for other implementation artifacts.","pos":[15357,15487]},{"content":"Because you added the PBIX files as an asset within an LCS project, environments that you deployed using that project will have access to this report.","pos":[15488,15638]},{"content":"Optionally, you can publish this report so that all of your projects can access the shared assets.","pos":[15643,15741]},{"content":"If you are a partner or an ISV, and want to share this report with your customers, you would share this asset to your global library and enable your customers to import the asset into their respective LCS projects.","pos":[15742,15956]},{"content":"To do this, select the <bpt id=\"p1\">**</bpt>Save to my library<ept id=\"p1\">**</ept> option.","pos":[15957,16010],"source":" To do this, select the **Save to my library** option."},{"pos":[16016,16077],"content":"Migrate the aggregate measurement to a production environment","linkify":"Migrate the aggregate measurement to a production environment","nodes":[{"content":"Migrate the aggregate measurement to a production environment","pos":[0,61]}]},{"content":"You need to migrate the aggregate measurement that you modified in the developer environment to the production environment.","pos":[16083,16206]},{"content":"You can follow the instructions in Generate a deployable package.","pos":[16207,16272]},{"content":"create-apply-deployable-package.md.","pos":[16273,16308]},{"pos":[16313,16490],"content":"After you successfully publish the model, perform the steps outlined in the <bpt id=\"p1\">**</bpt>Refresh the entity store<ept id=\"p1\">**</ept> section of this tutorial, so that the entity store is updated with data.","source":"After you successfully publish the model, perform the steps outlined in the **Refresh the entity store** section of this tutorial, so that the entity store is updated with data."},{"pos":[16496,16520],"content":"Configure an LCS project","linkify":"Configure an LCS project","nodes":[{"content":"Configure an LCS project","pos":[0,24]}]},{"content":"If you haven’t already done so, associate your environment with an LCS project so that Dynamics 365 for Operations is able to consume assets within the project.","pos":[16522,16682]},{"content":"Launch the client from the instance that you want to use to deploy the Power BI reports.","pos":[16688,16776]},{"content":"Typically this is the test or a production instance where you want to see a report with a different set of data than what you worked with as a report developer.","pos":[16777,16937]},{"content":"Open <bpt id=\"p1\">**</bpt>System Administration<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Setup<ept id=\"p2\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>System parameters<ept id=\"p3\">**</ept>.","pos":[16942,17015],"source":"Open **System Administration** &gt; **Setup** &gt; **System parameters**."},{"content":"Select the <bpt id=\"p1\">**</bpt>Help<ept id=\"p1\">**</ept> tab.","pos":[17016,17040],"source":" Select the **Help** tab."},{"content":"Using the <bpt id=\"p1\">**</bpt>Lifecycle services help configuration<ept id=\"p1\">**</ept> list box, select the LCS project that you uploaded the PBIX file to.","pos":[17041,17161],"source":" Using the **Lifecycle services help configuration** list box, select the LCS project that you uploaded the PBIX file to."},{"content":"Click <bpt id=\"p1\">**</bpt>Save<ept id=\"p1\">**</ept>.","pos":[17162,17177],"source":" Click **Save**."},{"content":"<bpt id=\"p1\">**</bpt>Note:<ept id=\"p1\">**</ept> This form will only show the LCS projects that the current user has access to.","pos":[17178,17266],"source":"**Note:** This form will only show the LCS projects that the current user has access to."},{"content":"If this step is being performed by an administrator, either the administrator needs to have access to the project, or the PBIX artifacts need to be imported into a project that the administrator has access to.","pos":[17267,17476]},{"pos":[17482,17534],"content":"Publish Power BI reports to a production environment","linkify":"Publish Power BI reports to a production environment","nodes":[{"content":"Publish Power BI reports to a production environment","pos":[0,52]}]},{"content":"Open <bpt id=\"p1\">**</bpt>System Administration<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Setup<ept id=\"p2\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>Deploy PowerBI<ept id=\"p3\">**</ept> from the client.","pos":[17540,17626],"source":"Open **System Administration** &gt; **Setup** &gt; **Deploy PowerBI** from the client."},{"content":"You will see the file that you uploaded to LCS.","pos":[17627,17674]},{"content":"Select the <bpt id=\"p1\">**</bpt>Sales Report<ept id=\"p1\">**</ept> file and select the <bpt id=\"p2\">**</bpt>Deploy Power BI files<ept id=\"p2\">**</ept> option on the menu bar.","pos":[17679,17776],"source":"Select the **Sales Report** file and select the **Deploy Power BI files** option on the menu bar."},{"content":"<bpt id=\"p1\">**</bpt>Note:<ept id=\"p1\">**</ept> You may be asked to consent publishing to the PowerBI.com service.","pos":[17777,17853],"source":"**Note:** You may be asked to consent publishing to the PowerBI.com service."},{"content":"Click the link to provide consent.","pos":[17854,17888]},{"content":"When consent is complete, you need to go back to the original browser window and click the <bpt id=\"p1\">**</bpt>Close<ept id=\"p1\">**</ept> button.","pos":[17889,17997],"source":" When consent is complete, you need to go back to the original browser window and click the **Close** button."},{"content":"After you successfully publish the file, the Power BI report will appear in your PowerBI.com subscription.","pos":[18002,18108]},{"content":"You will notice that the report now points to the entity store in the production environment.","pos":[18109,18202]},{"pos":[18207,18234],"content":"Continuing with PowerBI.com","linkify":"Continuing with PowerBI.com","nodes":[{"content":"Continuing with PowerBI.com","pos":[0,27]}]},{"content":"As an administrator or a power user, you have successfully authored and published a Power BI report to the production environment using the entity store.","pos":[18235,18388]},{"content":"You can perform several additional steps using Power BI functionality.","pos":[18389,18459]},{"content":"Optionally, you can apply record-level security to the dataset to restrict users from seeing data they are not allowed to view in Power BI.","pos":[18465,18604]},{"content":"You can create an organizational content pack and share it among users in a group.","pos":[18609,18691]},{"content":"You can export datasets, reports, and dashboards from your PowerBI.com instance as a new content pack to a selected group of users.","pos":[18700,18831]},{"content":"Note that organizational content packs adhere to any record-level security rules that you defined at the dataset level.","pos":[18840,18959]},{"content":"Users can personalize their workspaces by adding Power BI tiles or reports.","pos":[18964,19039]},{"pos":[19042,19050],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[19061,19134],"content":"<bpt id=\"p1\">[</bpt>Modeling and using aggregate data<ept id=\"p1\">](../analytics/model-aggregate-data.md)</ept>","source":"[Modeling and using aggregate data](../analytics/model-aggregate-data.md)"}],"content":"---\n# required metadata\n\ntitle: Migrate an upgraded Dynamics AX 2012 R3 sales cube to the entity store\ndescription: In this tutorial, you'll migrate an upgraded Microsoft Dynamics AX 2012 R3 cube schema to the entity store in Microsoft Dynamics 365 for Operations. You'll use the sales cube that was included in Dynamics AX 2012 R3 as an example.\nauthor: sericks007\nmanager: AnnBe\nms.date: 04/04/2017\nms.topic: article\nms.prod: \nms.service: Dynamics365Operations\nms.technology: \n\n# optional metadata\n\n# ms.search.form: \n# ROBOTS: \naudience: Developer, IT Pro\n# ms.devlang: \n# ms.reviewer: 61\nms.search.scope: Operations, Platform, AX Platform\n# ms.tgt_pltfrm: \nms.custom: 94203\nms.assetid: e992cdd8-abe8-42d0-97ad-6165822abbba\nms.search.region: Global\n# ms.search.industry: \nms.author: milindav\nms.search.validFrom: 2016-05-31\nms.dyn365.ops.version: Platform update 1\n\n---\n\n# Migrate an upgraded Dynamics AX 2012 R3 sales cube to the entity store\n\nIn this tutorial, you'll migrate an upgraded Microsoft Dynamics AX 2012 R3 cube schema to the entity store in Microsoft Dynamics 365 for Operations. You'll use the sales cube that was included in Dynamics AX 2012 R3 as an example.\n\nThe entity store will support near real-time Microsoft Power BI integration scenarios, as shown in the following diagram. For an overview of Power BI integration with entity store, see [Power BI integration with entity store](https://blogs.msdn.microsoft.com/dynamicsaxbi/2016/06/09/power-bi-integration-with-entity-store-in-dynamics-ax-7-may-update/). [![Power BI Architecture diagram](./media/powerbiarchitecture.png)](./media/powerbiarchitecture.png)\n\n## New Power BI features included in the May 2016 and November 2016 updates\nThis tutorial requires the Dynamics 365 for Operations May 2016 update or later. You will use the following new capabilities in this tutorial:\n\n-   Stage an aggregate measurement in the entity store and refresh the data from Dynamics AX. You might prefer this option over in-memory real time aggregate measurements when:\n    -   You upgrade a Dynamics AX 2012 cube.\n    -   Your aggregate measurements are very large.\n    -   Data freshness (latency) from a few minutes up to a few hours is acceptable for reporting.\n-   Use the batch framework to schedule a recurring refresh. For this release, only a full refresh is enabled.\n-   Create reports using Power BI desktop in a developer/test environment.\n-   Leverage the direct query option when creating Power BI content. For example, you can create larger models without relying on OData as the data refresh mechanism.\n-   Migrate reports from your development environment to a production environment using Lifecycle Services (LCS).\n-   As a partner or an ISV you can distribute Power BI content as part of an LCS solution to your customers.\n-   **If you're using the November update (platform release 1611)** or later, some steps in this document are part of the process to refresh the entity store - you do not need to perform them manually.\n\n## Change upgraded aggregate measurement properties\nAs part of the code upgrade process, analysis services projects from the Application Object Tree (AOT) in Dynamics AX 2012 can be migrated to the new aggregate measurements metadata format.\n\n1.  Launch Visual Studio and create a new project in Application Suite. **Note**: You can create a model and include the customized aggregate measurement within that model. For more information, see [Customization: Overlayering and extensions](..\\extensibility\\customization-overlayering-extensions.md).\n2.  Open Application Explorer. Navigate to **Analytics** &gt; **Perspectives** &gt; **Aggregate measurements**. You will notice a set of aggregate measurements that were upgraded from Dynamics AX 2012 R3, as well as the measurements that ship in the current version of Dynamics 365 for Operations.\n3.  Select **SalesCube**. Right-click and select **Duplicate in project**.\n4.  An aggregate measurement with the name **SalesCubeCopy** will be added to the project.\n5.  Rename this measurement. Select **SalesCubeCopy** in Solution Explorer. Right-click and select **Rename**. Enter **SalesCubeV2** as the new name.\n6.  Double-click **SalesCubeV2** to launch the Aggregate measurement designer. Notice the structure of the aggregate measurement that was migrated from Dynamics AX 2012.\n7.  The Sales cube in Dynamics AX 2012 encompassed a broad subject area related to Sales. In this case, let’s create a smaller, more focused Power BI model using the metadata that was upgraded. Expand the **Sales Order Lines** measure group and review the list of measures and dimension references. **Note:** Leveraging the modeling capabilities you can quickly make a few enhancements to this model. Suggestions for improvements:\n    -   Replace views/tables that have been used to model the measure group (and/or dimensions) with an entity. You can model an entity using the underlying view and replace the view with the corresponding entity. This will enable you to leverage upcoming features such as incremental refresh and security.\n    -   Remove unwanted dimension references by adding the corresponding field to the attributes node. For example, the Sizes dimension reference can be removed because the **Size** field in the measure group is sufficiently descriptive. This will improve the runtime performance of queries as well as refresh times.\n\n8.  Select the **SalesCubeV2** root node in the Aggregate measurement designer. Right-click and select **Properties**.\n9.  During upgrade, aggregate measurements are set to the legacy property flag, **SSASCube**. You need to change this property to one of two supported usage types. Previously, **InMemoryRealTime** was supported as usage for aggregate measurements. **StagedEntityStore** is supported as a new usage type. **Note:** Modify the usage property to InMemoryRealTime if you plan to use the Aggregate measurement for embedded BI scenarios as well as Power BI integration. If you are using the Aggregate measurement only for Power BI or Cortana Intelligence Suite integration, select **StagedEntityStore**.\n10. Save the project. Right-click the project in Solution Explorer and select **Rebuild**.\n11. After the rebuild operation is finished, save the project, and then close Visual Studio. This completes the development work. You will author reports as a report developer or a power user.\n\n## Refresh the entity store\nAs an administrator you can configure the refresh of the aggregate measurement using the client.\n\n1.  Launch the Dynamics AX client and navigate to **System Administration** &gt; **Setup** &gt; **Entity Store**. The **Entity Store** form shows a list of aggregate measurements that are available for deployment to the entity store.\n2.  Notice that **Sales Cube** (which was upgraded from Dynamics AX 2012) is not available for deployment to the entity store. **SalesCubeV2**, which you created in the previous step, can be deployed to the entity store.\n3.  Select **SalesCubeV2** from the list, and click the **Refresh** button. The **Refresh** dialog box will display. Expand the **Run in the background** tab.\n4.  Provide a descriptive name in the **Task description** field. Optionally, you can select the **Recurrence** tab and create a recurring schedule instead of a one-time refresh. Click **OK**.\n5.  The system will create a batch job for refresh of the aggregate measurement in the entity store.\n\n## Authoring a report on Sales by State with Power BI desktop\nThis step requires that you the install Power BI desktop tool that can be downloaded from [Microsoft Power BI Desktop](http://www.microsoft.com/en-us/download/details.aspx?id=45331).\n\n1.  Launch Power BI desktop. You may need to apply updates. A welcome page will display. Click **Get data**.\n2.  Alternatively, when Power BI desktop launches, on the **Home** tab select **Get Data** &gt; **SQL Server**.\n3.  In the **SQL Server Database** dialog box, enter the server name and the name of the entity store database. If you deployed a developer environment, you can enter “.” as the server name and **AxDW** as the database name. If you are working in a test environment, you need to get these parameters from your system administrator\n4.  Select the **DirectQuery** option. In this exercise, you will create Power BI reports that are executed directly on the entity store. If you had used the **Import** option, Power BI would cache data from the entity store and you would need to periodically refresh the Power BI model. **Import mode is currently not supported with reports written using entity store**. Click **OK**.\n5.  Next you will see the **Navigator** dialog box. Navigator enables you to select tables and views from the entity store that you want to report on. Enter **Sales** in the search box. The system will filter entities that are related to the **SalesCubeV2** aggregate measurement that was previously created. **Note:** The entity store stages the aggregate measurements that have been created. While entities within each aggregate measurement are prefixed and stored as individual tables, Power BI desktop enables you to combine data from multiple aggregate measurements.\n6.  You will create a report that shows sales by state. Select **SalesCubeV2\\_Customer** and **SalesCubeV2\\_CustomerInvoices** from Navigator and click **Load**.\n7.  You will notice Power BI designer with **Fields** present in the entities that you have chosen (on the far right), as well as available visualization.\n\n### Create a surrogate key that links customers and invoices (applies to platform versions before November 2016 update)\n\n**Note:** You do not need to perform this step if you are working on the November 2016 release of the platform or later. Surrogate keys are generated in aggregate measurements staged into entity store. Power BI desktop does not enable you to relate table joins using multiple fields (also known as, composite keys). The **SalesCubeV2\\_Customer** entity does not have a surrogate key (such as AX RecID) defined in it. Next, you will create a surrogate key that enables relating a customer entity to invoices.\n\n1.  Select the ellipsis (…) icon next to the **SalesCubeV2\\_CustomerInvoices** entity. Right-click and select **New Column**.\n2.  Enter the following expression in the **Formula editor** window.\n\n```\nFKCustomer = CONCATENATE(CONCATENATE(SalesCubeV2_CustomerInvoices[DATAAREAID], \"-\"), SalesCubeV2_CustomerInvoices[ORDERACCOUNT])\n```\n\n**Note:** When you enter the first few letters of the field name or function, the editor will display a list of candidate fields. This is called a type-ahead feature. You can either copy and paste this expression or use the type-ahead feature.\n\n1.  When completed, your formula should look similar to the following.\n\n[![Power BI Formula](./media/powerbiformula.png)](./media/powerbiformula.png)\n\n1.  Notice that a new field, **FKCustomer**, is shown in the list of fields for the **SalesCubeV2\\_CustomerInvoices** table. Because this field is used to relate two tables, you can hide it from end users by right-clicking the field and selecting the **Hide** option.\n2.  Next, create a similar field in the **SalesCubeV2\\_Customer** table. Select the ellipsis (…) icon next to **SalesCubeV2\\_Customer** entity. Right-click and select **New Column**.\n3.  Enter the following expression in the **Formula editor** window.\n\n```\nFKCustomer = CONCATENATE(CONCATENATE(SalesCubeV2_Customer[DATAAREAID], \"-\"), SalesCubeV2_Customer[CUSTOMER])\n```\n\n1.  Notice that the field **FKCustomer** is shown in the list of fields for the **SalesCubeV2\\_Customer** table. Because this field is used for relating two tables, you can hide it from end users by right-clicking the field and selecting the **Hide** option.\n\n### Relate invoices and customers\n\n**Note:** If you are on the November 2016 version of the platform or later, you can relate the surrogate keys already created within entity store. If not, you must relate the surrogate keys that you created manually. Next you will create a relationship between **SalesCubeV2\\_CustomerInvoices** and **SalesCubeV2\\_Customers** entities.\n\n1.  Click the **Manage Relationships** button on the Power BI ribbon. You will see the **Manage Relationships** dialog box. Click the **New** button.\n2.  In the **Create Relationship** dialog box, select **SalesCubeV2CustomerInvoices** as the first table in the drop-down list. Scroll to the right and select the **FKCustomer** field as the column to relate to.\n3.  In the second drop-down list select **SalesCubeV2Customer** as the table. Scroll to the right and select **FKCustomer** as the column to relate to.\n4.  Select the **Make this relationship active** option if it is not already selected. Click **OK** to continue.\n5.  You will notice the newly created relationship in the **Manage Relationships** dialog box. Click the **Close** button.\n\n### Create a Sales by state report\n\n1.  To create a report that shows sales by customer group, drag the **CustomerInvoiceAmountAccountingCurrency** field from the **SalesCubeV2\\_CustomerIncoices** table and drop it on the Power BI desktop canvas. Next, drag the **CustomerGroupName** field in the **SalesCubeV2\\_Customer** table to the same grid.\n2.  Change the chart type to a doughnut chart. You should see a report similar to the following.\n\n[![Power BI Doughnut Chart](./media/doughnut-chart-1024x733.png)](./media/doughnut-chart.png)\n\n1.  You can create additional visuals using the Power BI desktop. When you save, you will notice that the file has a **PBIX** extension.\n2.  Save the report to your desktop.\n3.  At this point the report is fully functional (with data from your environment) and you can continue to use the Power BI desktop or upload this report to PowerBI.com and continue with data exploration.\n4.  Next, you will migrate this report to a production environment using LCS so that you can see this report with production data and share it with other users.\n\n## Publish the report and the model\nPublishing a report and model requires uploading the report to Lifecycle Services, migrating the aggregate measurement to your production environment, configuring the client to point to the correct LCS library, and publishing your reports in your production environment.\n\n### Upload the report to Lifecycle Services\n\nMicrosoft Dynamics Lifecycle Services (LCS) is the tool used to migrate development artifacts from developer to production environments. In the May 2016 update, LCS supports migrating PBIX files (authored using the entity store) between environments.\n\n1.  Launch LCS ([http://lcs.dynamics.com](http://lcs.dynamics.com/)) from the developer environment. If you haven’t created a project in the LCS environment, create a project.\n2.  Scroll to the right and you will notice the **Asset Library** icon. Click the icon and launch **Asset Library**.\n\nNotice that the asset library enables adding **PowerBI report models** (PBIX files) as implementation artifacts to a project.\n\n1.  Select the plus (+) icon to add a new asset.\n2.  Provide a name and a description. Click **Upload** and then locate the file that you saved in an earlier step.\n3.  After you successfully upload the file, click **Confirm**. Notice that the file is uploaded into LCS as an implementation asset. LCS supports managing versions and releases for Power BI reports. You can maintain several versions and publish reports to other environments, just as you would for other implementation artifacts. Because you added the PBIX files as an asset within an LCS project, environments that you deployed using that project will have access to this report.\n4.  Optionally, you can publish this report so that all of your projects can access the shared assets. If you are a partner or an ISV, and want to share this report with your customers, you would share this asset to your global library and enable your customers to import the asset into their respective LCS projects. To do this, select the **Save to my library** option.\n\n### Migrate the aggregate measurement to a production environment\n\n1.  You need to migrate the aggregate measurement that you modified in the developer environment to the production environment. You can follow the instructions in Generate a deployable package. create-apply-deployable-package.md.\n2.  After you successfully publish the model, perform the steps outlined in the **Refresh the entity store** section of this tutorial, so that the entity store is updated with data.\n\n### Configure an LCS project\n\nIf you haven’t already done so, associate your environment with an LCS project so that Dynamics 365 for Operations is able to consume assets within the project.\n\n1.  Launch the client from the instance that you want to use to deploy the Power BI reports. Typically this is the test or a production instance where you want to see a report with a different set of data than what you worked with as a report developer.\n2.  Open **System Administration** &gt; **Setup** &gt; **System parameters**. Select the **Help** tab. Using the **Lifecycle services help configuration** list box, select the LCS project that you uploaded the PBIX file to. Click **Save**. **Note:** This form will only show the LCS projects that the current user has access to. If this step is being performed by an administrator, either the administrator needs to have access to the project, or the PBIX artifacts need to be imported into a project that the administrator has access to.\n\n### Publish Power BI reports to a production environment\n\n1.  Open **System Administration** &gt; **Setup** &gt; **Deploy PowerBI** from the client. You will see the file that you uploaded to LCS.\n2.  Select the **Sales Report** file and select the **Deploy Power BI files** option on the menu bar. **Note:** You may be asked to consent publishing to the PowerBI.com service. Click the link to provide consent. When consent is complete, you need to go back to the original browser window and click the **Close** button.\n3.  After you successfully publish the file, the Power BI report will appear in your PowerBI.com subscription. You will notice that the report now points to the entity store in the production environment.\n\n## Continuing with PowerBI.com\nAs an administrator or a power user, you have successfully authored and published a Power BI report to the production environment using the entity store. You can perform several additional steps using Power BI functionality.\n\n-   Optionally, you can apply record-level security to the dataset to restrict users from seeing data they are not allowed to view in Power BI.\n-   You can create an organizational content pack and share it among users in a group.\n    -   You can export datasets, reports, and dashboards from your PowerBI.com instance as a new content pack to a selected group of users.\n    -   Note that organizational content packs adhere to any record-level security rules that you defined at the dataset level.\n-   Users can personalize their workspaces by adding Power BI tiles or reports.\n\n\nSee also\n--------\n\n[Modeling and using aggregate data](../analytics/model-aggregate-data.md)\n\n"}